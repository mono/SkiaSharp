parameters:
  name: ''                    # in the form type_platform_host
  displayName: ''             # the human name
  vmImage: ''                 # the VM image
  packages: ''                # any additional packages
  target: ''                  # the bootstrapper target
  dependsOn: []               # the dependiencies
  requiredArtifacts: []       # the artifacts that this build needs to download
  demands: []                 # the demands
  preBuildSteps: []           # any steps to run before the build
  postBuildSteps: []          # any additional steps to run after the build
  additionalArgs: ''          # any additional arguments to pass to the bootstrapper
  retryCount: 1               # the number of times to retry the bootstrapper
  condition: succeeded()      # whether or not to run this template
  shouldPublish: true         # whether or not to publish the artifacts
  downloadExternals: ''       # the build number to use to download externals

jobs:
  - job: ${{ parameters.name }}
    displayName: ${{ parameters.displayName }}
    pool:
      vmImage: ${{ parameters.vmImage }}
    condition: ${{ parameters.condition }}
    steps:
      - checkout: self
      - ${{ if ne(parameters.downloadExternals, '') }}:
         - pwsh: echo "not blank --${{ parameters.downloadExternals }}--"
      - ${{ if eq(parameters.downloadExternals, '') }}:
         - pwsh: echo "blank --${{ parameters.downloadExternals }}--"
      - pwsh: ./scripts/download-externals.ps1 -BuildNumber ${{ parameters.downloadExternals }} -Artifact ${{ parameters.name }}
        displayName: Download the pre-built ${{ parameters.name }} artifacts
      - task: PublishBuildArtifacts@1
        displayName: Publish the ${{ parameters.name }} artifacts
        condition: ${{ parameters.shouldPublish }}
        inputs:
          artifactName: ${{ parameters.name }}
          pathToPublish: 'output'
