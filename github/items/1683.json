{
  "number": 1683,
  "type": "issue",
  "state": "open",
  "title": "[BUG] [iOS] SKGLView Memory Leak compared to SKCanvasView",
  "body": "**Description**\r\n\r\nI\u0027ve been investigating a memory issues i\u0027ve been seeing when using SKGLView compared to SKCanvasView.\r\n\r\nI\u0027m using SkiaScene to handle touch manipulation but I\u0027m fairly confident that isn\u0027t the issue.\r\n\r\nTo better test, I setup my project on iOS with a CADisplayLink to continuously trigger a SetNeedsDisplay on the Skia view so a new render will occur (I found the memory leak like this when I was doing a simple animation using CADisplayLink and left the animation running, its also possible to trigger this by continuously touching the screen triggering a redraw, but obviously thats much more effort to test!).\r\n\r\nMy skia drawing is fairly complex but at the root of it, the current example is basically drawing approximately 30 DrawLine calls and 30 DrawCircle calls every render.\r\n\r\nI\u0027m comparing the exact same code, with the only difference being one uses SKGLView and one uses SKCanvasView. I hook up to the PaintSurface events and the canvas from the surface is passed through the rendering, from what I can tell the reference to the canvas is never stored off anywhere within my logic (or SkiaScene).\r\n\r\nWith SKGLView, after about 1 minute the app completely freezes. No crash or application output is displayed or recieved. Looking at the console for the device the following lines print out...\r\n\r\n\u0060\u0060\u0060\r\nIOReturn IOGPUDevice::new_resource(IOGPUNewResourceArgs *, struct IOGPUNewResourceReturnData *, IOByteCount, uint32_t *): PID 40079 likely leaking IOGPUResource (count=46000)\r\nIOReturn IOGPUDevice::new_resource(IOGPUNewResourceArgs *, struct IOGPUNewResourceReturnData *, IOByteCount, uint32_t *): PID 40079 likely leaking IOGPUResource (count=47000)\r\nIOReturn IOGPUDevice::new_resource(IOGPUNewResourceArgs *, struct IOGPUNewResourceReturnData *, IOByteCount, uint32_t *): PID 40079 likely leaking IOGPUResource (count=48000)\r\nIOReturn IOGPUDevice::new_resource(IOGPUNewResourceArgs *, struct IOGPUNewResourceReturnData *, IOByteCount, uint32_t *): PID 40079 likely leaking IOGPUResource (count=49000)\r\n\u0060\u0060\u0060\r\n\r\nThis continues until count=60000 and then it freezes (always increasing in 1000 increments and freezing at 60000).\r\n\r\nWhen I run the exact same code with SKCanvasView it can run forever (I\u0027ve had the app running for 2hr\u002B on my desk and never had it freeze).\r\n\r\nBelow you can see the Xamarin profiler outputs. The first is the SKGLView and you can see it shoots up to a working set of around 500mb, then decreases and during this time the errors start printing out, and eventually it freezes (flatlines in the profiler).\r\n\r\nThe second is SKCanvasView, you can see my memory increases to a point, then when the continous rendering update occurs the memory basically hovers flat around 185mb (with a slight creep up but I suspect that isn\u0027t Skia related).\r\n\r\n\r\nI\u0027ve checked the Handle on the e.Surface.Canvas in the PaintSurface event when using the SKGLView and it always seems to be the same, so I\u0027m getting the same canvas object through in the PaintSurface event (I think).\r\n\r\nI\u0027m calling Flush on the canvas after rendering.\r\n\r\nAny thoughts?\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.80.2\r\n- IDE:  Visual Studio for Mac\r\n- Platform Target Frameworks:\r\n  - iOS:  Min Deploy Target of 12.0\r\n- Target Devices:  \r\n  - iPhone 6s\r\n  - iPad Mini 4\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\n=== Visual Studio Enterprise 2019 for Mac ===\r\n\r\nVersion 8.9.4 (build 25)\r\nInstallation UUID: 088507f4-3001-4ca4-9722-69b7ab1ca6e1\r\n\tGTK\u002B 2.24.23 (Raleigh theme)\r\n\tXamarin.Mac 6.18.0.23 (d16-6 / 088c73638)\r\n\r\n\tPackage version: 612000125\r\n\r\n=== Mono Framework MDK ===\r\n\r\nRuntime:\r\n\tMono 6.12.0.125 (2020-02/8c552e98bd6) (64-bit)\r\n\tPackage version: 612000125\r\n\r\n=== Roslyn (Language Service) ===\r\n\r\n3.9.0-6.21152.10\u002Bc10f884b30737542ddd84ca889a4aad9281ce210\r\n\r\n=== NuGet ===\r\n\r\nVersion: 5.8.0.6860\r\n\r\n=== .NET Core SDK ===\r\n\r\nSDK: /usr/local/share/dotnet/sdk/5.0.201/Sdks\r\nSDK Versions:\r\n\t5.0.201\r\n\t5.0.103\r\n\t5.0.101\r\n\t5.0.100\r\n\t3.1.407\r\n\t3.1.406\r\n\t3.1.404\r\n\t3.1.403\r\n\t3.1.402\r\n\t3.1.401\r\n\t3.1.302\r\n\t3.1.301\r\n\t3.1.300\r\n\t3.1.202\r\n\t3.1.200\r\n\t3.1.102\r\nMSBuild SDKs: /Applications/Visual Studio.app/Contents/Resources/lib/monodevelop/bin/MSBuild/Current/bin/Sdks\r\n\r\n=== .NET Core Runtime ===\r\n\r\nRuntime: /usr/local/share/dotnet/dotnet\r\nRuntime Versions:\r\n\t5.0.4\r\n\t5.0.3\r\n\t5.0.1\r\n\t5.0.0\r\n\t3.1.13\r\n\t3.1.12\r\n\t3.1.10\r\n\t3.1.9\r\n\t3.1.8\r\n\t3.1.7\r\n\t3.1.6\r\n\t3.1.5\r\n\t3.1.4\r\n\t3.1.2\r\n\t2.1.23\r\n\t2.1.22\r\n\t2.1.21\r\n\t2.1.20\r\n\t2.1.19\r\n\t2.1.18\r\n\t2.1.17\r\n\t2.1.16\r\n\r\n=== .NET Core 3.1 SDK ===\r\n\r\nSDK: 3.1.407\r\n\r\n=== Xamarin.Profiler ===\r\n\r\nVersion: 1.6.13.11\r\nLocation: /Applications/Xamarin Profiler.app/Contents/MacOS/Xamarin Profiler\r\n\r\n=== Updater ===\r\n\r\nVersion: 11\r\n\r\n=== Xamarin Designer ===\r\n\r\nVersion: 16.9.0.316\r\nHash: 2241b204a\r\nBranch: tags/vsm-rel/d16.9-4540908\r\nBuild date: 2021-03-10 21:18:10 UTC\r\n\r\n=== Apple Developer Tools ===\r\n\r\nXcode 12.4 (17801)\r\nBuild 12D4e\r\n\r\n=== Xamarin.Mac ===\r\n\r\nVersion: 7.8.2.5 (Visual Studio Enterprise)\r\nHash: 3836759d4\r\nBranch: d16-9\r\nBuild date: 2021-02-10 17:56:43-0500\r\n\r\n=== Xamarin.iOS ===\r\n\r\nVersion: 14.14.2.5 (Visual Studio Enterprise)\r\nHash: 3836759d4\r\nBranch: d16-9\r\nBuild date: 2021-02-10 17:56:44-0500\r\n\r\n=== Xamarin.Android ===\r\n\r\nVersion: 11.2.2.1 (Visual Studio Enterprise)\r\nCommit: xamarin-android/d16-9/877f572\r\nAndroid SDK: /Users/iainstanford/Library/Developer/Xamarin/android-sdk-macosx\r\n\tSupported Android versions:\r\n\t\t5.1 (API level 22)\r\n\t\t6.0 (API level 23)\r\n\t\t7.1 (API level 25)\r\n\t\t8.1 (API level 27)\r\n\r\nSDK Tools Version: 26.1.1\r\nSDK Platform Tools Version: 31.0.0\r\nSDK Build Tools Version: 30.0.3\r\n\r\nBuild Information: \r\nMono: 5e9cb6d\r\nJava.Interop: xamarin/java.interop/d16-9@54f8c24\r\nProGuard: Guardsquare/proguard/v7.0.1@912d149\r\nSQLite: xamarin/sqlite/3.34.1@daff8f4\r\nXamarin.Android Tools: xamarin/xamarin-android-tools/d16-9@d210f11\r\n\r\n=== Microsoft OpenJDK for Mobile ===\r\n\r\nJava SDK: /Users/iainstanford/Library/Developer/Xamarin/jdk/microsoft_dist_openjdk_1.8.0.25\r\n1.8.0-25\r\nAndroid Designer EPL code available here:\r\nhttps://github.com/xamarin/AndroidDesigner.EPL\r\n\r\n=== Android SDK Manager ===\r\n\r\nVersion: 16.9.0.22\r\nHash: a391de2\r\nBranch: remotes/origin/d16-9~2\r\nBuild date: 2021-03-24 08:30:26 UTC\r\n\r\n=== Android Device Manager ===\r\n\r\nVersion: 16.9.0.17\r\nHash: fc2b3db\r\nBranch: remotes/origin/dev/jmt/d16-9bump~1\r\nBuild date: 2021-03-24 08:30:44 UTC\r\n\r\n=== Build Information ===\r\n\r\nRelease ID: 809040025\r\nGit revision: 5d0f80a4343884101c6c7869bc61d5101cf30052\r\nBuild date: 2021-03-25 08:43:13-04\r\nBuild branch: release-8.9\r\nXamarin extensions: 5d0f80a4343884101c6c7869bc61d5101cf30052\r\n\r\n=== Operating System ===\r\n\r\nMac OS X 10.15.7\r\nDarwin 19.6.0 Darwin Kernel Version 19.6.0\r\n    Thu Oct 29 22:56:45 PDT 2020\r\n    root:xnu-6153.141.2.2~1/RELEASE_X86_64 x86_64\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\r\nSKGLView Memory Usage:\r\n![Screenshot 2021-04-07 at 08 50 51](https://user-images.githubusercontent.com/16193452/113833087-273fcc80-9781-11eb-9166-48a8d088ce7d.png)\r\n\r\nSKCanvasView Memory Usage:\r\n![Screenshot 2021-04-07 at 09 09 21](https://user-images.githubusercontent.com/16193452/113833095-29a22680-9781-11eb-8e79-82f7b5797319.png)\r\n\r\n",
  "author": {
    "login": "IainS1986",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2021-04-07T08:11:21",
  "updatedAt": "2023-10-07T00:18:12",
  "commentCount": 8,
  "reactionCount": 1,
  "engagement": {
    "syncedAt": "2026-02-04T20:24:18.6101982Z",
    "reactions": [
      {
        "user": "nor0x",
        "content": "eyes",
        "createdAt": "2026-02-04T20:24:18.6102079Z"
      }
    ],
    "comments": [
      {
        "id": 815486443,
        "author": "radev8",
        "createdAt": "2021-04-08T06:28:08",
        "reactions": []
      },
      {
        "id": 815509116,
        "author": "IainS1986",
        "createdAt": "2021-04-08T07:07:24",
        "reactions": []
      },
      {
        "id": 914066910,
        "author": "charlenni",
        "createdAt": "2021-09-07T07:38:23",
        "reactions": []
      },
      {
        "id": 914076056,
        "author": "IainS1986",
        "createdAt": "2021-09-07T07:52:52",
        "reactions": []
      },
      {
        "id": 914114298,
        "author": "charlenni",
        "createdAt": "2021-09-07T08:48:31",
        "reactions": []
      },
      {
        "id": 914131340,
        "author": "charlenni",
        "createdAt": "2021-09-07T09:08:39",
        "reactions": []
      },
      {
        "id": 914139405,
        "author": "IainS1986",
        "createdAt": "2021-09-07T09:19:16",
        "reactions": []
      },
      {
        "id": 1750316461,
        "author": "najak3d",
        "createdAt": "2023-10-06T09:54:59",
        "reactions": []
      }
    ]
  }
}