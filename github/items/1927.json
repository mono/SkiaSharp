{
  "number": 1927,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] GLFW and SkiaSharp code was working and now window closes silently",
  "body": "**Description**\r\n\r\nHello! I previously had some code working that integrated Silk.NET\u0027s windowing abstractions and SkiaSharp, and this was all several months ago. When I loaded it up this week, it still worked, but then the window would just close and the program would exit without any reported errors or exceptions.\r\n\r\nThis week, I made a decision to start working directly with Silk.NET\u0027s GLFW bindings and have now recreated my previous examples that has SkiaSharp drawing to a context provided by a GLFW window. However, I am still getting this silent close. The window runs for a couple of seconds and then just closes.\r\n\r\nAt one point, something mentioning an error or something about \u0060assert(SkTFitsIn\u003Cint\u003E(count)\u0060 was printed to the terminal, but that only happened once, strangely enough. I didn\u0027t copy the whole line.\r\n\r\n**Code**\r\n\r\nDependencies:\r\n\r\n* SkiaSharp\r\n* Silk.NET.GLFW\r\n\r\nThe following code is the entire program needed to reproduce this issue. I\u0027ve attached a .zip of the solution.\r\n\r\n\u0060\u0060\u0060fsharp\r\nopen FSharp.NativeInterop\r\nopen Silk.NET.GLFW\r\nopen SkiaSharp\r\n\r\n[\u003CEntryPoint\u003E]\r\nlet main argv =\r\n    let width = 500\r\n    let height = 500\r\n\r\n    ///////////////////////////////////////\r\n    /// GLFW setup ////////////////////////\r\n    ///////////////////////////////////////\r\n\r\n    let glfw = Glfw.GetApi()\r\n    glfw.Init() |\u003E printfn \u0022Initialized?: %A\u0022\r\n    glfw.WindowHint(WindowHintInt.ContextVersionMajor, 3)\r\n    glfw.WindowHint(WindowHintInt.ContextVersionMinor, 3)\r\n    glfw.WindowHint(WindowHintBool.OpenGLForwardCompat, true)\r\n    glfw.WindowHint(WindowHintOpenGlProfile.OpenGlProfile, OpenGlProfile.Core)\r\n    let window = glfw.CreateWindow(500, 500, \u0022Test Window\u0022, NativePtr.ofNativeInt 0n, NativePtr.ofNativeInt 0n)\r\n    printfn \u0022Window: %A\u0022 window\r\n    glfw.MakeContextCurrent(window)\r\n    let mutable error = nativeint\u003Cbyte\u003E 0uy |\u003E NativePtr.ofNativeInt\r\n    glfw.GetError(\u0026error) |\u003E printfn \u0022Error: %A\u0022\r\n\r\n    ///////////////////////////////////////\r\n    /// SkiaSharp setup ///////////////////\r\n    ///////////////////////////////////////\r\n\r\n    let grGlInterface = GRGlInterface.Create(fun name -\u003E glfw.GetProcAddress(name))\r\n\r\n    if not(grGlInterface.Validate())\r\n    then raise (System.Exception(\u0022Invalid GRGlInterface\u0022))\r\n\r\n    let grContext = GRContext.CreateGl(grGlInterface)\r\n    let grGlFramebufferInfo = new GRGlFramebufferInfo(0u, uint32(0x8058))\r\n\r\n    ///////////////////////////////////////\r\n    /// Render loop ///////////////////////\r\n    ///////////////////////////////////////\r\n\r\n    while not (glfw.WindowShouldClose(window)) do\r\n        grContext.ResetContext()\r\n        use grBackendRenderTarget = new GRBackendRenderTarget(2*width, 2*height, 1, 0, grGlFramebufferInfo)\r\n        let surface = SKSurface.Create(grContext, grBackendRenderTarget, GRSurfaceOrigin.BottomLeft, SKColorType.Rgba8888)\r\n        let canvas = surface.Canvas\r\n        canvas.Clear(SKColors.Cyan)\r\n        use red = new SKPaint(Color = SKColor(byte(255), byte(0), byte(0), byte(255)))\r\n        canvas.DrawCircle(float32(width), float32(height), float32(100), red)\r\n        canvas.Flush()\r\n\r\n        glfw.SwapBuffers(window)\r\n        glfw.PollEvents()\r\n        \r\n    glfw.DestroyWindow(window)\r\n    glfw.Terminate()\r\n\r\n    0 // return an integer exit code\r\n\u0060\u0060\u0060\r\nPotentially helpful debug information is that if the \u0060canvas.DrawCircle\u0060 method or the \u0060canvas.Flush()\u0060 method is commented out, then the window successfully stays open until the user closes it. So something seems to be going wrong there.\r\n\r\n**Questions**\r\n\r\nI have some questions about this code and interaction between GLFW and SkiaSharp.\r\n\r\n1. Is this the appropriate way to pass the OpenGL context to SkiaSharp and setup a canvas?\r\n    - My goal is to have GLFW handle the window and events and to have a SkiaSharp canvas take up the entire window in which I will draw into to handle all graphics and drawing.\r\n2. Note that in the above code, for this to work properly, the size of the \u0060GRBackendRenderTarget\u0060 needs to be double that of the GLFW window. Similarly, the coordinates of the canvas need to be doubled to be in the right spot. Note how the circle is drawn at coordinates \u0060width, height\u0060 of the window, but the circle actually appears at the center. Does anyone know why this might be?\r\n\r\n**Expected Behavior**\r\n\r\nThe general expected behavior is that the window will stay open while the rendering loop executes and until the window is closed. This is what is now not working. However, this assumes that I am doing things correctly, which may not be the case.\r\n\r\n**Actual Behavior**\r\n\r\nAfter a few seconds of running, the window suddenly closes without any exceptions or errors reported.\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  \u00602.80.3\u0060\r\n- Last known good version:  From what I can tell, I was also using \u00602.80.3\u0060 back in November 2021.\r\n- IDE: Visual Studio for Mac 2019, which is using .NET 5\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - macOS: 12.0.1 (Monterey). This is the one thing that definitely did change since I last tried this.\r\n- Target Devices: Apple MacBook Pro (x86)\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nPASTE ANY DETAILED VERSION INFO HERE\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n**Reproduction Link**\r\n\r\nSee attached solution and project.\r\n[GLFWandSkiaSharp.zip](https://github.com/mono/SkiaSharp/files/7917718/GLFWandSkiaSharp.zip)\r\n\r\n",
  "author": {
    "login": "bmitc",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-01-22T06:00:41",
  "updatedAt": "2022-09-19T21:01:16",
  "closedAt": "2022-08-20T20:14:21",
  "commentCount": 2,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:30:18.0835327Z",
    "reactions": [],
    "comments": [
      {
        "id": 1086365146,
        "author": "bmitc",
        "createdAt": "2022-04-01T22:01:25",
        "reactions": []
      },
      {
        "id": 1221400485,
        "author": "bmitc",
        "createdAt": "2022-08-20T20:14:21",
        "reactions": []
      }
    ]
  }
}