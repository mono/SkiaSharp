{
  "number": 3103,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SkiaSharp v3.116.0 System.TypeInitializationException when executing as Azure Linux Function (.NET 9.0 - isolated)",
  "body": "### Description\r\n\r\nThe following code executes successfully...\r\n\r\n1. when executed locally within VS2022.\r\n2. when executed within Docker desktop\r\n\r\nbut fails when executed as an Azure Linux Function app (.NET 9.0 - isolated).\r\n\r\n\r\n\r\n### Code\r\n\r\nThe test project: https://github.com/HmichaelG/SkiaTest\r\n\r\n**program.cs**\r\n\r\n\u0060\u0060\u0060cs\r\nusing Microsoft.Azure.Functions.Worker.Builder;\r\nusing Microsoft.Extensions.Hosting;\r\n\r\nvar builder = FunctionsApplication.CreateBuilder(args);\r\n\r\nbuilder.ConfigureFunctionsWebApplication();\r\n\r\n// Application Insights isn\u0027t enabled by default. See https://aka.ms/AAt8mw4.\r\n// builder.Services\r\n//     .AddApplicationInsightsTelemetryWorkerService()\r\n//     .ConfigureFunctionsApplicationInsights();\r\n\r\nbuilder.Build().Run();\r\n\r\n\u0060\u0060\u0060\r\n**function**\r\n\u0060\u0060\u0060cs\r\nusing System;\r\nusing Microsoft.Azure.Functions.Worker;\r\nusing Microsoft.Extensions.Logging;\r\nusing SkiaSharp;\r\nusing System.IO;\r\n\r\nnamespace SkiaTest\r\n{\r\n    public class SkiaTest\r\n    {\r\n        private readonly ILogger _logger;\r\n\r\n        public SkiaTest(ILoggerFactory loggerFactory)\r\n        {\r\n            _logger = loggerFactory.CreateLogger\u003CSkiaTest\u003E();\r\n        }\r\n\r\n        [Function(\u0022SkiaTest\u0022)]\r\n        public void Run([TimerTrigger(\u00220 */5 * * * *\u0022, RunOnStartup = true)] TimerInfo myTimer)\r\n        {\r\n            var path = Path.GetTempPath();\r\n            var outputFile = Path.Combine(path, \u0022report.pdf\u0022);\r\n\r\n            _logger.LogInformation(\u0022Writing to file...\u0022);\r\n            // Create a PDF document\r\n            var metadata = new SKDocumentPdfMetadata\r\n            {\r\n                Author = \u0022Your Name\u0022,\r\n                Title = \u0022Sample PDF Report\u0022,\r\n                Creation = DateTime.Now,\r\n                Modified = DateTime.Now\r\n            };\r\n\r\n            using (var stream = File.Create(outputFile))\r\n            {\r\n                var document = SKDocument.CreatePdf(stream, metadata);\r\n                using (var canvas = document.BeginPage(612, 792)) // A4 size in points\r\n                {\r\n                    canvas.Clear(SKColors.White);\r\n                    using (var paint = new SKPaint\r\n                    {\r\n                        Color = SKColors.Black,\r\n                        TextSize = 24\r\n                    })\r\n                    {\r\n                        canvas.DrawText(\u0022Hello, World!\u0022, 100, 100, paint);\r\n                    }\r\n                }\r\n                document.EndPage();\r\n                document.Close();\r\n            }\r\n            _logger.LogInformation($\u0022File written to: {outputFile}\u0022);\r\n\r\n            if (myTimer.ScheduleStatus is not null)\r\n            {\r\n                _logger.LogInformation($\u0022Next timer schedule at: {myTimer.ScheduleStatus.Next}\u0022);\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n\r\n\u0060\u0060\u0060\r\n\r\n\r\n### Expected Behavior\r\n\r\na report named \u0022report.pdf\u0022 be created in the temp directory.\r\n\r\n### Actual Behavior\r\n\r\n\u0060\u0060\u0060\r\nResult: Function \u0027SkiaTest\u0027, Invocation id \u00270245d8d8-2e4c-4d91-8363-5828a29c182a\u0027: An exception was thrown by the invocation.\r\nException: System.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKAbstractManagedWStream\u0027 threw an exception.\r\n ---\u003E System.DllNotFoundException: Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies. In order to help diagnose loading problems, consider using a tool like strace. If you\u0027re using glibc, consider setting the LD_DEBUG environment variable: \r\n/usr/share/dotnet/shared/Microsoft.NETCore.App/9.0.0/libSkiaSharp.so: cannot open shared object file: No such file or directory\r\n/home/site/wwwroot/libSkiaSharp.so: cannot open shared object file: No such file or directory\r\n/usr/share/dotnet/shared/Microsoft.NETCore.App/9.0.0/liblibSkiaSharp.so: cannot open shared object file: No such file or directory\r\n/home/site/wwwroot/liblibSkiaSharp.so: cannot open shared object file: No such file or directory\r\n/usr/share/dotnet/shared/Microsoft.NETCore.App/9.0.0/libSkiaSharp: cannot open shared object file: No such file or directory\r\n/home/site/wwwroot/libSkiaSharp: cannot open shared object file: No such file or directory\r\n/usr/share/dotnet/shared/Microsoft.NETCore.App/9.0.0/liblibSkiaSharp: cannot open shared object file: No such file or directory\r\n/home/site/wwwroot/liblibSkiaSharp: cannot open shared object file: No such file or directory\r\n\r\n   at SkiaSharp.SkiaApi.sk_managedwstream_set_procs(SKManagedWStreamDelegates procs)\r\n   at SkiaSharp.SkiaApi.sk_managedwstream_set_procs(SKManagedWStreamDelegates procs)\r\n   at SkiaSharp.SKAbstractManagedWStream..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at SkiaSharp.SKAbstractManagedWStream..ctor(Boolean owns)\r\n   at SkiaSharp.SKManagedWStream..ctor(Stream managedStream, Boolean disposeManagedStream, Boolean owns)\r\n   at SkiaSharp.SKManagedWStream..ctor(Stream managedStream, Boolean disposeManagedStream)\r\n   at SkiaSharp.SKManagedWStream..ctor(Stream managedStream)\r\n   at SkiaSharp.SKDocument.CreatePdf(Stream stream, SKDocumentPdfMetadata metadata)\r\n   at SkiaTest.SkiaTest.Run(TimerInfo myTimer) in D:\\source\\FunctionAppLatest\\FunctionApp1\\SkiaTest.cs:line 36\r\n   at SkiaTest.DirectFunctionExecutor.ExecuteAsync(FunctionContext context) in D:\\source\\FunctionAppLatest\\FunctionApp1\\obj\\Release\\net9.0\\linux-x64\\Microsoft.Azure.Functions.Worker.Sdk.Generators\\Microsoft.Azure.Functions.Worker.Sdk.Generators.FunctionExecutorGenerator\\GeneratedFunctionExecutor.g.cs:line 37\r\n   at Microsoft.Azure.Functions.Worker.OutputBindings.OutputBindingsMiddleware.Invoke(FunctionContext context, FunctionExecutionDelegate next) in D:\\a\\_work\\1\\s\\src\\DotNetWorker.Core\\OutputBindings\\OutputBindingsMiddleware.cs:line 13\r\n   at Microsoft.Azure.Functions.Worker.Extensions.Http.AspNetCore.FunctionsHttpProxyingMiddleware.Invoke(FunctionContext context, FunctionExecutionDelegate next) in D:\\a\\_work\\1\\s\\extensions\\Worker.Extensions.Http.AspNetCore\\src\\FunctionsMiddleware\\FunctionsHttpProxyingMiddleware.cs:line 38\r\n   at Microsoft.Azure.Functions.Worker.FunctionsApplication.InvokeFunctionAsync(FunctionContext context) in D:\\a\\_work\\1\\s\\src\\DotNetWorker.Core\\FunctionsApplication.cs:line 96\r\nStack:    at SkiaSharp.SKAbstractManagedWStream..ctor(Boolean owns)\r\n   at SkiaSharp.SKManagedWStream..ctor(Stream managedStream, Boolean disposeManagedStream, Boolean owns)\r\n   at SkiaSharp.SKManagedWStream..ctor(Stream managedStream, Boolean disposeManagedStream)\r\n   at SkiaSharp.SKManagedWStream..ctor(Stream managedStream)\r\n   at SkiaSharp.SKDocument.CreatePdf(Stream stream, SKDocumentPdfMetadata metadata)\r\n   at SkiaTest.SkiaTest.Run(TimerInfo myTimer) in D:\\source\\FunctionAppLatest\\FunctionApp1\\SkiaTest.cs:line 36\r\n   at SkiaTest.DirectFunctionExecutor.ExecuteAsync(FunctionContext context) in D:\\source\\FunctionAppLatest\\FunctionApp1\\obj\\Release\\net9.0\\linux-x64\\Microsoft.Azure.Functions.Worker.Sdk.Generators\\Microsoft.Azure.Functions.Worker.Sdk.Generators.FunctionExecutorGenerator\\GeneratedFunctionExecutor.g.cs:line 37\r\n   at Microsoft.Azure.Functions.Worker.OutputBindings.OutputBindingsMiddleware.Invoke(FunctionContext context, FunctionExecutionDelegate next) in D:\\a\\_work\\1\\s\\src\\DotNetWorker.Core\\OutputBindings\\OutputBindingsMiddleware.cs:line 13\r\n   at Microsoft.Azure.Functions.Worker.Extensions.Http.AspNetCore.FunctionsHttpProxyingMiddleware.Invoke(FunctionContext context, FunctionExecutionDelegate next) in D:\\a\\_work\\1\\s\\extensions\\Worker.Extensions.Http.AspNetCore\\src\\FunctionsMiddleware\\FunctionsHttpProxyingMiddleware.cs:line 38\r\n   at Microsoft.Azure.Functions.Worker.FunctionsApplication.InvokeFunctionAsync(FunctionContext context) in D:\\a\\_work\\1\\s\\src\\DotNetWorker.Core\\FunctionsApplication.cs:line 96 \r\n\u0060\u0060\u0060 \r\n\r\n### Version of SkiaSharp\r\n\r\n3.116.0 (Current)\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\n2.88.7 (Deprecated)\r\n\r\n### IDE / Editor\r\n\r\nVisual Studio (Windows)\r\n\r\n### Platform / Operating System\r\n\r\nLinux\r\n\r\n### Platform / Operating System Version\r\n\r\nAzure Linux Function app - .NET 9.0\r\n\r\n**Please note this appears to be a .NET 9.0 issue.\r\nSkiaSharp 2.88.7 works fine on .NET 8.0\r\nSkiaSharp 2.887 \u002B fails on .NET 9.0**\r\n\r\n### Devices\r\n\r\nNot applicable\r\n\r\n### Relevant Screenshots\r\n\r\n_No response_\r\n\r\n### Relevant Log Output\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "HmichaelG",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2024-12-05T01:15:16",
  "updatedAt": "2025-01-17T20:40:33",
  "commentCount": 2,
  "reactionCount": 2,
  "engagement": {
    "syncedAt": "2026-02-04T19:57:07.785729Z",
    "reactions": [
      {
        "user": "IngweLand",
        "content": "\u002B1",
        "createdAt": "2026-02-04T19:57:07.7857316Z"
      },
      {
        "user": "tormodfj",
        "content": "\u002B1",
        "createdAt": "2026-02-04T19:57:07.7857322Z"
      }
    ],
    "comments": [
      {
        "id": 2581456280,
        "author": "IngweLand",
        "createdAt": "2025-01-09T23:41:25",
        "reactions": []
      },
      {
        "id": 2599153792,
        "author": "IngweLand",
        "createdAt": "2025-01-17T20:40:32",
        "reactions": []
      }
    ]
  }
}