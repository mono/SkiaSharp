{
  "number": 1984,
  "type": "issue",
  "state": "open",
  "title": "[BUG][macOS] \u0060SKImage\u0060 \u0060ToTextureImage\u0060 causes native crash",
  "body": "**Description**\r\nI have a Xamarin.Mac application where i\u0027m trying to create a GPU backed image by calling \u0060.ToTextureImage(context)\u0060 on a \u0060SKImage\u0060 object, the \u0060context\u0060 is coming from the \u0060SKMetalView\u0060.\r\n\r\nThis call crashes my application and leads to the following output\r\n\u0060\u0060\u0060\r\n\r\n=================================================================\r\n\tNative Crash Reporting\r\n=================================================================\r\nGot a segv while executing native code. This usually indicates\r\na fatal error in the mono runtime or one of the native libraries \r\nused by your application.\r\n=================================================================\r\n\r\n=================================================================\r\n\tNative stacktrace:\r\n=================================================================\r\n\t0x106b10af6 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_dump_native_crash_info\r\n\t0x106b0466e - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_handle_native_crash\r\n\t0x106dcaee7 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : altstack_handle_and_restore.cold.1\r\n\t0x106a8073e - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : altstack_handle_and_restore\r\n\t0x7ffa0e1375ec - /System/Library/Extensions/AppleIntelKBLGraphicsMTLDriver.bundle/Contents/MacOS/AppleIntelKBLGraphicsMTLDriver : _ZN27IGAccelRenderCommandEncoder16setPipelineStateEP24MTLIGRenderPipelineState\r\n\t0x10883e4da - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : _ZN18GrMtlCommandBuffer18encodeWaitForEventEPU18objcproto8MTLEvent11objc_objecty\r\n\t0x1086bf373 - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x10874d147 - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x1086c1917 - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x1086c17bf - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x1086b210f - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x1086b1a1e - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x1086b22dd - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x1086e7cf0 - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x1087a02f6 - /Users/johnny/MyApp.app/Contents/MonoBundle/libSkiaSharp.dylib : gr_backendrendertarget_get_gl_framebufferinfo\r\n\t0x12650d2bb - Unknown\r\n\t0x12650cf0b - Unknown\r\n\t0x150bf9e6b - Unknown\r\n\t0x150bfa494 - Unknown\r\n\t0x106b1b443 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_jit_runtime_invoke\r\n\t0x106c4fa68 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_runtime_invoke_checked\r\n\t0x106c5434e - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_runtime_invoke\r\n\t0x10696b14c - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : xamarin_invoke_trampoline\r\n\t0x10696cee9 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : xamarin_arch_trampoline\r\n\t0x10696e0c6 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : xamarin_x86_64_common_trampoline\r\n\t0x7ff811f16b0c - /System/Library/Frameworks/MetalKit.framework/Versions/A/MetalKit : -[MTKView draw]\r\n\t0x7ff811f169ef - /System/Library/Frameworks/MetalKit.framework/Versions/A/MetalKit : __23-[MTKView __initCommon]_block_invoke\r\n\t0x7ff802c45317 - /usr/lib/system/libdispatch.dylib : _dispatch_client_callout\r\n\t0x7ff802c47d7c - /usr/lib/system/libdispatch.dylib : _dispatch_continuation_pop\r\n\t0x7ff802c59208 - /usr/lib/system/libdispatch.dylib : _dispatch_source_invoke\r\n\t0x7ff802c51bb1 - /usr/lib/system/libdispatch.dylib : _dispatch_main_queue_drain\r\n\t0x7ff802c518bb - /usr/lib/system/libdispatch.dylib : _dispatch_main_queue_callback_4CF\r\n\t0x7ff802f049c7 - /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation : __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__\r\n\t0x7ff802ec593f - /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation : __CFRunLoopRun\r\n\t0x7ff802ec47ac - /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation : CFRunLoopRunSpecific\r\n\t0x7ff80bb4bce6 - /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/HIToolbox.framework/Versions/A/HIToolbox : RunCurrentEventLoopInMode\r\n\t0x7ff80bb4b913 - /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/HIToolbox.framework/Versions/A/HIToolbox : ReceiveNextEventCommon\r\n\t0x7ff80bb4b7e5 - /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/HIToolbox.framework/Versions/A/HIToolbox : _BlockUntilNextEventMatchingListInModeWithFilter\r\n\t0x7ff8058eb5cd - /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit : _DPSNextEvent\r\n\t0x7ff8058e9c8a - /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit : -[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:]\r\n\t0x7ff8058dc339 - /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit : -[NSApplication run]\r\n\t0x7ff8058b02b7 - /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit : NSApplicationMain\r\n\t0x11364d687 - Unknown\r\n\t0x1135d04e3 - Unknown\r\n\t0x107b7c953 - Unknown\r\n\t0x107b7d1c1 - Unknown\r\n\t0x106b1b443 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_jit_runtime_invoke\r\n\t0x106c4fa68 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_runtime_invoke_checked\r\n\t0x106c56e35 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_runtime_exec_main_checked\r\n\t0x106a7656c - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_jit_exec\r\n\t0x106a79608 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : mono_main\r\n\t0x10696ea79 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : xamarin_main\r\n\t0x10696f884 - /Users/johnny/MyApp.app/Contents/MacOS/MyApp : main\r\n\t0x10e08b51e - Unknown\r\n\r\n=================================================================\r\n\tTelemetry Dumper:\r\n=================================================================\r\nPkilling 0x123145609048064x from 0x4530923008x\r\nPkilling 0x123145566859264x from 0x4530923008x\r\nPkilling 0x123145615376384x from 0x4530923008x\r\nPkilling 0x123145573187584x from 0x4530923008x\r\nPkilling 0x123145500319744x from 0x4530923008x\r\nPkilling 0x123145621704704x from 0x4530923008x\r\nPkilling 0x123145579515904x from 0x4530923008x\r\nPkilling 0x123145537327104x from 0x4530923008x\r\nPkilling 0x123145520414720x from 0x4530923008x\r\nPkilling 0x123145543655424x from 0x4530923008x\r\nPkilling 0x123145585844224x from 0x4530923008x\r\nPkilling 0x123145526743040x from 0x4530923008x\r\nPkilling 0x123145549983744x from 0x4530923008x\r\nPkilling 0x123145592172544x from 0x4530923008x\r\nPkilling 0x123145509830656x from 0x4530923008x\r\nPkilling 0x123145598500864x from 0x4530923008x\r\nPkilling 0x123145556312064x from 0x4530923008x\r\nPkilling 0x123145604829184x from 0x4530923008x\r\nPkilling 0x123145562640384x from 0x4530923008x\r\nPkilling 0x123145611157504x from 0x4530923008x\r\nPkilling 0x123145568968704x from 0x4530923008x\r\nPkilling 0x123145617485824x from 0x4530923008x\r\nPkilling 0x123145575297024x from 0x4530923008x\r\nPkilling 0x123145502429184x from 0x4530923008x\r\nPkilling 0x123145516195840x from 0x4530923008x\r\nPkilling 0x123145539436544x from 0x4530923008x\r\nPkilling 0x123145581625344x from 0x4530923008x\r\nPkilling 0x123145522524160x from 0x4530923008x\r\nPkilling 0x123145545764864x from 0x4530923008x\r\nPkilling 0x123145587953664x from 0x4530923008x\r\nPkilling 0x123145505611776x from 0x4530923008x\r\nPkilling 0x123145528852480x from 0x4530923008x\r\nPkilling 0x123145552093184x from 0x4530923008x\r\nPkilling 0x123145594281984x from 0x4530923008x\r\nPkilling 0x123145511940096x from 0x4530923008x\r\nPkilling 0x123145600610304x from 0x4530923008x\r\nPkilling 0x123145558421504x from 0x4530923008x\r\nPkilling 0x123145606938624x from 0x4530923008x\r\nPkilling 0x123145564749824x from 0x4530923008x\r\nPkilling 0x123145613266944x from 0x4530923008x\r\nPkilling 0x123145571078144x from 0x4530923008x\r\nPkilling 0x123145619595264x from 0x4530923008x\r\nPkilling 0x123145577406464x from 0x4530923008x\r\nPkilling 0x123145535217664x from 0x4530923008x\r\nPkilling 0x123145531498496x from 0x4530923008x\r\nPkilling 0x123145518305280x from 0x4530923008x\r\nPkilling 0x123145541545984x from 0x4530923008x\r\nPkilling 0x123145583734784x from 0x4530923008x\r\nPkilling 0x123145524633600x from 0x4530923008x\r\nPkilling 0x123145547874304x from 0x4530923008x\r\nPkilling 0x123145590063104x from 0x4530923008x\r\nCould not exec mono-hang-watchdog, expected on path \u0027/Users/johnny/MyApp.app/Contents/MonoBundle/../bin/mono-hang-watchdog\u0027 (errno 2)\r\nPkilling 0x123145507721216x from 0x4530923008x\r\nPkilling 0x123145596391424x from 0x4530923008x\r\nPkilling 0x123145554202624x from 0x4530923008x\r\nPkilling 0x123145602719744x from 0x4530923008x\r\nPkilling 0x123145560530944x from 0x4530923008x\r\nEntering thread summarizer pause from 0x4530923008x\r\nFinished thread summarizer pause from 0x4530923008x.\r\nFailed to create breadcrumb file (null)/crash_hash_0x68fd0aedc\r\n\r\n\r\n=================================================================\r\n\tExternal Debugger Dump:\r\n=================================================================\r\n\r\n=================================================================\r\n\tBasic Fault Address Reporting\r\n=================================================================\r\nMemory around native instruction pointer (0x7ffa0e1375ec):0x7ffa0e1375dc  37 48 8b 00 4c 8d 34 06 48 8b 8c 06 08 60 00 00  7H..L.4.H....\u0060..\r\n0x7ffa0e1375ec  48 89 8f e0 39 01 00 48 8b 8f 48 36 01 00 48 3b  H...9..H..H6..H;\r\n0x7ffa0e1375fc  8c 06 c8 5f 00 00 0f 84 d8 0b 00 00 48 89 f3 49  ..._........H..I\r\n0x7ffa0e13760c  8b bc 24 c0 39 01 00 48 85 ff 74 06 ff 15 2a 8b  ..$.9..H..t...*.\r\n\r\n=================================================================\r\n\tManaged Stacktrace:\r\n=================================================================\r\n\t  at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n\t  at SkiaSharp.SkiaApi:sk_canvas_flush \u003C0x000fa\u003E\r\n\t  at SkiaSharp.SKCanvas:Flush \u003C0x000ba\u003E\r\n\t  at SkiaSharp.Views.Mac.SKMetalView:MetalKit.IMTKViewDelegate.Draw \u003C0x00a8a\u003E\r\n\t  at \u003CModule\u003E:runtime_invoke_void__this___object \u003C0x00113\u003E\r\n\t  at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n\t  at AppKit.NSApplication:NSApplicationMain \u003C0x00276\u003E\r\n\t  at AppKit.NSApplication:Main \u003C0x00292\u003E\r\n\t  at MyApp.macOS.MainClass:Main \u003C0x001d2\u003E\r\n\t  at \u003CModule\u003E:runtime_invoke_void_object \u003C0x00110\u003E\r\n=================================================================\r\n\r\n\u0060\u0060\u0060\r\n\r\n**Expected Behavior**\r\n\r\nwould be nice if the application doesn\u0027t crash and i get a GPU backed image object \uD83E\uDD70\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.88.0-preview.187\r\n- IDE:  Visual Studio for Mac\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - macOS:  12.3\r\n\r\n",
  "author": {
    "login": "nor0x",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-03-30T13:12:38",
  "updatedAt": "2022-03-30T13:12:38",
  "commentCount": 0,
  "reactionCount": 1
}