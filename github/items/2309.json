{
  "number": 2309,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Cannot create Subset of Texture Image after upgrading to v2.88.x",
  "body": "**Description**\r\nAfter upgrading from SkiaSharp v2.80.4 to v2.88.x, it seems not possible to create a subset from a (GPU bound) texture image via SkiaSharp anymore. \r\n\r\nI am not sure if there has been a change in the Skia API? The documentation for the corresponding \u0060makeSubset(...)\u0060 API function states, that we need to provide the GRContext in order to create a subset of a texture image. \r\n\r\n\u0022_If this image is texture-backed, the context parameter is required and must match the context of the source image. If the context parameter is provided, and the image is raster-backed, the subset will be converted to texture-backed._\u0022\r\nSource: https://api.skia.org/classSkImage.html#a02b229cde4f7f2b80e810157e2d98b9b\r\n\r\nAs far as I can see, this is currently not possible via SkiaSharp, or am I missing something? \r\n\r\n\u0060\u0060\u0060csharp\r\n/// \u003Cparam name=\u0022subset\u0022\u003EThe rectangle indicating the subset to obtain.\u003C/param\u003E\r\n/// \u003Csummary\u003EReturns a new image that is a subset of this image.\u003C/summary\u003E\r\n/// \u003Creturns\u003EReturns the new image, or \u003Csee langword=\u0022null\u0022 /\u003E if there was an error or the rectangle does not intersect the image.\u003C/returns\u003E\r\n/// \u003Cremarks\u003EThe underlying implementation may share the pixels, or it may make a copy.\u003C/remarks\u003E\r\npublic unsafe SKImage Subset(SKRectI subset) =\u003E SKImage.GetObject(SkiaApi.sk_image_make_subset(this.Handle, \u0026subset));\r\n\u0060\u0060\u0060\r\n\r\nThe workaround is an expensive Texture \u003E to Raster \u003E make Subset \u003E to Texture operation, which isn\u0027t ideal at all, or a downgrad to SkiaSharp v2.80.4. \r\n\r\n**Code**\r\nHere is a little code snippet for easy reproduction. Required NuGet packages: \u0022OpenTK\u0022 \u0026 \u0022SkiaSharp\u0022 (failing with v2.88.x, successful with v2.80.4). \r\n\u0060\u0060\u0060csharp\r\nusing OpenTK.Graphics.OpenGL;\r\nusing OpenTK.Windowing.Common;\r\nusing OpenTK.Windowing.Desktop;\r\nusing SkiaSharp;\r\n\r\nConsole.WriteLine(\u0022Creating OpenGL context...\u0022);\r\n\r\nvar nativeWindowSettings = new NativeWindowSettings\r\n{\r\n    API = ContextAPI.OpenGL,\r\n    APIVersion = new Version(4, 3),\r\n    Title = \u0022Render Engine\u0022,\r\n    StartVisible = false,\r\n    Flags = ContextFlags.Offscreen,\r\n};\r\n\r\nvar window = new NativeWindow(nativeWindowSettings);\r\n\r\nvar version = GL.GetString(StringName.Version);\r\nvar vendor = GL.GetString(StringName.Vendor);\r\nvar renderer = GL.GetString(StringName.Renderer);\r\nvar shaderLanguageVersion = GL.GetString(StringName.ShadingLanguageVersion);\r\nConsole.WriteLine($\u0022Using OpenGL version \u0027{version}\u0027 from vendor \u0027{vendor}\u0027 on renderer \u0027{renderer}\u0027 with shader language version \u0027{shaderLanguageVersion}\u0027.\u0022);\r\n\r\nConsole.WriteLine(\u0022Creating SkiaSharp GL context...\u0022);\r\nvar glInterface = GRGlInterface.Create();\r\nvar skiaContext = GRContext.CreateGl(glInterface);\r\n_ = skiaContext ?? throw new ArgumentNullException(nameof(skiaContext), \u0022Failed to create SkiaSharp GL context.\u0022);\r\n\r\nConsole.WriteLine(\u0022Creating OpenGL source texture...\u0022);\r\nvar imageInfo = new SKImageInfo(32, 16, SKColorType.Rgba8888, SKAlphaType.Opaque);\r\nvar textureId = GL.GenTexture();\r\nGL.BindTexture(TextureTarget.Texture2D, textureId);\r\nGL.TexImage2D(TextureTarget.Texture2D, 0, PixelInternalFormat.Rgba, imageInfo.Width, imageInfo.Height, 0, PixelFormat.Rgba, PixelType.UnsignedByte, IntPtr.Zero);\r\nGL.BindTexture(TextureTarget.Texture2D, 0);\r\n\r\nConsole.WriteLine(\u0022Creating Skia image from texture...\u0022);\r\nvar textureInfo = new GRGlTextureInfo\r\n{\r\n    Id = (uint)textureId,\r\n    Target = (uint)TextureTarget.Texture2D,\r\n    Format = (uint)PixelInternalFormat.Rgba8,\r\n};\r\nvar backendTexture = new GRBackendTexture(imageInfo.Width, imageInfo.Height, false, textureInfo);\r\nif (!backendTexture.IsValid)\r\n{\r\n    GL.DeleteTexture(textureId);\r\n    throw new InvalidOperationException(\u0022Failed to create backend render texture.\u0022);\r\n}\r\n\r\nvar textureImage = SKImage.FromAdoptedTexture(skiaContext, backendTexture, GRSurfaceOrigin.TopLeft, SKColorType.Rgba8888);\r\n_ = textureImage ?? throw new ArgumentNullException(nameof(skiaContext), \u0022Failed to create Skia image from texture.\u0022);\r\n\r\nConsole.WriteLine(\u0022Trying to create subset of texture image...\u0022);\r\nvar subsetTextureImage = textureImage.Subset(new SKRectI(0, 0, 16, 16)); // TODO need to pass skiaContext!\r\n_ = subsetTextureImage ?? throw new ArgumentNullException(nameof(skiaContext), \u0022Failed to create subset from texture image.\u0022);\r\n\r\nConsole.ReadKey();\r\nConsole.WriteLine(\u0022Cleaning up all the stuff...\u0022);\r\nsubsetTextureImage.Dispose();\r\ntextureImage.Dispose();\r\nwindow.Dispose();\r\n\u0060\u0060\u0060\r\n\r\n**Expected Behavior**\r\nSubset method creates requested subset texture image. \r\n\r\n**Actual Behavior**\r\nSubset method returns null. \r\n\r\n**Basic Information**\r\n- Version with issue:  v2.88.x\r\n- Last known good version:  v2.80.4\r\n- IDE:  JetBrains Rider\r\n- Platform Target Frameworks: \r\n  - Windows Classic:  .Net 6 on Windows 11",
  "author": {
    "login": "a1i3n37",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-11-11T11:58:13",
  "updatedAt": "2022-11-11T12:00:10",
  "commentCount": 0,
  "reactionCount": 0
}