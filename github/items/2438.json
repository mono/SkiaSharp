{
  "number": 2438,
  "type": "issue",
  "state": "open",
  "title": "DllNotFoundException running Azure function on Docker container [BUG] ",
  "body": "**Description**\r\n\r\nI am running Azure function on Docker container using default settings and getting this exception:\r\n\r\n\u0060System.TypeInitializationException: \u0027The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception.\u0027\u0060\r\n\u0060DllNotFoundException: Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: liblibSkiaSharp: cannot open shared object file: No such file or directory\u0060\r\n\r\n\r\n**Code**\r\n\r\n\u0060\u0060\u0060\r\nusing Microsoft.AspNetCore.Http;\r\nusing Microsoft.AspNetCore.Mvc;\r\nusing Microsoft.Azure.WebJobs;\r\nusing Microsoft.Azure.WebJobs.Extensions.Http;\r\nusing Microsoft.Extensions.Logging;\r\nusing Newtonsoft.Json;\r\nusing SkiaSharp;\r\nusing System.IO;\r\nusing System.Threading.Tasks;\r\n\r\nnamespace FunctionApp1\r\n{\r\n    public static class Function1\r\n    {\r\n        [FunctionName(\u0022Function1\u0022)]\r\n        public static async Task\u003CIActionResult\u003E Run(\r\n            [HttpTrigger(AuthorizationLevel.Function, \u0022get\u0022, \u0022post\u0022, Route = null)] HttpRequest req,\r\n            ILogger log)\r\n        {\r\n            log.LogInformation(\u0022C# HTTP trigger function processed a request.\u0022);\r\n\r\n            string name = req.Query[\u0022name\u0022];\r\n\r\n            string requestBody = await new StreamReader(req.Body).ReadToEndAsync();\r\n            dynamic data = JsonConvert.DeserializeObject(requestBody);\r\n            name = name ?? data?.name;\r\n\r\n            string responseMessage = string.IsNullOrEmpty(name)\r\n                ? \u0022This HTTP triggered function executed successfully. Pass a name in the query string or in the request body for a personalized response.\u0022\r\n                : $\u0022Hello, {name}. This HTTP triggered function executed successfully.\u0022;\r\n\r\n            var info = new SKImageInfo(256, 256);\r\n            using (var surface = SKSurface.Create(info))\r\n            {\r\n                // the the canvas and properties\r\n                var canvas = surface.Canvas;\r\n\r\n                // make sure the canvas is blank\r\n                canvas.Clear(SKColors.White);\r\n\r\n                // draw some text\r\n                var paint = new SKPaint\r\n                {\r\n                    Color = SKColors.Black,\r\n                    IsAntialias = true,\r\n                    Style = SKPaintStyle.Fill,\r\n                    TextAlign = SKTextAlign.Center,\r\n                    TextSize = 24\r\n                };\r\n                var coord = new SKPoint(info.Width / 2, (info.Height \u002B paint.TextSize) / 2);\r\n                canvas.DrawText(\u0022SkiaSharp\u0022, coord, paint);\r\n\r\n                // save the file\r\n                using (var image = surface.Snapshot())\r\n                using (var data1 = image.Encode(SKEncodedImageFormat.Png, 100))\r\n                using (var stream = File.OpenWrite(\u0022output.png\u0022))\r\n                {\r\n                    data1.SaveTo(stream);\r\n                }\r\n            }\r\n\r\n            return new OkObjectResult(responseMessage);\r\n        }\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\n*Dockerfile*\r\n\u0060\u0060\u0060\r\n#See https://aka.ms/customizecontainer to learn how to customize your debug container and how Visual Studio uses this Dockerfile to build your images for faster debugging.\r\n\r\nFROM mcr.microsoft.com/azure-functions/dotnet:4 AS base\r\nWORKDIR /home/site/wwwroot\r\nEXPOSE 80\r\n\r\nFROM mcr.microsoft.com/dotnet/sdk:6.0 AS build\r\nWORKDIR /src\r\nCOPY [\u0022FunctionApp1/FunctionApp1.csproj\u0022, \u0022FunctionApp1/\u0022]\r\nRUN dotnet restore \u0022FunctionApp1/FunctionApp1.csproj\u0022\r\nCOPY . .\r\nWORKDIR \u0022/src/FunctionApp1\u0022\r\nRUN dotnet build \u0022FunctionApp1.csproj\u0022 -c Release -o /app/build\r\n\r\nFROM build AS publish\r\nRUN dotnet publish \u0022FunctionApp1.csproj\u0022 -c Release -o /app/publish /p:UseAppHost=false\r\n\r\nFROM base AS final\r\nWORKDIR /home/site/wwwroot\r\nCOPY --from=publish /app/publish .\r\nENV AzureWebJobsScriptRoot=/home/site/wwwroot \\\r\n    AzureFunctionsJobHost__Logging__Console__IsEnabled=true\r\n\u0060\u0060\u0060\r\n\r\n**Steps to reproduce**\r\n1. Create default Azure function on Visual Studio (ticking enable Docker container)\r\n2. Install \u0060SkiaSharp.NativeAssets.Linux.NoDependencies\u0060 nuget\r\n3. Add basic SkiaSharp code\r\n4. Run\r\n\r\n",
  "author": {
    "login": "deivydas321",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2023-04-11T10:38:42",
  "updatedAt": "2023-04-11T10:39:47",
  "commentCount": 0,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:27:50.0457926Z",
    "reactions": [],
    "comments": []
  }
}