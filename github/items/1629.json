{
  "number": 1629,
  "type": "issue",
  "state": "open",
  "title": "[BUG] System.TypeInitializationException : The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception in AWS Lambda function NET Core 3.1",
  "body": "**Description**\r\n\r\nSystem.TypeInitializationException : The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception.\r\n\r\n**Code**\r\n\r\nCreate an empty AWS Lambda Project (.NET Core - C#) in Visual Studio\r\nRefer:\r\nhttps://docs.aws.amazon.com/toolkit-for-visual-studio/latest/user-guide/lambda-creating-project-in-visual-studio.html \r\n\r\nAdd the below code in FunctionHandler\r\n\r\n\r\n\u0060\r\n\r\n            SKBitmap bitmap = new SKBitmap(100, 100, SKImageInfo.PlatformColorType, SKAlphaType.Premul);\r\n            var surface = SKSurface.Create(bitmap.Info);\r\n            SKCanvas canvas = surface.Canvas;\r\n            canvas.Clear(SKColors.White);\r\n            var paint = new SKPaint();\r\n            paint.IsAntialias = true;\r\n            paint.Color = SKColors.Red;\r\n            paint.StrokeWidth = 3;\r\n            canvas.DrawCircle(50, 50, 25, paint);\r\n            var image = SKImage.FromBitmap(bitmap);\r\n            var data = surface.Snapshot().Encode(SKEncodedImageFormat.Jpeg, 80);\r\n            MemoryStream outputStream = new MemoryStream();\r\n            data.SaveTo(outputStream);\r\n            outputStream.Position = 0;\r\n            return \u0022SkiaSharpImageCreation\u0022;\r\n        \u0060\r\n\r\nInstall SkiaSharp v2.80.2, SkiaSharp.NativeAssests.Linux v2.80.2 \r\nPublish the application in AWS Lambda (Right click -\u003E Publish AWS).\r\nUsing simple ASP.NET Core application access this function, you can receive exception.\r\n\r\n**Expected Behavior**\r\n\r\nShould run without an exception\r\n\r\n**Actual Behavior**\r\n\r\n{\r\n  \u0022errorType\u0022: \u0022TypeInitializationException\u0022,\r\n  \u0022errorMessage\u0022: \u0022The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception.\u0022,\r\n  \u0022stackTrace\u0022: [\r\n    \u0022at SimpleAWS.Function.FunctionHandler(String input, ILambdaContext context) in D:\\\\SimpleAWS\\\\Function.cs:line 31\u0022,\r\n    \u0022at lambda_method(Closure , Stream , Stream , LambdaContextInternal )\u0022\r\n  ],\r\n  \u0022cause\u0022: {\r\n    \u0022errorType\u0022: \u0022DllNotFoundException\u0022,\r\n    \u0022errorMessage\u0022: \u0022Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: liblibSkiaSharp: cannot open shared object file: No such file or directory\u0022,\r\n    \u0022stackTrace\u0022: [\r\n      \u0022at SkiaSharp.SkiaApi.sk_colortype_get_default_8888()\u0022,\r\n      \u0022at SkiaSharp.SKImageInfo..cctor()\u0022\r\n    ]\r\n  }\r\n}\r\n\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  SkiaSharp v2.80.2, SkiaSharp.NativeAssests.Linux v2.80.2\r\n\r\n- IDE: Microsoft Visual Studio Professional 2019, Version 16.8.4\r\n- Platform Target Frameworks: ASP.NET Core 3.1\r\n\r\n  \r\n\u003Cdetails\u003E\r\n Screenshot of dependencies:\r\n\r\n![image](https://user-images.githubusercontent.com/41197331/107758492-f62cb800-6d4c-11eb-8f7d-5f14e05f8c07.png)\r\n\r\nScreenshot of code snippet:\r\n\r\n![image](https://user-images.githubusercontent.com/41197331/107758572-16f50d80-6d4d-11eb-82b9-d9f0e5a82a49.png)\r\n\r\n\r\n\r\n\u003C/details\u003E\r\n\r\n\r\n**Additional Information**\r\nThis issue not occur in ASP.NET Core 2.1 AWS Lambda application.\r\n\r\n\r\n**Sample to reproduce the issue:**\r\n[IssueReproduceSample.zip](https://github.com/mono/SkiaSharp/files/5971480/IssueReproduceSample.zip)\r\n\r\n**Replication steps:**\r\n1. Download and unzip.\r\n2. Publish SimpleAWS Sample.\r\n3. Run the ASP.NET Core sample by adding access key and secret key, to get response from AWS Lambda Function.\r\n\r\nPlease let me know if you need further details on this",
  "author": {
    "login": "MohanaselvamJ",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2021-02-12T10:49:45",
  "updatedAt": "2023-03-22T16:15:27",
  "commentCount": 3,
  "reactionCount": 3
}