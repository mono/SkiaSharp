{
  "number": 2953,
  "type": "issue",
  "state": "closed",
  "title": "[iOS, 3.0] Building projects with SkiaSharp hang up in Release configuration in .NET MAUI 9.0 Preview 6 and Visual Studio 17.11.0 Preview 4.0",
  "body": "### Description\r\n\r\nWhen using Visual Studio 17.11.0 Preview 4.0 to build a project using .NET MAUI 9.0 Preview 6 and SkiaSharp in Release configuration, the build process hangs up indefinitely in AOT compilation. Debug configuration works fine. Other platforms work fine. Xamarin iOS works fine. Both SkiaSharp 3.0 Preview 3.1 and 4.1 hang up, so it is not about SkiaSharp version.\r\n\r\n### Code\r\n\r\n1. Try to build https://github.com/hyvanmielenpelit/iOSMauiSkiaSharpMemoryLeak in Release configuration using .NET MAUI 9.0 Preview 6 and Visual Studio 17.11.0 Preview 4.0 (using Rebuild)\r\n2. The build process hangs up indefinitely in AOT compilation. In Debug configuration, it does not hang up.\r\n\r\n### Expected Behavior\r\n\r\nThe build process succeeds in Release configuration.\r\n\r\n### Actual Behavior\r\n\r\nThe build process hangs up indefinitely in AOT compilation step in Release configuration.\r\n\r\n### Version of SkiaSharp\r\n\r\n3.x (Alpha)\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### IDE / Editor\r\n\r\nVisual Studio (Windows)\r\n\r\n### Platform / Operating System\r\n\r\niOS\r\n\r\n### Platform / Operating System Version\r\n\r\niOS 17.5.1, but did not get that far\r\n\r\n### Devices\r\n\r\niPad 11,7 but did not get that far\r\n\r\n### Relevant Screenshots\r\n\r\n_No response_\r\n\r\n### Relevant Log Output\r\n\r\n\u0060\u0060\u0060shell\r\n1\u003E        Done building target \u0022IncrementalClean\u0022 in project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E        Target \u0022PostBuildEvent\u0022 skipped, due to false condition; (\u0027$(PostBuildEvent)\u0027 != \u0027\u0027 and (\u0027$(RunPostBuildEvent)\u0027 != \u0027OnOutputUpdated\u0027 or \u0027$(_AssemblyTimestampBeforeCompile)\u0027 != \u0027$(_AssemblyTimestampAfterCompile)\u0027)) was evaluated as (\u0027\u0027 != \u0027\u0027 and (\u0027\u0027 != \u0027OnOutputUpdated\u0027 or \u0027\u0027 != \u0027\u0027)).\r\n1\u003E        Target \u0022GenerateBuildDependencyFile\u0022 skipped. Previously built successfully.\r\n1\u003E        Target \u0022GenerateBuildRuntimeConfigurationFiles\u0022 skipped. Previously built successfully.\r\n1\u003E        Target \u0022CoreBuild\u0022 in file \u0022C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\amd64\\Microsoft.Common.CurrentVersion.targets\u0022:\r\n1\u003E        Done building target \u0022CoreBuild\u0022 in project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E        Target \u0022AfterBuild\u0022 in file \u0022C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\amd64\\Microsoft.Common.CurrentVersion.targets\u0022:\r\n1\u003E        Done building target \u0022AfterBuild\u0022 in project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E        Target \u0022_CheckBrowserWorkloadNeededButNotAvailable\u0022 skipped, due to false condition; (\u0027$(RuntimeIdentifier)\u0027 == \u0027browser-wasm\u0027 and \u0027$(_BrowserWorkloadDisabled)\u0027 != \u0027true\u0027 and \u0027$(WasmNativeWorkloadAvailable)\u0027 != \u0027true\u0027) was evaluated as (\u0027win10-x64\u0027 == \u0027browser-wasm\u0027 and \u0027\u0027 != \u0027true\u0027 and \u0027\u0027 != \u0027true\u0027).\r\n1\u003E        Target \u0022_ErrorWorkloadDisabledForTFMLessThan6\u0022 skipped, due to false condition; (\u0027$(_BrowserWorkloadNotSupportedForTFM)\u0027 == \u0027true\u0027) was evaluated as (\u0027\u0027 == \u0027true\u0027).\r\n1\u003E        Target \u0022_ErrorDualWasmThreadPropsOn7\u0022 skipped, due to false condition; (\u0027$(TargetsNet7)\u0027 == \u0027true\u0027 and \u0027$(RuntimeIdentifier)\u0027 == \u0027browser-wasm\u0027 and\r\n1\u003E            \u0027$(BrowserWorkloadDisabled)\u0027 != \u0027true\u0027 and \u0027$(WasmEnableThreads)\u0027 == \u0027true\u0027 and \u0027$(WasmEnablePerfTrace)\u0027 == \u0027true\u0027) was evaluated as (\u0027\u0027 == \u0027true\u0027 and \u0027win10-x64\u0027 == \u0027browser-wasm\u0027 and\r\n1\u003E            \u0027\u0027 != \u0027true\u0027 and \u0027\u0027 == \u0027true\u0027 and \u0027\u0027 == \u0027true\u0027).\r\n1\u003E        Target \u0022Build\u0022 in file \u0022C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\amd64\\Microsoft.Common.CurrentVersion.targets\u0022:\r\n1\u003E        Done building target \u0022Build\u0022 in project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E        Target \u0022CallPublishContainerSdkContainerProfile\u0022 skipped, due to false condition; (\u0027$(EnableSdkContainerDebugging)\u0027 == \u0027true\u0027 AND \u0027$(SdkContainerPublishOnBuild)\u0027 == \u0027true\u0027) was evaluated as (\u0027\u0027 == \u0027true\u0027 AND \u0027\u0027 == \u0027true\u0027).\r\n1\u003E        Target \u0022_CalculatePostXamarinTelemetry\u0022 skipped. Previously built successfully.\r\n1\u003E        Target \u0022_PostXamarinTelemetry\u0022 skipped. Previously built successfully.\r\n1\u003E        Target \u0022RestorePackageVersion\u0022 skipped, due to false condition; (\u0027$(InteractiveExperiencesVersion)\u0027!=\u0027\u0027) was evaluated as (\u0027\u0027!=\u0027\u0027).\r\n1\u003E        Target \u0022_PackAsBuildAfterTarget\u0022 skipped, due to false condition; (\u0027$(GeneratePackageOnBuild)\u0027 == \u0027true\u0027 AND \u0027$(IsInnerBuild)\u0027 != \u0027true\u0027) was evaluated as (\u0027false\u0027 == \u0027true\u0027 AND \u0027true\u0027 != \u0027true\u0027).\r\n1\u003E        Target \u0022_CheckContainersPackage\u0022 in file \u0022C:\\Program Files\\dotnet\\sdk\\9.0.100-preview.6.24328.19\\Containers\\build\\Microsoft.NET.Build.Containers.targets\u0022:\r\n1\u003E          Set Property: _ContainersPackageIdentity=Microsoft.NET.Build.Containers\r\n1\u003E          Set Property: _WebDefaultSdkVersion=7.0.300\r\n1\u003E          Set Property: _WorkerDefaultSdkVersion=8.0.100\r\n1\u003E          Set Property: _ConsoleDefaultSdkVersion=8.0.200\r\n1\u003E          Set Property: _SdkCanPublishWeb=True\r\n1\u003E          Set Property: _SdkCanPublishWorker=True\r\n1\u003E          Set Property: _SdkCanPublishConsole=True\r\n1\u003E          Set Property: _ContainerPackageIsPresent=false\r\n1\u003E          Set Property: _IsWebProject=false\r\n1\u003E          Set Property: _IsWorkerProject=false\r\n1\u003E          Task \u0022Warning\u0022 skipped, due to false condition; ($(_ContainerPackageIsPresent)\r\n1\u003E                  and (\r\n1\u003E                    ($(_SdkCanPublishWeb) and $(_IsWebProject)) or\r\n1\u003E                    ($(_SdkCanPublishWorker) and $(_IsWorkerProject)) or\r\n1\u003E                    ($(_SdkCanPublishConsole) and \u0027$(EnableSdkContainerSupport)\u0027 == \u0027true\u0027)\r\n1\u003E                  )) was evaluated as (false\r\n1\u003E                  and (\r\n1\u003E                    (True and false) or\r\n1\u003E                    (True and false) or\r\n1\u003E                    (True and \u0027\u0027 == \u0027true\u0027)\r\n1\u003E                  )).\r\n1\u003E        Done building target \u0022_CheckContainersPackage\u0022 in project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E        Target \u0022AfterRebuild\u0022 in file \u0022C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\amd64\\Microsoft.Common.CurrentVersion.targets\u0022:\r\n1\u003E        Done building target \u0022AfterRebuild\u0022 in project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E        Target \u0022_CheckForInvalidConfigurationAndPlatform\u0022 skipped. Previously built successfully.\r\n1\u003E        Target \u0022Rebuild\u0022 in file \u0022C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\amd64\\Microsoft.Common.CurrentVersion.targets\u0022:\r\n1\u003E        Done building target \u0022Rebuild\u0022 in project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E\r\n1\u003E        Done building project \u0022SkiaSharpMemoryLeak.csproj\u0022.\r\n1\u003E        [xma][info]: Pinging client \u0027Broker\u0027...\r\n1\u003E        [xma][info]: Sending Request Xamarin.Messaging.PingMessage to topic xma/ping/Broker\r\n1\u003E        [xma][info]: Received Response of Xamarin.Messaging.PingMessage to topic build3160817324janne/\u002B/xma/ping/Broker\r\n1\u003E        [xma][info]: The client \u0027Broker\u0027 has acknowledged the ping\r\n1\u003E        [xma][info]: Pinging client \u0027Broker\u0027...\r\n1\u003E        [xma][info]: Sending Request Xamarin.Messaging.PingMessage to topic xma/ping/Broker\r\n1\u003E        [xma][info]: Received Response of Xamarin.Messaging.PingMessage to topic build3160817324janne/\u002B/xma/ping/Broker\r\n1\u003E        [xma][info]: The client \u0027Broker\u0027 has acknowledged the ping\r\n1\u003E        [xma][info]: Pinging client \u0027Broker\u0027...\r\n1\u003E        [xma][info]: Sending Request Xamarin.Messaging.PingMessage to topic xma/ping/Broker\r\n1\u003E        [xma][info]: Received Response of Xamarin.Messaging.PingMessage to topic build3160817324janne/\u002B/xma/ping/Broker\r\n1\u003E        [xma][info]: The client \u0027Broker\u0027 has acknowledged the ping\r\n1\u003E        [xma][info]: Pinging client \u0027Broker\u0027...\r\n1\u003E        [xma][info]: Sending Request Xamarin.Messaging.PingMessage to topic xma/ping/Broker\r\n1\u003E        [xma][info]: Received Response of Xamarin.Messaging.PingMessage to topic build3160817324janne/\u002B/xma/ping/Broker\r\n1\u003E        [xma][info]: The client \u0027Broker\u0027 has acknowledged the ping\r\n\r\nNever finishes, ping continues forever in Release.\r\n\u0060\u0060\u0060\r\n\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "janne-hmp",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2024-07-23T13:15:48",
  "updatedAt": "2025-04-18T10:24:05",
  "closedAt": "2025-04-18T10:24:04",
  "commentCount": 2,
  "reactionCount": 0
}