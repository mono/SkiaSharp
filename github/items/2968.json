{
  "number": 2968,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] [WinUI 3 / MAUI, 9.0 Preview 6, SkiaSharp 3.0-preview4.1] SKGLView crashes WinUI 3 MAUI App when the app is built in the unpackaged mode",
  "body": "### Description\n\n#### Technology stack\r\n\r\n- .NET 9.0 Preview 6\r\n- .NET MAUI 9.0 Preview 6\r\n- SkiaSharp 3.0-preview4.1\r\n- Windows / WinUI 3 1.5.x\r\n\r\n#### Bug\r\n\r\nSKGLView crashes the app at runtime when .NET MAUI App is built in the **unpackaged mode** (\u0060-p:WindowsPackageType=None\u0060).\n\n### Code\n\n#### Steps to reproduce the bug\r\n\r\n1. Clone the public reproduction repository ([link](https://github.com/hyvanmielenpelit/WindowsMauiUnpackagedSKGLViewError)) and open the solution in Visual Studio 2022 Preview (latest).\r\n2. First, let\u0027s check that things work in the packaged mode.\r\n3. Select Windows Machine and click the green Debug button.\r\n4. The app should start.\r\n5. Click the Click Me button. A new page with some text should open. The app will not crash.\r\n6. Close the app and go back to Visual Studio 2022 Preview.\r\n7. Open the Developer PowerShell and check that you are in the solution folder.\r\n8. Delete **bin** and **obj** folders. _(Otherwise the unpackaged app will not start.)_\r\n9. Build the unpackaged app with \u0060dotnet build -f:net9.0-windows10.0.19041.0 -c:Debug -p:WindowsPackageType=None -p:RuntimeIdentifierOverride=win10-x64 -p:WindowsAppSDKSelfContained=true\u0060\r\n10. Open File Explorer and go to \u0060bin\\Debug\\net9.0-windows10.0.19041.0\\win10-x64\u0060. The unpackaged app should be there.\r\n11. Click on **WindowsMauiUnpackagedSKGLViewError.exe**.\r\n12. The app will start.\r\n13. Click on the Click me button.\r\n14. The app will crash.\r\n15. Now, open Event Viewer and see the Windows Logs \u2192 Application error messages.\n\n### Expected Behavior\n\nThe app would not crash at runtime.\n\n### Actual Behavior\n\nThe app crashes in the OnLoaded event of AngleSwapChainPanel at runtime.\n\n### Version of SkiaSharp\n\n3.x (Alpha)\n\n### Last Known Good Version of SkiaSharp\n\nOther (Please indicate in the description)\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\nEdition\tWindows 11 Pro\r\nVersion\t23H2\r\nOS build\t22631.3958\r\nExperience\tWindows Feature Experience Pack 1000.22700.1026.0\n\n### Devices\n\nProcessor\t13th Gen Intel(R) Core(TM) i9-13980HX   2.20 GHz\r\nInstalled RAM\t32,0 GB (31,6 GB usable)\r\nSystem type\t64-bit operating system, x64-based processor\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\nLog Name:      Application\r\nSource:        .NET Runtime\r\nDate:          20.7.2024 21.57.32\r\nEvent ID:      1026\r\nTask Category: None\r\nLevel:         Error\r\nKeywords:      Classic\r\nUser:          N/A\r\nDescription:\r\nApplication: WindowsMauiUnpackagedSKGLViewError.exe\r\nCoreCLR Version: 9.0.24.32707\r\n.NET Version: 9.0.0-preview.6.24327.7\r\nDescription: The process was terminated due to an unhandled exception.\r\nStack:\r\n   at SkiaSharp.Views.GlesInterop.Egl.eglGetPlatformDisplayEXT(UInt32, IntPtr, Int32[])\r\n   at SkiaSharp.Views.GlesInterop.Egl.eglGetPlatformDisplayEXT(UInt32, IntPtr, Int32[])\r\n   at SkiaSharp.Views.GlesInterop.GlesContext.InitializeDisplay()\r\n   at SkiaSharp.Views.GlesInterop.GlesContext..ctor()\r\n   at SkiaSharp.Views.Windows.AngleSwapChainPanel.OnLoaded(System.Object, Microsoft.UI.Xaml.RoutedEventArgs)\r\n   at WinRT._EventSource_global__Microsoft_UI_Xaml_RoutedEventHandler\u002BEventState.\u003CGetEventInvoke\u003Eb__1_0(System.Object, Microsoft.UI.Xaml.RoutedEventArgs)\r\n   at ABI.Microsoft.UI.Xaml.RoutedEventHandler.Do_Abi_Invoke(IntPtr, IntPtr, IntPtr)\r\n   at ABI.Microsoft.UI.Xaml.IApplicationStaticsMethods.Start(WinRT.IObjectReference, Microsoft.UI.Xaml.ApplicationInitializationCallback)\r\n   at Microsoft.UI.Xaml.Application.Start(Microsoft.UI.Xaml.ApplicationInitializationCallback)\r\n   at WindowsMauiUnpackagedSKGLViewError.WinUI.Program.Main(System.String[])\r\n\r\nEvent Xml:\r\n\u003CEvent xmlns=\u0022http://schemas.microsoft.com/win/2004/08/events/event\u0022\u003E\r\n  \u003CSystem\u003E\r\n    \u003CProvider Name=\u0022.NET Runtime\u0022 /\u003E\r\n    \u003CEventID Qualifiers=\u00220\u0022\u003E1026\u003C/EventID\u003E\r\n    \u003CVersion\u003E0\u003C/Version\u003E\r\n    \u003CLevel\u003E2\u003C/Level\u003E\r\n    \u003CTask\u003E0\u003C/Task\u003E\r\n    \u003COpcode\u003E0\u003C/Opcode\u003E\r\n    \u003CKeywords\u003E0x80000000000000\u003C/Keywords\u003E\r\n    \u003CTimeCreated SystemTime=\u00222024-07-20T18:57:32.8237381Z\u0022 /\u003E\r\n    \u003CEventRecordID\u003E82274\u003C/EventRecordID\u003E\r\n    \u003CCorrelation /\u003E\r\n    \u003CExecution ProcessID=\u00222176\u0022 ThreadID=\u00220\u0022 /\u003E\r\n    \u003CChannel\u003EApplication\u003C/Channel\u003E\r\n  \u003C/System\u003E\r\n  \u003CEventData\u003E\r\n    \u003CData\u003EApplication: WindowsMauiUnpackagedSKGLViewError.exe\r\nCoreCLR Version: 9.0.24.32707\r\n.NET Version: 9.0.0-preview.6.24327.7\r\nDescription: The process was terminated due to an unhandled exception.\r\nStack:\r\n   at SkiaSharp.Views.GlesInterop.Egl.eglGetPlatformDisplayEXT(UInt32, IntPtr, Int32[])\r\n   at SkiaSharp.Views.GlesInterop.Egl.eglGetPlatformDisplayEXT(UInt32, IntPtr, Int32[])\r\n   at SkiaSharp.Views.GlesInterop.GlesContext.InitializeDisplay()\r\n   at SkiaSharp.Views.GlesInterop.GlesContext..ctor()\r\n   at SkiaSharp.Views.Windows.AngleSwapChainPanel.OnLoaded(System.Object, Microsoft.UI.Xaml.RoutedEventArgs)\r\n   at WinRT._EventSource_global__Microsoft_UI_Xaml_RoutedEventHandler\u002BEventState.\u0026lt;GetEventInvoke\u0026gt;b__1_0(System.Object, Microsoft.UI.Xaml.RoutedEventArgs)\r\n   at ABI.Microsoft.UI.Xaml.RoutedEventHandler.Do_Abi_Invoke(IntPtr, IntPtr, IntPtr)\r\n   at ABI.Microsoft.UI.Xaml.IApplicationStaticsMethods.Start(WinRT.IObjectReference, Microsoft.UI.Xaml.ApplicationInitializationCallback)\r\n   at Microsoft.UI.Xaml.Application.Start(Microsoft.UI.Xaml.ApplicationInitializationCallback)\r\n   at WindowsMauiUnpackagedSKGLViewError.WinUI.Program.Main(System.String[])\r\n\u003C/Data\u003E\r\n  \u003C/EventData\u003E\r\n\u003C/Event\u003E\r\n\r\nLog Name:      Application\r\nSource:        Application Error\r\nDate:          20.7.2024 21.57.33\r\nEvent ID:      1000\r\nTask Category: Application Crashing Events\r\nLevel:         Error\r\nKeywords:      \r\nDescription:\r\nFaulting application name: WindowsMauiUnpackagedSKGLViewError.exe, version: 1.0.0.0, time stamp: 0x667d0000\r\nFaulting module name: coreclr.dll, version: 9.0.24.32707, time stamp: 0x667de227\r\nException code: 0xc0000005\r\nFault offset: 0x00000000002de54e\r\nFaulting process ID: 0x0x880\r\nFaulting application start time: 0x0x1DADAD6AC829340\r\nFaulting application path: C:\\hmp\\WindowsMauiUnpackagedSKGLViewError\\WindowsMauiUnpackagedSKGLViewError\\WindowsMauiUnpackagedSKGLViewError\\bin\\Debug\\net9.0-windows10.0.19041.0\\win10-x64\\WindowsMauiUnpackagedSKGLViewError.exe\r\nFaulting module path: C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App\\9.0.0-preview.6.24327.7\\coreclr.dll\r\nReport ID: 3e1585be-c9dd-41c0-aa20-9933b81efeae\r\nFaulting package full name: \r\nFaulting package-relative application ID: \r\nEvent Xml:\r\n\u003CEvent xmlns=\u0022http://schemas.microsoft.com/win/2004/08/events/event\u0022\u003E\r\n  \u003CSystem\u003E\r\n    \u003CProvider Name=\u0022Application Error\u0022 Guid=\u0022{a0e9b465-b939-57d7-b27d-95d8e925ff57}\u0022 /\u003E\r\n    \u003CEventID\u003E1000\u003C/EventID\u003E\r\n    \u003CVersion\u003E0\u003C/Version\u003E\r\n    \u003CLevel\u003E2\u003C/Level\u003E\r\n    \u003CTask\u003E100\u003C/Task\u003E\r\n    \u003COpcode\u003E0\u003C/Opcode\u003E\r\n    \u003CKeywords\u003E0x8000000000000000\u003C/Keywords\u003E\r\n    \u003CTimeCreated SystemTime=\u00222024-07-20T18:57:33.1772821Z\u0022 /\u003E\r\n    \u003CEventRecordID\u003E82275\u003C/EventRecordID\u003E\r\n    \u003CCorrelation /\u003E\r\n    \u003CExecution ProcessID=\u002252744\u0022 ThreadID=\u002231284\u0022 /\u003E\r\n    \u003CChannel\u003EApplication\u003C/Channel\u003E\r\n  \u003C/System\u003E\r\n  \u003CEventData\u003E\r\n    \u003CData Name=\u0022AppName\u0022\u003EWindowsMauiUnpackagedSKGLViewError.exe\u003C/Data\u003E\r\n    \u003CData Name=\u0022AppVersion\u0022\u003E1.0.0.0\u003C/Data\u003E\r\n    \u003CData Name=\u0022AppTimeStamp\u0022\u003E667d0000\u003C/Data\u003E\r\n    \u003CData Name=\u0022ModuleName\u0022\u003Ecoreclr.dll\u003C/Data\u003E\r\n    \u003CData Name=\u0022ModuleVersion\u0022\u003E9.0.24.32707\u003C/Data\u003E\r\n    \u003CData Name=\u0022ModuleTimeStamp\u0022\u003E667de227\u003C/Data\u003E\r\n    \u003CData Name=\u0022ExceptionCode\u0022\u003Ec0000005\u003C/Data\u003E\r\n    \u003CData Name=\u0022FaultingOffset\u0022\u003E00000000002de54e\u003C/Data\u003E\r\n    \u003CData Name=\u0022ProcessId\u0022\u003E0x880\u003C/Data\u003E\r\n    \u003CData Name=\u0022ProcessCreationTime\u0022\u003E0x1dadad6ac829340\u003C/Data\u003E\r\n    \u003CData Name=\u0022AppPath\u0022\u003EC:\\hmp\\WindowsMauiUnpackagedSKGLViewError\\WindowsMauiUnpackagedSKGLViewError\\WindowsMauiUnpackagedSKGLViewError\\bin\\Debug\\net9.0-windows10.0.19041.0\\win10-x64\\WindowsMauiUnpackagedSKGLViewError.exe\u003C/Data\u003E\r\n    \u003CData Name=\u0022ModulePath\u0022\u003EC:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App\\9.0.0-preview.6.24327.7\\coreclr.dll\u003C/Data\u003E\r\n    \u003CData Name=\u0022IntegratorReportId\u0022\u003E3e1585be-c9dd-41c0-aa20-9933b81efeae\u003C/Data\u003E\r\n    \u003CData Name=\u0022PackageFullName\u0022\u003E\r\n    \u003C/Data\u003E\r\n    \u003CData Name=\u0022PackageRelativeAppId\u0022\u003E\r\n    \u003C/Data\u003E\r\n  \u003C/EventData\u003E\r\n\u003C/Event\u003E\n\u0060\u0060\u0060\n\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "TommiGustafsson-HMP",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [
    {
      "login": "mattleibow",
      "type": "User"
    }
  ],
  "createdAt": "2024-08-13T16:33:22",
  "updatedAt": "2025-08-22T23:55:10",
  "closedAt": "2025-08-22T23:55:10",
  "commentCount": 23,
  "reactionCount": 2
}