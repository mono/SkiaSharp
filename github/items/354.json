{
  "number": 354,
  "type": "issue",
  "state": "closed",
  "title": "Quality issues when drawing SKBitmap with transparency on rotated canvas",
  "body": "This happens only when canvas is rotated with angles different than 90, 180, 270, and 360 degrees, so any angle that is not a multiple of 90 degrees leads to quality issues. By quality issues I mean with jagged edges, it looks like anti-aliasing is turned off.\r\n\r\nHere you can see the code that replicate this issue:\r\n\u0060\u0060\u0060csharp\r\nusing System.IO;\r\nusing SkiaSharp;\r\n\r\nnamespace DemoSkia\r\n{\r\n    class MainClass\r\n    {\r\n        public static void Main(string[] args)\r\n        {\r\n\r\n            using (var surface = SKSurface.Create(2000, 300, SKImageInfo.PlatformColorType, SKAlphaType.Premul))\r\n            {\r\n                SKCanvas canvas = surface.Canvas;\r\n                canvas.Clear(new SKColor(255, 255, 255, 0));\r\n\r\n                var TextStyleFillColor = new SKColor(0, 0, 0, 255);\r\n\r\n                var TextStyleFillPaint = new SKPaint()\r\n                {\r\n                    Style = SKPaintStyle.Fill,\r\n                    Color = TextStyleFillColor,\r\n                    BlendMode = SKBlendMode.SrcOver,\r\n                    IsAntialias = true,\r\n                    Typeface = SKTypeface.FromFamilyName(\u0022Helvetica\u0022, SKTypefaceStyle.Normal),\r\n                    TextSize = 14f,\r\n                    TextAlign = SKTextAlign.Left,\r\n                    IsVerticalText = false,\r\n                    TextScaleX = 1f,\r\n                    TextSkewX = 0f\r\n                };\r\n\r\n                Stream fileStream = File.OpenRead(\u00223-2.png\u0022);\r\n\r\n                using (var stream = new SKManagedStream(fileStream))\r\n                using (var bitmap = SKBitmap.Decode(stream))\r\n                using (var paint = new SKPaint())\r\n                {\r\n                    var scaled = bitmap.Resize(new SKImageInfo(247, 260, bitmap.ColorType, bitmap.AlphaType), SKBitmapResizeMethod.Lanczos3);\r\n\r\n                    paint.IsAntialias = true;\r\n\r\n                    var x = 0;\r\n                    var y = 20;\r\n                    var angle = 0;\r\n\r\n                    // this looks fine with no rotation\r\n                    canvas.DrawBitmap(scaled, SKRect.Create(x, y, 247, 260), paint);\r\n                    canvas.DrawText($\u0022{angle} degress (good)\u0022, x \u002B 20, y, TextStyleFillPaint);\r\n\r\n                    // this looks bad with 15 degrees rotation\r\n                    angle = 15;\r\n                    x \u002B= 270;\r\n                    canvas.RotateDegrees(angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawBitmap(scaled, SKRect.Create(x, y, 247, 260), paint);\r\n                    canvas.RotateDegrees(-angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawText($\u0022{angle} degress (bad)\u0022, x \u002B 20, y, TextStyleFillPaint);\r\n\r\n                    // this looks bad with 45 degrees rotation\r\n                    angle = 45;\r\n                    x \u002B= 270;\r\n                    canvas.RotateDegrees(angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawBitmap(scaled, SKRect.Create(x, y, 247, 260), paint);\r\n                    canvas.RotateDegrees(-angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawText($\u0022{angle} degress (bad)\u0022, x \u002B 20, y, TextStyleFillPaint);\r\n\r\n                    // this looks bad with 120 degrees rotation\r\n                    angle = 120;\r\n                    x \u002B= 270;\r\n                    canvas.RotateDegrees(angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawBitmap(scaled, SKRect.Create(x, y, 247, 260), paint);\r\n                    canvas.RotateDegrees(-angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawText($\u0022{angle} degress (bad)\u0022, x \u002B 20, y, TextStyleFillPaint);\r\n\r\n                    // this looks good with 90 degrees rotation\r\n                    angle = 90;\r\n                    x \u002B= 270;\r\n                    canvas.RotateDegrees(angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawBitmap(scaled, SKRect.Create(x, y, 247, 260), paint);\r\n                    canvas.RotateDegrees(-angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawText($\u0022{angle} degress (good)\u0022, x \u002B 20, y, TextStyleFillPaint);\r\n\r\n                    // this looks good with 180 degrees rotation\r\n                    angle = 180;\r\n                    x \u002B= 270;\r\n                    canvas.RotateDegrees(angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawBitmap(scaled, SKRect.Create(x, y, 247, 260), paint);\r\n                    canvas.RotateDegrees(-angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawText($\u0022{angle} degress (good)\u0022, x \u002B 20, y, TextStyleFillPaint);\r\n\r\n                    // this looks good with 270 degrees rotation\r\n                    angle = 270;\r\n                    x \u002B= 270;\r\n                    canvas.RotateDegrees(angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawBitmap(scaled, SKRect.Create(x, y, 247, 260), paint);\r\n                    canvas.RotateDegrees(-angle, x \u002B scaled.Width / 2, y \u002B scaled.Height / 2);\r\n                    canvas.DrawText($\u0022{angle} degress (good)\u0022, x \u002B 20, y, TextStyleFillPaint);\r\n                }\r\n\r\n                using (var data = surface.Snapshot().Encode())\r\n                {\r\n                    using (var stream = File.OpenWrite(\u0022image.png\u0022))\r\n                    {\r\n                        data.SaveTo(stream);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\u0060\u0060\u0060\r\n\r\nThe code above generates this image (click on the image to see higher resolution version):\r\n![image](https://user-images.githubusercontent.com/1830747/29421021-6a896f04-837c-11e7-8ade-e40611201bc4.png)\r\n\r\nI\u0027m using net core 2.0.0 with SkiaSharp v1.59.1 on Mac and Linux and it happens on both.",
  "author": {
    "login": "adrian-catana",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "milestone": "v1.68.0",
  "createdAt": "2017-08-17T15:53:25",
  "updatedAt": "2022-08-19T18:02:49",
  "closedAt": "2018-11-26T16:10:28",
  "commentCount": 4,
  "reactionCount": 1,
  "engagement": {
    "syncedAt": "2026-02-04T20:38:51.9533415Z",
    "reactions": [
      {
        "user": "OutSorcerer",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:38:51.9533487Z"
      }
    ],
    "comments": [
      {
        "id": 412838194,
        "author": "paulinventome",
        "createdAt": "2018-08-14T11:17:33",
        "reactions": []
      },
      {
        "id": 413019159,
        "author": "define-private-public",
        "createdAt": "2018-08-14T21:17:17",
        "reactions": []
      },
      {
        "id": 431348445,
        "author": "zachsteffens",
        "createdAt": "2018-10-19T12:36:30",
        "reactions": []
      },
      {
        "id": 441696746,
        "author": "mattleibow",
        "createdAt": "2018-11-26T16:10:28",
        "reactions": [
          {
            "user": "OutSorcerer",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:38:51.9038389Z"
          }
        ]
      }
    ]
  }
}