{
  "number": 254,
  "type": "issue",
  "state": "closed",
  "title": "DrawBitmap in Android crashes the application (DllImport)",
  "body": "Windows 10 - VS2015 - Android emulator on 5.0.1/6.0/7.0 (at least I tested on these) with Intel x86 architecture \u002B play services - MultiDex On\r\n\r\nBasic things like drawing lines/Clear with color works properly, but whenever I try to draw bitmap in any way it crashes the application even if the method calls are in try-catch block.\r\n\r\nOnDraw in class that extends SKCanvasView\r\n\u0060\u0060\u0060\r\nprotected override void OnDraw( SKSurface surface, SKImageInfo info )\r\n{\r\n//....\r\nif( mBackgroundBitmap != null )\r\n        {\r\n            //var pp = new SKPaint();\r\n            //pp.XferMode = SKXferMode.\r\n            var np = new SKPaint();\r\n            np.BlendMode = SKBlendMode.Multiply;\r\n\r\n            try\r\n            {\r\n                canvas.Clear();\r\n                //All methods I tried to draw the bitmap with\r\n                //canvas.DrawBitmap(mBackgroundBitmap, info.Rect);\r\n                //canvas.DrawBitmap( mBackgroundBitmap, info.Rect, np );\r\n                //var image = SKImage.FromPixels(mBackgroundBitmap.Info, mBackgroundBitmap.GetPixels(), mBackgroundBitmap.RowBytes);\r\n                //canvas.DrawImage(image, 0, 0);\r\n                canvas.DrawBitmap(mBackgroundBitmap, SKRect.Create(canvasW, canvasH), new SKPaint());\r\n            }\r\n            catch( Exception ex )\r\n            {\r\n                System.Diagnostics.Debug.WriteLine( $\u0022OnDraw - {ex}\u0022 );\r\n            }\r\n        }\r\n//...\r\n}\r\n\u0060\u0060\u0060\r\n\r\nWhenever Draw/Convert Bitmap to Image method is called the app instantly crashes and the output spits out this Stacktrace:\r\n\r\n\u0060\u0060\u0060\r\n02-22 12:32:30.720 D/Mono    ( 3278): DllImport searching in: \u0027libSkiaSharp.so\u0027 (\u0027libSkiaSharp.so\u0027).\r\n02-22 12:32:30.720 D/Mono    ( 3278): Searching for \u0027sk_canvas_draw_bitmap_rect\u0027.\r\n02-22 12:32:30.720 D/Mono    ( 3278): Probing \u0027sk_canvas_draw_bitmap_rect\u0027.\r\n02-22 12:32:30.720 D/Mono    ( 3278): Found as \u0027sk_canvas_draw_bitmap_rect\u0027.\r\n02-22 12:32:30.722 E/mono-rt ( 3278): Stacktrace:\r\n02-22 12:32:30.722 E/mono-rt ( 3278): \r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at (wrapper managed-to-native) SkiaSharp.SkiaApi.sk_canvas_draw_bitmap_rect (intptr,intptr,intptr,SkiaSharp.SKRect\u0026,intptr) \u003C0x00012\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at SkiaSharp.SKCanvas.DrawBitmap (SkiaSharp.SKBitmap,SkiaSharp.SKRect,SkiaSharp.SKPaint) \u003CIL 0x0003a, 0x00177\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at hlma.lawnrun.Droid.ImageEditorCanvasView.OnDraw (SkiaSharp.SKSurface,SkiaSharp.SKImageInfo) [0x0004a] in C:\\Users\\Administrator\\Desktop\\Android\\mapop-android\\hlma.lawnrun.Droid\\Controls\\ImageEditorCanvasView.cs:190\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at SkiaSharp.Views.Android.SKCanvasView.OnDraw (Android.Graphics.Canvas) \u003CIL 0x0009e, 0x00390\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at Android.Views.View.n_OnDraw_Landroid_graphics_Canvas_ (intptr,intptr,intptr) [0x00011] in /Users/builder/data/lanes/3511/501e63ce/source/monodroid/src/Mono.Android/platforms/android-24/src/generated/Android.Views.View.cs:14432\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at (wrapper dynamic-method) object.846526ab-dc63-4232-99bd-37ed1032d9f5 (intptr,intptr,intptr) \u003CIL 0x00017, 0x00027\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at (wrapper native-to-managed) object.846526ab-dc63-4232-99bd-37ed1032d9f5 (intptr,intptr,intptr) \u003CIL 0x00022, 0x0009f\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at (wrapper managed-to-native) Java.Interop.NativeMethods.java_interop_jnienv_call_static_void_method_a (intptr,intptr\u0026,intptr,intptr,Java.Interop.JniArgumentValue*) \u003C0x00012\u003E\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at Java.Interop.JniEnvironment/StaticMethods.CallStaticVoidMethod (Java.Interop.JniObjectReference,Java.Interop.JniMethodInfo,Java.Interop.JniArgumentValue*) [0x00069] in /Users/builder/data/lanes/3511/501e63ce/source/Java.Interop/src/Java.Interop/Java.Interop/JniEnvironment.g.cs:13005\r\n02-22 12:32:30.722 E/mono-rt ( 3278):   at Java.Interop.JniPeerMembers/JniStaticMethods.InvokeVoidMethod (string,Java.Interop.JniArgumentValue*) [0x0001b] in /Users/builder/data/lanes/3511/501e63ce/source/Java.Interop/src/Java.Interop/Java.Interop/JniPeerMembers.JniStaticMethods.cs:43\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at Android.OS.Looper.Loop () [0x00000] in /Users/builder/data/lanes/3511/501e63ce/source/monodroid/src/Mono.Android/platforms/android-24/src/generated/Android.OS.Looper.cs:173\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at hlma.lawnrun.Droid.Services.LocationServiceDroid/\u003CRunInLooper\u003Ed__18.MoveNext () [0x000be] in C:\\Users\\Administrator\\Desktop\\Android\\mapop-android\\hlma.lawnrun.Droid\\Services\\LocationServiceDroid.cs:161\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Runtime.CompilerServices.AsyncMethodBuilderCore/MoveNextRunner.InvokeMoveNext (object) [0x00000] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/runtime/compilerservices/AsyncMethodBuilder.cs:1089\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.ExecutionContext.RunInternal (System.Threading.ExecutionContext,System.Threading.ContextCallback,object,bool) [0x0008d] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/executioncontext.cs:957\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.ExecutionContext.Run (System.Threading.ExecutionContext,System.Threading.ContextCallback,object,bool) [0x00000] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/executioncontext.cs:904\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Runtime.CompilerServices.AsyncMethodBuilderCore/MoveNextRunner.Run () [0x0003b] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/runtime/compilerservices/AsyncMethodBuilder.cs:1070\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.AwaitTaskContinuation.InvokeAction (object) [0x00000] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/TaskContinuation.cs:741\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.AwaitTaskContinuation.RunCallback (System.Threading.ContextCallback,object,System.Threading.Tasks.Task\u0026) [0x00017] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/TaskContinuation.cs:770\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.SynchronizationContextAwaitTaskContinuation.Run (System.Threading.Tasks.Task,bool) [0x00016] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/TaskContinuation.cs:419\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.Task.FinishContinuations () [0x000b7] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/Task.cs:3642\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.Task.FinishStageThree () [0x00045] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/Task.cs:2366\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.Task\u00601\u003CTResult_REF\u003E.TrySetResult (TResult_REF) [0x00058] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/Future.cs:488\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.TaskCompletionSource\u00601\u003CTResult_REF\u003E.TrySetResult (TResult_REF) [0x00000] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/TaskCompletionSource.cs:298\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at System.Threading.Tasks.TaskCompletionSource\u00601\u003CTResult_REF\u003E.SetResult (TResult_REF) [0x00000] in /Users/builder/data/lanes/3511/501e63ce/source/mono/mcs/class/referencesource/mscorlib/system/threading/Tasks/TaskCompletionSource.cs:321\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at Android.Gms.Common.Apis.AwaitableResultCallback\u00601\u003CTResult_REF\u003E.OnResult (Java.Lang.Object) \u003CIL 0x0000e, 0x00097\u003E\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at Android.Gms.Common.Apis.IResultCallbackInvoker.n_OnResult_Lcom_google_android_gms_common_api_Result_ (intptr,intptr,intptr) \u003CIL 0x00013, 0x000c8\u003E\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at (wrapper dynamic-method) object.badf158a-c251-40f7-9d7a-2dff344be4f0 (intptr,intptr,intptr) \u003CIL 0x00017, 0x00027\u003E\r\n02-22 12:32:30.723 E/mono-rt ( 3278):   at (wrapper native-to-managed) object.badf158a-c251-40f7-9d7a-2dff344be4f0 (intptr,intptr,intptr) \u003CIL 0x00022, 0x0009f\u003E\r\n\u0060\u0060\u0060\r\n\r\nFound in the output some errors while loading the library as well but in the end it says that it\u0027s loaded and basic functionality works\r\n\r\n\u0060\u0060\u0060\r\n02-22 12:32:30.184 D/Mono    ( 3278): DllImport attempting to load: \u0027libSkiaSharp.so\u0027.\r\n02-22 12:32:30.185 D/Mono    ( 3278): DllImport error loading library \u0027/data/data/superSecretPackage/files/.__override__/libSkiaSharp.so\u0027: \u0027dlopen failed: library \u0022/data/app/superSecretPackage-1/lib/x86//data/data/superSecretPackage/files/.__override__/libSkiaSharp.so\u0022 not found\u0027.\r\n02-22 12:32:30.185 D/Mono    ( 3278): DllImport error loading library \u0027/data/data/superSecretPackage/files/.__override__/libSkiaSharp.so\u0027: \u0027dlopen failed: library \u0022/data/app/superSecretPackage-1/lib/x86//data/data/superSecretPackage/files/.__override__/libSkiaSharp.so\u0022 not found\u0027.\r\n02-22 12:32:30.185 D/Mono    ( 3278): DllImport error loading library \u0027/system/lib/libSkiaSharp.so\u0027: \u0027dlopen failed: library \u0022/data/app/superSecretPackage-1/lib/x86//system/lib/libSkiaSharp.so\u0022 not found\u0027.\r\n02-22 12:32:30.185 D/Mono    ( 3278): DllImport error loading library \u0027/system/lib/libSkiaSharp.so\u0027: \u0027dlopen failed: library \u0022/data/app/superSecretPackage-1/lib/x86//system/lib/libSkiaSharp.so\u0022 not found\u0027.\r\n02-22 12:32:30.186 D/Mono    ( 3278): DllImport loaded library \u0027libSkiaSharp.so\u0027.\r\n02-22 12:32:30.186 D/Mono    ( 3278): DllImport searching in: \u0027libSkiaSharp.so\u0027 (\u0027libSkiaSharp.so\u0027).\r\n02-22 12:32:30.186 D/Mono    ( 3278): Searching for \u0027sk_surface_new_raster_direct\u0027.\r\n02-22 12:32:30.186 D/Mono    ( 3278): Probing \u0027sk_surface_new_raster_direct\u0027.\r\n02-22 12:32:30.186 D/Mono    ( 3278): Found as \u0027sk_surface_new_raster_direct\u0027.\r\n\r\n\u0060\u0060\u0060",
  "author": {
    "login": "karosas",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2017-02-22T12:46:36",
  "updatedAt": "2022-08-19T21:02:28",
  "closedAt": "2017-02-28T23:43:40",
  "commentCount": 3,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:36:21.5627491Z",
    "reactions": [],
    "comments": [
      {
        "id": 281673009,
        "author": "karosas",
        "createdAt": "2017-02-22T13:45:36",
        "reactions": []
      },
      {
        "id": 282310753,
        "author": "karosas",
        "createdAt": "2017-02-24T14:54:37",
        "reactions": []
      },
      {
        "id": 282452641,
        "author": "mattleibow",
        "createdAt": "2017-02-25T02:21:40",
        "reactions": [
          {
            "user": "lucidBrot",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:36:21.5123132Z"
          }
        ]
      }
    ]
  }
}