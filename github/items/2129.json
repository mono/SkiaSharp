{
  "number": 2129,
  "type": "pr",
  "state": "closed",
  "title": "Add a benchmark for SKData",
  "body": "**Description of Change**\r\n\r\nThis PR just updates the benchmarks project and build tooling so that it is easier to run benchmarks.\r\n\r\nBenchmarks can be run from the IDE or via the CLI:\r\n\r\n\u0060\u0060\u0060\r\ncd benchmarks/SkiaSharp.Benchmarks\r\ndotnet run -c Release -f net6.0\r\n\u0060\u0060\u0060\r\n\r\nI ran on CI: https://github.com/mattleibow/SkiaSharpBenchmarks/runs/7082633214\r\nDownload ETL \u002B Artifacts (226MB): https://github.com/mattleibow/SkiaSharpBenchmarks/suites/7116242957/artifacts/282140555\r\nlibSkiaSharp.dll Symbols: [libSkiaSharp.pdb.zip](https://github.com/mono/SkiaSharp/files/8996484/libSkiaSharp.pdb.zip)\r\n\r\n\r\nThe tests are simple and compare all the complexity of managed types and the handle registration with the raw p/invokes and I find the p/invokes are slower... somehow slower than all the managed stuff that also calls the very same p/invokes since the managed stuff wraps the p/invokes...\r\n\r\n\u0060\u0060\u0060\r\n// * Summary *\r\n\r\nBenchmarkDotNet=v0.13.1, OS=Windows 10.0.20348\r\nIntel Xeon Platinum 8272CL CPU 2.60GHz, 1 CPU, 2 logical and 2 physical cores\r\n.NET SDK=6.0.301\r\n  [Host]   : .NET 6.0.6 (6.0.622.26707), X64 RyuJIT\r\n  .NET 6.0 : .NET 6.0.6 (6.0.622.26707), X64 RyuJIT\r\n\r\nJob=.NET 6.0  Runtime=.NET 6.0  \r\n\r\n|      Method | SizeKB |       Mean |     Error |    StdDev |     Median |     Gen 0 |    Allocated |\r\n|------------ |------- |-----------:|----------:|----------:|-----------:|----------:|-------------:|\r\n|    Seekable |      1 | 177.338 ms | 1.2944 ms | 1.2107 ms | 177.187 ms | 1666.6667 | 35,200,469 B |\r\n| NonSeekable |      1 | 249.793 ms | 1.1976 ms | 1.1202 ms | 249.815 ms | 2000.0000 | 45,604,072 B |\r\n|     PInvoke |      1 |  33.169 ms | 0.2254 ms | 0.1998 ms |  33.073 ms |         - |         32 B |  \u003C-\r\n|    Seekable |    100 |   8.631 ms | 0.0325 ms | 0.0304 ms |   8.643 ms |   15.6250 |    352,014 B |\r\n| NonSeekable |    100 |  20.535 ms | 0.7700 ms | 2.2216 ms |  21.214 ms |         - |    456,034 B |\r\n|     PInvoke |    100 |  23.658 ms | 1.5165 ms | 4.4476 ms |  25.085 ms |         - |         15 B |  \u003C-\r\n|    Seekable |   1000 |  19.620 ms | 0.1443 ms | 0.1280 ms |  19.612 ms |         - |     35,214 B |\r\n| NonSeekable |   1000 |  26.144 ms | 1.3387 ms | 3.8411 ms |  24.046 ms |         - |     45,702 B |\r\n|     PInvoke |   1000 |  20.989 ms | 0.3592 ms | 0.7255 ms |  20.883 ms |         - |         34 B |  \u003C-\r\n|    Seekable |  10000 |  76.404 ms | 0.8505 ms | 0.7540 ms |  76.370 ms |         - |      3,721 B |\r\n| NonSeekable |  10000 | 112.895 ms | 2.2408 ms | 5.3688 ms | 112.395 ms |         - |      4,764 B |\r\n|     PInvoke |  10000 |  94.687 ms | 1.8322 ms | 2.2501 ms |  95.006 ms |         - |        120 B |  \u003C-\r\n\r\n// * Warnings *\r\nMultimodalDistribution\r\n  SKDataCreateFromStream.NonSeekable: .NET 6.0 -\u003E It seems that the distribution can have several modes (mValue = 2.95)\r\n\r\n// * Hints *\r\nOutliers\r\n  SKDataCreateFromStream.PInvoke: .NET 6.0     -\u003E 1 outlier  was  removed (33.62 ms)\r\n  SKDataCreateFromStream.NonSeekable: .NET 6.0 -\u003E 4 outliers were removed, 12 outliers were detected (13.21 ms..13.42 ms, 22.22 ms..22.95 ms)\r\n  SKDataCreateFromStream.PInvoke: .NET 6.0     -\u003E 1 outlier  was  removed, 11 outliers were detected (10.40 ms..10.59 ms, 25.82 ms)\r\n  SKDataCreateFromStream.Seekable: .NET 6.0    -\u003E 1 outlier  was  removed (20.01 ms)\r\n  SKDataCreateFromStream.NonSeekable: .NET 6.0 -\u003E 5 outliers were removed (50.09 ms..52.60 ms)\r\n  SKDataCreateFromStream.PInvoke: .NET 6.0     -\u003E 15 outliers were removed (28.03 ms..32.39 ms)\r\n  SKDataCreateFromStream.Seekable: .NET 6.0    -\u003E 1 outlier  was  removed (78.93 ms)\r\n\r\n// * Legends *\r\n  SizeKB    : Value of the \u0027SizeKB\u0027 parameter\r\n  Mean      : Arithmetic mean of all measurements\r\n  Error     : Half of 99.9% confidence interval\r\n  StdDev    : Standard deviation of all measurements\r\n  Median    : Value separating the higher half of all measurements (50th percentile)\r\n  Gen 0     : GC Generation 0 collects per 1000 operations\r\n  Allocated : Allocated memory per single operation (managed only, inclusive, 1KB = 1024B)\r\n  1 ms      : 1 Millisecond (0.001 sec)\r\n\u0060\u0060\u0060\r\n\r\n\u0060\u0060\u0060\r\n// * Summary *\r\n\r\nBenchmarkDotNet=v0.13.1, OS=Windows 10.0.22000\r\nIntel Core i9-9980HK CPU 2.40GHz, 1 CPU, 16 logical and 8 physical cores\r\n.NET SDK=6.0.400-preview.22301.10\r\n  [Host]   : .NET 6.0.6 (6.0.622.26707), X64 RyuJIT\r\n  .NET 6.0 : .NET 6.0.6 (6.0.622.26707), X64 RyuJIT\r\n\r\nJob=.NET 6.0  Runtime=.NET 6.0\r\n\r\n|      Method | SizeKB |       Mean |     Error |     StdDev |     Median |     Gen 0 |    Allocated |\r\n|------------ |------- |-----------:|----------:|-----------:|-----------:|----------:|-------------:|\r\n|    Seekable |      1 | 151.756 ms | 3.0298 ms |  6.9614 ms | 151.189 ms | 4000.0000 | 35,200,204 B |\r\n| NonSeekable |      1 | 208.893 ms | 4.3076 ms | 12.4285 ms | 205.653 ms | 5000.0000 | 45,600,816 B |\r\n|     PInvoke |      1 |  27.417 ms | 0.5226 ms |  0.5592 ms |  27.318 ms |         - |         15 B |  \u003C-\r\n|    Seekable |    100 |   7.288 ms | 0.0847 ms |  0.1215 ms |   7.302 ms |   31.2500 |    352,013 B |\r\n| NonSeekable |    100 |  16.017 ms | 0.4614 ms |  1.3459 ms |  16.053 ms |   46.8750 |    456,013 B |\r\n|     PInvoke |    100 |  17.501 ms | 1.1390 ms |  3.2310 ms |  18.604 ms |         - |         15 B |  \u003C-\r\n|    Seekable |   1000 |  12.377 ms | 0.2014 ms |  0.1682 ms |  12.343 ms |         - |     35,214 B |\r\n| NonSeekable |   1000 |  18.203 ms | 1.0855 ms |  3.1144 ms |  16.843 ms |         - |     45,663 B |\r\n|     PInvoke |   1000 |  16.223 ms | 0.3213 ms |  0.6984 ms |  16.112 ms |         - |         15 B |  \u003C-\r\n|    Seekable |  10000 |  34.093 ms | 0.4628 ms |  0.4103 ms |  34.059 ms |         - |      3,571 B |\r\n| NonSeekable |  10000 |  50.349 ms | 0.9412 ms |  1.6971 ms |  49.599 ms |         - |      4,662 B |\r\n|     PInvoke |  10000 |  49.853 ms | 0.8517 ms |  0.9466 ms |  49.715 ms |         - |        120 B |  \u003C-\r\n\r\n// * Hints *\r\nOutliers\r\n  SKDataCreateFromStream.Seekable: .NET 6.0    -\u003E 1 outlier  was  removed (186.02 ms)\r\n  SKDataCreateFromStream.NonSeekable: .NET 6.0 -\u003E 4 outliers were removed (246.96 ms..276.37 ms)\r\n  SKDataCreateFromStream.Seekable: .NET 6.0    -\u003E 9 outliers were removed (8.34 ms..9.08 ms)\r\n  SKDataCreateFromStream.NonSeekable: .NET 6.0 -\u003E 2 outliers were removed, 8 outliers were detected (11.15 ms..11.92 ms, 18.40 ms, 19.63 ms)\r\n  SKDataCreateFromStream.PInvoke: .NET 6.0     -\u003E 7 outliers were removed, 21 outliers were detected (9.55 ms..10.51 ms, 20.88 ms..23.54 ms)\r\n  SKDataCreateFromStream.Seekable: .NET 6.0    -\u003E 2 outliers were removed (13.08 ms, 15.96 ms)\r\n  SKDataCreateFromStream.NonSeekable: .NET 6.0 -\u003E 5 outliers were removed (27.88 ms..31.10 ms)\r\n  SKDataCreateFromStream.PInvoke: .NET 6.0     -\u003E 8 outliers were removed (19.61 ms..20.83 ms)\r\n  SKDataCreateFromStream.Seekable: .NET 6.0    -\u003E 1 outlier  was  removed (36.37 ms)\r\n  SKDataCreateFromStream.NonSeekable: .NET 6.0 -\u003E 12 outliers were removed (58.64 ms..66.31 ms)\r\n  SKDataCreateFromStream.PInvoke: .NET 6.0     -\u003E 4 outliers were removed (54.43 ms..57.34 ms)\r\n\r\n// * Legends *\r\n  SizeKB    : Value of the \u0027SizeKB\u0027 parameter\r\n  Mean      : Arithmetic mean of all measurements\r\n  Error     : Half of 99.9% confidence interval\r\n  StdDev    : Standard deviation of all measurements\r\n  Median    : Value separating the higher half of all measurements (50th percentile)\r\n  Gen 0     : GC Generation 0 collects per 1000 operations\r\n  Allocated : Allocated memory per single operation (managed only, inclusive, 1KB = 1024B)\r\n  1 ms      : 1 Millisecond (0.001 sec)\r\n\u0060\u0060\u0060",
  "author": {
    "login": "mattleibow",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-06-27T19:23:59",
  "updatedAt": "2024-02-08T23:53:33",
  "closedAt": "2024-02-08T23:53:33",
  "commentCount": 1,
  "reactionCount": 0,
  "draft": true,
  "mergeable": false,
  "mergeableState": "dirty",
  "baseBranch": "main",
  "headBranch": "dev/perf",
  "additions": 107,
  "deletions": 1,
  "changedFiles": 2,
  "commits": 7,
  "reviews": []
}