{
  "number": 2040,
  "type": "issue",
  "state": "open",
  "title": "[FEATURE] more informative building instructions (for Windows)",
  "body": "To build \u0060SkiaSharp\u0060 on \u0060Windows\u0060:\r\n\r\nthis requires \u0060~50GB\u0060 for \u0060installation/setup\u0060\r\nand an additional \u006044GB\u0060 for building natives and bindings/views\r\n\r\nbuilding is recommended on \u0060EXTERNAL HARD-DRIVE\u0060 if free space on internal hdd is small\r\n\r\ninstall \u0060VS 2022\u0060\r\ninstall specified https://github.com/mono/SkiaSharp/wiki/Building-SkiaSharp for 2022\r\n\r\nNOTE: \u0060MSVC v143 - VS 2019 C\u002B\u002B build tools\u0060 (x86/64, ARM, and ARM64) are required for the UWP natives to build\r\n\r\nNOTE: \u0060Xamarin SDKs\u0060 are required to build \u0060libs\u0060 (SkiaSharp bindings)\r\n\r\nIMPORTANT: the following files require re-targeting\r\n\u0060\u0060\u0060\r\nnative/uwp/libHarfBuzzSharp/libHarfBuzzSharp.sln\r\n\r\nnative/uwp/SkiaSharp.Views.Interop.UWP/SkiaSharp.Views.Interop.UWP.sln\r\n\r\nnative/windows/libHarfBuzzSharp/libHarfBuzzSharp.sln\r\n\u0060\u0060\u0060\r\n\r\nopen each solution, select \u0060Retarget solution\u0060 and then select \u0060Update to v143\u0060 and then select \u0060ok\u0060\r\n\r\n\u0060~25GB\u0060 for components installation\r\n\r\n\u0060Windows 10 SDK (10.0.10240)\u0060 can be obtained from https://go.microsoft.com/fwlink/p/?LinkId=619296\r\n\u0060Windows 10 SDK (10.0.16299.91)\u0060 can be obtained from https://go.microsoft.com/fwlink/p/?linkid=864422\r\n\r\n\u0060Android NDK\u0060 is \u0060not available in VS component selection\u0060\r\n\r\ninstall \u0060Android NDK 21\u0060 from https://github.com/android/ndk/wiki/Unsupported-Downloads#r21e\r\n\r\n\u0060Android NDK 22\u0060 restructures the following root paths, which are not yet adapted to this build system\r\n\u0060\u0060\u0060\r\n   * platforms\r\n   * sources/cxx-stl\r\n   * sysroot\r\n   * toolchains (with the exception of toolchains/llvm)\r\n\r\n   In general this change should only affect build system maintainers, or those\r\n   using build systems that are not up to date. ndk-build and the CMake\r\n   toolchain users are unaffected, and neither are\r\n   \u0060make_standalone_toolchain.py\u0060 users (though that script has been unnecessary\r\n   since r19).\r\n\u0060\u0060\u0060\r\n\r\n\r\ngo to \u0060System \u003E Advanced System Settings \u003E Environment Variables\u0060\r\nadd the following\r\n\u0060\u0060\u0060\r\nname:  ANDROID_SDK_ROOT\r\nvalue: C:\\Program Files (x86)\\Android\\android-sdk\r\n\u0060\u0060\u0060\r\nthe above is where VS installs the sdk to\r\n\r\n\r\n\u0060\u0060\u0060\r\nname:  ANDROID_NDK_ROOT\r\nvalue: C:\\Users\\small\\Downloads\\android-ndk-r21\r\n\u0060\u0060\u0060\r\n(replace \u0022small\u0022 with your username)\r\n\r\nrestart your machine to apply the above changes to system environmental variables\r\n\r\n\r\n\r\nopen and replace \u0060./scripts/install-android-platform.ps1\u0060 with the following content\r\n\u0060\u0060\u0060ps1\r\nParam(\r\n    [string] $API\r\n)\r\n\r\n$ErrorActionPreference = \u0027Stop\u0027\r\n\r\n$sdk = \u0022$env:ANDROID_SDK_ROOT\u0022\r\n\r\n$apiPath = \u0022$sdk/platforms/android-$API/android.jar\u0022\r\nif (Test-Path $apiPath) {\r\n    Write-Host \u0022Android API level $API was already installed.\u0022\r\n    exit 0\r\n}\r\n\r\n$latest = \u0022$sdk/cmdline-tools/latest\u0022\r\nif (-not (Test-Path $latest)) {\r\n    $versions = Get-ChildItem (\u0022$sdk/cmdline-tools\u0022)\r\n    $latest = \u0022$sdk/cmdline-tools/\u0022 \u002B ($versions | Select-Object -Last 1)[0]\r\n}\r\n\r\nif (-not $IsMacOS -and -not $IsLinux) {\r\n    $ext = \u0022.bat\u0022\r\n}\r\n\r\n$sdkmanager = \u0022$latest/bin/sdkmanager$ext\u0022\r\n\r\nSet-Content -Value \u0022y\u0022 -Path \u0022yes.txt\u0022\r\ntry {\r\n    if ($IsMacOS -or $IsLinux) {\r\n        sh -c \u0022\u0060\u0022$sdkmanager\u0060\u0022 \u0060\u0022platforms\\;android-$API\u0060\u0022 \u003C yes.txt\u0022\r\n    } else {\r\n        cmd /c \u0022\u0060\u0022$sdkmanager\u0060\u0022 \u0060\u0022platforms;android-$API\u0060\u0022 \u003C yes.txt\u0022\r\n    }\r\n} finally {\r\n    Remove-Item \u0022yes.txt\u0022\r\n}\r\n\r\nexit $LASTEXITCODE\r\n\u0060\u0060\u0060\r\n\r\nnext execute the following in an admin powershell\r\n\u0060\u0060\u0060\r\n./scripts/install-android-platform.ps1 29\r\n\u0060\u0060\u0060\r\n\r\nexecute the following in non-admin powershell\r\n\u0060\u0060\u0060ps1\r\n# note you will need to execute ./scripts/install-tizen.ps1\r\n# multiple times due to bugs in waiting for process to finish\r\n./scripts/install-tizen.ps1 # install tizen studio\r\n# dont execute the next line until the above is done installing tizen studio\r\n\u0060\u0060\u0060\r\n\u0060\u0060\u0060ps1\r\n# note you will need to execute ./scripts/install-tizen.ps1\r\n# multiple times due to bugs in waiting for process to finish\r\n./scripts/install-tizen.ps1 # install packages from tizen studio package manager\r\n# dont execute the next line until the above is done installing packages from tizen studio package manager\r\n\u0060\u0060\u0060\r\n\u0060\u0060\u0060ps1\r\n# note you will need to execute ./scripts/install-tizen.ps1\r\n# multiple times due to bugs in waiting for process to finish\r\n./scripts/install-tizen.ps1 # patch llvm in tizen\r\n./scripts/install-llvm.ps1 # windows llvm\r\n./scripts/install-gtk.ps1\r\n./scrips/install-maui.ps1\r\n./scrips/install-mono.ps1\r\ndotnet workload install android ios tvos macos maccatalyst wasm-tools maui --source https://api.nuget.org/v3/index.json --source https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet6/nuget/v3/index.json --source https://pkgs.dev.azure.com/dnceng/public/_packaging/darc-pub-dotnet-runtime-bd261ea4/nuget/v3/index.json --source https://pkgs.dev.azure.com/dnceng/public/_packaging/darc-pub-dotnet-emsdk-52e9452f-3/nuget/v3/index.json\r\n\u0060\u0060\u0060\r\n\r\n\r\nadd the following to \u0060cake/msbuild.cake\u0060\r\n\r\nfind\r\n\u0060\u0060\u0060ps1\r\n        if (!string.IsNullOrEmpty(MSBUILD_EXE)) {\r\n            c.ToolPath = MSBUILD_EXE;\r\n        } else if (IsRunningOnWindows() \u0026\u0026 !string.IsNullOrEmpty(VS_INSTALL)) {\r\n            c.ToolPath = ((DirectoryPath)VS_INSTALL).CombineWithFilePath(\u0022MSBuild/Current/Bin/MSBuild.exe\u0022);\r\n        }\r\n\u0060\u0060\u0060\r\nand replace it with\r\n\u0060\u0060\u0060ps1\r\n        if (!string.IsNullOrEmpty(MSBUILD_EXE)) {\r\n            c.ToolPath = MSBUILD_EXE;\r\n        } else if (IsRunningOnWindows()) {\r\n            if (!string.IsNullOrEmpty(VS_INSTALL)) {\r\n                c.ToolPath = ((DirectoryPath)VS_INSTALL).CombineWithFilePath(\u0022MSBuild/Current/Bin/MSBuild.exe\u0022);\r\n            } else {\r\n                // check for msbuild 17, this is required to build .net 6 projects (non-natives)\r\n                // VS 2022 is in preview\r\n                // check VS 2022 Community when it comes out of preview\r\n                bool vs2022Cexists = DirectoryExists(\u0022C:/Program Files/Microsoft Visual Studio/2022/Community\u0022);\r\n                bool vs2022Pexists = DirectoryExists(\u0022C:/Program Files/Microsoft Visual Studio/2022/Preview\u0022);\r\n                if (!vs2022Pexists \u0026\u0026 !vs2022Cexists) {\r\n                    throw new Exception(\u0022Visual Studio 2022 Preview or Community is required\u0022);\r\n                }\r\n                if (vs2022Pexists) {\r\n                    c.ToolPath = \u0022C:/Program Files/Microsoft Visual Studio/2022/Preview/MSBuild/Current/Bin/MSBuild.exe\u0022;\r\n                }\r\n                if (vs2022Cexists) {\r\n                    c.ToolPath = \u0022C:/Program Files/Microsoft Visual Studio/2022/Community/MSBuild/Current/Bin/MSBuild.exe\u0022;\r\n                }\r\n            }\r\n        }\r\n\u0060\u0060\u0060\r\n\r\n\r\n\r\n\r\n\r\nnext, we can begin building\r\n\r\nwe will assume \u0060K:\\\u0060 is location of \u0060SkiaSharp git repo\u0060 and the repo has been cloned into \u0060SkiaSharp\u0060\r\n\r\nfirst we need to grab all external libs needed to pack the nuget\r\n\r\n\u0060\u0060\u0060ps1\r\ndotnet cake --target=externals-download\r\n\u0060\u0060\u0060\r\n\r\nany native builds will be built over the top of these\r\n\u0060\u0060\u0060ps1\r\nbuild/windows/skia.so -\u003E out/native/windows/skia.so # overwrites downloaded native/windows/skia.so\r\n\u0060\u0060\u0060\r\n\r\nwhen building on a different platform the above will need to be done to retain changes to native libs\r\n\u0060\u0060\u0060\r\nWindows natives/windows/skia.so -\u003E K:\\skia.so\r\nOSX download natives\r\nOSX K:\\skia.so -\u003E natives/windows/skia.so // for windows\r\n\u0060\u0060\u0060\r\nnext we build\r\n\r\nthe nugets (WITH NATIVE BUILDING) can be built via\r\n\u0060\u0060\u0060ps1\r\ncd K:\\SkiaSharp\\\r\ndotnet tool restore\r\n\r\nif ($?) {\r\n\tdotnet run --project=utils/SkiaSharpGenerator/SkiaSharpGenerator.csproj -- generate --config binding/libSkiaSharp.json --skia externals/skia --output binding/Binding/SkiaApi.generated.cs\r\n\tif ($?) {\r\n\t\tdotnet run --project=utils/SkiaSharpGenerator/SkiaSharpGenerator.csproj -- verify --config binding/libSkiaSharp.json --skia externals/skia\r\n\t\tif ($?) {\r\n\t\t\tdotnet cake --target=nuget --buildall=true\r\n\t\t}\r\n\t}\r\n}\r\n\u0060\u0060\u0060\r\nthis is useful if you want to \u0060build the natives\u0060 (and then build C# bindings to be able to test) (\u0060when modifying native code\u0060)\r\n\r\nthe nugets (WITHOUT NATIVE BUILDING) can be built via\r\n\u0060\u0060\u0060ps1\r\ncd K:\\SkiaSharp\\\r\ndotnet tool restore\r\n\r\nif ($?) {\r\n\tdotnet run --project=utils/SkiaSharpGenerator/SkiaSharpGenerator.csproj -- generate --config binding/libSkiaSharp.json --skia externals/skia --output binding/Binding/SkiaApi.generated.cs\r\n\tif ($?) {\r\n\t\tdotnet run --project=utils/SkiaSharpGenerator/SkiaSharpGenerator.csproj -- verify --config binding/libSkiaSharp.json --skia externals/skia\r\n\t\tif ($?) {\r\n\t\t\tdotnet cake --target=nuget --buildall=true --skipexternals=all\r\n\t\t}\r\n\t}\r\n}\r\n\u0060\u0060\u0060\r\nthis is useful if you want to \u0060build the C# bindings only\u0060 (\u0060when your modifying the C# code\u0060)",
  "author": {
    "login": "mgood7123",
    "type": "User"
  },
  "labels": [
    {
      "name": "area/Build",
      "color": "0052cc"
    },
    {
      "name": "area/Docs",
      "color": "0052cc"
    }
  ],
  "assignees": [],
  "createdAt": "2022-05-13T03:55:19",
  "updatedAt": "2022-06-04T04:43:02",
  "commentCount": 1,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:58:40.666124Z",
    "reactions": [],
    "comments": [
      {
        "id": 1144844259,
        "author": "mgood7123",
        "createdAt": "2022-06-02T13:08:50",
        "reactions": []
      }
    ]
  }
}