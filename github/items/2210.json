{
  "number": 2210,
  "type": "issue",
  "state": "open",
  "title": "Xamarin Android Image Render [BUG] ",
  "body": "**Description**\r\nI was running version 2.80.0 and upgraded to 2.88.0.  When I did that the image I was drawing with Skiasharp scaled completely different on Android but the same on IOS.   I am going to copy in my code below...what I do know is that the SkiaSharp.Views.Forms.SKCanvasView behaves completely different in 2.88.0.  The image no longer seems to be scaled correctly on Android.   I am not sure if its the canvas.RestMatrix or the canvas.Scale that is not working correclty.  I rolled back to 2.80.0 and it behaves correctly.  \r\n\r\nI added two images, one entitled 2.88.0 where the image displays incorrectly and 2.80.0 where the image displays correctly\r\n\u003C!-- a general description goes here --\u003E\r\n\r\n**Code**\r\n\u003C!-- XAML Code Snippet --\u003E \r\n\u0060\u0060\u0060\r\n\u003CGrid BackgroundColor=\u0022Transparent\u0022\u003E\r\n                    \u003CGrid.RowDefinitions\u003E\r\n                        \u003CRowDefinition Height=\u0022450\u0022/\u003E\r\n                        \u003CRowDefinition Height=\u0022*\u0022/\u003E\r\n                    \u003C/Grid.RowDefinitions\u003E\r\n\r\n                    \u003CGrid Grid.Row=\u00220\u0022 BackgroundColor=\u0022Transparent\u0022\u003E\r\n                        \u003Cskia:SKCanvasView  x:Name=\u0022CanvasView\u0022  IgnorePixelScaling=\u0022False\u0022 \r\n                                   IsVisible=\u0022true\u0022 BackgroundColor=\u0022Transparent\u0022 EnableTouchEvents=\u0022True\u0022 Touch=\u0022CanvasView_Touch\u0022 \r\n                                   PaintSurface=\u0022CanvasView_PaintSurface\u0022 \u003E\r\n                            \u003Cskia:SKCanvasView.GestureRecognizers\u003E\r\n                                \u003CPinchGestureRecognizer PinchUpdated=\u0022PinchGestureRecognizer_PinchUpdated\u0022  /\u003E\r\n                                \u003CTapGestureRecognizer Tapped=\u0022TapGestureRecognizer_Tapped\u0022 NumberOfTapsRequired=\u00221\u0022 /\u003E\r\n                            \u003C/skia:SKCanvasView.GestureRecognizers\u003E\r\n                        \u003C/skia:SKCanvasView\u003E\r\n                    \u003C/Grid\u003E\r\n                    \u003CGrid Grid.Row=\u00221\u0022 Padding=\u00220\u0022\u003E\r\n                     \u003C/Grid\u003E\r\n\u003C/Grid\u003E\r\n\u0060\u0060\u0060\r\n\u003C!-- c# code --\u003E \r\n\u0060\u0060\u0060\r\npublic static void DrawLayout(SKImageInfo info, SKCanvas canvas, SKSvg svg, ReticleSetupViewModel vm, float redBoxAdjustment = 0)\r\n        {\r\n\r\n            var layout = vm.SelectedReticleLayout;\r\n            float magScale;\r\n            float yRatio;\r\n            float xRatio;\r\n\r\n            canvas.Translate(info.Width / 2f, info.Height / 2f);\r\n            SKRect bounds = svg.ViewBox; \r\n\r\n            if (layout.ReticleLayoutScaleType == ReticleLayoutScaleType.ReticleOnly || layout.ReticleLayoutScaleType == ReticleLayoutScaleType.WidgetAndReticle)\r\n            {\r\n                magScale = vm.SelectedReticle.ReticleZoomScale[vm.SelectedScopeAndReticles.CurrentMag];\r\n                xRatio = (info.Width / bounds.Width) \u002B ((info.Width / bounds.Width) * magScale);\r\n                yRatio = (info.Height / bounds.Height) \u002B ((info.Height / bounds.Height) * magScale);\r\n            }\r\n            else\r\n            {\r\n                magScale = vm.SelectedReticle.ReticleZoomScale[vm.SelectedScopeAndReticles.LowMag];\r\n                xRatio = (info.Width / bounds.Width) \u002B ((info.Width / bounds.Width) * magScale);\r\n                yRatio = (info.Height / bounds.Height) \u002B ((info.Height / bounds.Height) * magScale);\r\n            }\r\n\r\n            float ratio = Math.Min(xRatio, yRatio);\r\n            canvas.Scale(ratio);\r\n            canvas.Translate(-bounds.MidX, -bounds.MidY);\r\n            canvas.DrawPicture(svg.Picture);\r\n\r\n            canvas.ResetMatrix();\r\n\r\n            float imageCenter = canvas.LocalClipBounds.Width / 2;\r\n\r\n            float redBorderXOffSet = imageCenter - (imageCenter / 2.0f) \u002B canvas.LocalClipBounds.Left;\r\n\r\n            // .0654450261780105f this number is the calculation of where to draw the top of the red border below the image.  \r\n            // This was calculated from an Android phone by setting the off set to image.Top \u002B 75. \r\n            // To get the percentage take 75/Image.Bottom = .0654450261780105f\r\n            // now for any given platform we take the following to calculate the correct place for the Y offset for the red box\r\n            //float redBorderYOffSet = (float)(svg.Picture.CullRect.Top \u002B Math.Ceiling(.0654450261780105f * svg.Picture.CullRect.Bottom));\r\n            float redBorderYOffSet = (float)(canvas.LocalClipBounds.Top \u002B Math.Ceiling(.0654450261780105f * canvas.LocalClipBounds.Bottom));\r\n\r\n\r\n            float adjustedRedBorderWidth = canvas.LocalClipBounds.Width / 2.0f;\r\n\r\n            // this centers the red square, it may be different between phones and how they lay out.  \r\n            var adjustedRedborderHeight = (float)(canvas.LocalClipBounds.Bottom - Math.Ceiling(.0654450261780105f * canvas.LocalClipBounds.Bottom * 2)) - canvas.LocalClipBounds.Top;\r\n\r\n            //now account for the red box adjustment\r\n            adjustedRedborderHeight \u002B= redBoxAdjustment * 2;\r\n\r\n            // we need to clip the red square so that the widgets do not grow beyond the red square \r\n            if (layout.ReticleLayoutScaleType == ReticleLayoutScaleType.WidgetOnly || layout.ReticleLayoutScaleType == ReticleLayoutScaleType.WidgetAndReticle)\r\n            {\r\n                var redSquare = SKRect.Create(redBorderXOffSet - 2, redBorderYOffSet - 2, adjustedRedBorderWidth \u002B 4, adjustedRedborderHeight \u002B 4);\r\n                canvas.ClipRect(redSquare, SKClipOperation.Intersect);\r\n            }\r\n\r\n            canvas.DrawRect(redBorderXOffSet, redBorderYOffSet, adjustedRedBorderWidth, adjustedRedborderHeight, RedBorderPaint);\r\n\r\n            // set the node scale on the layout, I will need this to convert to send to the scope and saving to the DB for user created layouts\r\n            layout.NodeScaleWidth = adjustedRedBorderWidth / ActualLayoutWidth;\r\n            layout.NodeScaleHeight = adjustedRedborderHeight / ActualLayoutHeight;\r\n\r\n            // configure the X and Y offset locations of the Red Box\r\n            TopLeftDefaultOuterXOffSet = redBorderXOffSet \u002B 5;\r\n            TopLeftDefaultInnerXOffSet = TopLeftDefaultOuterXOffSet \u002B (MediumDataBoxWidth * layout.NodeScaleWidth * 2) \u002B 15;\r\n            TopRightDefaultOuterXOffset = (redBorderXOffSet \u002B adjustedRedBorderWidth) - 5;\r\n            TopRightDefaultInnerXOffset = TopRightDefaultOuterXOffset - ((MediumDataBoxWidth * layout.NodeScaleWidth * 3) \u002B 10);\r\n        }\r\n\u0060\u0060\u0060\r\n\r\n\u003C!-- a snippet of code that demonstrates the issue --\u003E\r\n\r\n**Expected Behavior**\r\n\r\n\u003C!-- a general description of what was the expected behavior or result --\u003E\r\n\r\n**Actual Behavior**\r\n\r\n\u003C!-- a general description of what really happened --\u003E\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.88.0\r\n- Last known good version:  2.80.0\r\n- IDE:  Visual Studio for Windows 2022\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - Android and IOS...but Android is the only one that seems to have the issue\r\n- Target Devices:   \u003C!-- the devices that you noticed this on, e.g. iPhone X --\u003E\r\n- Samsung Galaxy S10, Samsung Flip (android 12)\r\n- Samsung Galaxy Z Flip 3 (android 12)\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nPASTE ANY DETAILED VERSION INFO HERE\r\nXamarin Forms 5.0.0.2515\r\nXamarin Essentials 1.7.3\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n![2 80 0](https://user-images.githubusercontent.com/62118624/183975619-6cbc5c3b-6783-464c-855c-f1bc3fa3a368.jpg)\r\n![2 88 0](https://user-images.githubusercontent.com/62118624/183975716-e21f89e5-87a1-4f6a-9e97-c0714b62c1b5.jpg)\r\n\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n**Reproduction Link**\r\n\r\n\u003C!-- please upload or provide a link to a reproduction case --\u003E\r\n\r\n",
  "author": {
    "login": "sisaacks",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-08-10T17:18:03",
  "updatedAt": "2022-08-17T11:46:30",
  "commentCount": 1,
  "reactionCount": 0
}