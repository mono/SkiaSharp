{
  "number": 1383,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SkiaSharp can call WM_PAINT handler and random COM callbacks when creating or obtaning objects",
  "body": "\u0060\u0060\u0060\r\n   Avalonia.Win32.dll!Avalonia.Win32.WindowImpl.WndProc(System.IntPtr hWnd, uint msg, System.IntPtr wParam, System.IntPtr lParam) Line 30  C#\r\n   [Native to Managed Transition]  \r\n   [Managed to Native Transition]  \r\n   System.Private.CoreLib.dll!System.Threading.WaitHandle.WaitOneNoCheck(int millisecondsTimeout)  Unknown\r\n   System.Private.CoreLib.dll!System.Threading.WaitHandle.WaitOne(int millisecondsTimeout)  Unknown\r\n   System.Private.CoreLib.dll!System.Threading.ReaderWriterLockSlim.WaitOnEvent(System.Threading.EventWaitHandle waitEvent, ref uint numWaiters, System.Threading.ReaderWriterLockSlim.TimeoutTracker timeout, System.Threading.ReaderWriterLockSlim.EnterLockType enterLockType)  Unknown\r\n   System.Private.CoreLib.dll!System.Threading.ReaderWriterLockSlim.TryEnterWriteLockCore(System.Threading.ReaderWriterLockSlim.TimeoutTracker timeout)  Unknown\r\n   SkiaSharp.dll!SkiaSharp.HandleDictionary.RegisterHandle(System.IntPtr handle, SkiaSharp.SKObject instance)  Unknown\r\n   SkiaSharp.dll!SkiaSharp.SKObject.RegisterHandle(System.IntPtr handle, SkiaSharp.SKObject instance)  Unknown\r\n   SkiaSharp.dll!SkiaSharp.SKObject.Handle.set(System.IntPtr value)  Unknown\r\n   SkiaSharp.dll!SkiaSharp.SKObject.SKObject(System.IntPtr handle, bool owns)  Unknown\r\n   SkiaSharp.dll!SkiaSharp.SKPath.SKPath(System.IntPtr handle, bool owns)  Unknown\r\n   SkiaSharp.dll!SkiaSharp.SKPath.SKPath()  Unknown\r\n\u0060\u0060\u0060\r\n\r\nThis is caused by all locks in .NET being alertable locks that [can still run the message pump when waiting for a lock](https://stackoverflow.com/a/4540745/2231814).\r\n\r\nThis behavior might lead to unexpected behavior in the user code or even deadlocks, since user code doesn\u0027t expect to receive WM_PAINT while calling SKPath constructor.",
  "author": {
    "login": "kekekeks",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2020-07-05T22:08:40",
  "updatedAt": "2022-08-12T12:04:48",
  "commentCount": 19,
  "reactionCount": 1,
  "engagement": {
    "syncedAt": "2026-02-04T20:57:18.9547861Z",
    "reactions": [
      {
        "user": "mattleibow",
        "content": "confused",
        "createdAt": "2026-02-04T20:57:18.954794Z"
      }
    ],
    "comments": [
      {
        "id": 654902144,
        "author": "mattleibow",
        "createdAt": "2020-07-07T14:27:38",
        "reactions": []
      },
      {
        "id": 654902443,
        "author": "mattleibow",
        "createdAt": "2020-07-07T14:28:05",
        "reactions": []
      },
      {
        "id": 927289248,
        "author": "toptensoftware",
        "createdAt": "2021-09-26T11:30:07",
        "reactions": []
      },
      {
        "id": 927307185,
        "author": "noseratio",
        "createdAt": "2021-09-26T13:29:43",
        "reactions": []
      },
      {
        "id": 927319707,
        "author": "mattleibow",
        "createdAt": "2021-09-26T15:00:32",
        "reactions": []
      },
      {
        "id": 927366629,
        "author": "kekekeks",
        "createdAt": "2021-09-26T20:39:29",
        "reactions": []
      },
      {
        "id": 927397573,
        "author": "toptensoftware",
        "createdAt": "2021-09-26T23:59:20",
        "reactions": []
      },
      {
        "id": 927401966,
        "author": "noseratio",
        "createdAt": "2021-09-27T00:15:51",
        "reactions": []
      },
      {
        "id": 927409389,
        "author": "toptensoftware",
        "createdAt": "2021-09-27T00:38:39",
        "reactions": []
      },
      {
        "id": 927427284,
        "author": "toptensoftware",
        "createdAt": "2021-09-27T01:16:18",
        "reactions": []
      },
      {
        "id": 927470345,
        "author": "noseratio",
        "createdAt": "2021-09-27T02:42:59",
        "reactions": []
      },
      {
        "id": 927486808,
        "author": "toptensoftware",
        "createdAt": "2021-09-27T03:04:25",
        "reactions": [
          {
            "user": "Gillibald",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:57:17.5300543Z"
          },
          {
            "user": "noseratio",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:57:17.5300548Z"
          }
        ]
      },
      {
        "id": 927498303,
        "author": "noseratio",
        "createdAt": "2021-09-27T03:26:32",
        "reactions": []
      },
      {
        "id": 927569702,
        "author": "kekekeks",
        "createdAt": "2021-09-27T06:26:01",
        "reactions": []
      },
      {
        "id": 927580185,
        "author": "toptensoftware",
        "createdAt": "2021-09-27T06:48:45",
        "reactions": []
      },
      {
        "id": 927630172,
        "author": "noseratio",
        "createdAt": "2021-09-27T08:07:05",
        "reactions": []
      },
      {
        "id": 927689857,
        "author": "mattleibow",
        "createdAt": "2021-09-27T09:27:13",
        "reactions": [
          {
            "user": "toptensoftware",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:57:18.4690941Z"
          }
        ]
      },
      {
        "id": 927724640,
        "author": "noseratio",
        "createdAt": "2021-09-27T10:14:07",
        "reactions": [
          {
            "user": "toptensoftware",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:57:18.6972543Z"
          }
        ]
      },
      {
        "id": 927750884,
        "author": "noseratio",
        "createdAt": "2021-09-27T10:56:23",
        "reactions": [
          {
            "user": "toptensoftware",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:57:18.9044927Z"
          }
        ]
      }
    ]
  }
}