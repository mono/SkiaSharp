{
  "number": 1928,
  "type": "issue",
  "state": "closed",
  "title": "[QUESTION] Minimal WebAssembly example with NativeAOT-LLVM",
  "body": "Hi,\r\n\r\nI\u0027m trying to see if its possible to use SkiaSharp with NativeAOT-LLVM (https://github.com/dotnet/runtimelab/tree/feature/NativeAOT-LLVM).  I\u0027ve created what I think is a pretty small example (https://github.com/yowl/wskia) .  You can build it with the command line (assuming you have SkiaSharp 2.0.12)\r\n\u0060\u0060\u0060\r\ndotnet publish /p:SelfContained=true -r browser-wasm -c Debug /p:TargetArchitecture=wasm /p:PlatformTarget=AnyCPU /p:MSBuildEnableWorkloadResolver=false  --self-contained /p:EmccExtraArgs=.packages\\skiasharp.nativeassets.webassembly\\2.80.3\\build\\netstandard1.0\\libSkiaSharp.a\\2.0.12\\libSkiaSharp.a\r\n\u0060\u0060\u0060\r\nIt attempts to fill the canvas with white and draws some rectangles, there\u0027s no errors but nothing appears on the canvas, it stays black.  Is the set up code ok?   Copied below (and removed the debug that\u0027s in the original for clarity):\r\n\r\n\u0060\u0060\u0060cs\r\n        [UnmanagedCallersOnly(EntryPoint = \u0022MainLoop\u0022)]\r\n        static void MainLoop()\r\n        {\r\n            SKCanvas canvas = surface.Canvas;\r\n\r\n            canvas.Clear(SKColors.White);\r\n\r\n            // configure our brush\r\n            var redBrush = new SKPaint\r\n            {\r\n                Color = new SKColor(0xff, 0, 0),\r\n                IsStroke = true\r\n            };\r\n            var blueBrush = new SKPaint\r\n            {\r\n                Color = new SKColor(0, 0, 0xff),\r\n                IsStroke = true\r\n            };\r\n\r\n            for (int i = 0; i \u003C 64; i \u002B= 8)\r\n            {\r\n                var rect = new SKRect(i, i, 256 - i - 1, 256 - i - 1);\r\n                canvas.DrawRect(rect, (i % 16 == 0) ? redBrush : blueBrush);\r\n            }\r\n        }\r\n        static SKSurface surface;\r\n\r\n        static void Main()\r\n        {\r\n            EmscriptenWebGLContextAttributes attrs;\r\n            emscripten_webgl_init_context_attributes(\u0026attrs);\r\n\r\n            attrs.stencil = 8;\r\n            // attrs.majorVersion = 2;\r\n            fixed (byte* n = \u0026(s[0]))\r\n            {\r\n                glContext = emscripten_webgl_create_context(n, \u0026attrs); // this is \u0022#canvas\u0022\r\n            }\r\n\r\n            emscripten_webgl_make_context_current(glContext);\r\n\r\n            GRGlInterface grGlInterface = GRGlInterface.Create();\r\n\r\n            GRContext grContext = GRContext.CreateGl(grGlInterface);\r\n\r\n            emscripten_set_main_loop(\u0026MainLoop, 0, 0);\r\n\r\n            const SKColorType colorType = SKColorType.Rgba8888;\r\n\r\n            int width, height;\r\n            fixed (byte* n = \u0026(s[0]))\r\n            {\r\n                emscripten_get_canvas_element_size(n, \u0026width, \u0026height);\r\n            }\r\n\r\n            var info = new GRGlFramebufferInfo(0, colorType.ToGlSizedFormat());\r\n\r\n            surface = SKSurface.Create(grContext, new GRBackendRenderTarget(width, height, 0, 8, info),\r\n                colorType);\r\n            if (surface != null)\r\n            {\r\n                Console.WriteLine(\u0022got a surface\u0022);\r\n            }\r\n            else\r\n            {\r\n                Console.WriteLine(\u0022Failed to create surface\u0022);\r\n            }\r\n\r\n            surface.Canvas.DrawColor(SKColors.White);\r\n    }\r\n\u0060\u0060\u0060\r\n\r\n",
  "author": {
    "login": "yowl",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-01-23T00:23:26",
  "updatedAt": "2024-08-21T15:16:06",
  "closedAt": "2024-08-21T15:16:06",
  "commentCount": 1,
  "reactionCount": 1,
  "engagement": {
    "syncedAt": "2026-02-04T20:12:13.5045338Z",
    "reactions": [
      {
        "user": "charlesroddie",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:12:13.5045389Z"
      }
    ],
    "comments": [
      {
        "id": 1129057319,
        "author": "mattleibow",
        "createdAt": "2022-05-17T16:09:15",
        "reactions": []
      }
    ]
  }
}