{
  "number": 2715,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Publishing tvOS application with SkiaSharp fails",
  "body": "### Description\n\nWhen I am trying to publish a tvOS app with SkiaSharp referenced, compilation fails.\r\nIt works well when I am running in debug with simulator though. \n\n### Code\n\nPretty much any usage of SkiaSharp. For example:\r\n\r\n\u0060\u0060\u0060cs\r\nusing SkiaSharp;\r\nusing tv_test;\r\n\r\nvar info = new SKImageInfo(512, 512);\r\nvar surface = SKSurface.Create(info);\r\nvar canvas = surface.Canvas;\r\ncanvas.Clear(SKColors.White);\r\n\r\nUIApplication.Main (args, null, typeof (AppDelegate));\r\n\r\n\u0060\u0060\u0060\r\n\r\nTo run:\r\n\u0060\u0060\u0060\r\ndotnet publish -c Release -r tvos-arm64\r\n\u0060\u0060\u0060\r\n\r\n[Archive.zip](https://github.com/mono/SkiaSharp/files/13930830/Archive.zip)\n\n### Expected Behavior\n\nApplication can be compiled.\n\n### Actual Behavior\n\nCompilation fails\n\n### Version of SkiaSharp\n\n2.88.3 (Current)\n\n### Last Known Good Version of SkiaSharp\n\nOther (Please indicate in the description)\n\n### IDE / Editor\n\nOther (Please indicate in the description)\n\n### Platform / Operating System\n\ntvOS\n\n### Platform / Operating System Version\n\ntvOS: 13.0\u002B\n\n### Devices\n\nApple TV\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\ntvtest -\u003E /Users/maxkatz6/repos/trash-bin/tvtest/bin/Release/net8.0-tvos/tvos-arm64/tvtest.dll\r\n  Optimizing assemblies for size may change the behavior of the app. Be sure to test after publishing. See: https://aka.ms/dotnet-illink\r\n  Optimizing assemblies for size. This process might take a while.\r\n  Tool xcrun execution finished (exit code = 1).\r\n          \r\n  Undefined symbols for architecture arm64:\r\n    \u0022_DeleteCriticalSection\u0022, referenced from:\r\n        wrapper_managed_to_native_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_DeleteCriticalSection_intptr in SkiaSharp.dll.o\r\n       (maybe you meant: _p_112_plt_SkiaSharp_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_DeleteCriticalSection_intptr_llvm)\r\n    \u0022_EnterCriticalSection\u0022, referenced from:\r\n        wrapper_managed_to_native_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_EnterCriticalSection_intptr in SkiaSharp.dll.o\r\n       (maybe you meant: _p_114_plt_SkiaSharp_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_EnterCriticalSection_intptr_llvm)\r\n    \u0022_InitializeCriticalSectionEx\u0022, referenced from:\r\n        wrapper_managed_to_native_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_InitializeCriticalSectionEx_intptr_uint_uint in SkiaSharp.dll.o\r\n       (maybe you meant: _p_111_plt_SkiaSharp_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_InitializeCriticalSectionEx_intptr_uint_uint_llvm)\r\n    \u0022_LeaveCriticalSection\u0022, referenced from:\r\n        wrapper_managed_to_native_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_LeaveCriticalSection_intptr in SkiaSharp.dll.o\r\n       (maybe you meant: _p_115_plt_SkiaSharp_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_LeaveCriticalSection_intptr_llvm)\r\n    \u0022_gnu_get_libc_version\u0022, referenced from:\r\n        wrapper_managed_to_native_SkiaSharp_Internals_PlatformConfiguration_gnu_get_libc_version in SkiaSharp.dll.o\r\n       (maybe you meant: _p_145_plt_SkiaSharp_SkiaSharp_Internals_PlatformConfiguration_gnu_get_libc_version_llvm)\r\n  ld: symbol(s) not found for architecture arm64\r\n  clang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n  \r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error : clang\u002B\u002B exited with code 1: [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error : Undefined symbols for architecture arm64: [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :   \u0022_DeleteCriticalSection\u0022, referenced from: [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :       wrapper_managed_to_native_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_DeleteCriticalSection_intptr in SkiaSharp.dll.o [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :      (maybe you meant: _p_112_plt_SkiaSharp_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_DeleteCriticalSection_intptr_llvm) [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :   \u0022_EnterCriticalSection\u0022, referenced from: [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :       wrapper_managed_to_native_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_EnterCriticalSection_intptr in SkiaSharp.dll.o [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :      (maybe you meant: _p_114_plt_SkiaSharp_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_EnterCriticalSection_intptr_llvm) [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :   \u0022_InitializeCriticalSectionEx\u0022, referenced from: [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :       wrapper_managed_to_native_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_InitializeCriticalSectionEx_intptr_uint_uint in SkiaSharp.dll.o [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :      (maybe you meant: _p_111_plt_SkiaSharp_SkiaSharp_Internals_PlatformLock_NonAlertableWin32Lock_InitializeCriticalSectionEx_intptr_uint_uint_llvm) [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\r\n/usr/local/share/dotnet/packs/Microsoft.tvOS.Sdk/17.0.8490/targets/Xamarin.Shared.Sdk.targets(1556,3): error :   \u0022_L [/Users/maxkatz6/repos/trash-bin/tvtest/tvtest.csproj]\n\u0060\u0060\u0060\n\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "maxkatz6",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2024-01-14T08:43:09",
  "updatedAt": "2024-03-03T18:00:28",
  "closedAt": "2024-02-02T16:04:03",
  "commentCount": 3,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:16:55.6016247Z",
    "reactions": [],
    "comments": [
      {
        "id": 1890895836,
        "author": "maxkatz6",
        "createdAt": "2024-01-14T09:22:01",
        "reactions": []
      },
      {
        "id": 1913061820,
        "author": "taublast",
        "createdAt": "2024-01-27T07:52:46",
        "reactions": []
      },
      {
        "id": 1913686831,
        "author": "maxkatz6",
        "createdAt": "2024-01-28T18:42:34",
        "reactions": []
      }
    ]
  }
}