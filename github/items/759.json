{
  "number": 759,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] iOS OutOfMemory crash when SKCanvasView height or width less than 1",
  "body": "This  situation may occur when SKCanvasView involved in animation\r\nFor example:\r\n\r\n\u0060 var ani = new Animation(x =\u003E _canvas.HeightRequest = x,_open ? 100 : 0,_open ? 0 : 100);\r\n  ani.Commit(_stack, \u0022sdfs\u0022, length: 2000);\r\n\u0060\r\nDemo project is attached\r\n\r\n- Version with issue:  1.68.0\r\n- IDE:   Visual Studio 15.9.3\r\n  - iOS: 12.2.1.11\r\n\r\nI work around this issue added the custom renderer:\r\n\r\n\u0060[assembly: ExportRenderer(typeof(SKCanvasView), typeof(CoreXF.iOS.MySKCanvasViewRenderer))]\r\nnamespace CoreXF.iOS\r\n{\r\n\r\n    public class  MySKCanvasView : SkiaSharp.Views.iOS.SKCanvasView\r\n    {\r\n        public override void Draw(CGRect rect)\r\n        {\r\n            if(rect.Height \u003C 1 || rect.Width \u003C 1)\r\n            {\r\n                Debug.WriteLine($\u0022Canvas {rect.Height}x{rect.Width},   Bounds {Bounds.Height}x{Bounds.Width}\u0022);\r\n                Debug.WriteLine($\u0022Skip !!\u0022);\r\n                return;\r\n            }\r\n\r\n            base.Draw(rect);\r\n        }\r\n    }\r\n\r\n    public class MySKCanvasViewRenderer : SKCanvasViewRenderer\r\n    {\r\n\r\n        public MySKCanvasViewRenderer() : base()\r\n        {\r\n        }\r\n        protected override SkiaSharp.Views.iOS.SKCanvasView CreateNativeControl()\r\n        {\r\n            return new MySKCanvasView();\r\n        }\r\n\r\n    }\r\n}\r\n\r\nLog for this renderer :\r\n[0:] Canvas 0.5x44,   Bounds 0.479999999999997x44\r\n[0:] Skip !!\r\n\r\nException log\r\n\r\n\u0060\u0060\u0060\r\nUnhandled Exception\r\nSystem.OutOfMemoryException: Out of memory\r\n2019-01-15 14:47:16.423281\u002B0300 App11.iOS[30640:979369] \r\nUnhandled Exception:\r\nOutOfMemoryException\r\n2019-01-15 14:47:16.424202\u002B0300 App11.iOS[30640:979369] Unhandled managed exception:\r\nOut of memory (System.OutOfMemoryException)\r\n  at (wrapper managed-to-native) System.Runtime.InteropServices.Marshal.ReAllocCoTaskMem(intptr,int)\r\n  at SkiaSharp.Views.iOS.SKDrawable.CreateSurface (CoreGraphics.CGRect contentsBounds, System.nfloat scale, SkiaSharp.SKImageInfo\u0026 info) [0x00080] in \u003C1dff7dabaada4d38b0d12baee26f046c\u003E:0 \r\n  at SkiaSharp.Views.iOS.SKCanvasView.Draw (CoreGraphics.CGRect rect) [0x00040] in \u003C1dff7dabaada4d38b0d12baee26f046c\u003E:0 \r\n  at (wrapper managed-to-native) UIKit.UIApplication.UIApplicationMain(int,string[],intptr,intptr)\r\n  at UIKit.UIApplication.Main (System.String[] args, System.IntPtr principal, System.IntPtr delegate) [0x00005] in /Library/Frameworks/Xamarin.iOS.framework/Versions/12.2.1.11/src/Xamarin.iOS/UIKit/UIApplication.cs:79 \r\n  at UIKit.UIApplication.Main (System.String[] args, System.String principalClassName, System.String delegateClassName) [0x0002c] in /Library/Frameworks/Xamarin.iOS.fr\r\namework/Versions/12.2.1.11/src/Xamarin.iOS/UIKit/UIApplication.cs:63 \r\n  at App11.iOS.Application.Main (System.String[] args) [0x00001] in c:\\users\\vlkam\\Source\\Repos\\App11\\App11.iOS\\Main.cs:17\r\n2019-01-15 14:47:16.424957\u002B0300 App11.iOS[30640:979369] critical: Stacktrace:\r\n2019-01-15 14:47:16.425120\u002B0300 App11.iOS[30640:979369] critical: \r\nNative stacktrace:\r\n2019-01-15 14:47:16.449975\u002B0300 App11.iOS[30640:979369] critical: \t0   App11.iOS                           0x000000010d9b8134 mono_handle_native_crash \u002B 244\r\n2019-01-15 14:47:16.450203\u002B0300 App11.iOS[30640:979369] critical: \t1   libsystem_platform.dylib            0x000000011dfb0b3d _sigtramp \u002B 29\r\n2019-01-15 14:47:16.450330\u002B0300 App11.iOS[30640:979369] critical: \t2   ???                                 0x000000010dfe3a22 0x0 \u002B 4529732130\r\n2019-01-15 14:47:16.450433\u002B0300 App11.iOS[30640:979369] critical: \t3   libsystem_c.dylib                   0x000000011dd32c45 abort \u002B 127\r\n2019-01-15 14:47:16.450551\u002B0300 App11.iOS[30640:979369] critical: \t4   App11.iOS                           0x000000010dba9fdf xamarin_unhandled_exception_handler \u002B 47\r\n2019-01-15 14:47:16.450668\u002B0300 App11.iOS[30640:979369] critical: \t5   App11.iOS                           0x000000010da4ee4e mono_invoke_unhandled_exception_hook \u002B 158\r\n2019-01-15 14:47:16.450775\u002B0300 App11.iOS[30640:979369] critical: \t6   App11.iOS                           0x000000010d9b7cfc mono_handle_exception_internal \u002B 6140\r\n2019-01-15 14:47:16.450886\u002B0300 App11.iOS[30640:979369] critical: \t7   App11.iOS                      \r\n     0x000000010d9b64f9 mono_handle_exception \u002B 25\r\n2019-01-15 14:47:16.450980\u002B0300 App11.iOS[30640:979369] critical: \t8   App11.iOS                           0x000000010d939683 mono_amd64_throw_exception \u002B 131\r\n2019-01-15 14:47:16.451078\u002B0300 App11.iOS[30640:979369] critical: \t9   ???                                 0x000000013ce425a7 0x0 \u002B 5316552103\r\n2019-01-15 14:47:16.451181\u002B0300 App11.iOS[30640:979369] critical: \t10  ???                                 0x0000000140faba4b 0x0 \u002B 5385140811\r\n2019-01-15 14:47:16.451286\u002B0300 App11.iOS[30640:979369] critical: \t11  ???                                 0x0000000140fac3a2 0x0 \u002B 5385143202\r\n2019-01-15 14:47:16.451383\u002B0300 App11.iOS[30640:979369] critical: \t12  App11.iOS                           0x000000010d9ca9e1 mono_jit_runtime_invoke \u002B 1441\r\n2019-01-15 14:47:16.451502\u002B0300 App11.iOS[30640:979369] critical: \t13  App11.iOS                           0x000000010dab01ef mono_runtime_invoke_checked \u002B 127\r\n2019-01-15 14:47:16.451614\u002B0300 App11.iOS[30640:979369] critical: \t1\r\n4  App11.iOS                           0x000000010dab38e3 mono_runtime_invoke \u002B 83\r\n2019-01-15 14:47:16.451749\u002B0300 App11.iOS[30640:979369] critical: \t15  App11.iOS                           0x000000010dbb30cd xamarin_invoke_trampoline \u002B 6109\r\n2019-01-15 14:47:16.451904\u002B0300 App11.iOS[30640:979369] critical: \t16  App11.iOS                           0x000000010dbba2dd xamarin_arch_trampoline \u002B 189\r\n2019-01-15 14:47:16.452098\u002B0300 App11.iOS[30640:979369] critical: \t17  App11.iOS                           0x000000010dbbb711 xamarin_x86_64_common_trampoline \u002B 110\r\n2019-01-15 14:47:16.452307\u002B0300 App11.iOS[30640:979369] critical: \t18  UIKitCore                           0x0000000126953dc6 -[UIView(CALayerDelegate) drawLayer:inContext:] \u002B 550\r\n2019-01-15 14:47:16.452496\u002B0300 App11.iOS[30640:979369] critical: \t19  QuartzCore                          0x000000011524c729 -[CALayer drawInContext:] \u002B 285\r\n2019-01-15 14:47:16.452614\u002B0300 App11.iOS[30640:979369] critical: \t20  QuartzCore                          0x000000011524bc\r\n34 -[CALayer _display] \u002B 937\r\n2019-01-15 14:47:16.452775\u002B0300 App11.iOS[30640:979369] critical: \t21  QuartzCore                          0x00000001151ca8ee _ZN2CA7Context18commit_transactionEPNS_11TransactionE \u002B 634\r\n2019-01-15 14:47:16.452910\u002B0300 App11.iOS[30640:979369] critical: \t22  QuartzCore                          0x000000011520197e _ZN2CA11Transaction6commitEv \u002B 576\r\n2019-01-15 14:47:16.453091\u002B0300 App11.iOS[30640:979369] critical: \t23  QuartzCore                          0x00000001152026fa _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv \u002B 76\r\n2019-01-15 14:47:16.453289\u002B0300 App11.iOS[30640:979369] critical: \t24  CoreFoundation                      0x000000011b803c27 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ \u002B 23\r\n2019-01-15 14:47:16.453432\u002B0300 App11.iOS[30640:979369] critical: \t25  CoreFoundation                      0x000000011b7fe0be __CFRunLoopDoObservers \u002B 430\r\n2019-01-15 14:47:16.453583\u002B0300 App11.iOS[30640:979369] critical: \t26  CoreFoundation                   \r\n   0x000000011b7fe751 __CFRunLoopRun \u002B 1537\r\n2019-01-15 14:47:16.453695\u002B0300 App11.iOS[30640:979369] critical: \t27  CoreFoundation                      0x000000011b7fde11 CFRunLoopRunSpecific \u002B 625\r\n2019-01-15 14:47:16.453851\u002B0300 App11.iOS[30640:979369] critical: \t28  GraphicsServices                    0x0000000120a7f1dd GSEventRunModal \u002B 62\r\n2019-01-15 14:47:16.453974\u002B0300 App11.iOS[30640:979369] critical: \t29  UIKitCore                           0x000000012646a81d UIApplicationMain \u002B 140\r\n2019-01-15 14:47:16.454120\u002B0300 App11.iOS[30640:979369] critical: \t30  ???                                 0x0000000140b1f2be 0x0 \u002B 5380371134\r\n2019-01-15 14:47:16.454244\u002B0300 App11.iOS[30640:979369] critical: \t31  ???                                 0x0000000140b1f053 0x0 \u002B 5380370515\r\n2019-01-15 14:47:16.454363\u002B0300 App11.iOS[30640:979369] critical: \r\n=================================================================\r\nGot a SIGABRT while executing native code. This usually indicates\r\na fatal error in the mono runtime or one of t\r\nhe native libraries \r\nused by your application.\r\n\u0060\u0060\u0060\r\n\r\n\r\n[Repos.zip](https://github.com/mono/SkiaSharp/files/2759257/Repos.zip)\n\n\u003E VS bug [#770227](https://devdiv.visualstudio.com/DevDiv/_workitems/edit/770227)",
  "author": {
    "login": "vlkam",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "area/SkiaSharp.Views",
      "color": "0052cc"
    }
  ],
  "assignees": [
    {
      "login": "mattleibow",
      "type": "User"
    }
  ],
  "milestone": "v1.68.1",
  "createdAt": "2019-01-15T10:50:18",
  "updatedAt": "2022-08-19T12:01:58",
  "closedAt": "2019-06-20T23:56:38",
  "commentCount": 3,
  "reactionCount": 0
}