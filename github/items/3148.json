{
  "number": 3148,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Scale of ManipulationDelta never changes when using SKSwapChainPanel on IOS",
  "body": "### Description\n\nThere is a weird behaviour when using SKSwapChainPanel on IOS every ManipulationDelta of the Scale is 1. If SKXamlCanvas is used everything works just fine on every platform. \n\nEven though the event is not registered directly on SKSwapChainPanel the e.Delta.Scale is 1.\n\n\n### Code\n\nCodesample is based on the SkiaSharptest sample of uno platform: \n\n[SKSwapChainPanelIOS.zip](https://github.com/user-attachments/files/18601322/SKSwapChainPanelIOS.zip)\n\n\n\u0060\u0060\u0060cs\nusing Microsoft.UI.Xaml.Input;\nusing Windows.Foundation;\nusing SkiaSharp;\nusing SkiaSharp.Views.Windows;\n\n// The Blank Page item template is documented at http://go.microsoft.com/fwlink/?LinkId=402352\u0026clcid=0x409\n\nnamespace SkiaSharpTest\n{\n    /// \u003Csummary\u003E\n    /// An empty page that can be used on its own or navigated to within a Frame.\n    /// \u003C/summary\u003E\n    public sealed partial class MainPage : Page\n    {\n        private Point _currentPosition;\n\n        public MainPage()\n        {\n#if !WINDOWS\n            SKSwapChainPanel.RaiseOnUnsupported = false;\n#endif\n\n            this.ManipulationDelta \u002B= MainPage_ManipulationDelta;\n\n            this.ManipulationMode = ManipulationModes.TranslateX | ManipulationModes.TranslateY | ManipulationModes.Scale;\n\n            this.InitializeComponent();\n\n#if HAS_UNO_SKIA || WINDOWS\n            notSupported.Visibility = Visibility.Visible;\n#endif\n        }\n\n        public float Zoom { get; set; } = 1;\n\n        private void MainPage_ManipulationDelta(object sender, ManipulationDeltaRoutedEventArgs e)\n        {\n            Zoom *= e.Delta.Scale;\n\n            if(e.Delta.Scale != 1)\n            {\n                if (hwAcceleration.IsChecked ?? false)\n                {\n    #if !WINDOWS\n                    swapChain.Invalidate();\n    #endif\n                }\n                else\n                {\n                    canvas.Invalidate();\n                }\n            }\n        }\n\n        private Visibility Not(bool? value) =\u003E (!value ?? false) ? Visibility.Visible : Visibility.Collapsed;\n\n        private void OnPaintSwapChain(object sender, SKPaintGLSurfaceEventArgs e)\n        {\n            // the the canvas and properties\n            var canvas = e.Surface.Canvas;\n            var info = e.Info;\n\n            Render(canvas, new Size(info.Width, info.Height), SKColors.Green, \u0022SkiaSharp Hardware Rendering\u0022);\n            //canvas.Scale(Zoom);\n\n        }\n\n        private void OnPaintSurface(object sender, SKPaintSurfaceEventArgs e)\n        {\n            // the the canvas and properties\n            var canvas = e.Surface.Canvas;\n            var info = e.Info;\n\n            Render(canvas, new Size(info.Width, info.Height), SKColors.Yellow, \u0022SkiaSharp Software Rendering\u0022);\n\n            //canvas.Scale(Zoom);\n        }\n\n        private void OnSurfacePointerMoved(object sender, PointerRoutedEventArgs e)\n        {\n            _currentPosition = e.GetCurrentPoint(panelGrid).Position;\n            currentPositionText.Text = _currentPosition.ToString();\n            \n            if (hwAcceleration.IsChecked ?? false)\n            {\n#if !WINDOWS\n                swapChain.Invalidate();\n#endif\n            }\n            else\n            {\n                canvas.Invalidate();\n            }\n        }\n\n        private void Render(SKCanvas canvas, Size size, SKColor color, string text)\n        {\n            // get the screen density for scaling\n            var scale = (float)this.XamlRoot.RasterizationScale;\n            var scaledSize = new SKSize((float)size.Width / scale, (float)size.Height / scale);\n\n            // handle the device screen density\n            canvas.Scale(scale*Zoom);\n\n            // make sure the canvas is blank\n            canvas.Clear(color);\n\n            // draw some text\n            var paint = new SKPaint\n            {\n                Color = SKColors.Black,\n                IsAntialias = true,\n                Style = SKPaintStyle.Fill,\n                TextAlign = SKTextAlign.Center,\n                TextSize = 24\n            };\n            var coord = new SKPoint(scaledSize.Width / 2, (scaledSize.Height \u002B paint.TextSize) / 2);\n            canvas.DrawText(text, coord, paint);\n\n            var circlePaint = new SKPaint\n            {\n                Style = SKPaintStyle.Fill,\n                Color = SKColors.Red\n            };\n\n            canvas.DrawCircle((float)_currentPosition.X, (float)_currentPosition.Y, 5, circlePaint);\n        }\n\n    }\n}\n\n\u0060\u0060\u0060\nYou can also share some XAML:\n\u0060\u0060\u0060xaml\n\u003CPage x:Class=\u0022SkiaSharpTest.MainPage\u0022\n      xmlns=\u0022http://schemas.microsoft.com/winfx/2006/xaml/presentation\u0022\n      xmlns:x=\u0022http://schemas.microsoft.com/winfx/2006/xaml\u0022\n      xmlns:not_win=\u0022http://uno.ui/not_win\u0022\n      xmlns:local=\u0022using:SkiaSharpTest\u0022\n      xmlns:d=\u0022http://schemas.microsoft.com/expression/blend/2008\u0022\n      xmlns:mc=\u0022http://schemas.openxmlformats.org/markup-compatibility/2006\u0022\n      xmlns:sk=\u0022using:SkiaSharp.Views.Windows\u0022\n      mc:Ignorable=\u0022d not_win\u0022\n      Background=\u0022{ThemeResource ApplicationPageBackgroundThemeBrush}\u0022\u003E\n\n    \u003CGrid\u003E\n        \u003CGrid.RowDefinitions\u003E\n            \u003CRowDefinition Height=\u0022auto\u0022 /\u003E\n            \u003CRowDefinition /\u003E\n        \u003C/Grid.RowDefinitions\u003E\n        \u003CStackPanel\u003E\n            \u003CCheckBox Content=\u0022Hardware Accelerated\u0022\n                      x:Name=\u0022hwAcceleration\u0022 /\u003E\n            \u003CTextBlock x:Name=\u0022currentPositionText\u0022 /\u003E\n        \u003C/StackPanel\u003E\n        \u003CGrid x:Name=\u0022panelGrid\u0022\n              Grid.Row=\u00221\u0022\u003E\n            \u003Cnot_win:Border\u003E\n                \u003Csk:SKSwapChainPanel x:Name=\u0022swapChain\u0022\n                                     PaintSurface=\u0022OnPaintSwapChain\u0022\n                                     PointerMoved=\u0022{x:Bind OnSurfacePointerMoved}\u0022\n                                     \n                                     not_win:Background=\u0022Transparent\u0022\n                                     Visibility=\u0022{x:Bind hwAcceleration.IsChecked, Mode=OneWay}\u0022 /\u003E\n            \u003C/not_win:Border\u003E\n            \u003CTextBlock x:Name=\u0022notSupported\u0022\n                       Visibility=\u0022Collapsed\u0022\n                       Text=\u0022SKSwapChainPanel is not supported on this platform\u0022 /\u003E\n            \u003Csk:SKXamlCanvas x:Name=\u0022canvas\u0022\n                             PaintSurface=\u0022OnPaintSurface\u0022\n                             PointerMoved=\u0022{x:Bind OnSurfacePointerMoved}\u0022\n                             not_win:Background=\u0022Transparent\u0022\n                             Visibility=\u0022{x:Bind Not(hwAcceleration.IsChecked), Mode=OneWay}\u0022 /\u003E\n        \u003C/Grid\u003E\n    \u003C/Grid\u003E\n\u003C/Page\u003E\n\u0060\u0060\u0060\n\n\n### Expected Behavior\n\n_No response_\n\n### Actual Behavior\n\n_No response_\n\n### Version of SkiaSharp\n\n2.88.9 (Previous)\n\n### Last Known Good Version of SkiaSharp\n\nOther (Please indicate in the description)\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\niOS\n\n### Platform / Operating System Version\n\niOS 18.0 - 18.3\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\n\n\u0060\u0060\u0060\n\n### Code of Conduct\n\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "VRage",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2025-01-30T10:59:37",
  "updatedAt": "2025-01-30T10:59:37",
  "commentCount": 0,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T19:56:55.0566601Z",
    "reactions": [],
    "comments": []
  }
}