{
  "number": 2326,
  "type": "issue",
  "state": "open",
  "title": "[BUG] UWP: Using SKXamlCanvas for print preview pages stopped working",
  "body": "**Description**\r\n\r\nI use SKXamlCanvas in my PageToPrint object that gets displayed in print preview. It displays correctly in 2.80.1, but does not in 2.88.3.\r\nFor testing, I\u0027m just using code from the sample project to draw text on the preview page.\r\n\r\n**Code**\r\n\r\nPageToPrint.xaml:\r\n\r\n\u003CPage\r\n    x:Class=\u0022Mobile.UWP.Native.Pages.PageToPrint\u0022\r\n    xmlns=\u0022http://schemas.microsoft.com/winfx/2006/xaml/presentation\u0022\r\n    xmlns:x=\u0022http://schemas.microsoft.com/winfx/2006/xaml\u0022\r\n    xmlns:skia=\u0022using:SkiaSharp.Views.UWP\u0022\r\n    xmlns:d=\u0022http://schemas.microsoft.com/expression/blend/2008\u0022\r\n    xmlns:mc=\u0022http://schemas.openxmlformats.org/markup-compatibility/2006\u0022\r\n    mc:Ignorable=\u0022d\u0022\r\n    Background=\u0022{ThemeResource ApplicationPageBackgroundThemeBrush}\u0022\u003E\r\n\r\n    \u003Cskia:SKXamlCanvas x:Name=\u0022_canvasToPrint\u0022 HorizontalAlignment=\u0022Center\u0022 IgnorePixelScaling=\u0022True\u0022 IsTapEnabled=\u0022False\u0022 VerticalAlignment=\u0022Top\u0022/\u003E\r\n\u003C/Page\u003E\r\n\r\nPageToPrint.xaml.cs:\r\n\r\n    /// \u003Csummary\u003E\r\n    /// Print preview page.\r\n    /// \u003C/summary\u003E\r\n    public sealed partial class PageToPrint : Page\r\n    {\r\n        public PageToPrint(double width, double height)\r\n        {\r\n            InitializeComponent();\r\n\r\n            _canvasToPrint.MinWidth = width;\r\n            _canvasToPrint.MinHeight = height;\r\n            _canvasToPrint.PaintSurface \u002B= OnPaintCurrentSurface;\r\n        }\r\n\r\n        /// \u003Csummary\u003E\r\n        /// draw form and fields onto canvas for printing\r\n        /// \u003C/summary\u003E\r\n        /// \u003Cparam name=\u0022sender\u0022\u003E\u003C/param\u003E\r\n        /// \u003Cparam name=\u0022args\u0022\u003E\u003C/param\u003E\r\n        private void OnPaintCurrentSurface(object sender, SKPaintSurfaceEventArgs args)\r\n        {\r\n            var canvas = args.Surface.Canvas;\r\n\t\t\t\r\n            // get the screen density for scaling\r\n            var display = DisplayInformation.GetForCurrentView();\r\n            var scale = display.LogicalDpi / 96.0f;\r\n            var scaledSize = new SKSize(args.Info.Width / scale, args.Info.Height / scale);\r\n\r\n            // handle the device screen density\r\n            canvas.Scale(scale);\r\n\r\n            // make sure the canvas is blank\r\n            canvas.Clear(SKColors.White);\r\n\r\n            // draw some text\r\n            var paint = new SKPaint\r\n            {\r\n                Color = SKColors.Black,\r\n                IsAntialias = true,\r\n                Style = SKPaintStyle.Fill,\r\n                TextAlign = SKTextAlign.Center,\r\n                TextSize = 24\r\n            };\r\n            var coord = new SKPoint(scaledSize.Width / 2, (scaledSize.Height \u002B paint.TextSize) / 2);\r\n\t\t\t\r\n            canvas.DrawText(\u0022SkiaSharp\u0022, coord, paint);\r\n        }\r\n    }\r\n\r\nPrintHelper.cs:\r\n\r\n        /// \u003Csummary\u003E\r\n        /// This is the event handler for PrintDocument.Paginate. It creates print preview pages for the app.\r\n        /// \u003C/summary\u003E\r\n        /// \u003Cparam name=\u0022sender\u0022\u003EPrintDocument\u003C/param\u003E\r\n        /// \u003Cparam name=\u0022argsPaginate\u0022\u003EPaginate Event Arguments\u003C/param\u003E\r\n        private void PrintDocument_Paginate(object sender, PaginateEventArgs argsPaginate)\r\n        {\r\n\t\t\tlock (PrintPreviewPages)\r\n\t\t\t{\r\n\t\t\t\t// Clear the cache of preview pages\r\n\t\t\t\tPrintPreviewPages.Clear();\r\n\r\n\t\t\t\t// Get the page description to determine how big the page is\r\n\t\t\t\tvar pageDescription = argsPaginate.PrintTaskOptions.GetPageDescription(0);\r\n\r\n\t\t\t\t// draw each page to create the print preview pages\r\n\t\t\t\tvar ptp = new PageToPrint(pageDescription.PageSize.Width, pageDescription.PageSize.Height);\r\n\r\n\t\t\t\t// add this page to the collection\r\n\t\t\t\tPrintPreviewPages.Add(ptp);\r\n\r\n\t\t\t\tvar printDoc = (PrintDocument)sender;\r\n\r\n\t\t\t\t// Report the number of preview pages created\r\n\t\t\t\tprintDoc.SetPreviewPageCount(PrintPreviewPages.Count, PreviewPageCountType.Intermediate);\r\n\t\t\t}\r\n        }\r\n\r\n        /// \u003Csummary\u003E\r\n        /// This is the event handler for PrintDocument.GetPrintPreviewPage. It provides a specific print preview page,\r\n        /// in the form of an UIElement, to an instance of PrintDocument. PrintDocument subsequently converts the UIElement\r\n        /// into a page that the Windows print system can deal with.\r\n        /// \u003C/summary\u003E\r\n        /// \u003Cparam name=\u0022sender\u0022\u003EPrintDocument\u003C/param\u003E\r\n        /// \u003Cparam name=\u0022argsPreview\u0022\u003EArguments containing the preview requested page\u003C/param\u003E\r\n        private void PrintDocument_GetPreviewPage(object sender, GetPreviewPageEventArgs argsPreview)\r\n        {\r\n\t\t\tlock (PrintPreviewPages)\r\n\t\t\t{\r\n\t\t\t\tvar printDoc = (PrintDocument)sender;\r\n\t\t\t\tvar pageToPrint = PrintPreviewPages[argsPreview.PageNumber - 1];\r\n\r\n\t\t\t\tprintDoc.SetPreviewPage(argsPreview.PageNumber, pageToPrint);\r\n\t\t\t}\r\n        }\r\n\r\n**Expected Behavior**\r\n\r\nThe preview page is displayed in the Print Preview dialog.\r\n\r\n**Actual Behavior**\r\n\r\nThe preview page is blank in the Print Preview dialog.\r\n\r\nUsing debug, I see that with 2.80.1, the PaintSurface event is triggered (once) by printDoc.SetPreviewPage. In 2.88.3, the PaintSurface event is triggered multiple times, but not by SetPreviewPage. There is no triggering method in the stack trace.\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.88.3\r\n- Last known good version:  2.80.1\r\n- IDE:  Visual Studio 2019\r\n- Platform Target Frameworks: \r\n  - UWP:  18362 \r\n- Target Devices:   Windows 10",
  "author": {
    "login": "RichPrism",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-11-30T23:25:10",
  "updatedAt": "2025-06-06T18:01:18",
  "commentCount": 1,
  "reactionCount": 0
}