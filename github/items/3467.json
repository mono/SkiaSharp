{
  "number": 3467,
  "type": "pr",
  "state": "open",
  "title": "Add tests for ToHarfBuzzBlob disposal behavior (#3466)",
  "body": "**Description of Change**\n\nAdd test coverage for PR #3466\u0027s behavioral change where \u0060ToHarfBuzzBlob\u0060 no longer disposes the \u0060SKStreamAsset\u0060 parameter.\n\n**Tests Added (6 methods in \u0060SKShaperTest.cs\u0060)**\n\n- \u0060ToHarfBuzzBlobDoesNotDisposeStream\u0060 - Stream remains accessible after blob creation\n- \u0060ToHarfBuzzBlobStreamMustBeDisposedByCaller\u0060 - Validates caller disposal responsibility\n- \u0060ToHarfBuzzBlobBlobCanBeUsedWithinStreamLifetime\u0060 - Safe usage pattern: \u0060using (stream) using (blob)\u0060\n- \u0060ToHarfBuzzBlobWorksWithNonMemoryMappedStream\u0060 - Memory copy fallback path (when \u0060GetMemoryBase()\u0060 returns zero)\n- \u0060SKShaperConstructorSucceeds\u0060 - Integration test for SKShaper with new behavior\n- \u0060ToHarfBuzzBlobCanCreateMultipleBlobsFromSameStream\u0060 - Stream reusability validation\n\n**Test Expectations**\n\nCurrent code (before #3466): Tests fail - blob incorrectly disposes stream via destroy callback  \nAfter #3466 merge: Tests pass - caller manages stream lifecycle\n\n**Bugs Fixed**\n\nNone. (Test-only PR supporting #3466)\n\n**API Changes**\n\nNone.\n\n**Behavioral Changes**\n\nNone.\n\n**Required skia PR**\n\nNone.\n\n**PR Checklist**\n\n- [x] Has tests (if omitted, state reason in description)\n- [x] Rebased on top of main at time of PR\n- [x] Merged related skia PRs\n- [x] Changes adhere to coding standard\n- [ ] Updated documentation\n\n\u003E [!WARNING]\n\u003E\n\u003E \u003Cdetails\u003E\n\u003E \u003Csummary\u003EFirewall rules blocked me from connecting to one or more addresses (expand for details)\u003C/summary\u003E\n\u003E\n\u003E #### I tried to connect to the following addresses, but was blocked by firewall rules:\n\u003E\n\u003E - \u00600t3vsblobprodcus362.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u00601k9vsblobprodcus379.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u00601s1vsblobprodcus386.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u00604myvsblobprodcus32.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u00604vyvsblobprodcus361.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u00607devsblobprodcus323.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u00607k6vsblobprodcus337.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060c50vsblobprodcus330.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060c78vsblobprodcus322.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060cflvsblobprodcus383.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060frdvsblobprodcus327.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060jd4vsblobprodcus366.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060kh4vsblobprodcus325.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060l49vsblobprodcus358.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060l7avsblobprodcus319.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet tool restore\u0060 (dns block)\n\u003E - \u0060lylvsblobprodcus31.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060m6xvsblobprodcus342.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060pc2vsblobprodcus360.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060rcxvsblobprodcus328.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060u3hvsblobprodcus371.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060u6ovsblobprodcus377.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060uy6vsblobprodcus34.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E - \u0060yluvsblobprodcus367.vsblob.vsassets.io\u0060\n\u003E   - Triggering command: \u0060/usr/bin/dotnet dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj\u0060 (dns block)\n\u003E\n\u003E If you need me to access, download, or install something from one of these locations, you can either:\n\u003E\n\u003E - Configure [Actions setup steps](https://gh.io/copilot/actions-setup-steps) to set up my environment, which run before the firewall is enabled\n\u003E - Add the appropriate URLs or hosts to the custom allowlist in this repository\u0027s [Copilot coding agent settings](https://github.com/mono/SkiaSharp/settings/copilot/coding_agent) (admins only)\n\u003E\n\u003E \u003C/details\u003E\n\n\u003C!-- START COPILOT CODING AGENT SUFFIX --\u003E\n\n\n\n\u003C!-- START COPILOT ORIGINAL PROMPT --\u003E\n\n\n\n\u003Cdetails\u003E\n\n\u003Csummary\u003EOriginal prompt\u003C/summary\u003E\n\n\u003E please look at #3466 and write some tests for this change.\n\n\n\u003C/details\u003E\n\n\n\n\u003C!-- START COPILOT CODING AGENT TIPS --\u003E\n---\n\n\uD83D\uDCAC We\u0027d love your input! Share your thoughts on Copilot coding agent in our [2 minute survey](https://gh.io/copilot-coding-agent-survey).\n",
  "author": {
    "login": "Copilot",
    "type": "Bot"
  },
  "labels": [],
  "assignees": [
    {
      "login": "mattleibow",
      "type": "User"
    },
    {
      "login": "Copilot",
      "type": "Bot"
    }
  ],
  "createdAt": "2026-01-27T22:19:45",
  "updatedAt": "2026-01-27T22:30:08",
  "commentCount": 0,
  "reactionCount": 0,
  "draft": true,
  "mergeable": true,
  "mergeableState": "behind",
  "baseBranch": "main",
  "headBranch": "copilot/add-tests-for-issue-3466",
  "additions": 170,
  "deletions": 0,
  "changedFiles": 1,
  "commits": 3,
  "reviews": [],
  "engagement": {
    "syncedAt": "2026-02-04T19:45:17.5324661Z",
    "reactions": [],
    "comments": []
  }
}