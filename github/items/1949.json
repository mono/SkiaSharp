{
  "number": 1949,
  "type": "issue",
  "state": "closed",
  "title": "IPhone 12 \u62CD\u6444\u7684\u7167\u7247\uFF0C\u8FDB\u884C\u7F29\u7565\u56FE\u538B\u7F29\u7684\u65F6\u5019\uFF0C\u65E0\u6CD5\u6B63\u5E38\u4FDD\u5B58",
  "body": "IPhone 12 \u62CD\u6444\u7684\u7167\u7247\uFF0C\u8FDB\u884C\u7F29\u7565\u56FE\u538B\u7F29\u7684\u65F6\u5019\uFF0C\u4F1A\u51FA\u73B0\u4E00\u4E0B\u95EE\u9898\uFF1A\r\n1\u3001\u56FE\u7247\u7684\u957F\u3001\u5BBD\u50CF\u7D20\u503C\u4F1A\u53D6\u53CD\r\n2\u3001\u4FDD\u5B58\u5904\u7406\u7684\u4E4B\u540E\u7684\u56FE\u7247\u5185\u5BB9\u4F1A\u8FDB\u884C\u987A\u65F6\u9488270\u7684\u65CB\u8F6C\uFF0C\r\n\u56FE\u7247\u65E0\u8BBA\u662F\u7ECF\u8FC7\u5DE5\u5177\u8F6C\u6362\u4ECEHEIC\u53D8\u6210JPG\uFF0C\u8FD8\u662F\u91C7\u7528\u8BBE\u5907\u517C\u5BB9\u6A21\u5F0F\u62CD\u6444\u7684JPG\u683C\u5F0F\uFF0C\u90FD\u4F1A\u51FA\u73B0\u4EE5\u4E0A\u60C5\u51B5\u3002\u5173\u952E\u4EE3\u7801\u5982\u4E0B\r\n\r\n  using (var input = new MemoryStream(imgbyte))\r\n        {\r\n            using (var inputStream = new SKManagedStream(input))\r\n            {\r\n                using (var originalBitmap = SKBitmap.Decode(imgbyte))\r\n                {\r\n\r\n                    if (originalBitmap == null)\r\n                    {\r\n                        throw new Exception(\u0022\u538B\u7F29\u56FE\u7247\u5931\u8D25\uFF0C\u753B\u5E03\u521B\u5EFA\u5F02\u5E38\u0022);\r\n                    }\r\n\r\n                    //\u8BA1\u7B97\u65B0\u7684\u5C3A\u5BF8\r\n                    Size imageSize = ResizeImage(originalBitmap.Width, originalBitmap.Height, flag);\r\n\r\n                    //\u6839\u636E\u65B0\u7684\u5C3A\u5BF8\uFF0C\u521B\u5EFA\u65B0\u7684\u753B\u5E03\u8FDB\u884C\u538B\u7F29\r\n                    using (var resized = originalBitmap.Resize(new SKImageInfo(imageSize.Width, imageSize.Height), SKFilterQuality.High))\r\n                    {\r\n                        if (resized == null)\r\n                        {\r\n                            throw new Exception(\u0022\u56FE\u7247\u5904\u7406\uFF0C\u6839\u636E\u65B0\u7684\u5C3A\u5BF8\u521B\u5EFA\u753B\u5E03\u5931\u8D25\u0022);\r\n                        }\r\n\r\n                        //\u521B\u5EFA\u65B0\u7684\u63A5\u53D7\u5BB9\u5668\uFF0C\u5E76\u5C06\u5185\u5BB9\u4FDD\u5B58\u5230\u65B0\u7684\u6D41\u8FDB\u884C\u8F6C\u6362\r\n                        using (var newImageBitmap = SKImage.FromBitmap(resized))\r\n                        {\r\n                            using (var output = new MemoryStream())\r\n                            {\r\n\r\n                                newImageBitmap.Encode(sKEncodedImageFormat.Value, level).SaveTo(output);\r\n                                byte[] reduceBytes = output.GetBuffer();\r\n\r\n                                //\u5982\u679C\u7ECF\u8FC7\u538B\u7F29\u4EE5\u540E\u7684\u56FE\u7247\u957F\u5EA6\u4F9D\u7136\u8D85\u8FC7\u5E94\u7528\u63A8\u8350\u503C\uFF0C\u5C31\u91CD\u590D\u4EE5\u4E0A\u64CD\u4F5C\uFF0C\u76F4\u5230\u7B26\u5408\u5E94\u7528\u63A8\u8350\u503C\r\n                                if (reduceBytes.Length \u003E compressFileLength)\r\n                                {\r\n                                    ThumbImage(reduceBytes, fileName, compressFileLength, level, flag);\r\n                                }\r\n                                else\r\n                                {\r\n                                    SaveNewImageFile(reduceBytes,fileName);\r\n                                }\r\n\r\n\r\n                                return reduceBytes;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n[\u6D4B\u8BD5\u7684\u56FE\u7247](https://input-1257888251.cos.ap-nanjing.myqcloud.com/IMG_6474.JPG.zip)\r\n\r\n\u6D4B\u8BD5\u73AF\u5883:\r\nvs 2022 for windows\r\nvs 2022 for mac\r\nnet 6",
  "author": {
    "login": "chenyi2006520",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-02-11T06:46:00",
  "updatedAt": "2022-08-19T00:01:59",
  "closedAt": "2022-02-11T07:17:14",
  "commentCount": 0,
  "reactionCount": 0
}