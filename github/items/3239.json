{
  "number": 3239,
  "type": "issue",
  "state": "open",
  "title": "[BUG] InvalidateMeasure doesn\u0027t call MeasureOverride after the first call.",
  "body": "### Description\n\nI have two different cases where this occurs.  The scenario is essentially the same for both.\n\nSkLabel: A custom control derived from SKCanvasView\nGlyphView: A custom control derived from SKCanvasView\n\nI\u0027m using SkiaSharp.Views.Maui.Controls Version 3.116.1. I haven\u0027t tried it on earlier versions.\n\nIn both cases, I\u0027m attempting to resize the SKCanvasView based on the contents.\n\nFor SkLabel, I define various properties to configure the font to use to draw the text. The propertyChanged handles each call InvalidateMeasure.\n\nThe desired size is calculated in MeasureSize based on the text and the font properties.\n\nAfter the first successful MeasureOverride, I trigger a change to one of the font properties, such as FontSize.  InvalidateMeasure is called but MeasureOverride is not called and the canvas is not resized.\n\nI\u0027ve debugged into the InvalidateMeasure call to see the handler resolve to SKCanvasViewHandlerSkiaSharp.Views.Maui.Handlers.SKCanvasViewHandler\n***\n\u003EMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.Element.Handler.get() Line 380\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.Handler.get() Line 1054\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasureOverride() Line 2142\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.Microsoft.Maui.IView.InvalidateMeasure() Line 2137\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasureInternal(Microsoft.Maui.Controls.InvalidationEventArgs eventArgs) Line 1712\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasureInternal(Microsoft.Maui.Controls.Internals.InvalidationTrigger trigger) Line 1699\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasure() Line 1616\tC#\nGlyphViewer.dll!GlyphViewer.Controls.SkLabel.InvalidateTextMetrics() Line 300\tC#\n***\n\nOnce it resolves I reach the _commandMapper?.Invoke but I\u0027m not able to debug into it.\n\n_commandMapper?.Invoke(this, VirtualView, command, args);\n\n***\n\u003E Microsoft.Maui.dll!Microsoft.Maui.Handlers.ElementHandler.Invoke(string command, object args) Line 94\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasureOverride() Line 2143\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.Microsoft.Maui.IView.InvalidateMeasure() Line 2137\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasureInternal(Microsoft.Maui.Controls.InvalidationEventArgs eventArgs) Line 1712\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasureInternal(Microsoft.Maui.Controls.Internals.InvalidationTrigger trigger) Line 1699\tC#\nMicrosoft.Maui.Controls.dll!Microsoft.Maui.Controls.VisualElement.InvalidateMeasure() Line 1616\tC#\nGlyphViewer.dll!GlyphViewer.Controls.SkLabel.InvalidateTextMetrics() Line 300\tC#\n***\n\nThe scenario for GlyphView is simpler since it has a single value that changes the size but the failure is the same. After the first MeasureOverride call, InvalidateMeasure no longer results subsequent MeasureOverride calls.\n\n\n### Code\n\nThe SkLabel issue is illustrated here:  https://github.com/DanTravison/GlyphViewer/blob/Preferences/Controls/SkLabel.cs\n\n* Refer to the comments in InvalidateTextMetrics and MeasureOverride.\n* In each case, explicitly setting HeightRequest in these two methods is required to workaround the issue.\n\nThe GlyphView issue is here: \nhttps://github.com/DanTravison/GlyphViewer/blob/Preferences/Views/GlyphView.cs\n* Refer to the comments in OnGlyphChanged().\n* Again, explicitly setting HeightRequest is required to workaround the issue. \n\nTo repro The SkLabel case:\n1: Sync the repro and use the Preferences branch\n2: Edit Controls\\SkLabel and comment out the two calls to setting HeightRequest.\n3: Build/Run the app\n4: Select the gear icon in the upper left.\n5: Use any of the sliders adjacent to the font option sizes and not that the same text does not change.\n\nI\u0027ll see if I can repro this with a simpler app.\n\n### Expected Behavior\n\nAfter calling InvalidateMeasure, MeasureOverride should be called prior to calling OnPaintSurface\n\n### Actual Behavior\n\nAfter the first MeasureOverride occurs, calling InvalidateMeasure no longer causes MeasureOverride to occur.\n\n### Version of SkiaSharp\n\n3.116.0 (Current)\n\n### Last Known Good Version of SkiaSharp\n\n2.88.9 (Previous)\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\nI\u0027ve only tested this on Windows 11 so far.\n\n### Devices\n\nWindows 11 Desktop\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\n\n\u0060\u0060\u0060\n\n### Code of Conduct\n\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "DanTravison",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2025-04-20T03:32:35",
  "updatedAt": "2025-06-18T13:47:58",
  "commentCount": 5,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T19:52:11.6886587Z",
    "reactions": [],
    "comments": [
      {
        "id": 2818462955,
        "author": "DanTravison",
        "createdAt": "2025-04-21T13:58:20",
        "reactions": []
      },
      {
        "id": 2831279037,
        "author": "janne-hmp",
        "createdAt": "2025-04-25T19:33:33",
        "reactions": []
      },
      {
        "id": 2881877985,
        "author": "DanTravison",
        "createdAt": "2025-05-15T00:17:53",
        "reactions": []
      },
      {
        "id": 2972009152,
        "author": "DanTravison",
        "createdAt": "2025-06-14T00:09:45",
        "reactions": []
      },
      {
        "id": 2984295317,
        "author": "DanTravison",
        "createdAt": "2025-06-18T13:47:58",
        "reactions": []
      }
    ]
  }
}