{
  "number": 2999,
  "type": "issue",
  "state": "closed",
  "title": "Managed vtable types (ie. containing any reference types) are not supported. (With WindowsSdkPackageVersion 10.0.19041.38)",
  "body": "### Description\n\nIn this pull request I try to Update the WindowsAppSDK Dependency to 1.6.240829007 \r\n\r\nhttps://github.com/Mapsui/Mapsui/pull/2747\r\n\r\nThis needs following Entry in the csproj File\r\n\u0060\u0060\u0060\r\n\u003C!-- Windows App Sdk 1.6 Workaround--\u003E\r\n\u003CWindowsSdkPackageVersion\u003E10.0.19041.38\u003C/WindowsSdkPackageVersion\u003E\r\n\u0060\u0060\u0060\r\nWhich in Turn causes Managed vtable types (ie. containing any reference types) are not supported\r\n\r\nWhat I discovered is that adding alone without Updating WindowsAppSdk Causes this Exception so it is a Behavior change\r\nIn the Windows App SDK Ref starting around 10.0.x.38 Versions.\r\n\r\n\u0060\u0060\u0060\r\n\u003C!-- Windows App Sdk 1.6 Workaround--\u003E\r\n\u003CWindowsSdkPackageVersion\u003E10.0.19041.38\u003C/WindowsSdkPackageVersion\u003E\r\n\u0060\u0060\u0060\r\n\r\nSample the Reproduces the Crash, should display a circle could not test it it crashed before it can display anything.\r\n\r\nFrom the Callstack it seems Code that is executed in SKXamlCanvas.DoInvalidate crashes the Application\r\n\r\n[App1.zip](https://github.com/user-attachments/files/17005205/App1.zip)\r\n\n\n### Code\n\nThe best way to share code for larger projects is a link to a GitHub repository: https://github.com/user/repo/tree/bug-123\r\n\r\nBut, you can also share a short block of code here:\r\n\u0060\u0060\u0060cs\r\n// some C# code here\r\n\u0060\u0060\u0060\r\nYou can also share some XAML:\r\n\u0060\u0060\u0060xaml\r\n\u003C!-- xaml code here --\u003E\r\n\u0060\u0060\u0060\r\n\n\n### Expected Behavior\n\nNo exception and SkiaSharp Works with WindowsAppSdk 1.6\n\n### Actual Behavior\n\nSkiaSharp Crashes with Exception of \u0022Which in Turn causes Managed vtable types (ie. containing any reference types) are not supported\u0022\n\n### Version of SkiaSharp\n\n2.88.3 (Current)\n\n### Last Known Good Version of SkiaSharp\n\nNone\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\nWindows 11, Visual Studio 2022 Preview 17.12\n\n### Devices\n\nWindows Packaged Windows App\n\n### Relevant Screenshots\n\nCall Stack of Exception in the IDE.\r\n\u003Cimg width=\u0022988\u0022 alt=\u0022image\u0022 src=\u0022https://github.com/user-attachments/assets/c8caabd8-e99e-4eff-a6ef-0e511b9589b1\u0022\u003E\r\n\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\nCall Stack Of Exception\r\n\r\n\r\nWinRT.Runtime.dll!WinRT.ObjectReference\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E.GetVtable(nint thisPtr)\r\nWinRT.Runtime.dll!WinRT.ObjectReference\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E.ObjectReference(nint thisPtr)\r\nWinRT.Runtime.dll!WinRT.ObjectReference\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E.Attach(ref nint thisPtr, System.Guid iid)\r\nWinRT.Runtime.dll!WinRT.ObjectReference\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E.TryAs(WinRT.IObjectReference sourceRef, System.Guid iid, out WinRT.ObjectReference\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E objRef)\r\nWinRT.Runtime.dll!WinRT.IObjectReference.TryAs\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E(System.Guid iid, out WinRT.ObjectReference\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E objRef)\r\nWinRT.Runtime.dll!WinRT.IObjectReference.As\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E(System.Guid iid)\r\nWinRT.Runtime.dll!WinRT.IObjectReference.As\u003CABI.SkiaSharp.Views.Windows.IBufferByteAccess.Vftbl\u003E()\r\n[Native to Managed Transition]\r\n[Managed to Native Transition]\r\nSystem.Private.CoreLib.dll!System.Reflection.MethodBaseInvoker.InterpretedInvoke_Method(object obj, nint* args)\r\nSystem.Private.CoreLib.dll!System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(object obj, System.Reflection.BindingFlags invokeAttr)\r\nWinRT.Runtime.dll!WinRT.IWinRTObject.IsInterfaceImplementedFallback.__GetObjectReferenceViaVftbl|1_1(WinRT.IObjectReference objRef, System.Type vftblType)\r\nWinRT.Runtime.dll!WinRT.IWinRTObject.IsInterfaceImplementedFallback(System.RuntimeTypeHandle interfaceType, bool throwIfNotImplemented)\r\nWinRT.Runtime.dll!WinRT.IWinRTObject.System.Runtime.InteropServices.IDynamicInterfaceCastable.IsInterfaceImplemented(System.RuntimeTypeHandle interfaceType, bool throwIfNotImplemented)\r\nSystem.Private.CoreLib.dll!System.Runtime.InteropServices.DynamicInterfaceCastableHelpers.IsInterfaceImplemented(System.Runtime.InteropServices.IDynamicInterfaceCastable castable, System.RuntimeType interfaceType, bool throwIfNotImplemented)\r\n[Native to Managed Transition]\r\n[Managed to Native Transition]\r\nWinRT.Runtime.dll!WinRT.CastExtensions.As\u003CSkiaSharp.Views.Windows.IBufferByteAccess\u003E(object value)\r\nSkiaSharp.Views.Windows.dll!SkiaSharp.Views.Windows.Utils.GetByteBuffer(Windows.Storage.Streams.IBuffer buffer)\r\nSkiaSharp.Views.Windows.dll!SkiaSharp.Views.Windows.WindowsExtensions.GetPixels(Microsoft.UI.Xaml.Media.Imaging.WriteableBitmap bitmap)\r\nSkiaSharp.Views.Windows.dll!SkiaSharp.Views.Windows.SKXamlCanvas.CreateBitmap(out SkiaSharp.SKSizeI unscaledSize, out float dpi)\r\nSkiaSharp.Views.Windows.dll!SkiaSharp.Views.Windows.SKXamlCanvas.DoInvalidate()\r\nMicrosoft.InteractiveExperiences.Projection.dll!ABI.Microsoft.UI.Dispatching.DispatcherQueueHandler.Do_Abi_Invoke(nint thisPtr)\r\n[Native to Managed Transition]\r\n[Managed to Native Transition]\r\nMicrosoft.WinUI.dll!ABI.Microsoft.UI.Xaml.IApplicationStaticsMethods.Start(WinRT.IObjectReference _obj, Microsoft.UI.Xaml.ApplicationInitializationCallback callback)\r\nMicrosoft.WinUI.dll!Microsoft.UI.Xaml.Application.Start(Microsoft.UI.Xaml.ApplicationInitializationCallback callback)\r\nMapsui.Samples.WinUI.dll!Mapsui.Samples.WinUI.Program.Main(string[] args) Line 26\r\n\u0060\u0060\u0060\n\u0060\u0060\u0060\n\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "inforithmics",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2024-09-15T09:28:31",
  "updatedAt": "2024-10-25T16:28:28",
  "closedAt": "2024-10-25T16:28:28",
  "commentCount": 31,
  "reactionCount": 5
}