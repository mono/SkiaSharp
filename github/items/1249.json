{
  "number": 1249,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] SKImage.FromEncodedData fails on loading image",
  "body": "**Description**\r\n\r\nI am getting an exception when trying to load a botmap from file into an AvaloniaUI \u0060\u003CImage\u003E\u0060 control.  The bitmap is a 1 pixel wide image, but with a potentially large (ridiculous) height. The image control will scale the image to fit the associated size. \r\n\r\nIt works when the image is not too high. But when it gets large it fails. \r\n\r\n**Code**\r\n\r\n1. The image is created using SixLabors ImageSharp, and was saved to disk via \u0060img.Save(\u0022name.bmp\u0022, new BmpEncoder());\u0060. The file appears on disk and can be opened in image-viewers without any issue. \r\n\r\nThe size for the **failing** test-scenario is about 9 MB (1 x 2 309 534 pixels). \r\n\r\nThe size for a **non-failing** test-scenario is about 4 KB (1 x 1 065 pixels).\r\n\r\n2. An Avalonia UI \u0060\u003CImage\u003E\u0060 control is set up as follows\r\n\u0060\u0060\u0060\r\n\u003CImage Width=\u002210\u0022 Stretch=\u0022Fill\u0022 DockPanel.Dock=\u0022Right\u0022 /\u003E\r\n\u0060\u0060\u0060\r\nWhen the view-model detects that the file is created it assigns the filename to the image control\u0027s \u0060Source\u0060 attribute.\r\n\r\n**Expected Behavior**\r\n\r\nAn image that expands in width to 10 pixels (based on the single pixel width), with a height equal to the height of the DockPanel. The height should (normally) shrink to fit the height.\r\n\r\nFor the working test-scenario this works exactly as expected.\r\n\r\n**Actual Behavior**\r\n\r\nI get an exception as a result of assigning the filename to the Source attribute for the failing test-scenario.\r\n\r\n\u0060\u0060\u0060\r\nSystem.ArgumentException\r\n  HResult=0x80070057\r\n  Message=Unable to load bitmap from provided data\r\n  Source=Avalonia.Skia\r\n  StackTrace:\r\n   at Avalonia.Skia.ImmutableBitmap..ctor(Stream stream)\r\n   at Avalonia.Skia.PlatformRenderInterface.LoadBitmap(Stream stream)\r\n   at Avalonia.Skia.PlatformRenderInterface.LoadBitmap(String fileName)\r\n   at Avalonia.Media.Imaging.Bitmap..ctor(String fileName)\r\n   at LogExpress.ViewModels.LogViewModel.\u003C.ctor\u003Eb__15_13(String fileName) in D:\\src\\Haive\\LogExpress\\src\\LogExpress-Avalonia\\ViewModels\\LogViewModel.cs:line 75\r\n   at System.Reactive.AnonymousSafeObserver\u00601.OnNext(T value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\AnonymousSafeObserver.cs:line 54\r\n   at System.Reactive.Linq.ObservableImpl.DistinctUntilChanged\u00602._.OnNext(TSource value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Linq\\Observable\\DistinctUntilChanged.cs:line 74\r\n   at System.Reactive.Linq.ObservableImpl.Switch\u00601._.InnerObserver.OnNext(TSource value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Linq\\Observable\\Switch.cs:line 100\r\n   at System.Reactive.IdentitySink\u00601.OnNext(T value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Internal\\IdentitySink.cs:line 16\r\n   at System.Reactive.Linq.ObservableImpl.Cast\u00602._.OnNext(TSource value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Linq\\Observable\\Cast.cs:line 41\r\n   at System.Reactive.IdentitySink\u00601.OnNext(T value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Internal\\IdentitySink.cs:line 16\r\n   at System.Reactive.Subjects.Subject\u00601.OnNext(T value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Subjects\\Subject.cs:line 148\r\n   at System.Reactive.IdentitySink\u00601.OnNext(T value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Internal\\IdentitySink.cs:line 16\r\n   at System.Reactive.Linq.ObservableImpl.SelectMany\u00602.EnumerableSelector._.OnNext(TSource value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Linq\\Observable\\SelectMany.cs:line 1351\r\n   at System.Reactive.Linq.ObservableImpl.Buffer\u00602.Boundaries._.BufferClosingObserver.OnNext(TBufferClosing value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Linq\\Observable\\Buffer.cs:line 829\r\n   at System.Reactive.Linq.ObservableImpl.Merge\u00601.Observables._.InnerObserver.OnNext(TSource value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Linq\\Observable\\Merge.cs:line 236\r\n   at System.Reactive.Linq.ObservableImpl.Select\u00602.Selector._.OnNext(TSource value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Linq\\Observable\\Select.cs:line 48\r\n   at System.Reactive.Subjects.Subject\u00601.OnNext(T value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Subjects\\Subject.cs:line 148\r\n   at ReactiveUI.IReactiveObjectExtensions.ExtensionState\u00601.NotifyObservable[T](TSender rxObj, T item, ISubject\u00601 subject) in d:\\a\\1\\s\\src\\ReactiveUI\\ReactiveObject\\IReactiveObjectExtensions.cs:line 386\r\n   at ReactiveUI.IReactiveObjectExtensions.ExtensionState\u00601.RaisePropertyChanged(String propertyName) in d:\\a\\1\\s\\src\\ReactiveUI\\ReactiveObject\\IReactiveObjectExtensions.cs:line 380\r\n   at ReactiveUI.IReactiveObjectExtensions.RaisingPropertyChanged[TSender](TSender reactiveObject, String propertyName) in d:\\a\\1\\s\\src\\ReactiveUI\\ReactiveObject\\IReactiveObjectExtensions.cs:line 193\r\n   at ReactiveUI.IReactiveObjectExtensions.RaiseAndSetIfChanged[TObj,TRet](TObj reactiveObject, TRet\u0026 backingField, TRet newValue, String propertyName) in d:\\a\\1\\s\\src\\ReactiveUI\\ReactiveObject\\IReactiveObjectExtensions.cs:line 119\r\n   at LogExpress.Services.VirtualLogFile.set_LogLevelMapFile(String value) in D:\\src\\Haive\\LogExpress\\src\\LogExpress-Avalonia\\Services\\VirtualLogFile.cs:line 194\r\n   at LogExpress.Services.VirtualLogFile.CreateLogLevelMapImage() in D:\\src\\Haive\\LogExpress\\src\\LogExpress-Avalonia\\Services\\VirtualLogFile.cs:line 185\r\n   at LogExpress.Services.VirtualLogFile.\u003C.ctor\u003Eb__11_5(Boolean x) in D:\\src\\Haive\\LogExpress\\src\\LogExpress-Avalonia\\Services\\VirtualLogFile.cs:line 134\r\n   at System.Reactive.AnonymousSafeObserver\u00601.OnNext(T value) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\AnonymousSafeObserver.cs:line 44\r\n   at System.Reactive.ObserveOnObserverNew\u00601.DrainStep(ConcurrentQueue\u00601 q) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Internal\\ScheduledObserver.cs:line 577\r\n   at System.Reactive.ObserveOnObserverNew\u00601.DrainShortRunning(IScheduler recursiveScheduler) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Internal\\ScheduledObserver.cs:line 509\r\n   at System.Reactive.ObserveOnObserverNew\u00601.\u003C\u003Ec.\u003C.cctor\u003Eb__17_0(IScheduler scheduler, ObserveOnObserverNew\u00601 self) in d:\\a\\1\\s\\Rx.NET\\Source\\src\\System.Reactive\\Internal\\ScheduledObserver.cs:line 497\r\n   at Avalonia.Threading.AvaloniaScheduler.\u003C\u003Ec__DisplayClass2_1\u00601.\u003CSchedule\u003Eb__1()\r\n   at Avalonia.Threading.JobRunner.RunJobs(Nullable\u00601 priority)\r\n   at Avalonia.Win32.Win32Platform.WndProc(IntPtr hWnd, UInt32 msg, IntPtr wParam, IntPtr lParam)\r\n   at Avalonia.Win32.Interop.UnmanagedMethods.DispatchMessage(MSG\u0026 lpmsg)\r\n   at Avalonia.Win32.Win32Platform.RunLoop(CancellationToken cancellationToken)\r\n   at Avalonia.Threading.Dispatcher.MainLoop(CancellationToken cancellationToken)\r\n   at Avalonia.Controls.ApplicationLifetimes.ClassicDesktopStyleApplicationLifetime.Start(String[] args)\r\n   at Avalonia.ClassicDesktopStyleApplicationLifetimeExtensions.StartWithClassicDesktopLifetime[T](T builder, String[] args, ShutdownMode shutdownMode)\r\n   at LogExpress.Program.Main(String[] args) in D:\\src\\Haive\\LogExpress\\src\\LogExpress-Avalonia\\Program.cs:line 32\r\n\r\n  This exception was originally thrown at this call stack:\r\n    Avalonia.Skia.ImmutableBitmap.ImmutableBitmap(System.IO.Stream)\r\n    Avalonia.Skia.PlatformRenderInterface.LoadBitmap(System.IO.Stream)\r\n    Avalonia.Skia.PlatformRenderInterface.LoadBitmap(string)\r\n    Avalonia.Media.Imaging.Bitmap.Bitmap(string)\r\n    LogExpress.ViewModels.LogViewModel..ctor.AnonymousMethod__15_13(string) in LogViewModel.cs\r\n    System.Reactive.AnonymousSafeObserver\u003CT\u003E.OnNext(T) in AnonymousSafeObserver.cs\r\n    System.Reactive.Linq.ObservableImpl.DistinctUntilChanged\u003CTSource, TKey\u003E._.OnNext(TSource) in DistinctUntilChanged.cs\r\n    System.Reactive.Linq.ObservableImpl.Switch\u003CTSource\u003E._.InnerObserver.OnNext(TSource) in Switch.cs\r\n    System.Reactive.IdentitySink\u003CT\u003E.OnNext(T) in IdentitySink.cs\r\n    System.Reactive.Linq.ObservableImpl.Cast\u003CTSource, TResult\u003E._.OnNext(TSource) in Cast.cs\r\n    ...\r\n    [Call Stack Truncated]\r\n\u0060\u0060\u0060\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  AvaloniaUI v9.9 (not sure which version of SkiaSharp is used for it)\r\n- Last known good version:  Don\u0027t know. This is new code.\r\n- IDE:  Visual Studio\r\n- Platform Target Frameworks: \r\n  - Windows Classic:  Windows 10\r\n\r\n**Screenshots**\r\n\r\n[failing-image.zip](https://github.com/mono/SkiaSharp/files/4533900/failing-image.zip)\r\n[non-failing-image.zip](https://github.com/mono/SkiaSharp/files/4533904/non-failing-image.zip)\r\n\r\n**Reproduction Link**\r\n\r\nN/A",
  "author": {
    "login": "Spiralis",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/duplicate",
      "color": "cccccc"
    }
  ],
  "assignees": [],
  "createdAt": "2020-04-25T19:57:43",
  "updatedAt": "2022-08-19T06:01:55",
  "closedAt": "2020-05-08T17:52:05",
  "commentCount": 12,
  "reactionCount": 0
}