{
  "number": 157,
  "type": "issue",
  "state": "open",
  "title": "Programmatically Create SKLottieView in MAUI",
  "body": "All of the examples I have seen assign the source in XAML; I have tried to do it in code without success:\r\n\r\n\u0060\u0060\u0060\r\n            var source = new SKFileLottieImageSource()\r\n            { \r\n                File = String.Format(\u0022{0}.json\u0022, Name)\r\n            };\r\n            \r\n            var view = new SKLottieView()\r\n            {\r\n                Source = source,\r\n                WidthRequest = 400,\r\n                HeightRequest = 400,\r\n                BackgroundColor = Colors.Red,\r\n                RepeatMode = SKLottieRepeatMode.Restart,\r\n                RepeatCount = Loop ? -1 : 0,\r\n                //Scale = Scale,\r\n                StyleId = ID\r\n            };\r\n\u0060\u0060\u0060\r\n\r\nThe view renders to the screen but the animation does not appear.\r\n\r\nI see in the source that the file is ultimately loaded using _FileSystem.OpenAppPackageFileAsync_ and so I tested that with the file path I used in SKFileLottieImageSource, and it worked.\r\n\r\nAlso, I know the Lottie file I am using works, as it did fine in the Xamarin Forms app that we are attempting to migrate to MAUI.\r\n",
  "author": {
    "login": "heiser",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-12-09T19:06:41",
  "updatedAt": "2024-08-02T18:22:55",
  "commentCount": 10,
  "reactionCount": 5,
  "engagement": {
    "syncedAt": "2026-02-06T12:21:29.8966781Z",
    "reactions": [
      {
        "user": "Strypper",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:21:29.8966839Z"
      },
      {
        "user": "borrmann",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:21:29.8966846Z"
      },
      {
        "user": "mrlacey",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:21:29.8966848Z"
      },
      {
        "user": "kyurkchyan",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:21:29.8966851Z"
      },
      {
        "user": "bradencohen",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:21:29.8966853Z"
      }
    ],
    "comments": [
      {
        "id": 1385386266,
        "author": "dpjha84",
        "body": "Similar to this but slightly different. I cannot play animation on demand from code behind. In Xamarin.Forms there was a method available PlayAnimation() but it it is missing in MAUI version. Can somebody provide some work around on how to play an animation from code behind for the LottieView created in XAML?",
        "createdAt": "2023-01-17T12:57:50",
        "reactions": [
          {
            "user": "Strypper",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:21:27.6108368Z"
          },
          {
            "user": "dpjha84",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:21:27.6108373Z"
          }
        ]
      },
      {
        "id": 1426193899,
        "author": "Strypper",
        "body": "Yes we need an example or guidance to set image source using C#",
        "createdAt": "2023-02-10T18:38:40",
        "reactions": []
      },
      {
        "id": 1566857644,
        "author": "mrlacey",
        "body": "I was trying to get this working with Maui.Markup.\r\nThe \u0060AnimationLoaded\u0060 event fires, but the animation is never displayed. \uD83D\uDE22 ",
        "createdAt": "2023-05-29T09:41:48",
        "reactions": []
      },
      {
        "id": 1597200014,
        "author": "kyurkchyan",
        "body": "Animations work perfectly fine when I assign them in Xaml. However, when I try to setup a derived control, that would set some predefined animations, the animations won\u0027t show up. \r\n\r\n\u0060\u0060\u0060C#\r\nusing System.Diagnostics;\r\nusing SkiaSharp.Extended.UI.Controls;\r\n\r\nnamespace MSOISales.Maui.Legacy.Controls;\r\n\r\npublic enum LoadingIndicatorType\r\n{\r\n    Circular,\r\n    Horizontal\r\n}\r\n\r\npublic class LoadingIndicator : SKLottieView\r\n{\r\n    public LoadingIndicator()\r\n    {\r\n        AnimationLoaded \u002B= OnAnimationLoaded;\r\n        AnimationFailed \u002B= OnAnimationFailed;\r\n        UpdateIndicatorType();\r\n        UpdateIndicatorState();\r\n    }\r\n\r\n    public static readonly BindableProperty IndicatorTypeProperty = BindableProperty.Create(nameof(IndicatorType),\r\n                                                                                            typeof(LoadingIndicatorType),\r\n                                                                                            typeof(LoadingIndicator),\r\n                                                                                            defaultValue:LoadingIndicatorType.Circular,\r\n                                                                                            propertyChanged:OnIndicatorTypeChanged);\r\n\r\n    public LoadingIndicatorType IndicatorType\r\n    {\r\n        get =\u003E (LoadingIndicatorType)GetValue(IndicatorTypeProperty);\r\n        set =\u003E SetValue(IndicatorTypeProperty, value);\r\n    }\r\n\r\n    private static void OnIndicatorTypeChanged(BindableObject bindable, object oldValue, object newValue)\r\n    {\r\n        var loadingIndicator = (LoadingIndicator)bindable;\r\n        loadingIndicator.UpdateIndicatorType();\r\n    }\r\n\r\n    public static readonly BindableProperty IsRunningProperty = BindableProperty.Create(nameof(IsRunning),\r\n                                                                                        typeof(bool),\r\n                                                                                        typeof(LoadingIndicator),\r\n                                                                                        defaultValue:false,\r\n                                                                                        propertyChanged:OnIsRunningChanged);\r\n\r\n    public bool IsRunning\r\n    {\r\n        get =\u003E (bool)GetValue(IsRunningProperty);\r\n        set =\u003E SetValue(IsRunningProperty, value);\r\n    }\r\n\r\n    private static void OnIsRunningChanged(BindableObject bindable, object oldValue, object newValue)\r\n    {\r\n        var loadingIndicator = (LoadingIndicator)bindable;\r\n        loadingIndicator.UpdateIndicatorState();\r\n    }\r\n\r\n    private void UpdateIndicatorType()\r\n    {\r\n        Source = IndicatorType switch\r\n        {\r\n            LoadingIndicatorType.Circular =\u003E new SKFileLottieImageSource { File = \u0022animation_circular_loading.json\u0022 },\r\n            LoadingIndicatorType.Horizontal =\u003E new SKFileLottieImageSource { File = \u0022animation_horizontal_loading.json\u0022 },\r\n            _ =\u003E throw new ArgumentOutOfRangeException()\r\n        };\r\n    }\r\n\r\n    private void UpdateIndicatorState()\r\n    {\r\n        IsAnimationEnabled = IsRunning;\r\n        IsVisible = IsRunning;\r\n    }\r\n\r\n    private void OnAnimationLoaded(object sender, EventArgs e)\r\n    {\r\n        Debug.WriteLine($\u0022Animation {IndicatorType} loaded\u0022);\r\n    }\r\n\r\n    private void OnAnimationFailed(object sender, EventArgs e)\r\n    {\r\n        Debug.WriteLine($\u0022Animation {IndicatorType} failed\u0022);\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\nLater, I use it in Xaml like this\r\n\r\n\u0060\u0060\u0060xaml\r\n     \u003CStyle\r\n        x:Key=\u0022DefaultLoadingIndicatorStyle\u0022\r\n        TargetType=\u0022controls:LoadingIndicator\u0022\u003E\r\n        \u003CSetter Property=\u0022WidthRequest\u0022 Value=\u0022{StaticResource LoadingIndicatorWidth}\u0022 /\u003E\r\n        \u003CSetter Property=\u0022HeightRequest\u0022 Value=\u0022{StaticResource LoadingIndicatorHeight}\u0022 /\u003E\r\n        \u003CSetter Property=\u0022VerticalOptions\u0022 Value=\u0022Center\u0022 /\u003E\r\n        \u003CSetter Property=\u0022HorizontalOptions\u0022 Value=\u0022Center\u0022 /\u003E\r\n        \u003CSetter Property=\u0022BackgroundColor\u0022 Value=\u0022Red\u0022 /\u003E\r\n    \u003C/Style\u003E\r\n\r\n    \u003CStyle\r\n        BasedOn=\u0022{StaticResource DefaultLoadingIndicatorStyle}\u0022\r\n        TargetType=\u0022controls:LoadingIndicator\u0022 /\u003E\r\n\r\n    \u003Ccontrols:LoadingIndicator\r\n        IsRunning=\u0022{Binding SyncCommand.IsBusy}\u0022\r\n        IndicatorType=\u0022Horizontal\u0022 /\u003E\r\n\u0060\u0060\u0060\r\n\r\nThe \u0060AnimationLoaded\u0060 is fired, and I never receive an error on the \u0060AnimationFailed\u0060; however, nothing happens, I see a blank view.",
        "createdAt": "2023-06-19T13:30:43",
        "reactions": []
      },
      {
        "id": 1726266215,
        "author": "haavamoa",
        "body": "I think I found a workaround for this. We create a [library](https://github.com/DIPSAS/DIPS.Mobile.UI) where we have a Content Page that will animate using SKLottieView when consumers set a property for the page \u0060IsFinishedSaving\u0060.\r\n\r\nThe SKLottieView is created programatically, and we also noticed that the first time the app loads and the first time we display the animation, it does not appear. The second time we try to display the animation it does appear.\r\nI went through this repository, and found [this line in the constructor of SKLottieView:](https://github.com/mono/SkiaSharp.Extended/blob/8b5d7bd969f3c6c8d91ca60f3b057882184548a0/source/SkiaSharp.Extended.UI/Controls/Lottie/SKLottieView.shared.cs#L57)\r\n\r\n\u0060ResourceLoader\u003CSKLottieViewResources\u003E.EnsureRegistered((VisualElement) this);\u0060\r\n\r\nFrom my reading, the [ResourcesLoader](https://github.com/mono/SkiaSharp.Extended/blob/8b5d7bd969f3c6c8d91ca60f3b057882184548a0/source/SkiaSharp.Extended.UI/Utils/ResourceLoader.shared.cs#L8) basically makes sure that the \u0060SKLottieViewResources\u0060 is added to the apps resources. I somehow figured out that this has to be some kind of race condition where it might not have been loaded successfully when we try to display the animation the first time you try to create it. The second time you display it its already merged and it works as expected.\r\n\r\nThe workaround is to merge this resource to your resources manually in your App.xaml:\r\n\u0060\u0060\u0060\r\n\u003CApplication xmlns=\u0022http://schemas.microsoft.com/dotnet/2021/maui\u0022\r\n             xmlns:x=\u0022http://schemas.microsoft.com/winfx/2009/xaml\u0022\r\n             xmlns:themes=\u0022clr-namespace:SkiaSharp.Extended.UI.Controls.Themes;assembly=SkiaSharp.Extended.UI\u0022\r\n    ...\u003E\r\n    \u003CApplication.Resources\u003E\r\n        \u003CResourceDictionary\u003E\r\n            \u003CResourceDictionary.MergedDictionaries\u003E\r\n                \u003Cthemes:SKLottieViewResources/\u003E\r\n            \u003C/ResourceDictionary.MergedDictionaries\u003E\r\n        \u003C/ResourceDictionary\u003E\r\n    \u003C/Application.Resources\u003E\r\n\u003C/Application\u003E\r\n\u0060\u0060\u0060\r\n\r\nLet me know if this did not work, we did not inherit directly from SKLottieView in our [component](https://github.com/DIPSAS/DIPS.Mobile.UI/blob/main/src/library/DIPS.Mobile.UI/Components/CheckBoxes/FilledCheckBox.cs). So there might be differences in how we programatically use SKLottieView if it does not work for you.",
        "createdAt": "2023-09-19T18:23:05",
        "reactions": [
          {
            "user": "MarMarIV",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:21:28.5888717Z"
          },
          {
            "user": "awasilik",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:21:28.5888854Z"
          },
          {
            "user": "bradencohen",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:21:28.5888856Z"
          },
          {
            "user": "devoirtechsandip",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:21:28.5888856Z"
          }
        ]
      },
      {
        "id": 1824603073,
        "author": "naaeef",
        "body": "Hello @haavamoa \r\nI have the same problem. Unfortunately, your workaround doesn\u0027t work for me.\r\nIf I load the animation for the second time, it works as expected.",
        "createdAt": "2023-11-23T15:18:55",
        "reactions": []
      },
      {
        "id": 1831733367,
        "author": "naaeef",
        "body": "If I add the following to the constructor of the page containing the animation, it works for me:\r\n\u0060Application.Current?.Resources?.MergedDictionaries.Add(new SKLottieViewResources());\u0060",
        "createdAt": "2023-11-29T11:40:21",
        "reactions": []
      },
      {
        "id": 1936999816,
        "author": "ghost",
        "body": "Looks like binding the source does not work either. When using binding, nothing displays within the SKLottieView. Not even after loading a second or third time. Only when hardcoding the name of the JSON file within the source attribute, the animation displays.",
        "createdAt": "2024-02-10T12:50:14",
        "reactions": []
      },
      {
        "id": 2119217814,
        "author": "awasilik",
        "body": "\u003E I think I found a workaround for this. We create a [library](https://github.com/DIPSAS/DIPS.Mobile.UI) where we have a Content Page that will animate using SKLottieView when consumers set a property for the page \u0060IsFinishedSaving\u0060.\r\n\u003E \r\n\u003E The SKLottieView is created programatically, and we also noticed that the first time the app loads and the first time we display the animation, it does not appear. The second time we try to display the animation it does appear. I went through this repository, and found [this line in the constructor of SKLottieView:](https://github.com/mono/SkiaSharp.Extended/blob/8b5d7bd969f3c6c8d91ca60f3b057882184548a0/source/SkiaSharp.Extended.UI/Controls/Lottie/SKLottieView.shared.cs#L57)\r\n\u003E \r\n\u003E \u0060ResourceLoader\u003CSKLottieViewResources\u003E.EnsureRegistered((VisualElement) this);\u0060\r\n\u003E \r\n\u003E From my reading, the [ResourcesLoader](https://github.com/mono/SkiaSharp.Extended/blob/8b5d7bd969f3c6c8d91ca60f3b057882184548a0/source/SkiaSharp.Extended.UI/Utils/ResourceLoader.shared.cs#L8) basically makes sure that the \u0060SKLottieViewResources\u0060 is added to the apps resources. I somehow figured out that this has to be some kind of race condition where it might not have been loaded successfully when we try to display the animation the first time you try to create it. The second time you display it its already merged and it works as expected.\r\n\u003E \r\n\u003E The workaround is to merge this resource to your resources manually in your App.xaml:\r\n\u003E \r\n\u003E \u0060\u0060\u0060\r\n\u003E \u003CApplication xmlns=\u0022http://schemas.microsoft.com/dotnet/2021/maui\u0022\r\n\u003E              xmlns:x=\u0022http://schemas.microsoft.com/winfx/2009/xaml\u0022\r\n\u003E              xmlns:themes=\u0022clr-namespace:SkiaSharp.Extended.UI.Controls.Themes;assembly=SkiaSharp.Extended.UI\u0022\r\n\u003E     ...\u003E\r\n\u003E     \u003CApplication.Resources\u003E\r\n\u003E         \u003CResourceDictionary\u003E\r\n\u003E             \u003CResourceDictionary.MergedDictionaries\u003E\r\n\u003E                 \u003Cthemes:SKLottieViewResources/\u003E\r\n\u003E             \u003C/ResourceDictionary.MergedDictionaries\u003E\r\n\u003E         \u003C/ResourceDictionary\u003E\r\n\u003E     \u003C/Application.Resources\u003E\r\n\u003E \u003C/Application\u003E\r\n\u003E \u0060\u0060\u0060\r\n\u003E \r\n\u003E Let me know if this did not work, we did not inherit directly from SKLottieView in our [component](https://github.com/DIPSAS/DIPS.Mobile.UI/blob/main/src/library/DIPS.Mobile.UI/Components/CheckBoxes/FilledCheckBox.cs). So there might be differences in how we programatically use SKLottieView if it does not work for you.\r\n\r\nThanks, the workaround worked for me :)\r\n\r\nI think this should be easy to fix in library though since this clearly shows where the issue is :)",
        "createdAt": "2024-05-19T12:24:02",
        "reactions": []
      },
      {
        "id": 2265918173,
        "author": "bradencohen",
        "body": "\u003E I think I found a workaround for this. We create a [library](https://github.com/DIPSAS/DIPS.Mobile.UI) where we have a Content Page that will animate using SKLottieView when consumers set a property for the page \u0060IsFinishedSaving\u0060.\r\n\u003E \r\n\u003E The SKLottieView is created programatically, and we also noticed that the first time the app loads and the first time we display the animation, it does not appear. The second time we try to display the animation it does appear. I went through this repository, and found [this line in the constructor of SKLottieView:](https://github.com/mono/SkiaSharp.Extended/blob/8b5d7bd969f3c6c8d91ca60f3b057882184548a0/source/SkiaSharp.Extended.UI/Controls/Lottie/SKLottieView.shared.cs#L57)\r\n\u003E \r\n\u003E \u0060ResourceLoader\u003CSKLottieViewResources\u003E.EnsureRegistered((VisualElement) this);\u0060\r\n\u003E \r\n\u003E From my reading, the [ResourcesLoader](https://github.com/mono/SkiaSharp.Extended/blob/8b5d7bd969f3c6c8d91ca60f3b057882184548a0/source/SkiaSharp.Extended.UI/Utils/ResourceLoader.shared.cs#L8) basically makes sure that the \u0060SKLottieViewResources\u0060 is added to the apps resources. I somehow figured out that this has to be some kind of race condition where it might not have been loaded successfully when we try to display the animation the first time you try to create it. The second time you display it its already merged and it works as expected.\r\n\u003E \r\n\u003E The workaround is to merge this resource to your resources manually in your App.xaml:\r\n\u003E \r\n\u003E \u0060\u0060\u0060\r\n\u003E \u003CApplication xmlns=\u0022http://schemas.microsoft.com/dotnet/2021/maui\u0022\r\n\u003E              xmlns:x=\u0022http://schemas.microsoft.com/winfx/2009/xaml\u0022\r\n\u003E              xmlns:themes=\u0022clr-namespace:SkiaSharp.Extended.UI.Controls.Themes;assembly=SkiaSharp.Extended.UI\u0022\r\n\u003E     ...\u003E\r\n\u003E     \u003CApplication.Resources\u003E\r\n\u003E         \u003CResourceDictionary\u003E\r\n\u003E             \u003CResourceDictionary.MergedDictionaries\u003E\r\n\u003E                 \u003Cthemes:SKLottieViewResources/\u003E\r\n\u003E             \u003C/ResourceDictionary.MergedDictionaries\u003E\r\n\u003E         \u003C/ResourceDictionary\u003E\r\n\u003E     \u003C/Application.Resources\u003E\r\n\u003E \u003C/Application\u003E\r\n\u003E \u0060\u0060\u0060\r\n\u003E \r\n\u003E Let me know if this did not work, we did not inherit directly from SKLottieView in our [component](https://github.com/DIPSAS/DIPS.Mobile.UI/blob/main/src/library/DIPS.Mobile.UI/Components/CheckBoxes/FilledCheckBox.cs). So there might be differences in how we programatically use SKLottieView if it does not work for you.\r\n\r\nGreat workaround, thanks so much.\r\n\r\nIn our case, we were programmatically creating the SKLottieView before the Window was set, causing that EnsureRegistered to fail.\r\n\r\nThanks again!",
        "createdAt": "2024-08-02T18:22:54",
        "reactions": []
      }
    ]
  }
}