{
  "number": 11,
  "type": "issue",
  "state": "closed",
  "title": "Strange rendering of text and tspan when using text-anchor and baseline-shift",
  "body": "I am currently using SkiaSharp.SVG 1.59.0 and observed some rendering problems with respect to text-anchor and baseline-shift properties.\r\n\r\nSee the following example svg:\r\n\u0060\u0060\u0060xml\r\n\u003C?xml version=\u00221.0\u0022 standalone=\u0022no\u0022 ?\u003E\r\n\u003Csvg xmlns=\u0022http://www.w3.org/2000/svg\u0022 fill=\u0022white\u0022 version=\u00221.1\u0022\u003E\r\n\r\n    \u003Ctext x=\u0022350\u0022 y=\u002250\u0022 style=\u0022fill: #000000; font-size: 24px; text-anchor: start; \u0022\u003ENormal \u003Ctspan style=\u0022baseline-shift: -12px;\u0022\u003Esub\u003C/tspan\u003E NORMAL \u003Ctspan style=\u0022baseline-shift: 12px;\u0022\u003Esuper\u003C/tspan\u003E\u003C/text\u003E\r\n    \r\n    \u003Ctext x=\u0022350\u0022 y=\u0022100\u0022 style=\u0022fill: #000000; font-size: 24px; text-anchor: middle; \u0022\u003ENormal \u003Ctspan style=\u0022baseline-shift: -12px;\u0022\u003Esub\u003C/tspan\u003E NORMAL \u003Ctspan style=\u0022baseline-shift: 12px;\u0022\u003Esuper\u003C/tspan\u003E\u003C/text\u003E\r\n    \r\n    \u003Ctext x=\u0022350\u0022 y=\u0022150\u0022 style=\u0022fill: #000000; font-size: 24px; text-anchor: end; \u0022\u003ENormal \u003Ctspan style=\u0022baseline-shift: -12px;\u0022\u003Esub\u003C/tspan\u003E NORMAL \u003Ctspan style=\u0022baseline-shift: 12px;\u0022\u003Esuper\u003C/tspan\u003E\u003C/text\u003E\r\n    \r\n    \u003Cline x1=\u0022350\u0022 x2 =\u0022 350\u0022 y1=\u002250\u0022 y2=\u0022150\u0022 stroke=\u0022black\u0022 stroke-width=\u00221\u0022/\u003E\r\n\u003C/svg\u003E\r\n\u0060\u0060\u0060\r\n\r\nWhen you open this svg in a brrowser (I used Chrome here), you see the following result:\r\n\r\n![image](https://user-images.githubusercontent.com/2646473/28825001-dc1a2402-76c4-11e7-8619-5093cad34b48.png)\r\n\r\nWhen you render it using SKSvg class (I used WPF here), you get this result:\r\n![image](https://user-images.githubusercontent.com/2646473/28825075-12832444-76c5-11e7-8c3b-b2e684201508.png)\r\n\r\nIt seems like the text-anchor attribute is only working as expected, if its value is \u0027start\u0027. The baseline-shift seems to be ignored completely. \r\n\r\nI had a look in the source code and for me it seems, that SKTextAlignment does not correspond to svg text-anchor positions (as mapped in [ReadTextAlignment](https://github.com/mono/SkiaSharp.Extended/blob/master/SkiaSharp.Extended.Svg/source/SkiaSharp.Extended.Svg.Shared/SKSvg.cs#L976)).\r\nBaseline-Shift seems to be not implemented at all. \r\n\r\nAny idea on how to improve things? I\u0027d be happy to send a PR, as soon as it is clear what to do.",
  "author": {
    "login": "codedevote",
    "type": "User"
  },
  "labels": [
    {
      "name": "area-Svg",
      "color": "0052cc"
    }
  ],
  "assignees": [],
  "createdAt": "2017-08-01T12:34:09",
  "updatedAt": "2020-08-15T00:23:48",
  "closedAt": "2020-08-15T00:20:54",
  "commentCount": 4,
  "reactionCount": 2,
  "engagement": {
    "syncedAt": "2026-02-06T12:25:59.0770921Z",
    "reactions": [
      {
        "user": "tzachshabtay",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:25:59.0770991Z"
      },
      {
        "user": "Buzzker",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:25:59.0770999Z"
      }
    ],
    "comments": [
      {
        "id": 321006593,
        "author": "codedevote",
        "body": "I made some progress on this. What is imho missing from Skia/SkiaSharp in general, is the possibility to output contiguous pieces of formatted text. Take this markdown formatted example:\r\n\r\nNormal **and bold** text.\r\n\r\nTo render this in skia, I need three calls to DrawText and vary the paint / font / typeface and x-coordinate accordingly. Right now, I have implemented my own solution to output formatted text. I integrate the format right into the strings I want to output (like HTML or BBCode) and have a parser that cuts that into pieces and provides a list of SKFormattedText objects that can each be rendered using a single DrawText call (I have an extension method for that). I would be happy to get that code upstream into SkiaSharp, if you are interested. \r\nWith this implementation I can solve the baseline-shift in both directions (ie. IEnumerable\u003CSKFormattedText\u003E \u003C--\u003E outer text \u002B tspans). I am not done with the *text-anchor* yet, but I think it should be possible by measuring the text as it would be rendered using text-anchor=\u0022start\u0022 and then adjust the x-coordinate. \r\nWhat are your thoughts?",
        "createdAt": "2017-08-08T16:18:32",
        "reactions": [
          {
            "user": "charlesroddie",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:25:58.2688048Z"
          },
          {
            "user": "Buzzker",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:25:58.2688237Z"
          }
        ]
      },
      {
        "id": 326684282,
        "author": "mattleibow",
        "body": "I agree that the area that is lacking is text handling.\r\n\r\nSkiaSharp is not designed to handle the rendering of text from some formatted string, but rather gives you all the tools that you may need to DRAW arbitrary text.\r\n\r\nWe haven\u0027t yet had the opportunity to investigate this. But, as demand increases, this will rise up the ranks of the backlog.",
        "createdAt": "2017-09-01T21:08:56",
        "reactions": []
      },
      {
        "id": 360828882,
        "author": "Buzzker",
        "body": "As a workaround one can convert text into path and it works ok.",
        "createdAt": "2018-01-26T16:14:12",
        "reactions": []
      },
      {
        "id": 674319630,
        "author": "mattleibow",
        "body": "Thanks for this issue, but due the the fact that this library is now deprecated, no further work will be done on SkiaSharp.SVG.\r\n\r\nThank you for all of you folks that have been using this library this long, it is always great to know that some of my work has made things a bit better. However, I am unable to maintain this library, but I would recommend using the far superior https://github.com/wieslawsoltes/Svg.Skia \r\nIt has an API that is compatible and will just require a namespace change.\r\n\r\nFor better text support, I again would recommend the equally awesome https://github.com/toptensoftware/RichTextKit that can pretty much do everything.\r\n\r\nWith both of these, I have updated the sample app to demonstrate how to use these libraries, producing a far better result.",
        "createdAt": "2020-08-15T00:20:54",
        "reactions": []
      }
    ]
  }
}