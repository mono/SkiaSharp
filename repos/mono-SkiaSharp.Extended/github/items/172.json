{
  "number": 172,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] System.BadImageFormatException: \u0027Invalid field token 0x040000a1\u0027, MAUI NET8 Preview 5",
  "body": "**Description**\r\n\r\nFor a new project in MAUI, using NET8 preview, the control crashes the app with this exception: System.BadImageFormatException: \u0027Invalid field token 0x040000a1\u0027\r\n\r\n**Code**\r\n\r\nI\u0027ve created a solution which demonstrate the issue\r\n\r\nhttps://github.com/DarioAlonsoCerezo/Maui_preview_skia_lottie_issue\r\n\r\n**Expected Behavior**\r\n\r\nRender the animation\r\n\r\n**Actual Behavior**\r\n\r\nCrash the app\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.0.0-preview.61\r\n- Last known good version:  \u003C!-- the version of SkiaSharp that still working --\u003E\r\n- IDE:  Visual Studio\r\n- Platform Target Frameworks: \r\n  - Android: net8.0-android \r\n- Target Devices:   \u003C!-- the devices that you noticed this on, e.g. iPhone X --\u003E\r\n  - Device Android Emulator API 33\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\n**System.BadImageFormatException:** \u0027Invalid field token 0x040000a1\u0027\r\n\r\n**System.BadImageFormatException:** \u0027Invalid field token 0x040000a1\u0027\r\n\r\n[mono-rt] [ERROR] FATAL UNHANDLED EXCEPTION: System.BadImageFormatException: Invalid field token 0x040000a1\r\n[mono-rt] File name: \u0027SkiaSharp.Views.Android\u0027\r\n[mono-rt]    at SkiaSharp.Views.Android.SKCanvasView..ctor(Context context)\r\n[mono-rt]    at SkiaSharp.Views.Maui.Handlers.SKCanvasViewHandler.CreatePlatformView() in D:\\a\\1\\s\\source\\SkiaSharp.Views.Maui\\SkiaSharp.Views.Maui.Core\\Handlers\\SKCanvasView\\SKCanvasViewHandler.Android.cs:line 14\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[SkiaSharp.Views.Maui.ISKCanvasView, SkiaSharp.Views.Maui.Core, Version=2.88.0.0, Culture=neutral, PublicKeyToken=null],[SkiaSharp.Views.Android.SKCanvasView, SkiaSharp.Views.Android, Version=2.88.0.0, Culture=neutral, PublicKeyToken=0738eb9f132ed756]].OnCreatePlatformView() in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 72\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler.OnCreatePlatformElement() in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandler.cs:line 134\r\n[mono-rt]    at Microsoft.Maui.Handlers.ElementHandler.CreatePlatformElement() in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\Element\\ElementHandler.cs:line 101\r\n[mono-rt]    at Microsoft.Maui.Handlers.ElementHandler.SetVirtualView(IElement view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\Element\\ElementHandler.cs:line 50\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[SkiaSharp.Views.Maui.ISKCanvasView, SkiaSharp.Views.Maui.Core, Version=2.88.0.0, Culture=neutral, PublicKeyToken=null],[SkiaSharp.Views.Android.SKCanvasView, SkiaSharp.Views.Android, Version=2.88.0.0, Culture=neutral, PublicKeyToken=0738eb9f132ed756]].SetVirtualView(IView view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 53\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[SkiaSharp.Views.Maui.ISKCanvasView, SkiaSharp.Views.Maui.Core, Version=2.88.0.0, Culture=neutral, PublicKeyToken=null],[SkiaSharp.Views.Android.SKCanvasView, SkiaSharp.Views.Android, Version=2.88.0.0, Culture=neutral, PublicKeyToken=0738eb9f132ed756]].SetVirtualView(IElement view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 56\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.SetHandler(IElementHandler newHandler) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 70\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 20\r\n[mono-rt]    at Microsoft.Maui.Controls.VisualElement.Microsoft.Maui.IElement.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\VisualElement\\VisualElement.Impl.cs:line 305\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToHandler(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 96\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToPlatform(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 127\r\n[mono-rt]    at Microsoft.Maui.Handlers.ContentViewHandler.UpdateContent(IContentViewHandler handler) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\ContentView\\ContentViewHandler.Android.cs:line 44\r\n[mono-rt]    at Microsoft.Maui.Handlers.ContentViewHandler.MapContent(IContentViewHandler handler, IContentView page) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\ContentView\\ContentViewHandler.Android.cs:line 49\r\n[mono-rt]    at Microsoft.Maui.PropertyMapper\u00602.\u003C\u003Ec__DisplayClass5_0[[Microsoft.Maui.IContentView, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[Microsoft.Maui.Handlers.IContentViewHandler, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].\u003CAdd\u003Eb__0(IElementHandler h, IElement v) in D:\\a\\_work\\1\\s\\src\\Core\\src\\PropertyMapper.cs:line 172\r\n[mono-rt]    at Microsoft.Maui.PropertyMapper.UpdatePropertyCore(String key, IElementHandler viewHandler, IElement virtualView) in D:\\a\\_work\\1\\s\\src\\Core\\src\\PropertyMapper.cs:line 47\r\n[mono-rt]    at Microsoft.Maui.PropertyMapper.UpdateProperties(IElementHandler viewHandler, IElement virtualView) in D:\\a\\_work\\1\\s\\src\\Core\\src\\PropertyMapper.cs:line 82\r\n[mono-rt]    at Microsoft.Maui.Handlers.ElementHandler.SetVirtualView(IElement view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\Element\\ElementHandler.cs:line 79\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[Microsoft.Maui.IContentView, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[Microsoft.Maui.Platform.ContentViewGroup, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].SetVirtualView(IView view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 53\r\n[mono-rt]    at Microsoft.Maui.Handlers.ContentViewHandler.SetVirtualView(IView view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\ContentView\\ContentViewHandler.Android.cs:line 27\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[Microsoft.Maui.IContentView, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[Microsoft.Maui.Platform.ContentViewGroup, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].SetVirtualView(IElement view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 56\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.SetHandler(IElementHandler newHandler) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 70\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 20\r\n[mono-rt]    at Microsoft.Maui.Controls.VisualElement.Microsoft.Maui.IElement.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\VisualElement\\VisualElement.Impl.cs:line 305\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToHandler(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 96\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToPlatform(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 127\r\n[mono-rt]    at Microsoft.Maui.Handlers.LayoutHandler.SetVirtualView(IView view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\Layout\\LayoutHandler.Android.cs:line 43\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[Microsoft.Maui.ILayout, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[Microsoft.Maui.Platform.LayoutViewGroup, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].SetVirtualView(IElement view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 56\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.SetHandler(IElementHandler newHandler) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 70\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 20\r\n[mono-rt]    at Microsoft.Maui.Controls.VisualElement.Microsoft.Maui.IElement.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\VisualElement\\VisualElement.Impl.cs:line 305\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToHandler(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 96\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToPlatform(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 127\r\n[mono-rt]    at Microsoft.Maui.Handlers.ContentViewHandler.UpdateContent(IContentViewHandler handler) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\ContentView\\ContentViewHandler.Android.cs:line 44\r\n[mono-rt]    at Microsoft.Maui.Handlers.ContentViewHandler.MapContent(IContentViewHandler handler, IContentView page) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\ContentView\\ContentViewHandler.Android.cs:line 49\r\n[mono-rt]    at Microsoft.Maui.PropertyMapper\u00602.\u003C\u003Ec__DisplayClass5_0[[Microsoft.Maui.IContentView, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[Microsoft.Maui.Handlers.IContentViewHandler, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].\u003CAdd\u003Eb__0(IElementHandler h, IElement v) in D:\\a\\_work\\1\\s\\src\\Core\\src\\PropertyMapper.cs:line 172\r\n[mono-rt]    at Microsoft.Maui.PropertyMapper.UpdatePropertyCore(String key, IElementHandler viewHandler, IElement virtualView) in D:\\a\\_work\\1\\s\\src\\Core\\src\\PropertyMapper.cs:line 47\r\n[mono-rt]    at Microsoft.Maui.PropertyMapper.UpdateProperties(IElementHandler viewHandler, IElement virtualView) in D:\\a\\_work\\1\\s\\src\\Core\\src\\PropertyMapper.cs:line 82\r\n[mono-rt]    at Microsoft.Maui.Handlers.ElementHandler.SetVirtualView(IElement view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\Element\\ElementHandler.cs:line 79\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[Microsoft.Maui.IContentView, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[Microsoft.Maui.Platform.ContentViewGroup, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].SetVirtualView(IView view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 53\r\n[mono-rt]    at Microsoft.Maui.Handlers.ContentViewHandler.SetVirtualView(IView view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\ContentView\\ContentViewHandler.Android.cs:line 27\r\n[mono-rt]    at Microsoft.Maui.Handlers.ViewHandler\u00602[[Microsoft.Maui.IContentView, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[Microsoft.Maui.Platform.ContentViewGroup, Microsoft.Maui, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].SetVirtualView(IElement view) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Handlers\\View\\ViewHandlerOfT.cs:line 56\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.SetHandler(IElementHandler newHandler) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 70\r\n[mono-rt]    at Microsoft.Maui.Controls.Element.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\Element\\Element.Impl.cs:line 20\r\n[mono-rt]    at Microsoft.Maui.Controls.VisualElement.Microsoft.Maui.IElement.set_Handler(IElementHandler value) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\HandlerImpl\\VisualElement\\VisualElement.Impl.cs:line 305\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToHandler(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 96\r\n[mono-rt]    at Microsoft.Maui.Platform.ElementExtensions.ToPlatform(IElement view, IMauiContext context) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\ElementExtensions.cs:line 127\r\n[mono-rt]    at Microsoft.Maui.Platform.MauiContextExtensions.ToPlatform(IView view, IMauiContext fragmentMauiContext, Context context, LayoutInflater layoutInflater, FragmentManager childFragmentManager) in D:\\a\\_work\\1\\s\\src\\Core\\src\\Platform\\Android\\MauiContextExtensions.cs:line 96\r\n[mono-rt]    at Microsoft.Maui.Controls.Platform.Compatibility.ShellFragmentContainer.OnCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) in D:\\a\\_work\\1\\s\\src\\Controls\\src\\Core\\Compatibility\\Handlers\\Shell\\Android\\ShellFragmentContainer.cs:line 26\r\n[mono-rt]    at AndroidX.Fragment.App.Fragment.n_OnCreateView_Landroid_view_LayoutInflater_Landroid_view_ViewGroup_Landroid_os_Bundle_(IntPtr jnienv, IntPtr native__this, IntPtr native_inflater, IntPtr native_container, IntPtr native_savedInstanceState) in C:\\a\\_work\\1\\s\\generated\\androidx.fragment.fragment\\obj\\Release\r\net6.0-android\\generated\\src\\AndroidX.Fragment.App.Fragment.cs:line 2031\r\n[mono-rt]    at Android.Runtime.JNINativeWrapper.Wrap_JniMarshal_PPLLL_L(_JniMarshal_PPLLL_L callback, IntPtr jnienv, IntPtr klazz, IntPtr p0, IntPtr p1, IntPtr p2) in /Users/runner/work/1/s/xamarin-android/src/Mono.Android/Android.Runtime/JNINativeWrapper.g.cs:line 352\r\n[HostConnection] createUnique: call\r\n[HostConnection] HostConnection::get() New Host Connection established 0x71e784d22290, tid 23164\r\n[HostConnection] HostComposition ext ANDROID_EMU_CHECKSUM_HELPER_v1 ANDROID_EMU_native_sync_v2 ANDROID_EMU_native_sync_v3 ANDROID_EMU_native_sync_v4 ANDROID_EMU_dma_v1 ANDROID_EMU_direct_mem ANDROID_EMU_host_composition_v1 ANDROID_EMU_host_composition_v2 ANDROID_EMU_vulkan ANDROID_EMU_deferred_vulkan_commands ANDROID_EMU_vulkan_null_optional_strings ANDROID_EMU_vulkan_create_resources_with_requirements ANDROID_EMU_YUV_Cache ANDROID_EMU_vulkan_ignored_handles ANDROID_EMU_has_shared_slots_host_memory_allocator ANDROID_EMU_vulkan_free_memory_sync ANDROID_EMU_vulkan_shader_float16_int8 ANDROID_EMU_vulkan_async_queue_submit ANDROID_EMU_vulkan_queue_submit_with_commands ANDROID_EMU_sync_buffer_data ANDROID_EMU_vulkan_async_qsri ANDROID_EMU_read_color_buffer_dma GL_OES_vertex_array_object GL_KHR_texture_compression_astc_ldr ANDROID_EMU_host_side_tracing ANDROID_EMU_gles_max_version_2 \r\n[nyname.mauiapp3] address format is \u003Cfd_num\u003E not -1\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n**Reproduction Link**\r\n\r\n[\u003C!-- please upload or provide a link to a reproduction case --\u003E](https://github.com/DarioAlonsoCerezo/Maui_preview_skia_lottie_issue)\r\n\r\n",
  "author": {
    "login": "DarioAlonsoCerezo",
    "type": "User"
  },
  "labels": [
    {
      "name": "bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2023-06-15T13:19:59",
  "updatedAt": "2023-08-22T20:58:05",
  "closedAt": "2023-08-22T20:58:04",
  "commentCount": 3,
  "reactionCount": 0
}