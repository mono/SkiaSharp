{
  "number": 1102,
  "type": "issue",
  "state": "open",
  "title": "[BUG] wrong Width value while measuring Arabic Text",
  "body": "**Description**\r\n\r\nSkia sharp measures wrong Width value while measuring Arabic Text (RTL issues).\r\n\r\n**Code**\r\n\r\nnamespace portable_console\r\n{\r\n\r\n    class Program\r\n    {\r\n        static void Main(string[] args)\r\n        {\r\n            string text = \u0022Welcome to programming world\u0022;\r\n            float fontsize = 12f;\r\n\r\n            float SystemDrawing = GDIMeasureString(text, fontsize);\r\n            float Skia = SkiaMeasurements(text, fontsize);\r\n            Console.WriteLine(Skia \u002B \u0022 Skia sharp\u0022);\r\n            Console.WriteLine(SystemDrawing \u002B \u0022 GDI\u0022);\r\n            Console.ReadLine();\r\n        }\r\n        /// \u003Csummary\u003E\r\n        /// Retrun skia measured width value\r\n        /// \u003C/summary\u003E\r\n        /// \u003Cparam name=\u0022text\u0022\u003E\u003C/param\u003E\r\n        /// \u003Cparam name=\u0022fontsize\u0022\u003E\u003C/param\u003E\r\n        /// \u003Creturns\u003E\u003C/returns\u003E\r\n        private static float SkiaMeasurements(string text, float fontsize)\r\n        {\r\n            SKImageInfo info = new SKImageInfo(120, 120);\r\n            float skiaMeasurement = 0;\r\n            using (SKSurface surface = SKSurface.Create(info))\r\n            {\r\n                SKCanvas canvas = surface.Canvas;\r\n                canvas.Clear(SKColors.White);\r\n                using (SKPaint paint = new SKPaint())\r\n                {\r\n                    paint.Typeface = SKTypeface.FromFile(@\u0022D:\\font\\traditional_arabic.ttf\u0022);\r\n                    paint.Color = SKColors.Black;\r\n                    paint.IsAntialias = true;\r\n                    paint.TextSize = fontsize;\r\n                    paint.SubpixelText = true;\r\n                    paint.TextAlign = SKTextAlign.Left;\r\n                    paint.TextEncoding = SKTextEncoding.Utf8;\r\n                    SKRect rect = new SKRect();\r\n                    skiaMeasurement = paint.MeasureText(text, ref rect);\r\n                }\r\n            }\r\n            return skiaMeasurement;\r\n        }\r\n        /// \u003Csummary\u003E\r\n        /// Returns system.Drawing (GDI) measured width value.\r\n        /// \u003C/summary\u003E\r\n        /// \u003Cparam name=\u0022text\u0022\u003E\u003C/param\u003E\r\n        /// \u003Cparam name=\u0022fontsize\u0022\u003E\u003C/param\u003E\r\n        /// \u003Creturns\u003E\u003C/returns\u003E\r\n        private static float GDIMeasureString(string text, float fontsize)\r\n        {\r\n            Bitmap bitmap = new Bitmap(540, 720);\r\n            Graphics graphics = Graphics.FromImage(bitmap);\r\n            // Create string to draw.\r\n            String drawString = text;\r\n            graphics.FillRectangle(Brushes.White, new System.Drawing.Rectangle(0, 0, (int)540, (int)720));\r\n            // Create font and brush.\r\n            Font drawFont = new Font(\u0022Traditional Arabic\u0022, fontsize, FontStyle.Regular, GraphicsUnit.Point);\r\n            SolidBrush drawBrush = new SolidBrush(Color.Black);\r\n            StringFormat drawFormat = new StringFormat(StringFormat.GenericTypographic);\r\n            //remove the linelimit flag from create stringformat object.\r\n            //The behavior of the linelimit flag is \u201Conly entire lines are laid out in the formatting rectangle\u201D, \r\n            //By default layout continues until the end of the text, or until no more lines are visible as a result of clipping\u201D.\r\n            drawFormat.FormatFlags \u0026= ~StringFormatFlags.LineLimit;\r\n            drawFormat.FormatFlags |= StringFormatFlags.MeasureTrailingSpaces;\r\n            drawFormat.FormatFlags |= StringFormatFlags.NoClip;\r\n            graphics.PageUnit = GraphicsUnit.Point;\r\n\r\n            drawFormat.Trimming = StringTrimming.Word;\r\n            // Set format of string.\r\n            float width = graphics.MeasureString(drawString, drawFont, new PointF(0, 0), drawFormat).Width;\r\n\r\n            return width;\r\n        }\r\n    }\r\n}\r\n\r\n**Expected Behavior**\r\n\r\nFor English text eg: \u0022Hello world\u0022 measures 93.57 point in both skia sharp and GDI,\r\nFor Arabic text eg: \u0022\u0645\u0631\u062D\u0628\u0627 \u0628\u0643\u0645 \u0641\u064A \u0627\u0644\u062A\u0632\u0627\u0645\u0646 \u0022 width should be 66.21 points.  \r\n\r\n**Actual Behavior**\r\n\r\nActual measurement was for \u0022\u0645\u0631\u062D\u0628\u0627 \u0628\u0643\u0645 \u0641\u064A \u0627\u0644\u062A\u0632\u0627\u0645\u0646 \u0022 is 95.61 points, so there is 29.4 points, i have referred using harfbuzz but i cannot use third party module, please let me know if there is any way to achieve this in skia sharp in 1.59.3 version itself, or please confirm me whether it\u0027s a bug. \r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  1.59.3\r\n- IDE:  Visual studio 2017\r\n- Platform Target Frameworks: .Net core 2.1",
  "author": {
    "login": "Jack-Paul",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2020-01-14T12:13:23",
  "updatedAt": "2021-09-02T12:44:43",
  "commentCount": 35,
  "reactionCount": 2
}