{
  "number": 1074,
  "type": "issue",
  "state": "closed",
  "title": "[BUG][Xamarin.Forms macOS \u0026 iOS] Stack overflow when using SKGLView",
  "body": "**Description**\r\nI switched from \u0060SKCanvasView\u0060 to \u0060SKGLView\u0060 in my \u0060Xamarin.Forms\u0060 app and since then am not able to run the macOS and iOS projects. I\u0027m getting a \u0060Stack overflow: IP: 0x114116454, fault addr: 0x7ffee32d0fe0\u0060. When i switch back to \u0060SKCanvasView\u0060 everything works as expected but since rendering could be quite intense in this project I would be happy to use \u0060SKGLView\u0060. Android project works fine with \u0060SKGLView\u0060.\r\n\r\nHere is a small dump of the stacktrace - the full output is below and quite huge. \r\n\r\n\r\n**Code**\r\n\r\n\u003Cdetails\u003E\u003Csummary\u003EMini Stacktrace from macOS project\u003C/summary\u003E\r\n\u003Cp\u003E\r\n\r\n#### private project name and namespaces are replaced\r\n\r\n\u0060\u0060\u0060csharp\r\nStack overflow: IP: 0x114116454, fault addr: 0x7ffee32d0fe0\r\nStacktrace:\r\n  at ObjCRuntime.Class.FindMapIndex (ObjCRuntime.Runtime/MTClassMap*,int,int,intptr) [0x00065] in /Library/Frameworks/Xamarin.Mac.framework/Versions/6.6.0.12/src/Xamarin.Mac/ObjCRuntime/Class.cs:335\r\n  \u003C...\u003E\r\n  at ObjCRuntime.Class.FindType (intptr,bool\u0026) [0x00023] in /Library/Frameworks/Xamarin.Mac.framework/Versions/6.6.0.12/src/Xamarin.Mac/ObjCRuntime/Class.cs:355\r\n  at ObjCRuntime.Class.LookupClass (intptr,bool) [0x00004] in /Library/Frameworks/Xamarin.Mac.framework/Versions/6.6.0.12/src/Xamarin.Mac/ObjCRuntime/Class.cs:217\r\n  at ObjCRuntime.Class.Lookup (intptr) [0x00001] in /Library/Frameworks/Xamarin.Mac.framework/Versions/6.6.0.12/src/Xamarin.Mac/ObjCRuntime/Class.cs:203\r\n  at ObjCRuntime.Runtime.GetMethodAndObjectForSelector (intptr,intptr,bool,intptr,intptr\u0026,intptr) [0x00001] in /Library/Frameworks/Xamarin.Mac.framework/Versions/6.6.0.12/src/Xamarin.Mac/ObjCRuntime/Runtime.cs:744\r\n  at ObjCRuntime.Runtime.get_method_and_object_for_selector (intptr,intptr,bool,intptr,intptr\u0026,intptr,int\u0026) [0x00006] in /Users/builder/jenkins/workspace/xamarin-macios/xamarin-macios/runtime/Delegates.generated.cs:431\r\n  at (wrapper native-to-managed) ObjCRuntime.Runtime.get_method_and_object_for_selector (intptr,intptr,int,intptr,intptr\u0026,intptr,int\u0026) [0x00045] in \u003Ce3680806ee9a47fe8a96d30bc69cd44d\u003E:0\r\n  at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n  at (wrapper managed-to-native) ObjCRuntime.Messaging.void_objc_msgSendSuper (intptr,intptr) [0x00014] in \u003Ce3680806ee9a47fe8a96d30bc69cd44d\u003E:0\r\n  at AppKit.NSView.Display () [0x00027] in /Library/Frameworks/Xamarin.Mac.framework/Versions/6.6.0.12/src/Xamarin.Mac/NSView.g.cs:2993\r\n  at SkiaSharp.Views.Forms.SKGLViewRenderer.SetupRenderLoop (bool) [0x00028] in \u003Cc24722d16497496596cb977486b76e04\u003E:0\r\n  at SkiaSharp.Views.Forms.SKGLViewRendererBase\u00602\u003CTFormsView_REF, TNativeView_REF\u003E.OnSurfaceInvalidated (object,System.EventArgs) [0x00014] in \u003Cc24722d16497496596cb977486b76e04\u003E:0\r\n  at SkiaSharp.Views.Forms.SKGLView.InvalidateSurface () [0x00011] in \u003Cc24722d16497496596cb977486b76e04\u003E:0\r\n  at MYVIEW.ReDraw (MYPROJECT.Common.Rect) [0x00001] in MYPROJECT.Forms/MYVIEW.cs:173\r\n  at MYPROJECT.Views.MYCANVAS.HandleInvalidatedEvent (object,MYPROJECT.InvalidatedEventHandlerArgs) [0x0001f] in MYPROJECT.Core/MYCANVAS.cs:505\r\n  at MYPROJECT.Chart.EmitInvalidatedEvent (object,MYPROJECT.InvalidatedEventHandlerArgs) [0x00001] in MYPROJECT.Core/Chart.cs:598\r\n  \r\n  ...\r\n  ...\r\n  ...\r\n  at MYPROJECT (object,MYPROJECT.Common.DrawEventArgs) [0x00014] in MYPROJECT.Core/MYCANVAS.cs:495\r\n  at MYVIEW.OnPaintSurface (SkiaSharp.Views.Forms.SKPaintGLSurfaceEventArgs) [0x00089] in MYPROJECT.Forms/MYVIEW.cs:217\r\n  at SkiaSharp.Views.Forms.SKGLView.SkiaSharp.Views.Forms.ISKGLViewController.OnPaintSurface (SkiaSharp.Views.Forms.SKPaintGLSurfaceEventArgs) [0x00002] in \u003Cc24722d16497496596cb977486b76e04\u003E:0\r\n  at SkiaSharp.Views.Forms.SKGLViewRendererBase\u00602\u003CTFormsView_REF, TNativeView_REF\u003E.OnPaintSurface (object,SkiaSharp.Views.Mac.SKPaintGLSurfaceEventArgs) [0x00021] in \u003Cc24722d16497496596cb977486b76e04\u003E:0\r\n  at SkiaSharp.Views.Mac.SKGLView.OnPaintSurface (SkiaSharp.Views.Mac.SKPaintGLSurfaceEventArgs) [0x0000d] in \u003Cdbc034b81e6146c090c3151a6aaf3336\u003E:0\r\n  at SkiaSharp.Views.Mac.SKGLView.DrawRect (CoreGraphics.CGRect) [0x00147] in \u003Cdbc034b81e6146c090c3151a6aaf3336\u003E:0\r\n  at (wrapper runtime-invoke) \u003CModule\u003E.runtime_invoke_void__this___CGRect (object,intptr,intptr,intptr) [0x00075] in \u003Cdbc034b81e6146c090c3151a6aaf3336\u003E:0\r\n  at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n  at (wrapper managed-to-native) ObjCRuntime.Messaging.void_objc_msgSendSuper (intptr,intptr) [0x00014] in \u003Ce3680806ee9a47fe8a96d30bc69cd44d\u003E:0\r\n  at AppKit.NSView.Display () [0x00027] in /Library/Frameworks/Xamarin.Mac.framework/Versions/6.6.0.12/src/Xamarin.Mac/NSView.g.cs:2993\r\n\u0060\u0060\u0060\r\n\r\n\u003C/p\u003E\r\n\u003C/details\u003E\r\n\r\n\r\n**Expected Behavior**\r\n\r\nswitching between SKCanvasView and SKGLView without many code changes\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  1.68.1\r\n- IDE:  Visual Studio for Mac 8.3.11\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - Xamarin.Android: 10.0.6.2\r\n\t\t7.0 (API level 24)\r\n\t\t7.1 (API level 25)\r\n\t\t8.0 (API level 26)\r\n\t\t8.1 (API level 27)\r\n  - Xamarin.iOS:  13.6.0.12\r\n  - Xamarin.Mac:  6.6.0.12 Target 10.15.2\r\n  - Target Devices:   \u003C!-- the devices that you noticed this on, e.g. iPhone X --\u003E\r\nMacBook Pro (13-inch, 2018, Four Thunderbolt 3 Ports)\r\n2,3 GHz Quad-Core Intel Core i5\r\n16 GB 2133 MHz LPDDR3\r\nIntel Iris Plus Graphics 655 1536 MB\r\n\r\n**Reproduction Link**\r\nSorry no repro at the moment, because this is an enterprise closed-source project. I\u0027m happy to share more info in a private session.\r\n",
  "author": {
    "login": "nor0x",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "milestone": "v1.68.2",
  "createdAt": "2019-12-20T10:12:13",
  "updatedAt": "2022-08-19T09:01:40",
  "closedAt": "2020-02-11T15:56:36",
  "commentCount": 5,
  "reactionCount": 0
}