{
  "number": 2515,
  "type": "issue",
  "state": "closed",
  "title": "[QUESTION] Understanding screen pixel coordinates convertion to bitmap coordinates",
  "body": "**Editing for question reformulation:**\r\n\r\nI need some guidance for this one:\r\n\r\nHaving a canvasA taking full screen and a smaller canvasB and a customView \u0022pointView\u0022:\r\n\r\n \u0060\u0060\u0060\r\n\u003CContentPage.Content\u003E\r\n        \u003CGrid\u003E\r\n            \u003CGrid.RowDefinitions\u003E\r\n                \u003CRowDefinition Height=\u0022150\u0022/\u003E\r\n                \u003CRowDefinition Height=\u0022*\u0022/\u003E\r\n            \u003C/Grid.RowDefinitions\u003E\r\n\r\n            \u003CGrid.ColumnDefinitions\u003E\r\n                \u003CColumnDefinition Width=\u0022*\u0022/\u003E\r\n                \u003CColumnDefinition Width=\u0022*\u0022/\u003E\r\n            \u003C/Grid.ColumnDefinitions\u003E\r\n\r\n            \u003Cskia:SKCanvasView x:Name=\u0022CanvasA\u0022 BackgroundColor=\u0022Black\u0022 Grid.Column=\u00220\u0022 Grid.Row=\u00220\u0022 Grid.ColumnSpan=\u00222\u0022 Grid.RowSpan=\u00222\u0022/\u003E\r\n            \u003Ccustom:PointView x:Name=\u0022PointView\u0022  Grid.Column=\u00220\u0022 Grid.Row=\u00220\u0022 Grid.ColumnSpan=\u00222\u0022 Grid.RowSpan=\u00222\u0022/\u003E\r\n            \r\n\t\t\t\u003CGrid x:Name=\u0022MiniCanvas\u0022 Grid.Row=\u00220\u0022 Grid.Column=\u00221\u0022\u003E\r\n                \u003CGrid.RowDefinitions\u003E\r\n                    \u003CRowDefinition Height=\u0022*\u0022/\u003E\r\n                    \u003CRowDefinition Height=\u00221\u0022/\u003E\r\n                    \u003CRowDefinition Height=\u0022*\u0022/\u003E\r\n                \u003C/Grid.RowDefinitions\u003E\r\n\r\n                \u003CGrid.ColumnDefinitions\u003E\r\n                    \u003CColumnDefinition Width=\u0022*\u0022/\u003E\r\n                    \u003CColumnDefinition Width=\u00221\u0022/\u003E\r\n                    \u003CColumnDefinition Width=\u0022*\u0022/\u003E\r\n                \u003C/Grid.ColumnDefinitions\u003E\r\n\r\n                \u003Cskia:SKCanvasView x:Name=\u0022CanvasB\u0022  Grid.Row=\u00220\u0022 Grid.Column=\u00220\u0022 Grid.ColumnSpan=\u00223\u0022 Grid.RowSpan=\u00223\u0022/\u003E\r\n                \u003CBoxView BackgroundColor=\u0022Black\u0022 Grid.Row=\u00221\u0022 Grid.Column=\u00220\u0022 Grid.ColumnSpan=\u00223\u0022/\u003E\r\n                \u003CBoxView BackgroundColor=\u0022Black\u0022 Grid.Row=\u00220\u0022 Grid.Column=\u00221\u0022 Grid.RowSpan=\u00223\u0022/\u003E\r\n            \u003C/Grid\u003E\r\n\t\t\u003C/Grid\u003E\r\n\u003C/ContentPage.Content\u003E\r\n\u0060\u0060\u0060\r\n\r\nPointView represents a point that can be moved across CanvasA and anytime its position changes, it raises an event with the new screen coordinates. I\u0027m trying to use the coordinates from this point to create a zoom region on CanvasB. With other words, giving a screen coordinate, I want to create a zoom from that region of CanvasA over CanvasB.\r\n\r\nI tried this so far:\r\n\r\nThe point update event. My region is a square created by adding 30 pixels to each side of the point new coordinates\r\n\u0060\u0060\u0060\r\nprivate void PointUpdatedEvent_Arrived(AppGlobals.PointEnum point, Classes.Point newPointCoordinates)\r\n        {\r\n            Classes.Point leftTopPoint = new Classes.Point((newPointCoordinates.X - 30) * DeviceDisplay.MainDisplayInfo.Density,\r\n                (newPointCoordinates.Y - 30) * DeviceDisplay.MainDisplayInfo.Density);\r\n            Classes.Point rightBottomPoint = new Classes.Point((newPointCoordinates.X \u002B 30) * DeviceDisplay.MainDisplayInfo.Density,\r\n                (newPointCoordinates.Y \u002B 30) * DeviceDisplay.MainDisplayInfo.Density);\r\n\r\n            int height = miniCanvasHeight;\r\n            int width = miniCanvasWidth;\r\n\r\n            croppedBitmap = new SKBitmap(width, height);\r\n            SKRect dest = new SKRect(0, 0, width, height);\r\n            SKRect source = new SKRect((float)leftTopPoint.X, (float)leftTopPoint.Y, (float)rightBottomPoint.X, (float)rightBottomPoint.Y);\r\n\r\n            using (SKCanvas canvas = new SKCanvas(croppedBitmap))\r\n            {\r\n                canvas.DrawBitmap(_originalBitmap.Resize(new SKImageInfo((int)(DeviceDisplay.MainDisplayInfo.Width),\r\n                    (int)(DeviceDisplay.MainDisplayInfo.Height)), SKFilterQuality.High), source, dest);\r\n            }\r\n\r\n            CanvasB.InvalidateSurface();\r\n        }\r\n\u0060\u0060\u0060\r\n\r\nThen I redraw CanvasB. \r\n\r\n\u0060\u0060\u0060\r\nprivate void CanvasB_PaintSurface(object sender, SKPaintSurfaceEventArgs e)\r\n        {\r\n            SKImageInfo info = e.Info;\r\n            SKSurface surface = e.Surface;\r\n            SKCanvas canvas = surface.Canvas;\r\n\r\n            miniCanvasWidth = info.Width;\r\n            miniCanvasHeight = info.Height;\r\n\r\n            canvas.Clear();\r\n\r\n            if (croppedBitmap != null)\r\n            {\r\n                BitmapStretch stretch = BitmapStretch.AspectFit;\r\n                BitmapAlignment horizontal = BitmapAlignment.Center;\r\n                BitmapAlignment vertical = BitmapAlignment.Center;\r\n\r\n                SKRect dest = new SKRect(0, 0, info.Width, info.Height);\r\n                canvas.DrawBitmap(croppedBitmap, dest, stretch, horizontal, vertical);\r\n            }\r\n        }\r\n\u0060\u0060\u0060\r\n\r\nThen I get the following result (continuing next post since I have to edit and add image)\r\n",
  "author": {
    "login": "nk-alex",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2023-07-03T09:19:14",
  "updatedAt": "2024-02-04T09:00:25",
  "closedAt": "2024-01-05T08:01:49",
  "commentCount": 1,
  "reactionCount": 0
}