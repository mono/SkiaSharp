{
  "number": 2572,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Fatal error. System.AccessViolationException at SkiaSharp.SKFont.set_Typeface(SkiaSharp.SKTypeface)",
  "body": "### Description\r\n\u0060\u0060\u0060\r\nFatal error. System.AccessViolationException: Attempted to read or write protected memory. This is often an indication that other memory is corrupt.\r\nRepeat 2 times:\r\n--------------------------------\r\n   at SkiaSharp.SkiaApi.sk_font_set_typeface(IntPtr, IntPtr)\r\n--------------------------------\r\n   at SkiaSharp.SKFont.set_Typeface(SkiaSharp.SKTypeface)\r\n   at SkiaSharp.SKPaint.set_Typeface(SkiaSharp.SKTypeface)\r\n   at Svg.Skia.SkiaAssetLoader.FindTypefaces(System.String, SkiaSharp.SKPaint)\r\n   at Svg.Model.Drawables.Elements.TextDrawable.DrawTextString(Svg.SvgTextBase, System.String, Single ByRef, Single ByRef, SkiaSharp.SKRect, Svg.Model.DrawAttributes, SkiaSharp.SKCanvas, Svg.Model.Drawables.DrawableBase)\r\n   at Svg.Model.Drawables.Elements.TextDrawable.DrawTextBase(Svg.SvgTextBase, Single ByRef, Single ByRef, SkiaSharp.SKRect, Svg.Model.DrawAttributes, SkiaSharp.SKCanvas, Svg.Model.Drawables.DrawableBase)     \r\n   at Svg.Model.Drawables.Elements.TextDrawable.DrawText(Svg.SvgText, SkiaSharp.SKRect, Svg.Model.DrawAttributes, SkiaSharp.SKCanvas, Svg.Model.Drawables.DrawableBase, Boolean)\r\n   at Svg.Model.Drawables.Elements.TextDrawable.Draw(SkiaSharp.SKCanvas, Svg.Model.DrawAttributes, Svg.Model.Drawables.DrawableBase, Boolean)\r\n   at Svg.Model.Drawables.DrawableContainer.OnDraw(SkiaSharp.SKCanvas, Svg.Model.DrawAttributes, Svg.Model.Drawables.DrawableBase)\r\n   at Svg.Model.Drawables.DrawableBase.Draw(SkiaSharp.SKCanvas, Svg.Model.DrawAttributes, Svg.Model.Drawables.DrawableBase, Boolean)\r\n   at Svg.Model.Drawables.DrawableContainer.OnDraw(SkiaSharp.SKCanvas, Svg.Model.DrawAttributes, Svg.Model.Drawables.DrawableBase)\r\n   at Svg.Model.Drawables.DrawableBase.Draw(SkiaSharp.SKCanvas, Svg.Model.DrawAttributes, Svg.Model.Drawables.DrawableBase, Boolean)\r\n   at Svg.Model.Drawables.DrawableContainer.OnDraw(SkiaSharp.SKCanvas, Svg.Model.DrawAttributes, Svg.Model.Drawables.DrawableBase)\r\n   at Svg.Model.Drawables.DrawableBase.Draw(SkiaSharp.SKCanvas, Svg.Model.DrawAttributes, Svg.Model.Drawables.DrawableBase, Boolean)\r\n   at Svg.Model.Drawables.DrawableBase.OnDraw(SkiaSharp.SKCanvas)\r\n   at SkiaSharp.SKDrawable.DrawInternal(IntPtr, Void*, IntPtr)\r\n   at SkiaSharp.SkiaApi.sk_drawable_draw(IntPtr, IntPtr, SkiaSharp.SKMatrix*)\r\n   at SkiaSharp.SkiaApi.sk_drawable_draw(IntPtr, IntPtr, SkiaSharp.SKMatrix*)\r\n   at SkiaSharp.SKDrawable.Draw(SkiaSharp.SKCanvas, SkiaSharp.SKMatrix ByRef)\r\n   at SkiaSharp.SKDrawable.Draw(SkiaSharp.SKCanvas, Single, Single)\r\n   at SkiaSharp.SKDrawable.OnSnapshot()\r\n   at SkiaSharp.SKDrawable.MakePictureSnapshotInternal(IntPtr, Void*)\r\n   at SkiaSharp.SkiaApi.sk_drawable_new_picture_snapshot(IntPtr)\r\n   at SkiaSharp.SkiaApi.sk_drawable_new_picture_snapshot(IntPtr)\r\n   at SkiaSharp.SKDrawable.Snapshot()\r\n   at Svg.Model.SvgExtensions.ToPicture(Svg.SvgFragment, Svg.Model.IAssetLoader, SkiaSharp.SKDrawable ByRef, System.Nullable\u00601\u003CSkiaSharp.SKRect\u003E ByRef, Svg.Model.DrawAttributes)\r\n   at Svg.Skia.SKSvg.Load(System.String)\r\n   at Svg.Skia.Converter.SvgConverter.Save(System.IO.FileInfo, System.String, System.String, Int32, System.String, Single, Single, Single, Boolean, Int32)\r\n   at Svg.Skia.Converter.SvgConverter.Run(Svg.Skia.Converter.Settings)\r\n   at Svg.Skia.Converter.SvgConverter.Execute(System.IO.FileInfo, System.IO.FileInfo, Svg.Skia.Converter.Settings)\r\n   at Svg.Skia.Converter.Program\u002B\u003C\u003Ec.\u003CMain\u003Eb__0_0(Svg.Skia.Converter.Settings, System.IO.FileInfo, System.IO.FileInfo)\r\n   at System.RuntimeMethodHandle.InvokeMethod(System.Object, Void**, System.Signature, Boolean)\r\n   at System.Reflection.MethodInvoker.Invoke(System.Object, IntPtr*, System.Reflection.BindingFlags)\r\n   at System.Reflection.RuntimeMethodInfo.Invoke(System.Object, System.Reflection.BindingFlags, System.Reflection.Binder, System.Object[], System.Globalization.CultureInfo)\r\n   at System.Delegate.DynamicInvokeImpl(System.Object[])\r\n   at System.CommandLine.Invocation.ModelBindingCommandHandler\u002B\u003CInvokeAsync\u003Ed__8.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Invocation.ModelBindingCommandHandler\u002B\u003CInvokeAsync\u003Ed__8, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003CInvokeAsync\u003Ed__8 ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder\u00601[[System.Int32, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]].Start[[System.CommandLine.Invocation.ModelBindingCommandHandler\u002B\u003CInvokeAsync\u003Ed__8, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003CInvokeAsync\u003Ed__8 ByRef)\r\n   at System.CommandLine.Invocation.ModelBindingCommandHandler.InvokeAsync(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_0\u002B\u003C\u003CBuildInvocationChain\u003Eb__0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_0\u002B\u003C\u003CBuildInvocationChain\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CBuildInvocationChain\u003Eb__0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_0\u002B\u003C\u003CBuildInvocationChain\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CBuildInvocationChain\u003Eb__0\u003Ed ByRef)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_0.\u003CBuildInvocationChain\u003Eb__0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseParseErrorReporting\u003Eb__19_0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseParseErrorReporting\u003Eb__19_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseParseErrorReporting\u003Eb__19_0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseParseErrorReporting\u003Eb__19_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseParseErrorReporting\u003Eb__19_0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec.\u003CUseParseErrorReporting\u003Eb__19_0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass14_0\u002B\u003C\u003CUseHelp\u003Eb__0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass14_0\u002B\u003C\u003CUseHelp\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseHelp\u003Eb__0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass14_0\u002B\u003C\u003CUseHelp\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseHelp\u003Eb__0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass14_0.\u003CUseHelp\u003Eb__0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass22_0\u002B\u003C\u003CUseVersionOption\u003Eb__0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass22_0\u002B\u003C\u003CUseVersionOption\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseVersionOption\u003Eb__0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass22_0\u002B\u003C\u003CUseVersionOption\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseVersionOption\u003Eb__0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass22_0.\u003CUseVersionOption\u003Eb__0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass21_0\u002B\u003C\u003CUseTypoCorrections\u003Eb__0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass21_0\u002B\u003C\u003CUseTypoCorrections\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseTypoCorrections\u003Eb__0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass21_0\u002B\u003C\u003CUseTypoCorrections\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseTypoCorrections\u003Eb__0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass21_0.\u003CUseTypoCorrections\u003Eb__0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseSuggestDirective\u003Eb__20_0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseSuggestDirective\u003Eb__20_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseSuggestDirective\u003Eb__20_0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseSuggestDirective\u003Eb__20_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseSuggestDirective\u003Eb__20_0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec.\u003CUseSuggestDirective\u003Eb__20_0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseParseDirective\u003Eb__18_0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseParseDirective\u003Eb__18_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseParseDirective\u003Eb__18_0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseParseDirective\u003Eb__18_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseParseDirective\u003Eb__18_0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec.\u003CUseParseDirective\u003Eb__18_0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseDebugDirective\u003Eb__10_0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseDebugDirective\u003Eb__10_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseDebugDirective\u003Eb__10_0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CUseDebugDirective\u003Eb__10_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseDebugDirective\u003Eb__10_0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec.\u003CUseDebugDirective\u003Eb__10_0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CRegisterWithDotnetSuggest\u003Eb__9_0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CRegisterWithDotnetSuggest\u003Eb__9_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CRegisterWithDotnetSuggest\u003Eb__9_0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CRegisterWithDotnetSuggest\u003Eb__9_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CRegisterWithDotnetSuggest\u003Eb__9_0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec.\u003CRegisterWithDotnetSuggest\u003Eb__9_0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass12_0\u002B\u003C\u003CUseExceptionHandler\u003Eb__0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass12_0\u002B\u003C\u003CUseExceptionHandler\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseExceptionHandler\u003Eb__0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass12_0\u002B\u003C\u003CUseExceptionHandler\u003Eb__0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CUseExceptionHandler\u003Eb__0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec__DisplayClass12_0.\u003CUseExceptionHandler\u003Eb__0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_2.\u003CBuildInvocationChain\u003Eb__3(System.CommandLine.Invocation.InvocationContext)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CCancelOnProcessTermination\u003Eb__4_0\u003Ed.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CCancelOnProcessTermination\u003Eb__4_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CCancelOnProcessTermination\u003Eb__4_0\u003Ed ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start[[System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec\u002B\u003C\u003CCancelOnProcessTermination\u003Eb__4_0\u003Ed, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003C\u003CCancelOnProcessTermination\u003Eb__4_0\u003Ed ByRef)\r\n   at System.CommandLine.Builder.CommandLineBuilderExtensions\u002B\u003C\u003Ec.\u003CCancelOnProcessTermination\u003Eb__4_0(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003C\u003Ec__DisplayClass4_1.\u003CBuildInvocationChain\u003Eb__2(System.CommandLine.Invocation.InvocationContext, System.Func\u00602\u003CSystem.CommandLine.Invocation.InvocationContext,System.Threading.Tasks.Task\u003E)\r\n   at System.CommandLine.Invocation.InvocationPipeline\u002B\u003CInvokeAsync\u003Ed__2.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.Invocation.InvocationPipeline\u002B\u003CInvokeAsync\u003Ed__2, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003CInvokeAsync\u003Ed__2 ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder\u00601[[System.Int32, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]].Start[[System.CommandLine.Invocation.InvocationPipeline\u002B\u003CInvokeAsync\u003Ed__2, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003CInvokeAsync\u003Ed__2 ByRef)\r\n   at System.CommandLine.Invocation.InvocationPipeline.InvokeAsync(System.CommandLine.IConsole)\r\n   at System.CommandLine.CommandExtensions\u002B\u003CInvokeAsync\u003Ed__2.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.CommandLine.CommandExtensions\u002B\u003CInvokeAsync\u003Ed__2, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003CInvokeAsync\u003Ed__2 ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder\u00601[[System.Int32, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]].Start[[System.CommandLine.CommandExtensions\u002B\u003CInvokeAsync\u003Ed__2, System.CommandLine, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]](\u003CInvokeAsync\u003Ed__2 ByRef)\r\n   at System.CommandLine.CommandExtensions.InvokeAsync(System.CommandLine.Command, System.String[], System.CommandLine.IConsole)\r\n   at Svg.Skia.Converter.Program\u002B\u003CMain\u003Ed__0.MoveNext()\r\n   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[[System.__Canon, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]](System.__Canon ByRef)\r\n   at System.Runtime.CompilerServices.AsyncTaskMethodBuilder\u00601[[System.Int32, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]].Start[[System.__Canon, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]](System.__Canon ByRef)\r\n   at Svg.Skia.Converter.Program.Main(System.String[])\r\n   at Svg.Skia.Converter.Program.\u003CMain\u003E(System.String[])\r\n\u0060\u0060\u0060\r\n### Code\r\n\u0060\u0060\u0060cs\r\nusing System.Collections.Generic;\r\n\r\nnamespace Svg.Skia;\r\n\r\npublic class SkiaAssetLoader : Model.IAssetLoader\r\n{\r\n#if !USE_SKIASHARP\r\n    private readonly SkiaModel _skiaModel;\r\n\r\n    public SkiaAssetLoader(SkiaModel skiaModel)\r\n    {\r\n        _skiaModel = skiaModel;\r\n    }\r\n#endif\r\n    \r\n#if USE_SKIASHARP\r\n    public SkiaSharp.SKImage LoadImage(System.IO.Stream stream)\r\n    {\r\n        return SkiaSharp.SKImage.FromEncodedData(stream);\r\n    }\r\n#else\r\n    public ShimSkiaSharp.SKImage LoadImage(System.IO.Stream stream)\r\n    {\r\n        var data = ShimSkiaSharp.SKImage.FromStream(stream);\r\n        using var image = SkiaSharp.SKImage.FromEncodedData(data);\r\n        return new ShimSkiaSharp.SKImage {Data = data, Width = image.Width, Height = image.Height};\r\n    }\r\n#endif\r\n\r\n#if USE_SKIASHARP\r\n    public List\u003CModel.TypefaceSpan\u003E FindTypefaces(string? text, SkiaSharp.SKPaint paintPreferredTypeface)\r\n#else\r\n    public List\u003CModel.TypefaceSpan\u003E FindTypefaces(string? text, ShimSkiaSharp.SKPaint paintPreferredTypeface)\r\n#endif\r\n    {\r\n        var ret = new List\u003CModel.TypefaceSpan\u003E();\r\n\r\n        if (text is null || string.IsNullOrEmpty(text))\r\n        {\r\n            return ret;\r\n        }\r\n\r\n        System.Func\u003Cint, SkiaSharp.SKTypeface?\u003E matchCharacter;\r\n\r\n        if (paintPreferredTypeface.Typeface is { } preferredTypeface)\r\n        {\r\n#if USE_SKIASHARP\r\n            var weight = (SkiaSharp.SKFontStyleWeight)preferredTypeface.FontWeight;\r\n            var width = (SkiaSharp.SKFontStyleWidth)preferredTypeface.FontWidth;\r\n            var slant = (SkiaSharp.SKFontStyleSlant)preferredTypeface.FontSlant;\r\n#else\r\n            var weight = _skiaModel.ToSKFontStyleWeight(preferredTypeface.FontWeight);\r\n            var width = _skiaModel.ToSKFontStyleWidth(preferredTypeface.FontWidth);\r\n            var slant = _skiaModel.ToSKFontStyleSlant(preferredTypeface.FontSlant);\r\n#endif\r\n            matchCharacter = codepoint =\u003E SkiaSharp.SKFontManager.Default.MatchCharacter(\r\n                preferredTypeface.FamilyName,\r\n                weight,\r\n                width,\r\n                slant,\r\n                null,\r\n                codepoint);\r\n        }\r\n        else\r\n        {\r\n            matchCharacter = codepoint =\u003E SkiaSharp.SKFontManager.Default.MatchCharacter(codepoint);\r\n        }\r\n\r\n        \r\n#if USE_SKIASHARP\r\n        using var runningPaint = paintPreferredTypeface.Clone();\r\n#else\r\n        using var runningPaint = _skiaModel.ToSKPaint(paintPreferredTypeface);\r\n#endif\r\n        if (runningPaint is null)\r\n        {\r\n            return ret;\r\n        }\r\n\r\n        var currentTypefaceStartIndex = 0;\r\n        var i = 0;\r\n\r\n        void YieldCurrentTypefaceText()\r\n        {\r\n            var currentTypefaceText = text.Substring(currentTypefaceStartIndex, i - currentTypefaceStartIndex);\r\n\r\n            ret.Add(new(currentTypefaceText, runningPaint.MeasureText(currentTypefaceText),\r\n#if USE_SKIASHARP\r\n                runningPaint.Typeface\r\n#else\r\n                runningPaint.Typeface is null\r\n                    ? null\r\n                    : ShimSkiaSharp.SKTypeface.FromFamilyName(\r\n                        runningPaint.Typeface.FamilyName,\r\n                        // SkiaSharp provides int properties here. Let\u0027s just assume our\r\n                        // ShimSkiaSharp defines the same values as SkiaSharp and convert directly\r\n                        (ShimSkiaSharp.SKFontStyleWeight)runningPaint.Typeface.FontWeight,\r\n                        (ShimSkiaSharp.SKFontStyleWidth)runningPaint.Typeface.FontWidth,\r\n                        (ShimSkiaSharp.SKFontStyleSlant)runningPaint.Typeface.FontSlant)\r\n#endif\r\n            ));\r\n        }\r\n\r\n        for (; i \u003C text.Length; i\u002B\u002B)\r\n        {\r\n            var typeface = matchCharacter(char.ConvertToUtf32(text, i));\r\n\r\n            if (i == 0)\r\n            {\r\n                runningPaint.Typeface = typeface;\r\n            }\r\n            else if (runningPaint.Typeface is null\r\n                     \u0026\u0026 typeface is { } || runningPaint.Typeface is { }\r\n                     \u0026\u0026 typeface is null || runningPaint.Typeface is { } l\r\n                     \u0026\u0026 typeface is { } r\r\n                     \u0026\u0026 (l.FamilyName, l.FontWeight, l.FontWidth, l.FontSlant) != (r.FamilyName, r.FontWeight, r.FontWidth, r.FontSlant))\r\n            {\r\n                YieldCurrentTypefaceText();\r\n\r\n                currentTypefaceStartIndex = i;\r\n                runningPaint.Typeface = typeface;\r\n            }\r\n\r\n            if (char.IsHighSurrogate(text[i]))\r\n            {\r\n                i\u002B\u002B;\r\n            }\r\n        }\r\n\r\n        YieldCurrentTypefaceText();\r\n\r\n        return ret;\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\n### Expected Behavior\r\n\r\nNo exception.\r\n\r\n### Actual Behavior\r\n\r\n Fatal error. System.AccessViolationException at SkiaSharp.SKFont.set_Typeface(SkiaSharp.SKTypeface)\r\n\r\n### Version of SkiaSharp\r\n\r\n3.x (Alpha)\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\n2.88.2 (Previous)\r\n\r\n### IDE / Editor\r\n\r\nOther (Please indicate in the description)\r\n\r\n### Platform / Operating System\r\n\r\nWindows\r\n\r\n### Platform / Operating System Version\r\n\r\nWindows 11\r\n\r\n### Devices\r\n\r\n_No response_\r\n\r\n### Relevant Screenshots\r\n\r\n_No response_\r\n\r\n### Relevant Log Output\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "wieslawsoltes",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "upgrading/3.x",
      "color": "E99695"
    }
  ],
  "assignees": [],
  "createdAt": "2023-08-19T23:18:02",
  "updatedAt": "2023-09-19T21:00:27",
  "closedAt": "2023-08-20T20:04:04",
  "commentCount": 2,
  "reactionCount": 0
}