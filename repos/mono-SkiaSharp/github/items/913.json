{
  "number": 913,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Native library missing on Xamarin.Mac Full",
  "body": "**Description**\r\n- Using Visual Studio for Mac (8.1.5 build 9), create a Mac / Cocoa App\r\n- In Options / Build / General, change \u0022Xamarin.Mac Modern\u0022 to \u0022Xamarin.Mac Full\u0022\r\n- Add SkiaSharp nuget to project, and create a new SKBitmap\r\n\r\nApplication crash on SKBitmap creation with a DllNotFoundException in inner exception :\r\n\r\nSystem.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception. ---\u003E System.DllNotFoundException: libSkiaSharp\r\n  at at (wrapper managed-to-native) SkiaSharp.SkiaApi.sk_colortype_get_default_8888()\r\n  at SkiaSharp.SKImageInfo..cctor () [0x00000] in \u003Ca0087d635ef94b8aaf6fe37af2df4f8d\u003E:0\r\n  --- End of inner exception stack trace ---\r\n  at at (wrapper managed-to-native) System.Object.__icall_wrapper_mono_generic_class_init(intptr)\r\n  at SkiaSharp.SKBitmap..ctor (System.Int32 width, System.Int32 height, System.Boolean isOpaque) [0x00000] in \u003Ca0087d635ef94b8aaf6fe37af2df4f8d\u003E:0\r\n  at TestSkia.MainClass.Main (System.String[] args) [0x00001] in /Users/christophe/Projects/TestSkia/TestSkia/Main.cs:10\r\n\r\n\r\n\r\n**Code**\r\n\u0060namespace TestSkia\r\n{\r\n    static class MainClass\r\n    {\r\n        static void Main(string[] args)\r\n        {\r\n            new SKBitmap(10, 10);\r\n\r\n            NSApplication.Init();\r\n            NSApplication.Main(args);\r\n        }\r\n    }\r\n}\r\n\u0060\r\n\r\n\r\n**Expected Behavior**\r\n\r\nOutput directory should contains libSkiaSharp.dylib (native Skia library for OSX)\r\n\r\n\r\n**Actual Behavior**\r\n\r\nOutput directory contains x86/libSkiaSharp.dll and x64/libSkiaSharp.dll, which are native library for Windows and not OSX\r\n\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  1.68.0\r\n- IDE:   Visual Studio for Mac (8.1.5 build 9)\r\n- Platform Target Frameworks: \r\n  - macOS:  mojave 10.14.5\r\n\r\n",
  "author": {
    "login": "Odirb",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "milestone": "v1.68.1",
  "createdAt": "2019-07-17T14:03:32",
  "updatedAt": "2022-08-19T09:02:43",
  "closedAt": "2019-07-26T18:22:44",
  "commentCount": 5,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:08:13.4892339Z",
    "reactions": [],
    "comments": [
      {
        "id": 513271022,
        "author": "mattleibow",
        "body": "I believe this is a duplicate of https://github.com/mono/SkiaSharp/issues/736",
        "createdAt": "2019-07-19T15:23:25",
        "reactions": []
      },
      {
        "id": 513271525,
        "author": "mattleibow",
        "body": "\u003E You can add \u0060\u003CMigrateToNewXMIdentifier\u003Etrue\u003C/MigrateToNewXMIdentifier\u003E\u0060 in your project.",
        "createdAt": "2019-07-19T15:24:47",
        "reactions": []
      },
      {
        "id": 513696984,
        "author": "Odirb",
        "body": "Thanks for you response Matthew,\r\nBut when I add MigrateToNewXMIdentifier to my project it cannot be loaded by Visual Studio (I\u0027m using the latest VS for Mac 2019 - version 8.1.5 build 9).\r\n\r\nI have extracted the exception from ~/Library/Logs/VisualStudio/8.0/Ide.2019-07-22__09-01-53.log file :\r\n\r\n\u0060\u0060\u0060\r\n\u003E 2019-07-22 09:55:10.238 VisualStudio[1779:67299] View \u003CNSStackView: 0x7fa2b2206f50\u003E has 1 views pointing at it that can\u0027t be found.\r\nERROR [2019-07-22 09:55:10Z]: Error while trying to load the project /Users/christophe/Projects/TestSkia/FullMicMac/FullMicMac.csproj\r\nSystem.ArgumentException: Project does not support framework \u0027Xamarin.Mac.NET,Version=v4.7.2\u0027\r\n  at MonoDevelop.Projects.DotNetProject.set_TargetFramework (MonoDevelop.Core.Assemblies.TargetFramework value) [0x0008a] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/DotNetProject.cs:419 \r\n  at MonoDevelop.Projects.DotNetProject.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00106] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/DotNetProject.cs:1972 \r\n  at MonoDevelop.Projects.Project\u002BDefaultMSBuildProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/Project.cs:4836 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.MonoMac.XamMac2ProjectFlavor.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.150.3/work/1/s/MonoDevelop.MonoMac/MonoDevelop.MonoMac/Project/XamMac2Project.cs:309 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.ProjectExtension.OnReadProjectHeader (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x00000] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectExtension.cs:141 \r\n  at MonoDevelop.Projects.Project.ReadProject (MonoDevelop.Core.ProgressMonitor monitor, MonoDevelop.Projects.MSBuild.MSBuildProject msproject) [0x0004d] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/Project.cs:2593 \r\n  at MonoDevelop.Projects.Project.LoadAsync (MonoDevelop.Core.ProgressMonitor monitor) [0x000ed] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/Project.cs:437 \r\n  at MonoDevelop.Projects.Project\u002B\u003C\u003Ec__DisplayClass68_0.\u003COnLoad\u003Eb__0 () [0x00028] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/Project.cs:418 \r\n  at MonoDevelop.Projects.MSBuild.MSBuildProjectService.LoadItem (MonoDevelop.Core.ProgressMonitor monitor, System.String fileName, MonoDevelop.Projects.MSBuild.MSBuildFileFormat expectedFormat, System.String typeGuid, System.String itemGuid, MonoDevelop.Projects.SolutionLoadContext ctx) [0x001f0] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects.MSBuild/MSBuildProjectService.cs:405 \r\n  at MonoDevelop.Projects.ProjectService\u002B\u003C\u003Ec__DisplayClass25_0.\u003CReadSolutionItem\u003Eb__0 () [0x00101] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Projects/ProjectService.cs:126 \r\n  at MonoDevelop.Core.Runtime\u002B\u003C\u003Ec__44\u00601[T].\u003CRunInMainThread\u003Eb__44_0 (System.Object state) [0x00046] in /Users/vsts/agent/2.153.2/work/1/s/monodevelop/main/src/core/MonoDevelop.Core/MonoDevelop.Core/Runtime.cs:389 \r\n\u0060\u0060\u0060",
        "createdAt": "2019-07-22T08:36:50",
        "reactions": []
      },
      {
        "id": 514539265,
        "author": "Odirb",
        "body": "Since VS for Mac is not ready to target Xamarin.Mac.NET yet, I will use this ugly workaround for now: add the libSkiaSharp.dylib in my main project as \u0022Content\u0022. The library will be copy in bundle after compilation in the correct folder to be loaded by SkiaSharp.dll",
        "createdAt": "2019-07-24T08:44:38",
        "reactions": []
      },
      {
        "id": 515491672,
        "author": "mattleibow",
        "body": "It is a tad bit disappointing. But the workaround to add the .dylib should do it for the time being. I\u0027ll have a look at the targets file - I may be able to tweak a few lines to copy this in if it detects the full framework.\r\n\r\nJust a link to the info about the support: https://github.com/NuGet/NuGet.Client/pull/2572#issuecomment-514103636",
        "createdAt": "2019-07-26T15:11:19",
        "reactions": []
      }
    ]
  }
}