{
  "number": 2629,
  "type": "issue",
  "state": "closed",
  "title": "Issue with ICC Profile Loss in .Resize() Function - Version 2.88.0",
  "body": "### Description\n\nWe have encountered an issue with the \u0060.Resize()\u0060 function in our software. It appears that, starting from version \u00602.88.0\u0060, images lose their ICC profile after passing through this function. Prior to version 2.88.0, this functionality was working as expected, including in version \u00602.80.4\u0060 and earlier.\n\n### Code\n\nWe\u0027re using images on this [site](https://displaycal.net/icc-color-management-test/). All the test cases were negatives using the \u0022newer\u0022 versions\r\n\r\n\u0060\u0060\u0060cs\r\nusing SkiaSharp;\r\n\r\ntry\r\n{\r\n    // Load an image with an ICC profile\r\n    using SKBitmap originalImage = SKBitmap.Decode(\u0022pathToImage.jpg\u0022);\r\n\r\n    // Resize the image\r\n    int newWidth = 200;\r\n    int newHeight = 200;\r\n\r\n    // Resize the original image using SkiaSharp\r\n    using SKBitmap skiaResizedBitmap = originalImage.Resize(new SKImageInfo(newWidth, newHeight), SKFilterQuality.High);\r\n\r\n    var ms = new MemoryStream();\r\n    skiaResizedBitmap.Encode(ms, SKEncodedImageFormat.Png, 100);\r\n    ms.Position = 0;\r\n    File.WriteAllBytes(\u0022resized_image.jpg\u0022, ms.ToArray());\r\n}\r\ncatch (Exception ex)\r\n{\r\n    Console.WriteLine(\u0022An error occurred: \u0022 \u002B ex.Message);\r\n}\r\n\u0060\u0060\u0060\r\n\n\n### Expected Behavior\n\nAll ICC tests cases should be positives when resizing with SkiaSharp.\n\n### Actual Behavior\n\nAll ICC test cases are actually negatives when using \u0060.Resize()\u0060 with SkiaSharp\n\n### Version of SkiaSharp\n\n2.88.3 (Current)\n\n### Last Known Good Version of SkiaSharp\n\n2.80.x (Deprecated)\n\n### IDE / Editor\n\nOther (Please indicate in the description)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\n_No response_\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "IAMManuel",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2023-09-22T16:03:22",
  "updatedAt": "2024-08-16T15:12:29",
  "closedAt": "2024-08-16T15:12:29",
  "commentCount": 4,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T12:52:11.0010983Z",
    "reactions": [],
    "comments": [
      {
        "id": 2017958553,
        "author": "TommiGustafsson-HMP",
        "body": "Here\u0027s a duplicate of this issue, which was resolved and closed:\r\nhttps://github.com/mono/SkiaSharp/issues/2784",
        "createdAt": "2024-03-25T13:02:09",
        "reactions": []
      },
      {
        "id": 2022745184,
        "author": "IAMManuel",
        "body": "After adding the color space, like mention in the issue #2784, I still got an image not respecting the ICC profile again.",
        "createdAt": "2024-03-27T13:18:12",
        "reactions": []
      },
      {
        "id": 2142558008,
        "author": "IAMManuel",
        "body": "Since we still got the same issues, I\u0027ve prepared 4 solutions ( 2 with .png and 2 with .jpg images). One used the 2.80.2 version and the other used the 2.88.8 version ( it could be any version later than 2.80.4). They both use the same code expressed in the following issue #2784. \r\n\r\nHere are the result images:\r\n- For the .png using the the 2.80.2 version\r\n![result-picture-icc-embedded-matrix](https://github.com/mono/SkiaSharp/assets/2425292/a731e846-ad6e-42af-bcd0-9e409023dedd)\r\n- For the .png using the the 2.88.8 version\r\n![result-picture-icc-embedded-matrix](https://github.com/mono/SkiaSharp/assets/2425292/99ece539-5405-4024-8cf3-e566bfafea41)\r\n- For the .jpg using the the 2.80.2 version\r\n![result-picture-icc-embedded-matrix](https://github.com/mono/SkiaSharp/assets/2425292/11afc0ea-50cb-4b6d-b5f5-fdc17c40239c)\r\n- For the .jpg using the the 2.88.8 version\r\n![result-picture-icc-embedded-matrix](https://github.com/mono/SkiaSharp/assets/2425292/43520f56-c79a-4717-b90e-5b3a9522b2af)\r\n\r\n\r\nFor reference, here\u0027s the original images:\r\n- png\r\n![picture-icc-embedded-matrix](https://github.com/mono/SkiaSharp/assets/2425292/a9c370bd-beba-431e-a2b2-774121067686)\r\n- jpg\r\n![picture-icc-embedded-matrix](https://github.com/mono/SkiaSharp/assets/2425292/a47853fc-a268-4778-a440-2ce50d639794)\r\n\r\nAnd the code that test these cases: \r\n[SkiaWorkingPngSample.zip](https://github.com/user-attachments/files/15516069/SkiaWorkingPngSample.zip)\r\n[SkiaNonWorkingPngSample.zip](https://github.com/user-attachments/files/15516070/SkiaNonWorkingPngSample.zip)\r\n[SkiaWorkingJpegSample.zip](https://github.com/user-attachments/files/15516077/SkiaWorkingJpegSample.zip)\r\n[SkiaNonWorkingJpegSample.zip](https://github.com/user-attachments/files/15516080/SkiaNonWorkingJpegSample.zip)\r\n",
        "createdAt": "2024-05-31T16:01:56",
        "reactions": []
      },
      {
        "id": 2293692131,
        "author": "IAMManuel",
        "body": "After more verification on our part, we found that the issue was on our end. Sorry again for the time taken !",
        "createdAt": "2024-08-16T15:12:29",
        "reactions": []
      }
    ]
  }
}