{
  "number": 454,
  "type": "issue",
  "state": "closed",
  "title": "Width of png file dimensions is limited to 32767",
  "body": "(Title is not entirely accurate, please see below)\r\nThe following code in C# will generate a png image that has 36666 in width, but only the first 32767 pixels in width will be correctly generated.\r\n\u0060\u0060\u0060\r\n                const int TEST_WIDTH = 36666;\r\n                SKPath testPath = new SKPath();\r\n                // A straight horizontal path covering the full width\r\n                testPath.MoveTo(new SKPoint(0, 100));\r\n                testPath.LineTo(TEST_WIDTH, 100);\r\n                // Configure paint\r\n                SKPaint testPaint = new SKPaint\r\n                {\r\n                    Style = SKPaintStyle.Stroke,\r\n                    Color = SKColors.Red,\r\n                    StrokeWidth = 50,\r\n                    StrokeCap = SKStrokeCap.Cyan\r\n                };\r\n                // Save to file\r\n                var bitMap = new SKBitmap(TEST_WIDTH, 200);\r\n                SKCanvas imageCanvas = new SKCanvas(bitMap);\r\n                imageCanvas.DrawPath(testPath, testPaint);\r\n                using (Stream stream = File.OpenWrite(\u0027path to png file\u0027))\r\n                {\r\n                    SKData data = SKImage.FromBitmap(bitMap).Encode(SKEncodedImageFormat.Png, 100);\r\n                    data.SaveTo(stream);\r\n                }\r\n\u0060\u0060\u0060\r\nThe resulting image, if opened with Gimp or similar tools, will have a horizontal stroke that only spans to the 32767th pixel in x.\r\n\r\nThis is found in a Xamarin.Forms project, tested on Nexus 6P running Android 8.1 and iPhone 6s running iOS 11.2.6.",
  "author": {
    "login": "ChengmingLu",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "status/skia-update-required",
      "color": "B8EC4A"
    }
  ],
  "assignees": [],
  "createdAt": "2018-02-22T19:19:32",
  "updatedAt": "2022-08-19T18:01:28",
  "closedAt": "2018-02-23T12:59:26",
  "commentCount": 5,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:01:38.1107247Z",
    "reactions": [],
    "comments": [
      {
        "id": 367896280,
        "author": "mattleibow",
        "body": "You will never guess... skia just clips it so that it can fit into it\u0027s underlying type:\r\nhttps://github.com/google/skia/blob/master/src/core/SkScan_Hairline.cpp#L48-L62\r\n\r\nThey even have a note:\r\n\u003E // We have to pre-clip the line to fit in a SkFixed, so we just chop\r\n\u003E // the line. TODO find a way to actually draw beyond that range.\r\n\r\nI am not quite sure what to do at this point... You can still draw in that area (like a rect), just not with lines.",
        "createdAt": "2018-02-23T03:06:29",
        "reactions": []
      },
      {
        "id": 367896926,
        "author": "mattleibow",
        "body": "I asked a question here and we will see what they say: https://groups.google.com/forum/#!topic/skia-discuss/VDuN76yRFvQ\r\n",
        "createdAt": "2018-02-23T03:11:09",
        "reactions": []
      },
      {
        "id": 367899711,
        "author": "ChengmingLu",
        "body": "Appreciate the info and post to google forum!\r\n\r\nFYI, I tested with SKRect and ended up having the same issue.\r\n As indicated in the forum discussion, I think it\u0027s not only a limitation to SKPath but SKSurface as well?",
        "createdAt": "2018-02-23T03:31:11",
        "reactions": []
      },
      {
        "id": 368002325,
        "author": "mattleibow",
        "body": "I just go confirmation that this will happen with lines:\r\n\r\n\u003E Yes, I confirm that Skia\u0027s CPU backend will always clip the path into 32k x 32k bounds because we\u0027re using SkFixed (16.16 format) for scan conversion. The clip may be even smaller (8k x 8k) if 4x4 supersampling AA is used. We\u0027re thinking about adding tiling to completely remove that limitation.\r\n",
        "createdAt": "2018-02-23T12:58:07",
        "reactions": []
      },
      {
        "id": 368002613,
        "author": "mattleibow",
        "body": "I am going to close this as this is a core issue with skia. As soon as they fix it, it will magically appear in SkiaSharp.\r\n\r\nFor workarounds, I suggest discussing your case on their forums as they will be able to better help you.",
        "createdAt": "2018-02-23T12:59:26",
        "reactions": []
      }
    ]
  }
}