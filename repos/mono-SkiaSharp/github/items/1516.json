{
  "number": 1516,
  "type": "issue",
  "state": "closed",
  "title": "[QUESTION] FontSpacing seems to be too small",
  "body": "This is a follow up to the [twitter discussion](https://twitter.com/BeneStebner/status/1311310716578693121) I had with @mattleibow  and @Gillibald  as Twitter is the wrong medium for this.\r\n\r\nI want to use SkiaSharp to render a console. So I use a monospace font and I get character positions which I need to translate into pixels for SkiaSharp. I used \u0060SKPaint.FontSpacing\u0060 for the height and \u0060SKPaint.MeasureText(\u0022W\u0022)\u0060 for the width of a character.\r\n\r\nThis works fine with \u0060Courier New\u0060, but when I use the font \u0060Cascadia Mono PL\u0060, then \u0060SKPaint.FontSpacing\u0060 is not high enough. [Oh-my-posh (blog by shanselman)](https://www.hanselman.com/blog/HowToMakeAPrettyPromptInWindowsTerminalWithPowerlineNerdFontsCascadiaCodeWSLAndOhmyposh.aspx) uses some glyphs in that font, which go higher up than \u0060SKFontMetrics.Ascent\u0060.\r\n\r\nI wrote a repro project which shows that. The output looks like this:\r\n![image](https://user-images.githubusercontent.com/8309363/94916934-db4d5b80-04af-11eb-9347-436431ece38d.png)\r\n\r\nAs you can see the arrow is higher than \u0060Ascent\u0060. If I use \u0060Ascent\u0060 and \u0060FontSpacing\u0060 to position things, then this does not work. This is the code I use for drawing text, but it is wrong:\r\n\r\n\t// clear background with height FontSpacing\r\n\tcanvas.DrawRect(x, y, text.Length * charWidth, foreground.FontSpacing, background);\r\n\t// DrawText needs the baseline and Ascent is the (negative) offset\r\n\tcanvas.DrawText(text, x, y - foreground.FontMetrics.Ascent, foreground);\r\n\r\n\r\nIs this a bug in SkiaSharp, Skia or the Cascadia font? I can easily workaround when I use \u0060Top\u0060 instead of \u0060Ascent\u0060 for the distance to the baseline and \u0060Descent - Top\u0060 for the line height. But is this really the intended solution? What are \u0060Top\u0060 and \u0060Bottom\u0060 intended for anyway and why are they different than \u0060Ascent/Descent\u0060?\r\n\r\n\u0060Top\u0060 also does not seem to be 100% correct. You can see that the glyphs don\u0027t go all the way to \u0060Top\u0060. They are a bit shorter. Can I somehow measure how tall the highest glyph in the font is? Even if I use \u0060Top\u0060, the arrows don\u0027t look as good as in the Windows Terminal. You can see that in the following screenshot at the top right corner of every second arrow.\r\n![image](https://user-images.githubusercontent.com/8309363/94918725-6da32e80-04b3-11eb-9771-16eccaacd8b0.png)\r\n\r\n[Skia_Cascadia.zip](https://github.com/mono/SkiaSharp/files/5317517/Skia_Cascadia.zip)\r\n",
  "author": {
    "login": "MichaelRumpler",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2020-10-02T11:35:44",
  "updatedAt": "2022-08-19T03:01:44",
  "closedAt": "2020-10-03T08:55:10",
  "commentCount": 5,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:16:12.9324287Z",
    "reactions": [],
    "comments": [
      {
        "id": 702727632,
        "author": "Gillibald",
        "body": "This explains those properties pretty well: https://stackoverflow.com/a/27631737",
        "createdAt": "2020-10-02T13:15:34",
        "reactions": [
          {
            "user": "MichaelRumpler",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:16:12.0409016Z"
          }
        ]
      },
      {
        "id": 702847317,
        "author": "mattleibow",
        "body": "You can also check out values in the \u0060SKPaint.MeasureText\u0060 and see what that rect contains.\r\n\r\n@Gillibald I think what you are saying is that those values in the metrics are more a guide and maybe defined by the font? OR are the actually calculated?",
        "createdAt": "2020-10-02T17:02:24",
        "reactions": []
      },
      {
        "id": 702915083,
        "author": "Gillibald",
        "body": "They are defined by the font author and all glyphs share the same value",
        "createdAt": "2020-10-02T19:22:42",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:16:12.4450957Z"
          }
        ]
      },
      {
        "id": 703071425,
        "author": "MichaelRumpler",
        "body": "Thanks, that SO article is the best documentation I found so far.\r\n\r\nThat means there is some glyph which is even higher than that arrow or at least the font authors claimed so.\r\n\r\nI\u0027ll take a look at [the source of the Windows Terminal](https://github.com/microsoft/terminal) and see if I can find how they handle this. Because somehow their line seems to be as high as the arrow, starting at neither \u0060Top\u0060 nor \u0060Ascent\u0060.",
        "createdAt": "2020-10-03T08:55:09",
        "reactions": []
      },
      {
        "id": 707587140,
        "author": "MichaelRumpler",
        "body": "I didn\u0027t find any properties which resemble the values I need, so I measure how big the biggest chars are which may be used. This works best in what I tested so far.\r\n\r\n\t// check the maximum sizes of those chars:\r\n\t// a Powerline Arrow, Unicode Full Block and \u00D6 and y as fallback\r\n\tvar bigChars = \u0022\\uE0B0\\u2588\u00D6y\u0022;\r\n\tvar cellSize = new SKRect();\r\n\tfor (int i = 0; i \u003C bigChars.Length; i\u002B\u002B)\r\n\t{\r\n\t\tvar s = bigChars.Substring(i, 1);\r\n\t\tif (Paint.ContainsGlyphs(s))\t// if the font does not contain the glyph, then skip it\r\n\t\t{\r\n\t\t\tvar rect = new SKRect();\r\n\t\t\tPaint.MeasureText(s, ref rect);\r\n\t\t\tcellSize.Union(rect);\r\n\t\t}\r\n\t}\r\n\r\n\tCharWidth = Paint.MeasureText(\u0022W\u0022);     // cellSize.Width is too big\r\n\tLineHeight = cellSize.Height;\r\n\tAscent = cellSize.Top;\r\n\r\nIt\u0027s really a shame that even in a monospace font not all glyphs have the same size. This is only trial and error what I\u0027m doing here. And I only tested with Courier New and Cascadia Mono PL. For other fonts it might not work at all.",
        "createdAt": "2020-10-13T08:38:02",
        "reactions": []
      }
    ]
  }
}