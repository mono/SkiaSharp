{
  "number": 2331,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SkCanvas PaintSurface Event not triggering on physical iOS 16 device",
  "body": "**Description**\r\n\r\nI have a SKCanvas control which works fine when deployed to Android 13, and calls the PaintSurface Event, but when deployed using hot reload on a physical iOS 16 device an iphone 8 the Paintsurface event is never triggered therefore, no view is rendered. The control is initiated in a Grid using Net maui. A paid Apple Developer account is used, since that was the cause in earlier reports of the same issue. The framework is .NET 6, the following dependencies are installed : SkiaSharp.Views.Maui.Controls and SkiaSharp.Views.Maui.Core. As I mentioned it is working accordinlgly on Android so the cause is not the code.\r\n\r\n**Code**\r\n\r\npublic partial class RatingView : SKCanvasView\r\n    {\r\n        private PanGestureRecognizer panGestureRecognizer = new PanGestureRecognizer();\r\n        private double touchX;\r\n        private double touchY;\r\n\r\n        public RatingView()\r\n        {\r\n            this.BackgroundColor = Colors.Transparent;\r\n            this.PaintSurface \u002B= Handle_PaintSurface;\r\n            this.EnableTouchEvents = true;\r\n            this.panGestureRecognizer.PanUpdated \u002B= PanGestureRecognizer_PanUpdated;\r\n            this.GestureRecognizers.Add(panGestureRecognizer);\r\n\r\n        }\r\n\r\n        #region BindableProperties\r\n\r\n        public static readonly BindableProperty ValueProperty = BindableProperty.Create(nameof(Value), typeof(double), typeof(RatingView), default(double), propertyChanged: OnValueChanged);\r\n        public static readonly BindableProperty PathProperty = BindableProperty.Create(nameof(Path), typeof(string), typeof(RatingView), PathConstants.AnnoncerStar, propertyChanged: OnPropertyChanged);\r\n        public static readonly BindableProperty CountProperty = BindableProperty.Create(nameof(Count), typeof(int), typeof(RatingView), 5, propertyChanged: OnPropertyChanged);\r\n        public static readonly BindableProperty ColorOnProperty = BindableProperty.Create(nameof(ColorOn), typeof(Color), typeof(RatingView), MaterialColors.Amber.ToMauiColor(), propertyChanged: ColorOnChanged);\r\n        public static readonly BindableProperty OutlineOnColorProperty = BindableProperty.Create(nameof(OutlineOnColor), typeof(Color), typeof(RatingView), SKColors.Transparent.ToMauiColor(), propertyChanged: OutlineOnColorChanged);\r\n        public static readonly BindableProperty OutlineOffColorProperty = BindableProperty.Create(nameof(OutlineOffColor), typeof(Color), typeof(RatingView), MaterialColors.PlateYellow.ToMauiColor(), propertyChanged: OutlineOffColorChanged);\r\n        public static readonly BindableProperty RatingTypeProperty = BindableProperty.Create(nameof(RatingType), typeof(RatingType), typeof(RatingView), RatingType.Floating, propertyChanged: OnPropertyChanged);\r\n\r\n        public double Value\r\n        {\r\n            get { return (double)GetValue(ValueProperty); }\r\n            set { SetValue(ValueProperty, this.ClampValue(value)); }\r\n        }\r\n\r\n        public double ClampValue(double val)\r\n        {\r\n            if (val \u003C 0)\r\n                return 0;\r\n            else if (val \u003E this.Count)\r\n                return this.Count;\r\n            else\r\n                return val;\r\n        }\r\n        public string Path\r\n        {\r\n            get { return (string)GetValue(PathProperty); }\r\n            set { SetValue(PathProperty, value); }\r\n        }\r\n\r\n        public int Count\r\n        {\r\n            get { return (int)GetValue(CountProperty); }\r\n            set { SetValue(CountProperty, value); }\r\n        }\r\n\r\n        public Color ColorOn\r\n        {\r\n            get { return (Color)GetValue(ColorOnProperty); }\r\n            set { SetValue(ColorOnProperty, value); }\r\n        }\r\n\r\n        public Color OutlineOnColor\r\n        {\r\n            get { return (Color)GetValue(OutlineOnColorProperty); }\r\n            set { SetValue(OutlineOnColorProperty, value); }\r\n        }\r\n\r\n        public Color OutlineOffColor\r\n        {\r\n            get { return (Color)GetValue(OutlineOffColorProperty); }\r\n            set { SetValue(OutlineOffColorProperty, value); }\r\n        }\r\n\r\n        public RatingType RatingType\r\n        {\r\n            get { return (RatingType)GetValue(RatingTypeProperty); }\r\n            set { SetValue(RatingTypeProperty, value); }\r\n        }\r\n\r\n        public float Spacing { get; set; } = 20;\r\n\r\n        /// \u003Csummary\u003E\r\n        /// Gets or sets the color of the canvas background.\r\n        /// \u003C/summary\u003E\r\n        /// \u003Cvalue\u003EThe color of the canvas background.\u003C/value\u003E\r\n        public SKColor CanvasBackgroundColor { get; set; } = SKColors.Transparent;\r\n\r\n        /// \u003Csummary\u003E\r\n        /// Gets or sets the width of the stroke.\r\n        /// \u003C/summary\u003E\r\n        /// \u003Cvalue\u003EThe width of the stroke.\u003C/value\u003E\r\n        public float StrokeWidth { get; set; } = 12f;\r\n\r\n        private float ItemWidth { get; set; }\r\n        private float ItemHeight { get; set; }\r\n        private float CanvasScale { get; set; }\r\n        private SKColor SKColorOn { get; set; } = MaterialColors.PlateYellow;\r\n        private SKColor SKOutlineOnColor { get; set; } = MaterialColors.Black;\r\n        private SKColor SKOutlineOffColor { get; set; } = MaterialColors.PlateYellow;\r\n\r\n        #endregion\r\n\r\n\r\n        private void Handle_PaintSurface(object sender, SKPaintSurfaceEventArgs e)\r\n        {\r\n            this.Draw(e.Surface.Canvas, e.Info.Width, e.Info.Height);\r\n        }\r\n\r\n        public void Draw(SKCanvas canvas, int width, int height)\r\n        {\r\n            canvas.Clear(this.CanvasBackgroundColor);\r\n\r\n            var path = SKPath.ParseSvgPathData(this.Path);\r\n\r\n            var itemWidth = ((width - (this.Count - 1) * this.Spacing)) / this.Count;\r\n            var scaleX = (itemWidth / (path.Bounds.Width));\r\n            scaleX = (itemWidth - scaleX * this.StrokeWidth) / path.Bounds.Width;\r\n\r\n            this.ItemHeight = height;\r\n            var scaleY = this.ItemHeight / (path.Bounds.Height);\r\n            scaleY = (this.ItemHeight - scaleY * this.StrokeWidth) / (path.Bounds.Height);\r\n\r\n            this.CanvasScale = Math.Min(scaleX, scaleY);\r\n            this.ItemWidth = path.Bounds.Width * this.CanvasScale;\r\n\r\n            canvas.Scale(this.CanvasScale);\r\n            canvas.Translate(this.StrokeWidth / 2, this.StrokeWidth / 2);\r\n            canvas.Translate(-path.Bounds.Left, 0);\r\n            canvas.Translate(0, -path.Bounds.Top);\r\n\r\n            using (var strokePaint = new SKPaint\r\n            {\r\n                Style = SKPaintStyle.Stroke,\r\n                Color = this.OutlineOffColor.ToSKColor(),\r\n                StrokeWidth = this.StrokeWidth,\r\n                StrokeCap = SKStrokeCap.Round,\r\n                IsAntialias = true,\r\n            })\r\n            using (var fillPaint = new SKPaint\r\n            {\r\n                Style = SKPaintStyle.Fill,\r\n                Color = this.SKColorOn,\r\n                IsAntialias = true,\r\n            })\r\n            {\r\n                for (int i = 0; i \u003C this.Count; i\u002B\u002B)\r\n                {\r\n                    if (i \u003C= this.Value - 1) // Full\r\n                    {\r\n                        canvas.DrawPath(path, fillPaint);\r\n                        canvas.DrawPath(path, strokePaint);\r\n                    }\r\n                    else if (i \u003C this.Value) //Partial\r\n                    {\r\n                        float filledPercentage = (float)(this.Value - Math.Truncate(this.Value));\r\n                        strokePaint.Color = this.SKOutlineOffColor;\r\n                        canvas.DrawPath(path, strokePaint);\r\n\r\n                        using (var rectPath = new SKPath())\r\n                        {\r\n                            var rect = SKRect.Create(path.Bounds.Left \u002B path.Bounds.Width * filledPercentage, path.Bounds.Top, path.Bounds.Width * (1 - filledPercentage), this.ItemHeight * 2);\r\n                            rectPath.AddRect(rect);\r\n                            canvas.ClipPath(rectPath, SKClipOperation.Difference);\r\n                            canvas.DrawPath(path, fillPaint);\r\n                        }\r\n                    }\r\n                    else //Empty\r\n                    {\r\n                        strokePaint.Color = this.SKOutlineOffColor;\r\n                        canvas.DrawPath(path, strokePaint);\r\n                    }\r\n\r\n                    canvas.Translate((this.ItemWidth \u002B this.Spacing) / this.CanvasScale, 0);\r\n                }\r\n            }\r\n\r\n        }\r\n        protected override void OnTouch(SKTouchEventArgs e)\r\n        {\r\n            this.touchX = e.Location.X;\r\n            this.touchY = e.Location.Y;\r\n            this.SetValue(touchX, touchY);\r\n            this.InvalidateSurface();\r\n        }\r\n\r\n        public void SetValue(double x, double y)\r\n        {\r\n            var val = this.CalculateValue(x);\r\n            switch (this.RatingType)\r\n            {\r\n                case RatingType.Full:\r\n                    this.Value = ClampValue((double)Math.Ceiling(val));\r\n                    break;\r\n                case RatingType.Half:\r\n                    this.Value = ClampValue((double)Math.Round(val * 2) / 2);\r\n                    break;\r\n                case RatingType.Floating:\r\n                    this.Value = ClampValue(val);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        private double CalculateValue(double x)\r\n        {\r\n            if (x \u003C this.ItemWidth)\r\n                return (double)x / this.ItemWidth;\r\n            else if (x \u003C this.ItemWidth \u002B this.Spacing)\r\n                return 1;\r\n            else\r\n                return 1 \u002B CalculateValue(x - (this.ItemWidth \u002B this.Spacing));\r\n        }\r\n\r\n        private void PanGestureRecognizer_PanUpdated(object sender, PanUpdatedEventArgs e)\r\n        {\r\n            var point = ConvertToPixel(new Point(e.TotalX, e.TotalY));\r\n            if (e.StatusType != GestureStatus.Completed)\r\n            {\r\n                this.SetValue(touchX \u002B point.X, touchY \u002B e.TotalY);\r\n                this.InvalidateSurface();\r\n            }\r\n        }\r\n\r\n        private static void OnPropertyChanged(BindableObject bindable, object oldValue, object newValue)\r\n        {\r\n            var view = bindable as RatingView;\r\n            view.InvalidateSurface();\r\n        }\r\n\r\n        private static void OnValueChanged(BindableObject bindable, object oldValue, object newValue)\r\n        {\r\n            var view = bindable as RatingView;\r\n            view.Value = view.ClampValue((double)newValue);\r\n            OnPropertyChanged(bindable, oldValue, newValue);\r\n        }\r\n\r\n        private static void ColorOnChanged(BindableObject bindable, object oldValue, object newValue)\r\n        {\r\n            var view = bindable as RatingView;\r\n            view.SKColorOn = ((Color)newValue).ToSKColor();\r\n            OnPropertyChanged(bindable, oldValue, newValue);\r\n        }\r\n\r\n        private static void OutlineOffColorChanged(BindableObject bindable, object oldValue, object newValue)\r\n        {\r\n            var view = bindable as RatingView;\r\n            view.SKOutlineOffColor = ((Color)newValue).ToSKColor();\r\n            OnPropertyChanged(bindable, oldValue, newValue);\r\n        }\r\n\r\n        private static void OutlineOnColorChanged(BindableObject bindable, object oldValue, object newValue)\r\n        {\r\n            var view = bindable as RatingView;\r\n            view.SKOutlineOnColor = ((Color)newValue).ToSKColor();\r\n            OnPropertyChanged(bindable, oldValue, newValue);\r\n        }\r\n\r\n        SKPoint ConvertToPixel(Point pt)\r\n        {\r\n            return new SKPoint((float)(this.CanvasSize.Width * pt.X / this.Width),\r\n                               (float)(this.CanvasSize.Height * pt.Y / this.Height));\r\n        }\r\n\r\n    }\r\n\r\n**Expected Behavior**\r\n\r\nTo draw the Canvas view.\r\n\r\n**Actual Behavior**\r\n\r\n\u003C!-- a general description of what really happened --\u003E\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.88.3\r\n- Last known good version:  \u003C!-- the version of SkiaSharp that still working --\u003E\r\n- IDE:  Visual Studio\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - Android: \u003C!-- the version of the Android SDK you are compiling against, e.g. 7.1 --\u003E \r\n  - iOS:  16\r\n  - Linux:  \u003C!-- The version and distro of linux that you are building for, e.g. Ubuntu 16.04 --\u003E\r\n  - macOS:  \u003C!-- The version of macOS you are building for, e.g. 10.10 --\u003E\r\n  - Tizen:  \u003C!-- the version of the Tizen SDK you are compiling against, e.g. 4.0 --\u003E \r\n  - tvOS:  \u003C!-- the version of the tvOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - UWP:  \u003C!-- the version of the UWP SDK you are compiling against, e.g. 16299 --\u003E \r\n  - watchOS:  \u003C!-- the version of the watchOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - Windows Classic:  \u003C!-- the version of Windows you are building for, e.g. Windows 7 --\u003E\r\n- Target Devices:  iPhone 8\r\n  - \u003C!-- Google Pixel 4 XL --\u003E\r\n  - \u003C!-- iPhone 11 --\u003E\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nPASTE ANY DETAILED VERSION INFO HERE\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n**Reproduction Link**\r\n\r\n\u003C!-- please upload or provide a link to a reproduction case --\u003E\r\n\r\n",
  "author": {
    "login": "AlexanderSCK",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-12-07T16:47:40",
  "updatedAt": "2023-11-30T10:38:02",
  "commentCount": 3,
  "reactionCount": 0
}