{
  "number": 3039,
  "type": "pr",
  "state": "closed",
  "title": "fix: Add WinUI native helper for GetByteBuffer",
  "body": "**Description of Change**\r\n\r\nBackports changes from https://github.com/mono/SkiaSharp/pull/2920 to the 2x branch.\r\n\r\n**Bugs Fixed**\r\n\r\n- Fixes https://github.com/mono/SkiaSharp/issues/2999\r\n\r\n\u003C!-- Provide links to issues here. Ensure that a GitHub issue was created for your feature or bug fix before sending PR. --\u003E\r\n\r\n**API Changes**\r\n\r\nNone.\r\n\r\n\u003C!-- REPLACE THIS COMMENT\r\n\r\nList all API changes here (or just put None), example:\r\n\r\nAdded: \r\n \r\n- \u0060string Class.Property { get; set; }\u0060\r\n- \u0060void Class.Method();\u0060\r\n\r\nChanged:\r\n\r\n - \u0060object Cell.OldPropertyName =\u003E object Cell.NewPropertyName\u0060\r\n\r\n--\u003E\r\n\r\n**Behavioral Changes**\r\n\r\nNone.\r\n\r\n\u003C!-- Describe any non-bug related behavioral changes that may change how users app behaves when upgrading to this version of the codebase. --\u003E\r\n\r\n**Required skia PR**\r\n\r\nNone.\r\n\r\n\u003C!-- Replace this with the full URL to the skia PR. --\u003E\r\n\r\n**PR Checklist**\r\n\r\n- [ ] Has tests (if omitted, state reason in description)\r\n- [ ] Rebased on top of main at time of PR\r\n- [ ] Merged related skia PRs\r\n- [ ] Changes adhere to coding standard\r\n- [ ] Updated documentation\r\n",
  "author": {
    "login": "jeromelaban",
    "type": "User"
  },
  "labels": [
    {
      "name": "community \u2728",
      "color": "ededed"
    }
  ],
  "assignees": [],
  "createdAt": "2024-10-15T21:00:51",
  "updatedAt": "2024-10-23T12:57:01",
  "closedAt": "2024-10-23T12:30:45",
  "commentCount": 52,
  "reactionCount": 5,
  "draft": false,
  "merged": true,
  "mergedAt": "2024-10-23T12:30:45",
  "mergeableState": "unknown",
  "baseBranch": "release/2.x",
  "headBranch": "dev/jela/issue2999-2x",
  "additions": 697,
  "deletions": 111,
  "changedFiles": 31,
  "commits": 1,
  "reviews": [
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2024-10-20T08:41:16"
    },
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2024-10-20T09:00:02"
    },
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2024-10-20T10:21:50"
    },
    {
      "author": "mattleibow",
      "state": "APPROVED",
      "submittedAt": "2024-10-23T12:18:26"
    }
  ],
  "engagement": {
    "syncedAt": "2026-02-06T13:34:01.8965945Z",
    "reactions": [
      {
        "user": "vilgotf",
        "content": "heart",
        "createdAt": "2026-02-06T13:34:01.8965998Z"
      },
      {
        "user": "inforithmics",
        "content": "heart",
        "createdAt": "2026-02-06T13:34:01.8966009Z"
      },
      {
        "user": "mattleibow",
        "content": "heart",
        "createdAt": "2026-02-06T13:34:01.8966011Z"
      },
      {
        "user": "Mangepange",
        "content": "heart",
        "createdAt": "2026-02-06T13:34:01.8966014Z"
      },
      {
        "user": "beto-rodriguez",
        "content": "heart",
        "createdAt": "2026-02-06T13:34:01.8966016Z"
      }
    ],
    "comments": [
      {
        "id": 2415156447,
        "author": "jeromelaban",
        "body": "/azp run",
        "createdAt": "2024-10-15T21:05:44",
        "reactions": []
      },
      {
        "id": 2415156684,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nCommenter does not have sufficient privileges for PR 3039 in repo mono/SkiaSharp\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-15T21:05:50",
        "reactions": []
      },
      {
        "id": 2415166465,
        "author": "jeromelaban",
        "body": "Hi @mattleibow, @Redth! Could you update the azure devops branch triggers for PRs on the \u0060release/2x\u0060? Thanks!",
        "createdAt": "2024-10-15T21:08:29",
        "reactions": []
      },
      {
        "id": 2417506104,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-16T17:47:14",
        "reactions": []
      },
      {
        "id": 2417506333,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-16T17:47:21",
        "reactions": []
      },
      {
        "id": 2419667718,
        "author": "jeromelaban",
        "body": "/azp run",
        "createdAt": "2024-10-17T14:12:03",
        "reactions": []
      },
      {
        "id": 2419668013,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nCommenter does not have sufficient privileges for PR 3039 in repo mono/SkiaSharp\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-17T14:12:10",
        "reactions": []
      },
      {
        "id": 2419864204,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-17T15:28:39",
        "reactions": []
      },
      {
        "id": 2419864494,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-17T15:28:46",
        "reactions": []
      },
      {
        "id": 2420894692,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-18T00:05:34",
        "reactions": []
      },
      {
        "id": 2420894815,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-18T00:05:42",
        "reactions": []
      },
      {
        "id": 2421017447,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-18T01:05:50",
        "reactions": []
      },
      {
        "id": 2421017559,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-18T01:05:56",
        "reactions": []
      },
      {
        "id": 2421019732,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-18T01:07:29",
        "reactions": []
      },
      {
        "id": 2421019825,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-18T01:07:36",
        "reactions": []
      },
      {
        "id": 2423575953,
        "author": "mattleibow",
        "body": "/rebase",
        "createdAt": "2024-10-19T05:13:45",
        "reactions": []
      },
      {
        "id": 2424046707,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-19T16:23:46",
        "reactions": []
      },
      {
        "id": 2424046764,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-19T16:23:54",
        "reactions": []
      },
      {
        "id": 2424605743,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-20T05:30:31",
        "reactions": []
      },
      {
        "id": 2424605785,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-20T05:30:38",
        "reactions": []
      },
      {
        "id": 2424829523,
        "author": "mattleibow",
        "body": "Some more of my changes to get CI: https://github.com/unoplatform/Uno.SkiaSharp/pull/33\r\n\r\nStill not green yet, but closer i think?",
        "createdAt": "2024-10-20T10:34:55",
        "reactions": []
      },
      {
        "id": 2426118369,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-21T09:28:30",
        "reactions": []
      },
      {
        "id": 2426118716,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-21T09:28:39",
        "reactions": []
      },
      {
        "id": 2426120994,
        "author": "mattleibow",
        "body": "Closer! \r\n\r\n\u0060\u0060\u0060\r\n\u0022D:\\a\\1\\s\\source\\SkiaSharpSource.Windows-netfx.slnf\u0022 (Build target) (1:2) -\u003E\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharp.Views.Forms\\SkiaSharp.Views.Forms.UWP\\SkiaSharp.Views.Forms.UWP.csproj\u0022 (default target) (2:6) -\u003E\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharp.Views\\SkiaSharp.Views.UWP\\SkiaSharp.Views.UWP.csproj\u0022 (default target) (6:8) -\u003E\r\n       (CoreCompile target) -\u003E \r\n         D:\\a\\1\\s\\source\\SkiaSharp.Views\\SkiaSharp.Views.UWP\\UWPExtensions.cs(6,23): error CS0234: The type or namespace name \u0027WinUI\u0027 does not exist in the namespace \u0027SkiaSharp.Views\u0027 (are you missing an assembly reference?) [D:\\a\\1\\s\\source\\SkiaSharp.Views\\SkiaSharp.Views.UWP\\SkiaSharp.Views.UWP.csproj]\r\n\r\n\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharpSource.Windows-netfx.slnf\u0022 (Build target) (1:2) -\u003E\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI.csproj\u0022 (default target) (22:14) -\u003E\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI.csproj\u0022 (Build target) (22:16) -\u003E\r\n         D:\\a\\1\\s\\source\\SkiaSharp.Views\\SkiaSharp.Views.UWP\\UWPExtensions.cs(177,23): error CS0121: The call is ambiguous between the following methods or properties: \u0027Utils.GetByteBuffer(IBuffer)\u0027 and \u0027WindowsExtensions.GetByteBuffer(IBuffer)\u0027 [D:\\a\\1\\s\\source\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI.csproj::TargetFramework=net6.0-windows10.0.19041.0]\r\n\r\n\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharpSource.Windows-netfx.slnf\u0022 (Build target) (1:2) -\u003E\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI.csproj\u0022 (default target) (22:14) -\u003E\r\n       \u0022D:\\a\\1\\s\\source\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI.csproj\u0022 (Build target) (22:15) -\u003E\r\n         D:\\a\\1\\s\\source\\SkiaSharp.Views\\SkiaSharp.Views.UWP\\UWPExtensions.cs(177,23): error CS0121: The call is ambiguous between the following methods or properties: \u0027Utils.GetByteBuffer(IBuffer)\u0027 and \u0027WindowsExtensions.GetByteBuffer(IBuffer)\u0027 [D:\\a\\1\\s\\source\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI\\SkiaSharp.Views.WinUI.csproj::TargetFramework=net6.0-windows10.0.18362.0]\r\n\r\n\u0060\u0060\u0060",
        "createdAt": "2024-10-21T09:29:35",
        "reactions": []
      },
      {
        "id": 2426545855,
        "author": "mattleibow",
        "body": "building now and will see https://github.com/unoplatform/Uno.SkiaSharp/pull/35",
        "createdAt": "2024-10-21T12:34:25",
        "reactions": []
      },
      {
        "id": 2426645962,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-21T13:13:13",
        "reactions": []
      },
      {
        "id": 2426646422,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-21T13:13:22",
        "reactions": []
      },
      {
        "id": 2426677320,
        "author": "mattleibow",
        "body": "\u0060\u0060\u0060\r\nSuccessfully created package \u0027D:\\a\\1\\s\\output\\nugets\\SkiaSharp.NativeAssets.Win32.2.88.9-preview.0.1.symbols.nupkg\u0027.\r\nAttempting to build package from \u0027SkiaSharp.NativeAssets.WinUI.temp.nuspec\u0027.\r\nTarget path \u0027runtimes\\win-x64\\native\\*.dll\u0027 contains invalid characters.\r\nTarget path \u0027runtimes\\win-x64\\native\\*.winmd\u0027 contains invalid characters.\r\nTarget path \u0027runtimes\\win-x86\\native\\*.dll\u0027 contains invalid characters.\r\nTarget path \u0027runtimes\\win-x86\\native\\*.winmd\u0027 contains invalid characters.\r\nTarget path \u0027runtimes\\win-arm64\\native\\*.dll\u0027 contains invalid characters.\r\nTarget path \u0027runtimes\\win-arm64\\native\\*.winmd\u0027 contains invalid characters.\r\n\u0060\u0060\u0060",
        "createdAt": "2024-10-21T13:24:40",
        "reactions": []
      },
      {
        "id": 2426687487,
        "author": "mattleibow",
        "body": "The nuspec I think cannot handle wildcards. I do a bunch of things to manipulate it and I think that is not too fancy.",
        "createdAt": "2024-10-21T13:28:25",
        "reactions": []
      },
      {
        "id": 2426691128,
        "author": "jeromelaban",
        "body": "Indeed, I used it incorrectly, it should be the source path, not the target",
        "createdAt": "2024-10-21T13:29:42",
        "reactions": []
      },
      {
        "id": 2426696089,
        "author": "mattleibow",
        "body": "I think my magic copies the src into the target. Sort of my way to type less. You can either sepcify the full path in the src, or try add the target attribute.\r\n\r\nBut the full path is better as the pack will fail if we forget a file or if there is a missing file. Sort of a verification check.",
        "createdAt": "2024-10-21T13:31:28",
        "reactions": [
          {
            "user": "jeromelaban",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:33:57.1929453Z"
          }
        ]
      },
      {
        "id": 2426710709,
        "author": "mattleibow",
        "body": "This is how I had it in the 3.x series:\r\n\r\n![image](https://github.com/user-attachments/assets/fd329cd1-e331-41ed-a407-78ee6bfbff20)\r\n\r\nI think the only difference is this would now be net6.0?\r\n\r\n\r\nI did duplicate the projection dll in each because it was super easy vs some complicated logic or something.",
        "createdAt": "2024-10-21T13:37:08",
        "reactions": []
      },
      {
        "id": 2426862793,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-21T14:32:48",
        "reactions": []
      },
      {
        "id": 2426863305,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-21T14:32:57",
        "reactions": []
      },
      {
        "id": 2427288425,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-21T17:13:32",
        "reactions": []
      },
      {
        "id": 2427288639,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-21T17:13:39",
        "reactions": []
      },
      {
        "id": 2428750798,
        "author": "mattleibow",
        "body": "i think this fixes everything: https://github.com/unoplatform/Uno.SkiaSharp/pull/36\r\n\r\nbut now the agent runs out of storage. I saw it happen a few times, now it is failing on random extractions. I am going to check and then try extract in a separate step. I have to extract all the nugets so the security/secret/compliance/other scanners can read the dlls.",
        "createdAt": "2024-10-22T09:22:47",
        "reactions": []
      },
      {
        "id": 2429287730,
        "author": "mattleibow",
        "body": "this is the money i think https://github.com/unoplatform/Uno.SkiaSharp/pull/37\r\n\r\nGreen on my internal pipelines",
        "createdAt": "2024-10-22T13:27:14",
        "reactions": []
      },
      {
        "id": 2429291789,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-22T13:28:50",
        "reactions": []
      },
      {
        "id": 2429292065,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-22T13:28:57",
        "reactions": []
      },
      {
        "id": 2430217743,
        "author": "charlesroddie",
        "body": "Interesting. This PR could make SkiaSharp 2.88.9 work with UWP \u002B dotnet9/NativeAOT? Should be able to test that once there is a nuget published.",
        "createdAt": "2024-10-22T20:38:38",
        "reactions": []
      },
      {
        "id": 2430271574,
        "author": "jeromelaban",
        "body": "\u003E Interesting. This PR could make SkiaSharp 2.88.9 work with UWP \u002B dotnet9/NativeAOT? Should be able to test that once there is a nuget published.\r\n\r\nThis is not the original intent of the change. I\u0027m not too sure either if the CI will happily accept this kind of net9 inclusions either, as most of the CI is running net6 or 7 and it does not play well with the installed versions of VS.",
        "createdAt": "2024-10-22T21:01:31",
        "reactions": []
      },
      {
        "id": 2430560793,
        "author": "jeromelaban",
        "body": "Ok, so I can confirm the 2.x binaries are working with 8.0.402/9.0.100 and WinAppSDK 1.6!\r\n\r\nTwo small updates left to adjust the RIDs and to make the right nuget dependencies. Getting there!",
        "createdAt": "2024-10-23T00:30:37",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "hooray",
            "createdAt": "2026-02-06T13:34:00.0969764Z"
          }
        ]
      },
      {
        "id": 2430600073,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-23T01:15:59",
        "reactions": []
      },
      {
        "id": 2430600205,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-23T01:16:07",
        "reactions": []
      },
      {
        "id": 2430602244,
        "author": "mattleibow",
        "body": "\u003E Ok, so I can confirm the 2.x binaries are working with 8.0.402/9.0.100 and WinAppSDK 1.6!\n\nWhat about older wasdk?",
        "createdAt": "2024-10-23T01:17:54",
        "reactions": []
      },
      {
        "id": 2430639039,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-23T01:54:50",
        "reactions": []
      },
      {
        "id": 2430639210,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-23T01:54:57",
        "reactions": []
      },
      {
        "id": 2430656849,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2024-10-23T02:00:23",
        "reactions": []
      },
      {
        "id": 2430657064,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2024-10-23T02:00:29",
        "reactions": []
      }
    ]
  }
}