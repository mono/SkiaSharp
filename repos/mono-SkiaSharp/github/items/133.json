{
  "number": 133,
  "type": "issue",
  "state": "closed",
  "title": "Canvas rotation does not work correctly",
  "body": "I just started working with SkiaSharp and I have a problem with canvas rotation.\nThe code below generates the attached image:\n\n\u0060\u0060\u0060\nusing (SKSurface surface = SKSurface.Create(816, 1056, SKColorType.Bgra8888, SKAlphaType.Premul))\n{\n    SKCanvas canvas = surface.Canvas;\n    SKMatrix m = SKMatrix.MakeTranslation(300, 400);\n    canvas.Concat(ref m);\n\n    m = SKMatrix.MakeScale(400, 200);\n    canvas.Concat(ref m);\n\n    using (SKPaint redPaint = new SKPaint())\n    {\n        redPaint.Color = new SKColor(255, 0, 0);\n        canvas.DrawRect(SKRect.Create(0, 0, 1, 1), redPaint);\n    }\n\n    m = SKMatrix.MakeRotationDegrees(45);\n    canvas.Concat(ref m);\n\n    using (SKPaint bluePaint = new SKPaint())\n    {\n        bluePaint.Color = new SKColor(0, 0, 255);\n        canvas.DrawRect(SKRect.Create(0, 0, 1, 1), bluePaint);\n    }\n}\n\u0060\u0060\u0060\n\n![image-816x1056x4-red-blue](https://cloud.githubusercontent.com/assets/20994796/17629430/f85c8b1e-60c2-11e6-9bfa-36326a7f1a93.png)\nThe blue rectangle instead of being scaled like the red one, it is skewed and scaled equally on both axis.\nI\u0027m using the latest version 1.53.0.\n",
  "author": {
    "login": "xfiniumpdf-support",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "milestone": "1.53.1",
  "createdAt": "2016-08-12T16:35:23",
  "updatedAt": "2022-08-20T00:02:20",
  "closedAt": "2016-08-15T15:15:57",
  "commentCount": 2,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:53:42.8706108Z",
    "reactions": [],
    "comments": [
      {
        "id": 239823322,
        "author": "mattleibow",
        "body": "I had a look at this and I think that you might be going about this wrong. The matrix transformations are applied to the entire canvas, not the next drawing. With this in mind, you should rotate the canvas and then scale it. \n\nThat way, when you stretch the block horizontally, the horizontal-ness is actually rotated in line with the block.\n\n\u0060\u0060\u0060 csharp\nSKMatrix m = SKMatrix.MakeTranslation(300, 100);\ncanvas.Concat(ref m);\n\nusing (new SKAutoCanvasRestore(canvas, true))\n{\n    m = SKMatrix.MakeScale(400, 200);\n    canvas.Concat(ref m);\n\n    using (SKPaint redPaint = new SKPaint())\n    {\n        redPaint.Color = new SKColor(255, 0, 0);\n        canvas.DrawRect(SKRect.Create(0, 0, 1, 1), redPaint);\n    }\n}\n\nusing (new SKAutoCanvasRestore(canvas, true))\n{\n    m = SKMatrix.MakeRotationDegrees(45);\n    canvas.Concat(ref m);\n\n    m = SKMatrix.MakeScale(400, 200);\n    canvas.Concat(ref m);\n\n    using (SKPaint bluePaint = new SKPaint())\n    {\n        bluePaint.Color = new SKColor(0, 0, 255);\n        canvas.DrawRect(SKRect.Create(0, 0, 1, 1), bluePaint);\n    }\n}\n\u0060\u0060\u0060\n\nI would also suggest that you use the \u0060SKAutoCanvasRestore\u0060 type to auto-rollback transformations:\n\n\u0060\u0060\u0060 csharp\nusing (new SKAutoCanvasRestore(canvas, true))\n{\n    // do you matrix transformations\n}\n\u0060\u0060\u0060\n\nThe equivalent \u0060Save\u0060/\u0060Restore\u0060 code is:\n\n\u0060\u0060\u0060 csharp\ncanvas.Save();\n// do you matrix transformations\ncanvas.Restore();\n\u0060\u0060\u0060\n",
        "createdAt": "2016-08-15T14:54:45",
        "reactions": []
      },
      {
        "id": 239827350,
        "author": "mattleibow",
        "body": "The same thing happens with HTML Canvas: http://jsbin.com/tukurarika/edit?html,output\nand then after my changes: http://jsbin.com/mekubacive/edit?html,output\n",
        "createdAt": "2016-08-15T15:08:41",
        "reactions": []
      }
    ]
  }
}