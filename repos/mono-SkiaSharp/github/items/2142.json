{
  "number": 2142,
  "type": "issue",
  "state": "closed",
  "title": "SKPaint.MeasureText always returns 0 when run on Linux Docker",
  "body": "**Description**\r\n\r\nI\u0027m trying to use SkiaSharp with a ASP.NET Core 6.0 web application I\u0027m developing to run on a Linux-based (Synology) server. I am trying to create a function which converts a string to an image, however the code provided below is condensed to only the issue.\r\n\r\n**Code**\r\n\r\n\u0060\u0060\u0060\r\npublic void HelloWorld() {\r\n\tString text = \u0022Hello, World!!!\u0022;\r\n\tusing (SKFont font = new(SKTypeface.Default, 16)) {\r\n\t\tSingle textSize;\r\n\t\tSKRect textBounds = new();\r\n\t\tusing (SKPaint tempPaint = new(font)) {\r\n\t\t\ttextSize = tempPaint.MeasureText(text, ref textBounds);\r\n\t\t}\r\n\t}\r\n}\r\n\u0060\u0060\u0060\r\n\r\n**Expected Behavior**\r\n\r\nWhen run from IIS Express, it results in a SKRect object with dimensions 98x14.\r\n\r\n**Actual Behavior**\r\n\r\nWhen run on a Linux docker, the SKPaint.MeasureText call always returns a value 0; and when called with the overload which takes a SKRect reference parameter, the resulting SKRect describes a zero-area region (zero length, zero height).\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  SkiaSharp v2.88.0, SkiaSharp.NativeAssets.Linux.NoDependencies v2.88.00\r\n- Last known good version:  Haven\u0027t tried with previous versions.\r\n- IDE:  Visual Studio 2022 Version 17.2.5 (64-bit)\r\n- Platform Target Frameworks:\r\n  - Linux:  alpine (off of Docker)\r\n- Target Devices:\r\n  - Linux-based docker image\r\n  - Synology server\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nUsing Microsoft Windows 10 home version,\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n",
  "author": {
    "login": "jafeucht",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-07-02T21:22:25",
  "updatedAt": "2022-08-19T00:01:16",
  "closedAt": "2022-07-02T22:00:50",
  "commentCount": 1,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:19:24.0439741Z",
    "reactions": [],
    "comments": [
      {
        "id": 1172968991,
        "author": "jafeucht",
        "body": "Well, it turns out I have a bad habit of creating support tickets or bug reports, then fixing the issue on my own 5 minutes later.\r\n\r\nTurns out that SkiaSharp could not find a font. After copying cour.ttf (Courier New) from the C:\\Windows\\Fonts folder to a fonts folder in my wwwroot path, I was able to fix the functionality. Here is the resulting code:\r\n\r\n\u0060\u0060\u0060\r\npublic Byte[] TextToImage(String text) {\r\n\tByte[] imageData;\r\n\tString fontFile = Path.GetFullPath(Path.Combine(_env.WebRootPath, \u0022fonts\u0022, \u0022cour.ttf\u0022));\r\n\tif (!System.IO.File.Exists(fontFile)) {\r\n\t\tthrow new Exception(\u0022Font file \\\u0022cour.ttf\\\u0022 missing.\u0022);\r\n\t}\r\n\tusing (SKTypeface typeface = SKTypeface.FromFile(fontFile)) {\r\n\t\tusing (SKFont font = new(typeface, 16)) {\r\n\t\t\tSingle textSize;\r\n\t\t\tSKRect textBounds = new();\r\n\t\t\tusing (SKPaint tempPaint = new(font)) {\r\n\t\t\t\ttextSize = tempPaint.MeasureText(text, ref textBounds);\r\n\t\t\t}\r\n\t\t\tSKImageInfo imageInfo = new((Int32)textBounds.Width, (Int32)textBounds.Height);\r\n\t\t\tusing (SKSurface surface = SKSurface.Create(imageInfo)) {\r\n\t\t\t\tSKCanvas canvas = surface.Canvas;\r\n\t\t\t\tcanvas.Clear(SKColors.Transparent);\r\n\t\t\t\tusing (SKPaint paint = new(font)) {\r\n\t\t\t\t\tpaint.Color = SKColors.Black;\r\n\t\t\t\t\tpaint.IsAntialias = true;\r\n\t\t\t\t\tcanvas.DrawText(text, 0, textBounds.Height - textBounds.Bottom, font, paint);\r\n\t\t\t\t}\r\n\t\t\t\tusing (SKImage image = surface.Snapshot()) {\r\n\t\t\t\t\tusing (SKData data = image.Encode(SKEncodedImageFormat.Png, 100)) {\r\n\t\t\t\t\t\timageData = data.ToArray();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn imageData;\r\n}\r\n\u0060\u0060\u0060",
        "createdAt": "2022-07-02T21:58:10",
        "reactions": []
      }
    ]
  }
}