{
  "number": 735,
  "type": "issue",
  "state": "closed",
  "title": "Android throws System.ObjectDisposedException: when returning to a page with Skia. UWP and iOS work fine",
  "body": "### Description\r\n\r\nReturning to a Page with a Skia Canvas in Android causes an exception\r\n System.ObjectDisposedException: Cannot access a disposed object.\r\n Object name: \u0027Xamarin.Forms.Platform.Android.Platform\u002BDefaultRenderer\u0027.\r\nBoth UWP and iOS work fine. I have a Master/Detail app with one page using SkiaSharp for drawing. Sometimes I need to go to a different page to get some info and then return to the drawing to continue with the Sketch. That is when, in Android, I get the Exception.\r\nIt starts with:\r\n12-17 08:37:04.941 I/MonoDroid(12405): System.ObjectDisposedException: Cannot access a disposed object.\r\n12-17 08:37:04.941 I/MonoDroid(12405): Object name: \u0027Xamarin.Forms.Platform.Android.Platform\u002BDefaultRenderer\u0027.\r\n\r\n### Code\r\n\r\nBelow is a link to a repro.\r\n\r\n### Expected Behavior\r\n\r\nTo move successfully between detail pages.\r\n\r\n### Actual Behavior\r\n\r\nUpon returning to the page with Skia I get System.ObjectDisposedException\r\n\r\n### Basic Information\r\n\r\n- Version with issue:  SkiaSharp v 1.68.0\r\n- Last known good version:  new code, never run before\r\n- IDE:  VS 2017 v 15.9.4\r\n- Platform Target Frameworks: \r\n  - Android: 8.1 (Oreo) \r\n\r\n  -   Alcatel 9024O  Android v 7.1.1\r\n - Samsung SM-G960W Android v 8.0\r\n### Screenshots\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n### Reproduction Link\r\n\r\nhttps://bitbucket.org/WillAutio/skiafail\r\n",
  "author": {
    "login": "WillAutioItrax",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2018-12-17T17:15:32",
  "updatedAt": "2022-08-19T12:02:07",
  "closedAt": "2018-12-18T00:41:53",
  "commentCount": 3,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:06:15.6134481Z",
    "reactions": [],
    "comments": [
      {
        "id": 448051670,
        "author": "mattleibow",
        "body": "Adding a bigger stack trace:\r\n\u0060\u0060\u0060\r\n[MonoDroid] System.ObjectDisposedException: Cannot access a disposed object.\r\n[MonoDroid] Object name: \u0027Xamarin.Forms.Platform.Android.Platform\u002BDefaultRenderer\u0027.\r\n[MonoDroid]   at Java.Interop.JniPeerMembers.AssertSelf (Java.Interop.IJavaPeerable self) [0x00029] in \u003C42dc777b518744fdae9988e94489a4a0\u003E:0 \r\n[MonoDroid]   at Java.Interop.JniPeerMembers\u002BJniInstanceMethods.InvokeVirtualInt32Method (System.String encodedMember, Java.Interop.IJavaPeerable self, Java.Interop.JniArgumentValue* parameters) [0x00000] in \u003C42dc777b518744fdae9988e94489a4a0\u003E:0 \r\n[MonoDroid]   at Java.Lang.Object.GetHashCode () [0x0000a] in \u003C1219ce5aae934ab095dc0e05b2110050\u003E:0 \r\n[MonoDroid]   at System.Collections.Generic.ObjectEqualityComparer\u00601[T].GetHashCode (T obj) [0x0000a] in \u003Cd4a23bbd2f544c30a48c44dd622ce09f\u003E:0 \r\n[MonoDroid]   at System.Collections.Generic.Dictionary\u00602[TKey,TValue].FindEntry (TKey key) [0x00016] in \u003Cd4a23bbd2f544c30a48c44dd622ce09f\u003E:0 \r\n[MonoDroid]   at System.Collections.Generic.Dictionary\u00602[TKey,TValue].ContainsKey (TKey key) [0x00000] in \u003Cd4a23bbd2f544c30a48c44dd622ce09f\u003E:0 \r\n[MonoDroid]   at TouchTracking.Droid.TouchHandler.UnregisterEvents (Android.Views.View view) [0x00000] in \u003Cfaf34f40c5934307aca78246d317bd11\u003E:0 \r\n[MonoDroid]   at TouchTracking.Forms.Droid.TouchEffect.OnDetached () [0x00020] in \u003Cf585c8fe2f40407ab80b8a1904394be7\u003E:0 \r\n[MonoDroid]   at Xamarin.Forms.Effect.SendDetached () [0x00009] in D:\\a\\1\\s\\Xamarin.Forms.Core\\Effect.cs:62 \r\n[MonoDroid]   at Xamarin.Forms.PlatformEffect\u00602[TContainer,TControl].SendDetached () [0x00000] in D:\\a\\1\\s\\Xamarin.Forms.Core\\PlatformEffect.cs:23 \r\n[MonoDroid]   at Xamarin.Forms.RoutingEffect.SendDetached () [0x00000] in D:\\a\\1\\s\\Xamarin.Forms.Core\\RoutingEffect.cs:34 \r\n[MonoDroid]   at Xamarin.Forms.Element.set_EffectControlProvider (Xamarin.Forms.IEffectControlProvider value) [0x0002e] in D:\\a\\1\\s\\Xamarin.Forms.Core\\Element.cs:248 \r\n[MonoDroid]   at Xamarin.Forms.Internals.EffectUtilities.RegisterEffectControlProvider (Xamarin.Forms.IEffectControlProvider self, Xamarin.Forms.IElementController oldElement, Xamarin.Forms.IElementController newElement) [0x0001a] in D:\\a\\1\\s\\Xamarin.Forms.Core\\Internals\\EffectUtilities.cs:16 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].SetElement (TElement element) [0x0011e] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:221 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].Xamarin.Forms.Platform.Android.IVisualElementRenderer.SetElement (Xamarin.Forms.VisualElement element) [0x00027] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:125 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.Platform.CreateRenderer (Xamarin.Forms.VisualElement element, Android.Content.Context context) [0x0001f] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\Platform.cs:330 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementPackager.AddChild (Xamarin.Forms.VisualElement view, Xamarin.Forms.Platform.Android.IVisualElementRenderer oldRenderer, Xamarin.Forms.Platform.Android.RendererPool pool, System.Boolean sameChildren) [0x000af] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementPackager.cs:120 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementPackager.SetElement (Xamarin.Forms.VisualElement oldElement, Xamarin.Forms.VisualElement newElement) [0x00139] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementPackager.cs:268 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementPackager.Load () [0x00000] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementPackager.cs:92 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].SetPackager (Xamarin.Forms.Platform.Android.VisualElementPackager packager) [0x00007] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:388 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].SetElement (TElement element) [0x000e0] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:213 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].Xamarin.Forms.Platform.Android.IVisualElementRenderer.SetElement (Xamarin.Forms.VisualElement element) [0x00027] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:125 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.Platform.CreateRenderer (Xamarin.Forms.VisualElement element, Android.Content.Context context) [0x0001f] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\Platform.cs:330 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementPackager.AddChild (Xamarin.Forms.VisualElement view, Xamarin.Forms.Platform.Android.IVisualElementRenderer oldRenderer, Xamarin.Forms.Platform.Android.RendererPool pool, System.Boolean sameChildren) [0x000af] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementPackager.cs:120 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementPackager.SetElement (Xamarin.Forms.VisualElement oldElement, Xamarin.Forms.VisualElement newElement) [0x00139] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementPackager.cs:268 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementPackager.Load () [0x00000] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementPackager.cs:92 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].SetPackager (Xamarin.Forms.Platform.Android.VisualElementPackager packager) [0x00007] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:388 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].SetElement (TElement element) [0x000e0] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:213 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601[TElement].Xamarin.Forms.Platform.Android.IVisualElementRenderer.SetElement (Xamarin.Forms.VisualElement element) [0x00027] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:125 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.Platform.CreateRenderer (Xamarin.Forms.VisualElement element, Android.Support.V4.App.FragmentManager fragmentManager, Android.Content.Context context) [0x00031] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\Platform.cs:377 \r\n[MonoDroid]   at Xamarin.Forms.Platform.Android.AppCompat.FragmentContainer.OnCreateView (Android.Views.LayoutInflater inflater, Android.Views.ViewGroup container, Android.OS.Bundle savedInstanceState) [0x00008] in D:\\a\\1\\s\\Xamarin.Forms.Platform.Android\\AppCompat\\FragmentContainer.cs:50 \r\n[MonoDroid]   at Android.Support.V4.App.Fragment.n_OnCreateView_Landroid_view_LayoutInflater_Landroid_view_ViewGroup_Landroid_os_Bundle_ (System.IntPtr jnienv, System.IntPtr native__this, System.IntPtr native_inflater, System.IntPtr native_container, System.IntPtr native_savedInstanceState) [0x00020] in \u003C21e4bb539f4a49b58a498749b367d2a8\u003E:0 \r\n[MonoDroid]   at (wrapper dynamic-method) System.Object.37(intptr,intptr,intptr,intptr,intptr)\r\n\u0060\u0060\u0060",
        "createdAt": "2018-12-18T00:33:09",
        "reactions": []
      },
      {
        "id": 448053274,
        "author": "mattleibow",
        "body": "I had a look and I believe this is not directly related to SkiaSharp, but rather this library, https://github.com/OndrejKunc/SkiaScene, and the TouchTracking NuGet.\r\n\r\nIt appears that on this line, the view is being looked up, but it has been disposed already: \r\nhttps://github.com/OndrejKunc/SkiaScene/blob/b91da87eee1b8d03dce1abea779b68632bcef386/source/TouchTracking/TouchTracking.Droid/TouchHandler.cs#L36\r\n\r\nThe exception goes away when the touch effect is removed - and the effect is on the Grid, not the SKCanvasView.\r\n\r\nI would suggest opening an issue on that repo.",
        "createdAt": "2018-12-18T00:41:53",
        "reactions": []
      },
      {
        "id": 448273527,
        "author": "WillAutioItrax",
        "body": "@mattleibow  Awesome research - I\u0027ll post an issue there with a link to your findings. Thanks!",
        "createdAt": "2018-12-18T16:06:11",
        "reactions": []
      }
    ]
  }
}