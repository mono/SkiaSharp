{
  "number": 2200,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Build issues concerning libSkiaSharp",
  "body": "**Description**\r\nHello folks, thank you for the cool open source software! I am using SkiaSharp inside the game engine Godot for [this](https://github.com/file-acomplaint/GodoTeX). On Windows, it works just wonderful. Now, building the same code on Linux, this exception is raised, sadly without further information:\r\n\r\n\u0060\r\nSystem.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception. ---\u003E System.DllNotFoundException: Unable to load library \u0027libSkiaSharp\u0027.\r\n\u0060\r\n\r\n**Version Information**\r\nThe \u0060.csproj\u0060 is\r\n\r\n\u0060\u0060\u0060xml\r\n\u003CProject Sdk=\u0022Godot.NET.Sdk/3.3.0\u0022\u003E\r\n  \u003CPropertyGroup\u003E\r\n    \u003CTargetFramework\u003Enet472\u003C/TargetFramework\u003E\r\n    \u003CRootNamespace\u003EGodoTeX\u003C/RootNamespace\u003E\r\n  \u003C/PropertyGroup\u003E\r\n\r\n  \u003CItemGroup\u003E    \r\n    \u003CPackageReference Include=\u0022SkiaSharp.NativeAssets.Linux.NoDependencies\u0022 Version=\u00222.88.1-preview.91\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022CSharpMath\u0022 Version=\u00220.5.1\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022CSharpMath.SkiaSharp\u0022 Version=\u00220.5.1\u0022 /\u003E\r\n  \u003C/ItemGroup\u003E\r\n\u003C/Project\u003E\r\n\u0060\u0060\u0060\r\n\r\nI have also tried using version 2.80.4 of SkiaSharp, using SkiaSharp.NativeAssets.Linux, and specifying \u0060\u003CPreferredNativeSkiaSharp\u003E\u0060.\r\n\r\nThe output of  \u0060ldd\u0060 on \u0060bin/Debug/x64/libSkiaSharp.so\u0060 is\r\n\r\n\u0060\u0060\u0060\r\n        linux-vdso.so.1 (0x00007ffd4ced6000)\r\n        libpthread.so.0 =\u003E /usr/lib/libpthread.so.0 (0x00007fb717155000)\r\n        libdl.so.2 =\u003E /usr/lib/libdl.so.2 (0x00007fb717150000)\r\n        libm.so.6 =\u003E /usr/lib/libm.so.6 (0x00007fb716519000)\r\n        libc.so.6 =\u003E /usr/lib/libc.so.6 (0x00007fb716200000)\r\n        /usr/lib64/ld-linux-x86-64.so.2 (0x00007fb71717c000)\r\n\r\n\u0060\u0060\u0060\r\n\r\nThis is running on Arch Linux 5.18.14. I have also tried it on a clean install of Ubuntu, with precisely the same result.\r\n\r\nI would be very grateful for any and all feedback.\r\n",
  "author": {
    "login": "lennart-finke",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "os/Linux",
      "color": "fbca04"
    }
  ],
  "assignees": [],
  "milestone": "v2.88.1",
  "createdAt": "2022-08-06T18:37:36",
  "updatedAt": "2022-09-11T21:01:14",
  "closedAt": "2022-08-12T06:47:23",
  "commentCount": 7,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:49:48.2819601Z",
    "reactions": [],
    "comments": [
      {
        "id": 1211186689,
        "author": "mattleibow",
        "body": "I am not able to repro this: https://github.com/mattleibow/SkiaSharpArchLinux\r\n\r\n\u003E NAME=\u0022Arch Linux\u0022\r\n\u003E PRETTY_NAME=\u0022Arch Linux\u0022\r\n\u003E ID=arch\r\n\u003E BUILD_ID=rolling\r\n\u003E VERSION_ID=TEMPLATE_VERSION_ID\r\n\u003E ANSI_COLOR=\u002238;2;23;147;209\u0022\r\n\u003E HOME_URL=\u0022https://archlinux.org/\u0022\r\n\u003E DOCUMENTATION_URL=\u0022https://wiki.archlinux.org/\u0022\r\n\u003E SUPPORT_URL=\u0022https://bbs.archlinux.org/\u0022\r\n\u003E BUG_REPORT_URL=\u0022https://bugs.archlinux.org/\u0022\r\n\u003E LOGO=archlinux-logo\r\n\u003E \r\n\u003E 5.10.102.1-microsoft-standard-WSL2\r\n\u003E Hello, Bgra8888 World!\r\n\u003E ",
        "createdAt": "2022-08-10T19:41:24",
        "reactions": []
      },
      {
        "id": 1211204846,
        "author": "lennart-finke",
        "body": "Hello and thank you for your time. \r\n\r\nThe URL [https://github.com/mattleibow/SkiaSharpArchLinux](https://github.com/mattleibow/SkiaSharpArchLinux) seems not to lead anywhere at he moment. Perhaps it\u0027s a private repository?\r\n\r\nTo have a blind guess about why this might not reproduce: Maybe it\u0027s something specific to the build instructions bundled with the Godot engine. I wouldn\u0027t know where to look for issues though...",
        "createdAt": "2022-08-10T20:00:01",
        "reactions": []
      },
      {
        "id": 1211699288,
        "author": "mattleibow",
        "body": "Oooh, sorry. I was sure I checked public.\r\n\r\nYeah, the build engine may be excluding the required files?\r\n\r\nCan you maybe link to a repro repo :) so that I can check it out. And the fact that it does not work on Ubuntu which is what my CI uses for linux testing is really showing that the Gadot is doing something fishy... A repro will help.",
        "createdAt": "2022-08-11T08:36:02",
        "reactions": []
      },
      {
        "id": 1211802349,
        "author": "lennart-finke",
        "body": "Great, now I can see it! Hm, the only difference that I could see is the different target framework and that I didn\u0027t include SkiaSharp explicitly. I\u0027ve tried changing both, without effect. \r\n\r\nIf it\u0027s minimal enough, I have prepared [this](https://github.com/file-acomplaint/GodoTeX) for reproducing it now. If opened in Godot Mono, it will show a warning like \u0027couldn\u0027t load add on\u0027, which is OK. Simply clicking on build in Godot should then reproduce the error. (Perhaps reloading the add-on in Project Settings\u003EPlugins is needed) \r\n\r\nI sadly don\u0027t know anything about devops, so I can\u0027t provide something that runs on docker or the like. I also wouldn\u0027t know how to reproduce outside of Godot.\r\n\r\nBut f I should come up with a simpler repo, I can do that!",
        "createdAt": "2022-08-11T10:23:15",
        "reactions": []
      },
      {
        "id": 1212568802,
        "author": "mattleibow",
        "body": "OK, so I found the issue. Thanks for the repro as I used it to find this issue and I never would have been able to find it this fast without it. For some reason, Godot does something and the \u0060c\u0060 (libc) library no longer is the thing I expect. Not sure why, but it is fixable. I fix this in #2213 and I will get this out ASAP.\r\n\r\nThere is a workaround that you can use to override this detection.\r\n\r\nAdd this to a new file:\r\n\r\n\u0060\u0060\u0060cs\r\nstatic class InitSkia\r\n{\r\n\tstatic InitSkia()\r\n\t{\r\n\t\tConsole.WriteLine(\u0022Fixing SkiaSharp...\u0022);\r\n\t\tvar assembly = typeof(SkiaSharp.SkiaSharpVersion).Assembly;\r\n\t\tvar config = assembly.DefinedTypes.FirstOrDefault(t =\u003E t.Name == \u0022PlatformConfiguration\u0022);\r\n\t\tvar overrideProp = config.GetProperty(\u0022LinuxFlavor\u0022);\r\n\t\toverrideProp.SetValue(null, \u0022linux\u0022);\r\n\t\tConsole.WriteLine(\u0022Fixing SkiaSharp complete.\u0022);\r\n\t}\r\n\t\r\n\tpublic static void Init() {}\r\n}\r\n\u0060\u0060\u0060\r\n\r\nAdd this to the code somewhere before the render happens. I added to the beginning of the \u0060Render()\u0060 method, but you can add it anywhere:\r\n\r\n\u0060\u0060\u0060cs\r\nInitSkia.Init();\r\n\u0060\u0060\u0060\r\n\r\nThis workaround overrides the detection with the explicit \u0022linux\u0022 value. Unfortunately, I have to use reflection because I did not yet merge #1856 yet. I forgot about that one :( and will try get it in ASAP as well. Once this is merged you have a much simpler (albeit no longer necessary) way to set the value:\r\n\r\n\u0060\u0060\u0060cs\r\nSkiaSharp.Internals.PlatformConfiguration.LinuxFlavor = \u0022linux\u0022;\r\n\u0060\u0060\u0060\r\n\r\nBut, as I said, #2213 will fix the bug and all this is not necessary.",
        "createdAt": "2022-08-11T22:48:45",
        "reactions": []
      },
      {
        "id": 1212784732,
        "author": "lennart-finke",
        "body": "Oh wonderful, thank you so so much! It works like a charm. I feel indebted to you!",
        "createdAt": "2022-08-12T06:47:23",
        "reactions": []
      },
      {
        "id": 1213437320,
        "author": "mattleibow",
        "body": "I pushed out an update to nuget.org and preview 108 works out hte box and even in the editor :)\r\n\r\nHave fun!",
        "createdAt": "2022-08-12T19:16:02",
        "reactions": []
      }
    ]
  }
}