{
  "number": 2463,
  "type": "issue",
  "state": "open",
  "title": "[QUESTION] How to correctly package SkiaSharp for Installer on Windows VS",
  "body": "I have a WPF app that I added a SkiaSharp control to for high performance drawing. It works great. Runs fine in Visual Studio. It runs fine when I build and open the exe in the build output folder. But when I package an installer and try running the installed application, I get this error:\r\n\r\n\u0060\u0060\u0060\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKAbstractManagedStream\u0027 threw an exception. ---\u003E System.DllNotFoundException: Unable to load library \u0027libSkiaSharp\u0027.\r\n   at SkiaSharp.LibraryLoader.LoadLocalLibrary[T](String libraryName)\r\n   at System.Lazy\u00601.CreateValue()\r\n   at System.Lazy\u00601.LazyInitValue()\r\n   at SkiaSharp.SkiaApi.sk_managedstream_set_procs(SKManagedStreamDelegates procs)\r\n   at SkiaSharp.SKAbstractManagedStream..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at SkiaSharp.SKAbstractManagedStream..ctor(Boolean owns)\r\n   at SkiaSharp.SKManagedStream..ctor(Stream managedStream, Boolean disposeManagedStream)\r\n   at SkiaSharp.SKCodec.WrapManagedStream(Stream stream)\r\n   at SkiaSharp.SKBitmap.Decode(Stream stream)\r\n   at LabMonsterToolkit.SKImageStore.LoadResource(String key, String uri)\r\n   at LabMonsterToolkit.SKImageStore.LoadResources()\r\n   at LabMonsterToolkit.SKImageStore..ctor()\r\n   at LabMonsterToolkit.SKImageStore.GetImageStoreSingle()\r\n   at LabMonsterToolkit.TrainingWindow..ctor(ControllerInterface controllerInterface)\r\n   at LabMonsterToolkit.MainWindow.OpenTrainer(Object sender, RoutedEventArgs e)\r\n   at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)\r\n   at System.Windows.UIElement.RaiseEventImpl(DependencyObject sender, RoutedEventArgs args)\r\n   at System.Windows.Controls.Primitives.ButtonBase.OnClick()\r\n   at System.Windows.Controls.Button.OnClick()\r\n   at System.Windows.Controls.Primitives.ButtonBase.OnMouseLeftButtonUp(MouseButtonEventArgs e)\r\n   at System.Windows.RoutedEventArgs.InvokeHandler(Delegate handler, Object target)\r\n   at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)\r\n   at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)\r\n   at System.Windows.UIElement.ReRaiseEventAs(DependencyObject sender, RoutedEventArgs args, RoutedEvent newEvent)\r\n   at System.Windows.UIElement.OnMouseUpThunk(Object sender, MouseButtonEventArgs e)\r\n   at System.Windows.RoutedEventArgs.InvokeHandler(Delegate handler, Object target)\r\n   at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)\r\n   at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)\r\n   at System.Windows.UIElement.RaiseEventImpl(DependencyObject sender, RoutedEventArgs args)\r\n   at System.Windows.UIElement.RaiseTrustedEvent(RoutedEventArgs args)\r\n   at System.Windows.Input.InputManager.ProcessStagingArea()\r\n   at System.Windows.Input.InputManager.ProcessInput(InputEventArgs input)\r\n   at System.Windows.Input.InputProviderSite.ReportInput(InputReport inputReport)\r\n   at System.Windows.Interop.HwndMouseInputProvider.ReportInput(IntPtr hwnd, InputMode mode, Int32 timestamp, RawMouseActions actions, Int32 x, Int32 y, Int32 wheel)\r\n   at System.Windows.Interop.HwndMouseInputProvider.FilterMessage(IntPtr hwnd, WindowMessage msg, IntPtr wParam, IntPtr lParam, Boolean\u0026 handled)\r\n   at System.Windows.Interop.HwndSource.InputFilterMessage(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean\u0026 handled)\r\n   at MS.Win32.HwndWrapper.WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean\u0026 handled)\r\n   at MS.Win32.HwndSubclass.DispatcherCallbackOperation(Object o)\r\n   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Int32 numArgs)\r\n   at System.Windows.Threading.ExceptionWrapper.TryCatchWhen(Object source, Delegate callback, Object args, Int32 numArgs, Delegate catchHandler)\r\n   at System.Windows.Threading.Dispatcher.LegacyInvokeImpl(DispatcherPriority priority, TimeSpan timeout, Delegate method, Object args, Int32 numArgs)\r\n   at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam)\r\n   at MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG\u0026 msg)\r\n   at System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame)\r\n   at System.Windows.Application.RunDispatcher(Object ignore)\r\n   at System.Windows.Application.RunInternal(Window window)\r\n   at LabMonsterToolkit.App.Main()\r\n\u0060\u0060\u0060\r\n\r\nI\u0027ve been searching trying to determine the source of the issue. I installed Skia vis the NuGet installer for the project. The following dlls are included as dependencies in the installer:\r\n\r\n- SkiaSharp.dll\r\n- SkiaSharp.Views.Desktop.Common.dll\r\n- SkiaSharp.Views.Desktop.dll\r\n- SkiaSharp.Views.Gtk.dll\r\n- SkiaSharp.Views.WindowsForms.dll\r\n- SkiaSharp.Views.WPF.dll\r\n\r\n\r\nI can see the dlls are in the application directory for the installed application. \r\n\r\nThe dlls have the following attributes for the installer:\r\n![DLL config](https://github.com/mono/SkiaSharp/assets/319468/1cdb5447-d853-421a-aebf-713814546b20)\r\n\r\nAny help is appreciated. I put a lot of work rewriting my applicaiton to use SkiaSharp and it works great. Hitting this roadblock is very frustrating. \r\n\r\n\r\nEdit: When building the installer I found I have these error messages: \r\nWARNING: Unable to find dependency \u0027GLIB-SHARP\u0027 (Signature=\u002735E10195DAB3C99F\u0027 Version=\u00272.12.0.0\u0027) of assembly \u0027SkiaSharp.Views.Gtk.dll\u0027\r\nWARNING: Unable to find dependency \u0027GTK-SHARP\u0027 (Signature=\u002735E10195DAB3C99F\u0027 Version=\u00272.12.0.0\u0027) of assembly \u0027SkiaSharp.Views.Gtk.dll\u0027\r\nWARNING: Unable to find dependency \u0027GDK-SHARP\u0027 (Signature=\u002735E10195DAB3C99F\u0027 Version=\u00272.12.0.0\u0027) of assembly \u0027SkiaSharp.Views.Gtk.dll\u0027\r\n\r\nLooking into them further.\r\n",
  "author": {
    "login": "erebuswolf",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2023-05-17T23:23:14",
  "updatedAt": "2023-06-21T03:21:40",
  "commentCount": 5,
  "reactionCount": 0
}