{
  "number": 302,
  "type": "issue",
  "state": "closed",
  "title": "SIGSEGV while executing native code",
  "body": "I have a Xamarin Forms shared project and want to use SkiaSharp in XAML. \r\n\r\nMy MainPage.xaml looks like this:\r\n\r\n\u003C?xml version=\u00221.0\u0022 encoding=\u0022utf-8\u0022 ?\u003E\r\n\u003CContentPage xmlns=\u0022http://xamarin.com/schemas/2014/forms\u0022\r\n             xmlns:x=\u0022http://schemas.microsoft.com/winfx/2009/xaml\u0022\r\n             xmlns:local=\u0022clr-namespace:MyAppProto\u0022\r\n             xmlns:forms=\u0022clr-namespace:SkiaSharp.Views.Forms;assembly=SkiaSharp.Views.Forms\u0022\r\n             x:Class=\u0022MyApp.MainPage\u0022\u003E\r\n\r\n    \u003CGrid\u003E\r\n        \u003Cforms:SKCanvasView x:Name=\u0022canvas\u0022 PaintSurface=\u0022OnPaintSample\u0022 HorizontalOptions=\u0022FillAndExpand\u0022\r\n                            VerticalOptions=\u0022FillAndExpand\u0022 \u003E\r\n            \u003Cforms:SKCanvasView.GestureRecognizers\u003E\r\n                \u003CTapGestureRecognizer Tapped=\u0022TapGestureRecognizer_OnTapped\u0022 NumberOfTapsRequired=\u00221\u0022 /\u003E\r\n            \u003C/forms:SKCanvasView.GestureRecognizers\u003E\r\n        \u003C/forms:SKCanvasView\u003E\r\n    \u003C/Grid\u003E\r\n\u003C/ContentPage\u003E\r\n\r\nMy MainPage.xaml.cs file looks like this:\r\n\r\n\tpublic partial class MainPage : ContentPage\r\n\t{\r\n\t    private const int GridRows = 5;\r\n\t    private const int GridCols = 5;\r\n\t    private const float RectStrokeWidth = 2;\r\n\r\n\t    private readonly List\u003CSKRect\u003E _grid = new List\u003CSKRect\u003E();\r\n\t    private SKSurface _surface;\r\n\r\n\t\tpublic MainPage()\r\n\t\t{\r\n\t\t\tInitializeComponent();\r\n\t\t}\r\n\r\n\t    private void OnPaintSample(object sender, SKPaintSurfaceEventArgs e)\r\n\t    {\r\n\t        // Get surface info\r\n\t        var surfaceWidth = e.Info.Width;\r\n\t        var surfaceHeight = e.Info.Height;\r\n\r\n\t        // Get canvas\r\n\t        _surface = e.Surface;\r\n\t        var side = Math.Min(surfaceHeight, surfaceWidth);\r\n\r\n\t        var paint = new SKPaint();\r\n\t        // Set background\r\n\t        _surface.Canvas.Clear(Color.Black.ToSKColor());\r\n\r\n\t        // Set rect parameters\r\n\t        paint.Color = Color.Yellow.ToSKColor();\r\n\t        paint.IsStroke = true;\r\n\t        paint.StrokeWidth = RectStrokeWidth;\r\n\r\n\t        // Set rect\u0027s with and height\r\n\t        var rectHeight = side / (float) GridRows - RectStrokeWidth * 2;\r\n\t        var rectWidth = side / (float) GridCols - RectStrokeWidth * 2;\r\n\r\n\t        // Draw rects\r\n\t        for (var i = 0; i \u003C GridRows; i\u002B\u002B)\r\n\t        {\r\n\t            for (var j = 0; j \u003C GridCols; j\u002B\u002B)\r\n\t            {\r\n\t                var r1 = new SKRect(rectWidth * j, rectHeight * i, rectWidth * j \u002B rectWidth,\r\n\t                    rectHeight * i \u002B rectHeight);\r\n\t                _grid.Add(r1);\r\n\t                _surface.Canvas.DrawRect(r1, paint);\r\n\t            }\r\n\t        }\r\n\r\n\t    }\r\n          private void TapGestureRecognizer_OnTapped(object sender, EventArgs e)\r\n\t      {\r\n\t        var props = _surface.SurfaceProps;\r\n\t      }\r\n\t}\r\n\r\nIf I tap on the surface and the _TapGestureRecognizer_OnTapped_ event is fired, the app terminates. It seems that I cannot preserve the SKSurface object during application lifetime. Every time I access the object\u0027s properties from somewhere else than the _OnPaintSample_ event, the app crashes.\r\n\r\nHere is the stack trace of the exception that is raised:\r\n\r\n\u003E 05-25 15:40:34.540 D/Mono    ( 8096): DllImport searching in: \u0027libSkiaSharp.so\u0027 (\u0027libSkiaSharp.so\u0027).\r\n\u003E 05-25 15:40:34.540 D/Mono    ( 8096): Searching for \u0027sk_surface_get_props\u0027.\r\n\u003E 05-25 15:40:34.540 D/Mono    ( 8096): Probing \u0027sk_surface_get_props\u0027.\r\n\u003E 05-25 15:40:34.540 D/Mono    ( 8096): Found as \u0027sk_surface_get_props\u0027.\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096): Stacktrace:\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096): \r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at (wrapper managed-to-native) SkiaSharp.SkiaApi.sk_surface_get_props (intptr,SkiaSharp.SKSurfaceProps\u0026) \u003C0x00012\u003E\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at SkiaSharp.SKSurface.get_SurfaceProps () [0x00008] in \u003C8e4c06e066264a27bdda5f7ce87d3a90\u003E:0\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at (wrapper runtime-invoke) \u003CModule\u003E.runtime_invoke_SKSurfaceProps__this__ (object,intptr,intptr,intptr) [0x00020] in \u003C8e4c06e066264a27bdda5f7ce87d3a90\u003E:0\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at MyApp.MainPage.TapGestureRecognizer_OnTapped (object,System.EventArgs) [0x00001] in F:\\UnderDev\\Dev\\MyApp\\MyApp\\MainPage.xaml.cs:115\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at Xamarin.Forms.TapGestureRecognizer.SendTapped (Xamarin.Forms.View) [0x0002e] in C:\\BuildAgent3\\work\\ca3766cfc22354a1\\Xamarin.Forms.Core\\TapGestureRecognizer.cs:46\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at Xamarin.Forms.Platform.Android.TapGestureHandler.OnTap (int) [0x00028] in C:\\BuildAgent3\\work\\ca3766cfc22354a1\\Xamarin.Forms.Platform.Android\\TapGestureHandler.cs:36\r\n\u003E 05-25 15:40:34.540 E/mono-rt ( 8096):   at Xamarin.Forms.Platform.Android.InnerGestureListener.Android.Views.GestureDetector.IOnGestureListener.OnSingleTapUp (Android.Views.MotionEvent) [0x0001c] in C:\\BuildAgent3\\work\\ca3766cfc22354a1\\Xamarin.Forms.Platform.Android\\InnerGestureListener.cs:125\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Android.Views.GestureDetector/IOnGestureListenerInvoker.n_OnSingleTapUp_Landroid_view_MotionEvent_ (intptr,intptr,intptr) [0x00011] in \u003C33e6e739ac344166b157e323586f11a1\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper dynamic-method) object.36d9ca42-c7d7-440f-ae89-3846e8be25a2 (intptr,intptr,intptr) [0x00017] in \u003Cd18287e1d683419a8ec3216fd78947b9\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper native-to-managed) object.36d9ca42-c7d7-440f-ae89-3846e8be25a2 (intptr,intptr,intptr) [0x00023] in \u003Cd18287e1d683419a8ec3216fd78947b9\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper managed-to-native) Java.Interop.NativeMethods.java_interop_jnienv_call_boolean_method_a (intptr,intptr\u0026,intptr,intptr,Java.Interop.JniArgumentValue*) \u003C0x00012\u003E\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Java.Interop.JniEnvironment/InstanceMethods.CallBooleanMethod (Java.Interop.JniObjectReference,Java.Interop.JniMethodInfo,Java.Interop.JniArgumentValue*) [0x00054] in \u003C5716a943049b49ca928a3a1c8d2386f4\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Java.Interop.JniPeerMembers/JniInstanceMethods.InvokeVirtualBooleanMethod (string,Java.Interop.IJavaPeerable,Java.Interop.JniArgumentValue*) [0x0002c] in \u003C5716a943049b49ca928a3a1c8d2386f4\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Android.Views.GestureDetector.OnTouchEvent (Android.Views.MotionEvent) [0x00038] in \u003C33e6e739ac344166b157e323586f11a1\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Xamarin.Forms.Platform.Android.VisualElementRenderer\u00601\u003CTElement_REF\u003E.Android.Views.View.IOnTouchListener.OnTouch (Android.Views.View,Android.Views.MotionEvent) [0x0007c] in C:\\BuildAgent3\\work\\ca3766cfc22354a1\\Xamarin.Forms.Platform.Android\\VisualElementRenderer.cs:115\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Android.Views.View/IOnTouchListenerInvoker.n_OnTouch_Landroid_view_View_Landroid_view_MotionEvent_ (intptr,intptr,intptr,intptr) [0x0001a] in \u003C33e6e739ac344166b157e323586f11a1\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper dynamic-method) object.620578d7-374a-4f1b-9067-0573d938a7f6 (intptr,intptr,intptr,intptr) [0x0001d] in \u003Cd18287e1d683419a8ec3216fd78947b9\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper native-to-managed) object.620578d7-374a-4f1b-9067-0573d938a7f6 (intptr,intptr,intptr,intptr) [0x00024] in \u003Cd18287e1d683419a8ec3216fd78947b9\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper managed-to-native) Java.Interop.NativeMethods.java_interop_jnienv_call_nonvirtual_boolean_method_a (intptr,intptr\u0026,intptr,intptr,intptr,Java.Interop.JniArgumentValue*) \u003C0x00012\u003E\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Java.Interop.JniEnvironment/InstanceMethods.CallNonvirtualBooleanMethod (Java.Interop.JniObjectReference,Java.Interop.JniObjectReference,Java.Interop.JniMethodInfo,Java.Interop.JniArgumentValue*) [0x00074] in \u003C5716a943049b49ca928a3a1c8d2386f4\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Java.Interop.JniPeerMembers/JniInstanceMethods.InvokeVirtualBooleanMethod (string,Java.Interop.IJavaPeerable,Java.Interop.JniArgumentValue*) [0x0005f] in \u003C5716a943049b49ca928a3a1c8d2386f4\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Android.Views.View.DispatchTouchEvent (Android.Views.MotionEvent) [0x00038] in \u003C33e6e739ac344166b157e323586f11a1\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Xamarin.Forms.Platform.Android.PlatformRenderer.DispatchTouchEvent (Android.Views.MotionEvent) [0x0004e] in C:\\BuildAgent3\\work\\ca3766cfc22354a1\\Xamarin.Forms.Platform.Android\\PlatformRenderer.cs:35\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at Android.Views.View.n_DispatchTouchEvent_Landroid_view_MotionEvent_ (intptr,intptr,intptr) [0x00011] in \u003C33e6e739ac344166b157e323586f11a1\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper dynamic-method) object.d9314838-4c5f-4368-a3d0-8ab1f1d4e7a7 (intptr,intptr,intptr) [0x00017] in \u003Cd18287e1d683419a8ec3216fd78947b9\u003E:0\r\n\u003E 05-25 15:40:34.544 E/mono-rt ( 8096):   at (wrapper native-to-managed) object.d9314838-4c5f-4368-a3d0-8ab1f1d4e7a7 (intptr,intptr,intptr) [0x00023] in \u003Cd18287e1d683419a8ec3216fd78947b9\u003E:0",
  "author": {
    "login": "ahilsing",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2017-05-25T13:56:59",
  "updatedAt": "2022-08-19T21:01:51",
  "closedAt": "2017-05-26T16:41:29",
  "commentCount": 4,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:37:35.6979608Z",
    "reactions": [],
    "comments": [
      {
        "id": 304017670,
        "author": "ahilsing",
        "createdAt": "2017-05-25T14:02:40",
        "reactions": []
      },
      {
        "id": 304140517,
        "author": "mattleibow",
        "createdAt": "2017-05-25T22:22:09",
        "reactions": []
      },
      {
        "id": 304230933,
        "author": "ahilsing",
        "createdAt": "2017-05-26T09:03:05",
        "reactions": []
      },
      {
        "id": 304330537,
        "author": "mattleibow",
        "createdAt": "2017-05-26T16:41:28",
        "reactions": []
      }
    ]
  }
}