{
  "number": 3155,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] GRGlInterface.Create() returns null on Windows on Arm",
  "body": "### Description\n\nI am developing on Arm64 on Windows 11, using the latest version of SkiaSharp. The app is a .NET Framework 4.8 application. We use OpenGL for GPU rendering. \n\nCalling:\nGRGlInterface.Create()\n\nreturns null\n\nThe same code on x64 works correctly.\n\nI have the OpenCL\u2122, OpenGL\u00AE, and Vulkan\u00AE Compatibility Pack installed. https://apps.microsoft.com/detail/9nqpsl29bfff?hl=en-us\u0026gl=US, so would I expect this to work.\n\n### Code\n\nusing (var glInterface = GRGlInterface.Create())\n    _grContext = GRContext.CreateGl(glInterface);\n\nThis is how we get the OpenGL context. On Arm64 glInterface ends up being null which results in a null context as well.\n\n### Expected Behavior\n\nWe expect that OpenGL would work on Arm64 just as it does on x64 with that compatibility pack installed\n\n### Actual Behavior\n\nNull is returned\n\n### Version of SkiaSharp\n\n3.116.0 (Current)\n\n### Last Known Good Version of SkiaSharp\n\nNo known good versions\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\nWindows 11 2H24\nArm64\n.NET Framework 4.8\nOpenCL\u2122, OpenGL\u00AE, and Vulkan\u00AE Compatibility Pack\n\n### Devices\n\nLenovo Yoga Slim 7x\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\n\n\u0060\u0060\u0060\n\n### Code of Conduct\n\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "peternoyes",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2025-02-04T16:54:36",
  "updatedAt": "2025-03-24T17:01:29",
  "closedAt": "2025-03-07T16:59:59",
  "commentCount": 5,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T12:45:44.5100964Z",
    "reactions": [],
    "comments": [
      {
        "id": 2707108117,
        "author": "mattleibow",
        "body": "**EDIT**\n\nThe \u0060SKGLControl\u0060 (Windows Forms) just works. So it must be the WPF \u002B GL \u002B DX issues. I did see this issue: https://github.com/opentk/GLWpfControl/issues/136\n\nI am running Windows in Parallels on my M1, so it may just be that.\n\n**ORIGINAL**\n\nMy PR fixes the direct issue with the creation of the GL context for drawing. However, this does not mean the GL views suddenly start working.\n\nI am currently using this on WPF:\n\n\u0060\u0060\u0060\nvar ctrl = new GLWpfControl();\nContent = ctrl;\nctrl.Start(new()\n{\n    MajorVersion = 2,\n    MinorVersion = 1,\n    RenderContinuously = false\n});\n\u0060\u0060\u0060\n\nBut I get an error:\n\n\u0060\u0060\u0060\nFatal error. 0xC0000005\n   at OpenTK.Graphics.Wgl.Wgl.DXOpenDeviceNV(IntPtr)\n   at OpenTK.Wpf.DxGlContext..ctor(OpenTK.Wpf.GLWpfControlSettings)\n   at OpenTK.Wpf.GLWpfControlRenderer..ctor(OpenTK.Wpf.GLWpfControlSettings)\n   at OpenTK.Wpf.GLWpfControl.Start(OpenTK.Wpf.GLWpfControlSettings)\n   at MauiApp1.MainWindow..ctor()\n   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean, Boolean)\n   at System.RuntimeType.CreateInstanceImpl(System.Reflection.BindingFlags, System.Reflection.Binder, System.Object[], System.Globalization.CultureInfo)\n   at MS.Internal.Xaml.Runtime.ClrObjectRuntime.CreateInstance(System.Xaml.XamlType, System.Object[])\n   at System.Xaml.XamlObjectWriter.Logic_CreateAndAssignToParentStart(MS.Internal.Xaml.Context.ObjectWriterContext)\n   at System.Xaml.XamlObjectWriter.WriteStartMember(System.Xaml.XamlMember)\n   at System.Windows.Markup.WpfXamlLoader.TransformNodes(System.Xaml.XamlReader, System.Xaml.XamlObjectWriter, Boolean, Boolean, Boolean, System.Xaml.IXamlLineInfo, System.Xaml.IXamlLineInfoConsumer, MS.Internal.Xaml.Context.XamlContextStack\u00601\u003CSystem.Windows.Markup.WpfXamlFrame\u003E, System.Windows.Markup.IStyleConnector)\n   at System.Windows.Markup.WpfXamlLoader.Load(System.Xaml.XamlReader, System.Xaml.IXamlObjectWriterFactory, Boolean, System.Object, System.Xaml.XamlObjectWriterSettings, System.Uri)\n   at System.Windows.Markup.WpfXamlLoader.LoadBaml(System.Xaml.XamlReader, Boolean, System.Object, System.Xaml.Permissions.XamlAccessLevel, System.Uri)\n   at System.Windows.Markup.XamlReader.LoadBaml(System.IO.Stream, System.Windows.Markup.ParserContext, System.Object, Boolean)\n   at System.Windows.Application.LoadBamlStreamWithSyncInfo(System.IO.Stream, System.Windows.Markup.ParserContext)\n   at System.Windows.Application.DoStartup()\n   at System.Windows.Application.\u003C.ctor\u003Eb__1_0(System.Object)\n   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(System.Delegate, System.Object, Int32)\n   at System.Windows.Threading.ExceptionWrapper.TryCatchWhen(System.Object, System.Delegate, System.Object, Int32, System.Delegate)\n   at System.Windows.Threading.DispatcherOperation.InvokeImpl()\n   at MS.Internal.CulturePreservingExecutionContext.CallbackWrapper(System.Object)\n   at System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\n   at MS.Internal.CulturePreservingExecutionContext.Run(MS.Internal.CulturePreservingExecutionContext, System.Threading.ContextCallback, System.Object)\n   at System.Windows.Threading.DispatcherOperation.Invoke()\n   at System.Windows.Threading.Dispatcher.ProcessQueue()\n   at System.Windows.Threading.Dispatcher.WndProcHook(IntPtr, Int32, IntPtr, IntPtr, Boolean ByRef)\n   at MS.Win32.HwndWrapper.WndProc(IntPtr, Int32, IntPtr, IntPtr, Boolean ByRef)\n   at MS.Win32.HwndSubclass.DispatcherCallbackOperation(System.Object)\n   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(System.Delegate, System.Object, Int32)\n   at System.Windows.Threading.ExceptionWrapper.TryCatchWhen(System.Object, System.Delegate, System.Object, Int32, System.Delegate)\n   at System.Windows.Threading.Dispatcher.LegacyInvokeImpl(System.Windows.Threading.DispatcherPriority, System.TimeSpan, System.Delegate, System.Object, Int32)\n   at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr, Int32, IntPtr, IntPtr)\n   at MS.Win32.UnsafeNativeMethods.DispatchMessage(System.Windows.Interop.MSG ByRef)\n   at MS.Win32.UnsafeNativeMethods.DispatchMessage(System.Windows.Interop.MSG ByRef)\n   at System.Windows.Threading.Dispatcher.PushFrameImpl(System.Windows.Threading.DispatcherFrame)\n   at System.Windows.Application.RunDispatcher(System.Object)\n   at System.Windows.Application.RunInternal(System.Windows.Window)\n   at TheTestApp.App.Main()\n\u0060\u0060\u0060",
        "createdAt": "2025-03-07T18:20:19",
        "reactions": []
      },
      {
        "id": 2707124867,
        "author": "mattleibow",
        "body": "You do need to build your own \u0060glfw\u0060 as the OpenTK packages do not have it for ARM. This comes from https://github.com/glfw/glfw\n\nI built mine locally:\n\n\u0060\u0060\u0060cmd\ncmake -B build-win32-shared-arm64 -G \u0022Visual Studio 17 2022\u0022 -A arm64 -D BUILD_SHARED_LIBS=ON -D GLFW_BUILD_EXAMPLES=OFF -D GLFW_BUILD_TESTS=OFF -D GLFW_BUILD_DOCS=OFF\ncmake --build build-win32-shared-arm64 --parallel\n\u0060\u0060\u0060\n\nThen I copied the \u0060glfw3.dll\u0060 file from \u0060glfw\\build-win32-shared-arm64\\src\\Debug\\glfw3.dll\u0060 into my app.\n\nYou could also ty using vcpkg and build \u0060glfw3\u0060.\n\nI also am attaching the binaries I built here just for quick reference (use at own risk): [glfw3.zip](https://github.com/user-attachments/files/19131815/glfw3.zip)",
        "createdAt": "2025-03-07T18:29:49",
        "reactions": []
      },
      {
        "id": 2711938554,
        "author": "peternoyes",
        "body": "@mattleibow Thanks for doing this!\n\nI have never build SkiaSharp from source. I noticed your changes are C\u002B\u002B, so does that mean I need to compile native code as well?\n\nAny sense on when this would make it into a release?\n\nThanks!",
        "createdAt": "2025-03-10T21:57:27",
        "reactions": []
      },
      {
        "id": 2712862029,
        "author": "mattleibow",
        "body": "It should be on the preview feed https://aka.ms/skiasharp-eap/index.json\n\nIf you are able to test and confirm things are working, then I can release a preview soon. ",
        "createdAt": "2025-03-11T06:49:54",
        "reactions": []
      },
      {
        "id": 2748818909,
        "author": "peternoyes",
        "body": "@mattleibow Great news! We were able to test and confirm that things are working with your change. Getting this into a release would be amazing for us!",
        "createdAt": "2025-03-24T17:01:28",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "heart",
            "createdAt": "2026-02-06T12:45:44.4607735Z"
          }
        ]
      }
    ]
  }
}