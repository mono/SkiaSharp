{
  "number": 1218,
  "type": "issue",
  "state": "closed",
  "title": "[FEATURE] Expose SkSL?",
  "body": "It seems the SkSL has a public API, and had GPU and CPU backends. \r\n\r\nAlthough Google says it is likely to change a bit since it is under active development.\r\n\r\nSince back in the days even good old Silverlight had such a feature, I think it would make sense to expose it in SkiaSharp.\r\n\r\nIf so, I would be happy to make a PR.\r\n",
  "author": {
    "login": "ziriax",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2020-04-08T08:20:11",
  "updatedAt": "2024-05-31T16:17:49",
  "closedAt": "2024-05-31T16:17:27",
  "commentCount": 18,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T12:54:01.9056315Z",
    "reactions": [],
    "comments": [
      {
        "id": 610836708,
        "author": "Gillibald",
        "body": "I don\u0027t think that this will be useful because you need to compile shaders alongside Skia itself. If it would be possible to compile shaders at runtime this would be a killer feature. ",
        "createdAt": "2020-04-08T08:51:58",
        "reactions": []
      },
      {
        "id": 610838663,
        "author": "mattleibow",
        "body": "I _think_ I saw a demo where the shader was just a string... So maybe? I have been keeping an eye on that and I think a runtime compilation might actually be something. I\u0027ll have a closer look... ",
        "createdAt": "2020-04-08T08:56:09",
        "reactions": []
      },
      {
        "id": 610845625,
        "author": "ziriax",
        "body": "According to the reply I got from Google in Skia discuss, it now has an interpreter and JIT...\r\n\r\nIn the CanvasKit fiddle you just pass a string:\r\nhttps://jsfiddle.skia.org/canvaskit/33ff9bed883cd5742b4770169da0b36fb0cbc18fd395ddd9563213e178362d30\r\n\r\nBut that one is running on the GPU, so not a good reference...\r\n\r\nI will ask more questions in Skia discuss, but if you have to precompile shaders, it is indeed limited.\r\n\r\nWe could of course write a backend for SkSL that generates SIMD ILASM ;-) \r\n\r\n",
        "createdAt": "2020-04-08T09:11:30",
        "reactions": [
          {
            "user": "Gillibald",
            "content": "hooray",
            "createdAt": "2026-02-06T12:53:58.8014948Z"
          },
          {
            "user": "kekekeks",
            "content": "hooray",
            "createdAt": "2026-02-06T12:53:58.8014953Z"
          },
          {
            "user": "mattleibow",
            "content": "hooray",
            "createdAt": "2026-02-06T12:53:58.8014954Z"
          }
        ]
      },
      {
        "id": 610925717,
        "author": "mattleibow",
        "body": "Keep up the discussion there! Then I can see what needs to be done to make it work well in SkiaSharp ",
        "createdAt": "2020-04-08T12:20:16",
        "reactions": []
      },
      {
        "id": 610927199,
        "author": "mattleibow",
        "body": "For those following along at home https://groups.google.com/forum/#!topic/skia-discuss/LNCQs-7b7rk ",
        "createdAt": "2020-04-08T12:23:42",
        "reactions": []
      },
      {
        "id": 610927340,
        "author": "mattleibow",
        "body": "I think it was @kekekeks was asking about this in the past? ",
        "createdAt": "2020-04-08T12:24:03",
        "reactions": []
      },
      {
        "id": 610931652,
        "author": "Gillibald",
        "body": "Y being able to compile shaders at runtime would allow us to introduce custom effects. ",
        "createdAt": "2020-04-08T12:32:54",
        "reactions": []
      },
      {
        "id": 610937140,
        "author": "kekekeks",
        "body": "Our idea was to provide GLSL text and a pointer to software implementation func. Proper SkSL with JIT on the Skia side would be indeed way better.",
        "createdAt": "2020-04-08T12:44:28",
        "reactions": []
      },
      {
        "id": 611019081,
        "author": "ziriax",
        "body": "My feeling from following the discussion in the skia mailing list, is that the CPU implementation is currently a bit behind the GPU one. \r\n\r\nMy customer\u0027s current server side renderer uses DirectX 11 WARP, a purely software implementation of DirectX 11, so it seems Skia is not yet at that level, but its catching up ([in 2008, WARP could run Crysis on a Core i7!](https://techreport.com/news/15968/core-i7-beats-intel-igp-in-directx-10-software-rasterizer/))\r\n\r\nNevertheless I think that most users will use the GPU for rendering with Skia, and then exposing SkSL might be a really nice feature?\r\n\r\nIt seems one just needs to expose the \u0060SkRuntimeShader\u0060 class, with some small helper structs. To pass data, \u0060Span\u003Cbyte\u003E\u0060 could be used. Of course a much higher level interface could be provided, using .NET marshalling to provide the values of the uniforms, like SharpDX does.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
        "createdAt": "2020-04-08T15:16:49",
        "reactions": []
      },
      {
        "id": 611035951,
        "author": "mattleibow",
        "body": "Having a look right now. going to get a very simple thing working and see what happens. I should be working on actual issues, but COVID-19, right?",
        "createdAt": "2020-04-08T15:46:14",
        "reactions": [
          {
            "user": "ziriax",
            "content": "laugh",
            "createdAt": "2026-02-06T12:54:00.1854171Z"
          }
        ]
      },
      {
        "id": 611038328,
        "author": "Gillibald",
        "body": "That\u0027s the positive side of the Corona crisis. Some people have more time to spend on things they love.",
        "createdAt": "2020-04-08T15:50:25",
        "reactions": []
      },
      {
        "id": 611254658,
        "author": "mattleibow",
        "body": "Good news folks! Things seem to be working!!! At least on Windows x64. Just tweaking the bindings and adding a few tests and then I\u0027ll push a branch for folks to play around with. Seems all we need is a string and we are off to the races!",
        "createdAt": "2020-04-09T00:02:33",
        "reactions": [
          {
            "user": "daltonks",
            "content": "hooray",
            "createdAt": "2026-02-06T12:54:00.6069342Z"
          },
          {
            "user": "Gillibald",
            "content": "hooray",
            "createdAt": "2026-02-06T12:54:00.6069347Z"
          },
          {
            "user": "davidvmckay",
            "content": "hooray",
            "createdAt": "2026-02-06T12:54:00.6069348Z"
          },
          {
            "user": "h82258652",
            "content": "hooray",
            "createdAt": "2026-02-06T12:54:00.6069349Z"
          }
        ]
      },
      {
        "id": 611259790,
        "author": "ziriax",
        "body": "That is great news! So you couldn\u0027t resist, hehe, I know the feeling ;-)\r\n\r\nI guess in the longer term we will need some methods to transfer/marshal uniform data and SkShader instances to the runtime shader?\r\n\r\n\r\n",
        "createdAt": "2020-04-09T00:21:09",
        "reactions": []
      },
      {
        "id": 611266322,
        "author": "mattleibow",
        "body": "Hehe, no I couldn\u0027t. We might be able to do something with a \u0022dictionary\u0022 type of thing for the inputs. There is some iterable object.\r\nThe tests have a possible starting point: https://github.com/google/skia/blob/5f6b41e6d8aa1ead3cbdb94a483bc8bea32e0fb3/tests/SkRuntimeEffectTest.cpp#L74-L90",
        "createdAt": "2020-04-09T00:45:20",
        "reactions": []
      },
      {
        "id": 611267777,
        "author": "mattleibow",
        "body": "I have the code here for now (https://github.com/mono/SkiaSharp/pull/1221).\r\nThe GPU bits seem to work - 1 simple test. The CPU needs some compiler options but I think the GPU is fine for basic testing and experimentation. I need to do actual work now...\r\n\r\nOverall, this looks both simple and powerful. Let me know what you think. Looks cool so far.",
        "createdAt": "2020-04-09T00:50:59",
        "reactions": []
      },
      {
        "id": 639688481,
        "author": "mattleibow",
        "body": "Moved the code and changes to a new PR which is much better and I hope to get a working GPU package out: #1321",
        "createdAt": "2020-06-05T18:25:18",
        "reactions": []
      },
      {
        "id": 640530897,
        "author": "mattleibow",
        "body": "I have been doing some work on this... Let me know what you think: https://github.com/mono/SkiaSharp/issues/1319#issuecomment-640529824",
        "createdAt": "2020-06-08T10:56:30",
        "reactions": []
      },
      {
        "id": 2142590682,
        "author": "mattleibow",
        "body": "This has been implemented and 3.x of SkiaSharp now has full support.",
        "createdAt": "2024-05-31T16:17:48",
        "reactions": []
      }
    ]
  }
}