{
  "number": 1845,
  "type": "issue",
  "state": "open",
  "title": "[QUESTION] SVG not showing up after upgrade to Android 11 / API 30",
  "body": "Good day,\r\n\r\nWe have been using SkiaSharp to render SVG icons as part of our tabbed page icons for quite some time.  I recently changed the targeted sdk to 30 from 29, and the icons do not render any longer.  I have tried to update to the latest versions of SkiaSharp, but that didn\u0027t help.  \r\n\r\nhere is the code we use to load/draw the svg\r\n\r\n\u0060\u0060\u0060\r\nusing System;\r\nusing System.IO;\r\nusing System.Reflection;\r\nusing System.Collections.Generic;\r\nusing SkiaSharp;\r\nusing SkiaSharp.Views.Forms;\r\nusing Xamarin.Forms;\r\n\r\nnamespace TemptaleApp.Extensions\r\n{\r\n    public class TabSvgIcon : SKCanvasView\r\n\t{\r\n\t\tSkiaSharp.Extended.Svg.SKSvg svg;\r\n\r\n\t\tstatic Assembly mainPclAssembly;\r\n\r\n\t\tpublic static Assembly MainPclAssembly\r\n\t\t{\r\n\t\t\tget\r\n\t\t\t{\r\n\t\t\t\tif (mainPclAssembly == null)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (Application.Current == null)\r\n\t\t\t\t\t\tthrow new InvalidOperationException();\r\n\t\t\t\t\tmainPclAssembly = Application.Current.GetType().GetTypeInfo().Assembly;\r\n\t\t\t\t}\r\n\t\t\t\treturn mainPclAssembly;\r\n\t\t\t}\r\n\t\t\tset\r\n\t\t\t{\r\n\t\t\t\tmainPclAssembly = value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/// \u003Csummary\u003E\r\n\t\t/// Cache for SVG icons. Each SVG is kept in memory only once even if it\u0027s used multple places in application.\r\n\t\t/// \u003C/summary\u003E\r\n\t\tstatic readonly IDictionary\u003Cstring, SkiaSharp.Extended.Svg.SKSvg\u003E SvgCache = new Dictionary\u003Cstring, SkiaSharp.Extended.Svg.SKSvg\u003E();\r\n\r\n\t\t/// \u003Csummary\u003E\r\n\t\t/// Global prefix for resource ids. Enabled writing cleaner XAML.\r\n\t\t/// \u003C/summary\u003E\r\n\t\tpublic static string ResourceIdsPrefix { get; set; } = string.Empty;\r\n\r\n\t\t#region Bindable properties\r\n\r\n\t\tpublic static readonly BindableProperty ResourceIdProperty = BindableProperty.Create(nameof(ResourceId), typeof(string), typeof(SvgIcon), default(string));\r\n\t\tpublic string ResourceId\r\n\t\t{\r\n\t\t\tget { return (string)GetValue(ResourceIdProperty); }\r\n\t\t\tset { SetValue(ResourceIdProperty, value); }\r\n\t\t}\r\n\r\n\t\tpublic static readonly BindableProperty SelectedResourceIdProperty = BindableProperty.Create(nameof(SelectedResourceId), typeof(string), typeof(SvgIcon), default(string));\r\n\t\tpublic string SelectedResourceId\r\n\t\t{\r\n\t\t\tget { return (string)GetValue(SelectedResourceIdProperty); }\r\n\t\t\tset {\r\n\t\t\t\tSetValue(SelectedResourceIdProperty, value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic static readonly BindableProperty SelectedTabValueProperty = BindableProperty.Create(nameof(SelectedTabValue), typeof(String), typeof(SvgIcon), default(string));\r\n\t\tpublic string SelectedTabValue\r\n\t\t{\r\n\t\t\tget { return (string)GetValue(SelectedTabValueProperty); }\r\n\t\t\tset {\r\n\r\n\t\t\t\tSetValue(SelectedTabValueProperty, value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic string TabValue\r\n\t\t{\r\n\t\t\tget;\r\n\t\t\tset;\r\n\t\t}\r\n\r\n\t\tpublic static readonly BindableProperty ColorProperty = BindableProperty.Create(nameof(Color), typeof(Color), typeof(SvgIcon), Color.Black);\r\n\t\tpublic Color Color\r\n\t\t{\r\n\t\t\tget { return (Color)GetValue(ColorProperty); }\r\n\t\t\tset { SetValue(ColorProperty, value); }\r\n\t\t}\r\n\r\n\t\t#endregion\r\n\r\n\t\tvoid LoadSvgImage()\r\n\t\t{\r\n\t\t\tvar loadResourceId = (TabValue.Equals(SelectedTabValue) ? SelectedResourceId : ResourceId);\r\n\r\n\t\t\tif (svg != null \u0026\u0026 loadResourceId == null)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!SvgCache.TryGetValue(loadResourceId, out svg))\r\n\t\t\t{\r\n\t\t\t\tstring fullKey = $\u0022{ResourceIdsPrefix}{loadResourceId}\u0022;\r\n\t\t\t\tusing (Stream stream = MainPclAssembly.GetManifestResourceStream(fullKey))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (stream == null)\r\n\t\t\t\t\t\tthrow new FileNotFoundException($\u0022SvgIcon : could not load SVG file {fullKey} in assembly {MainPclAssembly}. Make sure the ID is correct, the file is there and it is set to Embedded Resource build action.\u0022);\r\n\t\t\t\t\tsvg = new SkiaSharp.Extended.Svg.SKSvg();\r\n\t\t\t\t\tsvg.Load(stream);\r\n\t\t\t\t\tSvgCache.Add(loadResourceId, svg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprotected override void OnPaintSurface(SKPaintSurfaceEventArgs e)\r\n\t\t{\r\n\t\t\tbase.OnPaintSurface(e);\r\n\t\t\te.Surface.Canvas.Clear();\r\n\r\n\t\t\tLoadSvgImage();\r\n\t\t\tvar matrix = CalculateScale(e.Info);\r\n\r\n\t\t\tusing (var paint = new SKPaint())\r\n\t\t\t{\r\n\t\t\t\t// Unlike CreateLighting(), blend mode support alpha channel of the color\r\n\t\t\t\tpaint.ColorFilter = SKColorFilter.CreateBlendMode(Color.ToSKColor(), SKBlendMode.SrcIn);\r\n\t\t\t\te.Surface.Canvas.DrawPicture(svg.Picture, ref matrix, paint);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tSKMatrix CalculateScale(SKImageInfo info)\r\n\t\t{\r\n\t\t\tfloat canvasMin = Math.Min(info.Width, info.Height);\r\n\t\t\tfloat svgMax = Math.Max(svg.Picture.CullRect.Width, svg.Picture.CullRect.Height);\r\n\t\t\tfloat scale = canvasMin / svgMax;\r\n\t\t\treturn SKMatrix.MakeScale(scale, scale);\r\n\t\t}\r\n\r\n\t\tprotected override void OnPropertyChanged(string propertyName = null)\r\n\t\t{\r\n\t\t\tbase.OnPropertyChanged(propertyName);\r\n\r\n\t\t\tif (propertyName == ResourceIdProperty.PropertyName)\r\n\t\t\t\tsvg = null;\r\n\r\n\t\t\tif (propertyName == ResourceIdProperty.PropertyName\r\n\t\t\t || propertyName == ColorProperty.PropertyName)\r\n\t\t\t\tInvalidateSurface();\r\n\t\t}\r\n\t}\r\n}\r\n\u0060\u0060\u0060\r\n\r\nAny thoughts or guidance would be greatly appreciated",
  "author": {
    "login": "andysousa",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2021-10-29T03:13:01",
  "updatedAt": "2023-05-22T11:39:35",
  "commentCount": 1,
  "reactionCount": 2,
  "engagement": {
    "syncedAt": "2026-02-04T20:27:35.3745585Z",
    "reactions": [
      {
        "user": "Freezor",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:27:35.3745646Z"
      },
      {
        "user": "MaxFelinger",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:27:35.3745652Z"
      }
    ],
    "comments": [
      {
        "id": 1557064216,
        "author": "charlesroddie",
        "createdAt": "2023-05-22T11:39:35",
        "reactions": []
      }
    ]
  }
}