{
  "number": 2536,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Shadders with SkiaSharp.Views.WPF Dont Work",
  "body": "**Description**\r\n\r\n\u003C!-- a general description goes here --\u003E\r\nCalling a Drawing function while  using an SKPAINT brings up an System.Runtime.InteropServices.SEHException and  of course ends the program. My code is based off an example I found someone in this repro (Im not super used to graphics API but I really need shadders for my next project and WPF\u0027s shadders are really hard to work when it comes to my low level projects) . Also I am using SkiaSharp.Views.WPF so that I can easlily use SkiSharp with WPF . That might be related to the problem but there wasn\u0027t much xaml code to begin with\r\n\r\n**Code**\r\n\u0060\u0060\u0060cs\r\n        private void AUView_PaintSurface(object sender, SkiaSharp.Views.Desktop.SKPaintSurfaceEventArgs e)\r\n        {\r\n            //SkiaSharp.SKRuntimeEffect\r\n            // Your SkiaSharp drawing code here\r\n            using (SKCanvas canvas = e.Surface.Canvas)\r\n            {\r\n\r\n                // input values\r\n                float threshold = 1.05f;\r\n                float exponent = 1.5f;\r\n\r\n                // image source\r\n                 var blueShirt = SKImage.FromEncodedData(@\u0022D:\\Images\\PogYouMan\\PogYouMan.png\u0022);\r\n                 var textureShader = blueShirt.ToShader();\r\n\r\n                // shader\r\n                var src = @\u0022\r\nuniform shader color_map;\r\nuniform float scale;\r\nuniform half exp;\r\nuniform float3 in_colors0;\r\nhalf4 main(float2 p) {\r\n    half4 texColor = sample(color_map, p);\r\n    if (length(abs(in_colors0 - pow(texColor.rgb, half3(exp)))) \u003C scale)\r\n        discard;\r\n    return texColor;\r\n}\u0022;\r\n                var effect = SKRuntimeEffect.Create(src, out var errorText);\r\n\r\n                // input values\r\n                var uniforms = new SKRuntimeEffectUniforms(effect)\r\n                {\r\n                    [\u0022scale\u0022] = threshold,\r\n                    [\u0022exp\u0022] = exponent,\r\n                    [\u0022in_colors0\u0022] = new[] { 1f, 1f, 1f },\r\n                };\r\n\r\n                // shader values\r\n                var children = new SKRuntimeEffectChildren(effect)\r\n                {\r\n                    [\u0022color_map\u0022] = textureShader\r\n                };\r\n\r\n                // create actual shader\r\n                var shader = effect.ToShader(true, uniforms, children);\r\n\r\n                // draw as normal\r\n                canvas.Clear(SKColors.Black);\r\n                var paint = new SKPaint { Shader = shader };\r\n                canvas.DrawRect(SKRect.Create(400, 400), paint);\r\n            }\r\n        }\r\n\u0060\u0060\u0060\r\n**XAML**\r\n\u0060\u0060\u0060xaml\r\n    \u003CWindow x:Class=\u0022SkiSharpTest.MainWindow\u0022\r\n        xmlns=\u0022http://schemas.microsoft.com/winfx/2006/xaml/presentation\u0022\r\n        xmlns:x=\u0022http://schemas.microsoft.com/winfx/2006/xaml\u0022\r\n        xmlns:d=\u0022http://schemas.microsoft.com/expression/blend/2008\u0022\r\n        xmlns:mc=\u0022http://schemas.openxmlformats.org/markup-compatibility/2006\u0022\r\n        xmlns:skia=\u0022clr-namespace:SkiaSharp.Views.WPF;assembly=SkiaSharp.Views.WPF\u0022\r\n        xmlns:local=\u0022clr-namespace:SkiSharpTest\u0022\r\n        mc:Ignorable=\u0022d\u0022\r\n        Title=\u0022MainWindow\u0022 Height=\u0022450\u0022 Width=\u0022800\u0022\u003E\r\n    \u003CGrid\u003E\r\n        \u003Cskia:SKElement  Width=\u0022100\u0022 Height=\u0022100\u0022 Name=\u0022AUView\u0022 PaintSurface=\u0022AUView_PaintSurface\u0022/\u003E\r\n    \u003C/Grid\u003E\r\n\u003C/Window\u003E\r\n\u0060\u0060\u0060\r\n\r\n\u003C!-- a snippet of code that demonstrates the issue --\u003E\r\n(I get the exception on the canvas.DrawRect line)\r\n**Expected Behavior**\r\n\r\n\u003C!-- a general description of what was the expected behavior or result --\u003E\r\n\r\n**Actual Behavior**\r\n\r\n\u003C!-- a general description of what really happened --\u003E\r\n?\r\n**Basic Information**\r\n\r\n- Version with issue:  \u003C!-- the version of SkiaSharp that has the issue --\u003E\r\n- Last known good version:  \u003C!-- the version of SkiaSharp that still working --\u003E\r\n- IDE:  \u003C!-- Visual Studio / Visual Studio for Mac / MonoDevelop / Visual Studio Code --\u003E\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - Android: \u003C!-- the version of the Android SDK you are compiling against, e.g. 7.1 --\u003E \r\n  - iOS:  \u003C!-- the version of the iOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - Linux:  \u003C!-- The version and distro of linux that you are building for, e.g. Ubuntu 16.04 --\u003E\r\n  - macOS:  \u003C!-- The version of macOS you are building for, e.g. 10.10 --\u003E\r\n  - Tizen:  \u003C!-- the version of the Tizen SDK you are compiling against, e.g. 4.0 --\u003E \r\n  - tvOS:  \u003C!-- the version of the tvOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - UWP:  \u003C!-- the version of the UWP SDK you are compiling against, e.g. 16299 --\u003E \r\n  - watchOS:  \u003C!-- the version of the watchOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - Windows Classic:  \u003C!-- the version of Windows you are building for, e.g. Windows 7 --\u003E\r\n- Target Devices:   \u003C!-- the devices that you noticed this on, e.g. iPhone X --\u003E\r\n  - \u003C!-- Google Pixel 4 XL --\u003E\r\n  - \u003C!-- iPhone 11 --\u003E\r\n  Windows 10\r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nPASTE ANY DETAILED VERSION INFO HERE\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n**Reproduction Link**\r\n\r\n\u003C!-- please upload or provide a link to a reproduction case --\u003E\r\n\r\n",
  "author": {
    "login": "Kuumba123",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2023-07-26T11:25:37",
  "updatedAt": "2023-08-31T03:00:29",
  "closedAt": "2023-07-31T16:35:46",
  "commentCount": 3,
  "reactionCount": 0
}