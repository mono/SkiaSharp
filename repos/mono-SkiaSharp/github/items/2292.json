{
  "number": 2292,
  "type": "issue",
  "state": "open",
  "title": "The application throws \u0027MissingMethodException\u0027 or \u0027ExecutionEngineException\u0027 or refuses to be built at all with message \u0027Native linking failed\u0027",
  "body": "_This issue has been moved from [a ticket on Developer Community](https://developercommunity.visualstudio.com/t/The-application-throws-MissingMethodExc/1376338)._\n\n---\n[severity:I\u0027m unable to use this version] [regression] [worked-in:8.8.7 (build 18)]\r\n**There is an archive with a source code of an application in an attachment. With the source you can reproduce the problem.**\n\nSee the file:\n[sample to_reproduce_the_problem.zip] (https://aka.ms/dc/file?name=B095f1463822d4774b8efa402f07d63c8637517621700632533_sample_to_reproduce_the_problem.zip\u0026tid=095f1463822d4774b8efa402f07d63c8637517621700632533)\n\nSince Visual Studio for Mac 8.9.1 (build 34) was released there is a problem with an extension method \u0027DrawShapedText\u0027 for a canvas in our iOS project.\nThere was no such problem in previous versions of Visual Studio for Mac.\nThis problematical method is located in a nuget package named \u0027SkiaSharp.HarfBuzz\u0027.\n\nLook here:\n[https://github.com/mono/SkiaSharp/blob/main/source/SkiaSharp.HarfBuzz/SkiaSharp.HarfBuzz.Shared/CanvasExtensions.cs] (CanvasExtensions.cs)\n\n**Since Visual Studio for Mac 8.9.1 (build 34) was released our application built on it and later versions has started to crash.**\n\n**( 1 )** If you build the app on an iPhone (in my case it\u0027s iPhone 6s), it crashes with an exception:\n\n\u0060\u0060\u0060\nSystem.ExecutionEngineException: Attempting to JIT compile method \u0027void SkiaSharp.HarfBuzz.CanvasExtensions:DrawShapedText (SkiaSharp.SKCanvas,SkiaSharp.HarfBuzz.SKShaper,string,single,single,SkiaSharp.SKPaint)\u0027 while running in aot-only mode. See https://docs.microsoft.com/xamarin/ios/internals/limitations for more information.\n\u0060\u0060\u0060\n.\nLinker behavior: Link SDK assemblies only\n\n**( 2 )** But if you build the app on an iPhone Simulator (in my case it\u0027s \u0022iPhone 12 Pro Max - 14.4\u0022), then it crashes with an exception:\n\u0060\u0060\u0060\n{System.MissingMethodException: Method not found: System.Span\u00601 SkiaSharp.SKRunBuffer.GetGlyphSpan()\n  at ILive.iOS.Views.Debugging.TimelineDebugView.CanvasView_PaintSurface (System.Object sender, SkiaSharp.Views.iOS.SKPaintSurfaceEventArgs evArgs) [0x00123] in /Users/Neocriss/Documents/iLive.Mobile/ILive/ILive.iOS/Views/Debugging/TimelineDebugView.cs:66 \n  at SkiaSharp.Views.iOS.SKCanvasView.OnPaintSurface (SkiaSharp.Views.iOS.SKPaintSurfaceEventArgs e) [0x0000a] in :0 \n  at SkiaSharp.Views.iOS.SKCanvasView.Draw (CoreGraphics.CGRect rect) [0x00064] in :0 \n  at (wrapper managed-to-native) UIKit.UIApplication.UIApplicationMain(int,string[],intptr,intptr)\n  at UIKit.UIApplication.Main (System.String[] args, System.IntPtr principal, System.IntPtr delegate) [0x00005] in /Users/builder/azdo/_work/1/s/xamarin-macios/src/UIKit/UIApplication.cs:86 \n  at UIKit.UIApplication.Main (System.String[] args, System.String principalClassName, System.String delegateClassName) [0x0000e] in /Users/builder/azdo/_work/1/s/xamarin-macios/src/UIKit/UIApplication.cs:65 \n  at ILive.iOS.Application.Main (System.String[] args) [0x00002] in /Users/Neocriss/Documents/iLive.Mobile/ILive/ILive.iOS/Application.cs:14 }\n\tbase: {System.MissingMemberException}\n\tMessage: \u0022Method not found: System.Span\u00601 SkiaSharp.SKRunBuffer.GetGlyphSpan()\u0022\n\u0060\u0060\u0060\n\n.\nThis \u0027GetGlyphSpan\u0027 method is located in the \u0027DrawShapedText\u0027 method in the \u0027SkiaSharp.HarfBuzz\u0027 nuget package.\n\nLinker behavior: Don\u0027t Link\n\n**( 3 )** But after I prepared the solution to pass it to you (removed all the source code from it except for the problem area), the first case changed its behavior.\n\nNow I can\u0027t build the app at all if I build it on an iPhone.\n\nBecause I get an error:\n\u0060\u0060\u0060\n/Users/Neocriss/Documents/iLive.Mobile/ILive/ILive.iOS/MTOUCH:\nError MT5216: Native linking failed for \u0027/Users/Neocriss/Documents/iLive.Mobile/ILive/ILive.iOS/obj/iPhone/Debug/device-builds/iphone8.1-14.4/mtouch-cache/arm64/libSkiaSharp.dll.dylib\u0027.\nPlease file a bug report at https://github.com/xamarin/xamarin-macios/issues/new (MT5216) (ILive.iOS)\n\u0060\u0060\u0060\n\n.\n--- --- --- --- --- --- --- --- --- --- --- ---\n\n**Steps to Reproduce:**\n\n1. Get Visual Studio for Mac 8.9.1 (build 34) or any later version of it\n2. Select \u0027ILive.iOS\u0027 as startup project\n3. Build the provided solution to an iPhone Simulator and run it\n4. The application will be stopped at the breakpoint on line 65 in \u0027TimelineDebugView.cs\u0027\n5. Let your app execution to continue\n6. The application will be stopped at the breakpoint on line 19 in \u0027Application.cs\u0027\n7. See results\n\n--- --- --- --- --- --- --- --- --- --- --- ---\n\n.\n=== Visual Studio Community 2019 for Mac ===\n\nVersion 8.9.2 (build 0)\nInstallation UUID: b703f1d2-4dd2-475a-9a4e-a54b6672b1e5\n\tGTK\u002B 2.24.23 (Raleigh theme)\n\tXamarin.Mac 6.18.0.23 (d16-6 / 088c73638)\n\nPackage version: 612000125\n\n=== Mono Framework MDK ===\n\nRuntime:\n\tMono 6.12.0.125 (2020-02/8c552e98bd6) (64-bit)\n\tPackage version: 612000125\n\n=== Roslyn (Language Service) ===\n\n3.9.0-6.21152.10\u002Bc10f884b30737542ddd84ca889a4aad9281ce210\n\n=== NuGet ===\n\nVersion: 5.8.0.6860\n\n=== .NET Core SDK ===\n\nSDK: /usr/local/share/dotnet/sdk/5.0.201/Sdks\nSDK Versions:\n\t5.0.201\n\t5.0.103\n\t5.0.102\n\t5.0.101\n\t5.0.100\n\t3.1.407\n\t3.1.406\n\t3.1.405\n\t3.1.404\n\t3.1.403\n\t3.1.402\n\t3.1.401\n\t3.1.302\n\t3.1.301\n\t3.1.300\n\t3.1.202\n\t3.1.200\n\t3.1.102\n\t3.1.101\n\t3.1.100\n\t3.0.101\n\t3.0.100\n\t2.2.207\n\t2.1.701\n\t2.1.700\n\t2.1.505\n\t2.1.504\n\t2.1.503\n\t2.1.302\n\t2.1.4\nMSBuild SDKs: /Applications/Visual Studio.app/Contents/Resources/lib/monodevelop/bin/MSBuild/Current/bin/Sdks\n\n=== .NET Core Runtime ===\n\nRuntime: /usr/local/share/dotnet/dotnet\nRuntime Versions:\n\t5.0.4\n\t5.0.3\n\t5.0.2\n\t5.0.1\n\t5.0.0\n\t3.1.13\n\t3.1.12\n\t3.1.11\n\t3.1.10\n\t3.1.9\n\t3.1.8\n\t3.1.7\n\t3.1.6\n\t3.1.5\n\t3.1.4\n\t3.1.2\n\t3.1.1\n\t3.1.0\n\t3.0.1\n\t3.0.0\n\t2.2.8\n\t2.1.23\n\t2.1.22\n\t2.1.21\n\t2.1.20\n\t2.1.19\n\t2.1.18\n\t2.1.17\n\t2.1.16\n\t2.1.15\n\t2.1.14\n\t2.1.13\n\t2.1.12\n\t2.1.11\n\t2.1.9\n\t2.1.8\n\t2.1.7\n\t2.1.2\n\t2.0.5\n\n=== .NET Core 3.1 SDK ===\n\nSDK: 3.1.407\n\n=== Xamarin.Profiler ===\n\nVersion: 1.6.15.68\nLocation: /Applications/Xamarin Profiler.app/Contents/MacOS/Xamarin Profiler\n\n=== Updater ===\n\nVersion: 11\n\n=== Apple Developer Tools ===\n\nXcode 12.4 (17801)\nBuild 12D4e\n\n=== Xamarin.Mac ===\n\nVersion: 7.8.2.5 (Visual Studio Community)\nHash: 3836759d4\nBranch: d16-9\nBuild date: 2021-02-10 17:56:43-0500\n\n=== Xamarin.iOS ===\n\nVersion: 14.14.2.5 (Visual Studio Community)\nHash: 3836759d4\nBranch: d16-9\nBuild date: 2021-02-10 17:56:44-0500\n\n=== Xamarin Designer ===\n\nVersion: 16.9.0.316\nHash: 2241b204a\nBranch: tags/vsm-rel/d16.9-4540908\nBuild date: 2021-03-10 22:18:10 UTC\n\n=== Xamarin.Android ===\n\nVersion: 11.2.2.1 (Visual Studio Community)\nCommit: xamarin-android/d16-9/877f572\nAndroid SDK: /Users/Neocriss/Library/Developer/Xamarin/android-sdk-macosx\n\tSupported Android versions:\n\t\t7.0 (API level 24)\n\t\t7.1 (API level 25)\n\t\t8.0 (API level 26)\n\t\t8.1 (API level 27)\n\nSDK Tools Version: 26.1.1\nSDK Platform Tools Version: 31.0.0\nSDK Build Tools Version: 30.0.2\n\nBuild Information: \nMono: 5e9cb6d\nJava.Interop: xamarin/java.interop/d16-9@54f8c24\nProGuard: Guardsquare/proguard/v7.0.1@912d149\nSQLite: xamarin/sqlite/3.34.1@daff8f4\nXamarin.Android Tools: xamarin/xamarin-android-tools/d16-9@d210f11\n\n=== Microsoft OpenJDK for Mobile ===\n\nJava SDK: /Users/Neocriss/Library/Developer/Xamarin/jdk/microsoft_dist_openjdk_1.8.0.25\n1.8.0-25\nAndroid Designer EPL code available here:\nhttps://github.com/xamarin/AndroidDesigner.EPL\n\n=== Android SDK Manager ===\n\nVersion: 16.9.0.22\nHash: a391de2\nBranch: remotes/origin/d16-9\nBuild date: 2021-03-05 19:52:30 UTC\n\n=== Android Device Manager ===\n\nVersion: 16.9.0.17\nHash: fc2b3db\nBranch: remotes/origin/d16-9\nBuild date: 2021-03-05 19:52:54 UTC\n\n=== Build Information ===\n\nRelease ID: 809020000\nGit revision: a69906fb0095d046b113a63419c9af3034ce104e\nBuild date: 2021-03-11 14:01:37-05\nBuild branch: release-8.9\nXamarin extensions: a69906fb0095d046b113a63419c9af3034ce104e\n\n=== Operating System ===\n\nMac OS X 10.15.7\nDarwin 19.6.0 Darwin Kernel Version 19.6.0\n    Tue Jan 12 22:13:05 PST 2021\n    root:xnu-6153.141.16~1/RELEASE_X86_64 x86_64\n\n=== Enabled user installed extensions ===\n\nDeepClean 1.2.5\n.NET Core support for Mono.Debugging 8.0.5\nFileNesting 0.1.2\nOpen With 0.2\nMSBuild Editor 2.4.0\nCSharp Interactive 0.1\nMvvmCross Template pack 2.1.0\n\n---\n### Original Comments\n\n#### Feedback Bot on 3/21/2021, 07:13 PM: \n\n(private comment, text removed)\n#### Feedback Bot on 3/21/2021, 10:30 PM: \n\n(private comment, text removed)\n#### neminush on 5/24/2021, 07:09 AM: \n\n(private comment, text removed)\n#### neminush on 5/26/2021, 07:49 AM: \n\n(private comment, text removed)\n\n---\n### Original Solutions\n(no solutions)",
  "author": {
    "login": "vsfeedback",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-10-25T01:30:14",
  "updatedAt": "2022-10-25T01:30:14",
  "commentCount": 0,
  "reactionCount": 0
}