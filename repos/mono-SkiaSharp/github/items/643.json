{
  "number": 643,
  "type": "issue",
  "state": "closed",
  "title": "SKTypeface.FromFamilyName returns null",
  "body": "My app uses the Avalonia library to show UIs on ARM devices. Avalonia internally uses SkiaSharp. I have a strange behavior on the Raspian system where SKTypeface.FromFamilyName returns null if one passes a font family name that does not exist.\r\nThe authors of Avalonia say it is expected to return the default font of the system. Unfortunately this unexpected null crashes the application during the application startup.\r\n\r\nAny idea what is going wrong here?\r\nIs this an issue with SkiaSharp, Skia or the specific operating system?\r\n\r\nI use a self built libSkiaSharp 1.60.3 with .NET Core 2.1 on Raspian 9.4\r\n",
  "author": {
    "login": "nicolasr75",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2018-09-27T11:56:41",
  "updatedAt": "2022-08-19T15:01:27",
  "closedAt": "2018-09-28T20:55:14",
  "commentCount": 4,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:04:34.6325326Z",
    "reactions": [],
    "comments": [
      {
        "id": 425064925,
        "author": "nicolasr75",
        "body": "I should add the following:\r\n\r\nthe Avalonia guys asked me to run the following line on Raspian\r\n\r\n    var typeface = SKTypeface.FromFamilyName(FontFamily.Default.Name);\r\n\r\nFontFamily.Default.Name is hardcoded in Avalonia as Courier New.\r\nOn Raspian this call returns the Liberation Mono font. But the same\r\ncall with \u0022Ubuntu\u0022 as the name returns null (The Ubuntu font does not\r\nexist on Raspian).\r\n",
        "createdAt": "2018-09-27T12:03:03",
        "reactions": []
      },
      {
        "id": 425474665,
        "author": "mattleibow",
        "body": "Hmm. I believe the Rasbian build should be using the fontconfig font manager, so I had a look and noticed this:\r\nhttps://github.com/google/skia/blob/chrome/m68/src/ports/SkFontMgr_fontconfig.cpp#L894\r\n\r\nBasically, if there is a problem matching the style it will return \u0060nullptr\u0060. This is not good, but appears to be the case.\r\n\r\nHowever, there is hope: it appears that if you pass \u0060null\u0060 as the name, then it will find something:\r\nhttps://github.com/google/skia/blob/chrome/m60/src/core/SkTypeface.cpp#L119\r\n\r\nSo, as a fix, you can do something like this:\r\n\r\n\u0060\u0060\u0060csharp\r\nvar typeface = SKTypeface.FromFamilyName(FontFamily.Default.Name) ?? SKTypeface.FromFamilyName(null);\r\n\u0060\u0060\u0060\r\n\r\nIn the coming release, I will expose the \u0060SKTypeface.CreateDefault()\u0060 method that will _never_ return \u0060null\u0060.",
        "createdAt": "2018-09-28T15:33:05",
        "reactions": []
      },
      {
        "id": 425488881,
        "author": "nicolasr75",
        "body": "Thanks for the analysis!",
        "createdAt": "2018-09-28T16:19:20",
        "reactions": []
      },
      {
        "id": 425520601,
        "author": "mattleibow",
        "body": "I am closing this as I believe there was never a promise that these methods would not return null.",
        "createdAt": "2018-09-28T18:08:28",
        "reactions": [
          {
            "user": "nicolasr75",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:04:34.5823057Z"
          }
        ]
      }
    ]
  }
}