{
  "number": 2923,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] .Net MAUI SKCanvasView memory leak on IOS",
  "body": "### Description\n\nIf you place SKCanvasView on Page it cause a memory leak. \r\n\n\n### Code\n\nI create a simple app wich reproduce this leak https://github.com/nevse/maui-tests-SKCanvasViewLeak\r\n\r\nStep to reproduce:\r\n1. Click button \u0022Open Page\u0022\r\n2. Navigate back from page with SKCanvasView\r\n3. Click button \u0022Check Memory Leak\u0022\r\n\r\nI use such code to detect memory leak:\r\n\u0060\u0060\u0060cs\r\nWeakReference pageRef;\r\nvoid OnOpenPage(object sender, EventArgs e)\r\n{\r\n    var page = new SKCanvasViewPage();\r\n    Navigation.PushAsync(page);\r\n    pageRef = new WeakReference(page);\r\n}\r\nvoid OnCheckMemoryLeak(object sender, EventArgs e)\r\n{\r\n    GC.Collect();\r\n    GC.WaitForPendingFinalizers();\r\n    GC.Collect();\r\n    if (pageRef != null \u0026\u0026 pageRef.IsAlive)\r\n    {\r\n        DisplayAlert(\u0022Memory Leak\u0022, \u0022Memory Leak Detected\u0022, \u0022OK\u0022);\r\n    }\r\n    else\r\n    {\r\n        DisplayAlert(\u0022Memory Leak\u0022, \u0022No Memory Leak Detected\u0022, \u0022OK\u0022);\r\n    }\r\n}\r\n\u0060\u0060\u0060\n\n### Expected Behavior\n\n_No response_\n\n### Actual Behavior\n\n_No response_\n\n### Version of SkiaSharp\n\n2.88.3 (Current)\n\n### Last Known Good Version of SkiaSharp\n\nOther (Please indicate in the description)\n\n### IDE / Editor\n\nVisual Studio Code (macOS)\n\n### Platform / Operating System\n\niOS\n\n### Platform / Operating System Version\n\n_No response_\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "nevse",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2024-07-04T12:42:44",
  "updatedAt": "2024-07-26T08:14:50",
  "closedAt": "2024-07-26T08:14:50",
  "commentCount": 5,
  "reactionCount": 2,
  "engagement": {
    "syncedAt": "2026-02-06T13:35:27.036034Z",
    "reactions": [
      {
        "user": "AlexGoOn",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:35:27.0360408Z"
      },
      {
        "user": "janne-hmp",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:35:27.0360416Z"
      }
    ],
    "comments": [
      {
        "id": 2222186170,
        "author": "AlexGoOn",
        "body": "Some DevExpress components have a memory leak due to this issue, which prevents the entire page from being released. This problem is affecting many of our customers. @mattleibow, could you please take a look at this when you have a chance?",
        "createdAt": "2024-07-11T07:02:21",
        "reactions": [
          {
            "user": "janne-hmp",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:35:26.1569253Z"
          }
        ]
      },
      {
        "id": 2233677319,
        "author": "janne-hmp",
        "body": "@mattleibow @davidortinau I think this should be critically prioritized, since you can\u0027t use SkiaSharp with .NET MAUI on iOS seriously. I think my memory corruption problem mentioned in #2840 maybe because of the same or related issue.",
        "createdAt": "2024-07-17T16:05:03",
        "reactions": []
      },
      {
        "id": 2240129975,
        "author": "janne-hmp",
        "body": "I just made a test app (see #2951) that confirms this by crashing my iPad by trying to open and close the same page 500 times. It crashes after opening the page c. 145th time.",
        "createdAt": "2024-07-19T21:17:53",
        "reactions": []
      },
      {
        "id": 2241469669,
        "author": "mattleibow",
        "body": "I think I know what is happening. After all our work to fix leaks in Maui itself, it appears that an event on the platform view to the handler keeps everything.\n\nThe platform view event keeps the handler alive, the handler keeps the Xaml view alive and the xaml view keeps the parent alive. The virtual view also keeps the handler alive and the handler keeps the platform view. So basically a big web of survival. \n\nHowever, there has also been a fix in Maui to break the virtual view and it\u0027s parent: https://github.com/dotnet/maui/pull/22561\n\nWe just have to do something like this: https://github.com/dotnet/maui/pull/18682\n\nThanks to the hard work of @jonathanpeppers \u2764\uFE0F",
        "createdAt": "2024-07-21T05:01:27",
        "reactions": [
          {
            "user": "janne-hmp",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:35:26.7854292Z"
          }
        ]
      },
      {
        "id": 2243175225,
        "author": "jonathanpeppers",
        "body": "If some \u0060SKSomethingView\u0060 has a circular reference, I don\u0027t think https://github.com/dotnet/maui/pull/22561 will fix it.\r\n\r\nDo you have any on-device tests, can you write one like:\r\n\r\n* https://github.com/dotnet/maui/blob/9251b38bd58921df21ebcf67d84a539e39b74d5c/src/Controls/tests/DeviceTests/Memory/MemoryTests.cs#L166\r\n\r\nAnd then, the solution would be to fix some of the warnings this analyzer catches:\r\n\r\n* https://github.com/jonathanpeppers/memory-analyzers",
        "createdAt": "2024-07-22T14:59:45",
        "reactions": [
          {
            "user": "janne-hmp",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:35:26.985446Z"
          }
        ]
      }
    ]
  }
}