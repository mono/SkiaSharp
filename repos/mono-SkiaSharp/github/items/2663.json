{
  "number": 2663,
  "type": "issue",
  "state": "open",
  "title": "SKSL does not allow SamplingOption Mode \u0022Linear\u0022 for Interpolation",
  "body": "### Description\r\n\r\nI\u0027ve got SKSL working well, except for that I can\u0027t seem to find a way to make SKSL \u0027sample(shader, uvCoord)\u0027 to \u0027interpolate\u0027.\r\n\r\nFrom the Skia online docs, they advertise a method for creating the child effects, for sampling another surface, like this:\r\n\r\n\u0060\u0060\u0060\u0060C\u002B\u002B\r\nsk_sp\u003CSkShader\u003E imageShader = image-\u003EmakeShader(SkSamplingOptions(SkFilterMode::kLinear));\r\n\u0060\u0060\u0060\u0060\r\n\r\nBut SkiaSharp 2.88.xx, doesn\u0027t expose \u0027SKFilterMode\u0027 nor \u0027SKSamplingOptions\u0027 types/members.\r\n\r\nTherefore, it looks like \u0027sample\u0027 in the SKSL always just does \u0027GetNearest (pixel)\u0027 producing a very blocky effect, without any interpolation.\r\n\r\n**Is SkiaSharp 3.0, going to expose this functionality?  If so, then I\u0027ll switch to the alpha now, and give it a try.**\r\n\r\n\r\n### Code\r\n\r\nJust to do the job of what should have been a \u0022single Sample\u0022 if the sampler with \u0022LinearMode\u0022 turned on, instead of \u0022closestPixel\u0022.\r\n\r\nHere\u0027s what our code WOULD LOOK LIKE, if we could turn on LinearMode for sampling:\r\n\u0060\u0060\u0060C#\r\nfloat3 elem = sample(elev_map, cf).xyz; // DONE!!  one line of code!\r\n\u0060\u0060\u0060\r\n\r\n**But** since we\u0027re stuck with \u0022ClosestPixel\u0022 sampling, our code instead looks like this:\r\n\u0060\u0060\u0060C#\r\nfloat2 fc;\r\nfloat fcxi = cf.x;   // raw fragCoord.x\r\nfloat fcyi = cf.y;   // raw fragCoord.y\r\nfloat fcxi0 = floor(fcxi);\r\nfloat fcyi0 = floor(fcyi);\r\n\r\n// These are \u0027lerps\u0027.\r\nfloat lpX = fcxi - fcxi0;\r\nfloat lpY = fcyi - fcyi0;\r\nfloat iLpX = 1.0 - lpX;\r\nfloat iLpY = 1.0 - lpY;\r\n\r\nfloat fcx0 = fcxi0;\r\nfloat fcy0 = fcyi0;\r\nfc = (float2(MinUV \u002B fcx0, MinUV \u002B fcy0));\r\nfloat3 el00 = sample(elev_map, fc).xyz; // top left pixel\r\nfc.x \u002B= 1;\r\nfloat3 el10 = sample(elev_map, fc).xyz; // top right pixel\r\nfc.y \u002B= 1;\r\nfloat3 el11 = sample(elev_map, fc).xyz; // bottom Right pixel\r\nfc.x -= 1;\r\nfloat3 el01 = sample(elev_map, fc).xyz; // bottom Left pixel\r\n\r\n// Now combine the 4 samples with lerp math applied (straight linear blending)\r\nelevNorm = (el00 * iLpX * iLpY) \u002B (el10 * lpX * iLpY) \u002B (el01 * iLpX * lpY) \u002B (el11 * lpX * lpY);\r\n\u0060\u0060\u0060\r\n\r\nNEXT -- we have to do this for TWO input textures.... so we\u0027re doing a whole lot more code/work to get something very simple done.\r\n\r\nIt would be AWESOME if we could have a fix for this ASAP, rather than wait for 3.0.0, which is still in alpha.\r\n\r\n### Expected Behavior\r\n\r\nI\u0027d really like to see SKSL \u0027sample\u0027 method allow \u0027interpolation\u0027 rather than just doing \u0027GetNearest(pixel)\u0027, which produces a blocky effect for us.\r\n\r\n### Actual Behavior\r\n\r\nNo option for telling SKSL to \u0027interpolate\u0027 when sampling another surface.\r\n\r\n### Version of SkiaSharp\r\n\r\n2.88.3 (Current)\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### IDE / Editor\r\n\r\nVisual Studio (Windows)\r\n\r\n### Platform / Operating System\r\n\r\nWindows\r\n\r\n### Platform / Operating System Version\r\n\r\n_No response_\r\n\r\n### Devices\r\n\r\n_No response_\r\n\r\n### Relevant Screenshots\r\n\r\nHere\u0027s the the blocky \u0022Relief shading\u0022 for our App:\r\n\r\n![image](https://github.com/mono/SkiaSharp/assets/10914515/83dddc9d-380c-4214-9e81-a48ee146e997)\r\n\r\n\r\nHere\u0027s a view of the same data, and equivalent OpenGL shader, but using interpolation:\r\n(this is what we want to achieve with SKSL)\r\n![image](https://github.com/mono/SkiaSharp/assets/10914515/a45cfd28-1d98-4e11-9d83-30986b4ea50b)\r\n\r\n**This 2nd snapshot also shows \u0022contour lines\u0022 achieved with \u0027fwidth\u0027 function in OpenGL, which we also hope is supported by SkiaSharp 3.x.**\r\n\r\n\r\nNote -- here\u0027s the result now of a simple Image Blit, using a single sample (Nearest Pixel mode):\r\n![image](https://github.com/mono/SkiaSharp/assets/10914515/3b8146a6-f6d8-4ac3-8866-b77c44ba4678)\r\n\r\nHere\u0027s what this should look like instead:\r\n![image](https://github.com/mono/SkiaSharp/assets/10914515/50039075-7bf9-448c-9c70-c9b85c719cec)\r\n\r\n\r\n### Relevant Log Output\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "najak3d",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2023-10-31T11:41:56",
  "updatedAt": "2024-03-12T11:23:59",
  "commentCount": 2,
  "reactionCount": 0
}