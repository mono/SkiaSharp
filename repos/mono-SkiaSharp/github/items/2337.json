{
  "number": 2337,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SKGLView Render thread (DrawInBackground=true) stops when UWP app runs for a long time (\u003E8h)",
  "body": "**Description**\r\n\r\nI am using SkiaSharp for rendering streaming signal data in a Xamarin.Forms application targeted for the UWP platform on windows. \r\nFor performance reasons I use SKGLView with DrawInBackground set to true in SKGLViewRenderer:\r\n\r\n\u0060\u0060\u0060\r\n[assembly: ExportRenderer(typeof(SignalSKGLView), typeof(SignalRenderer.UWP.SKGLViewBackgroundRenderer))]\r\nnamespace SignalRenderer.Uwp\r\n{\r\n    public class SKGLViewBackgroundRenderer : SKGLViewRenderer\r\n    {\r\n        protected override SKSwapChainPanel CreateNativeControl()\r\n        {\r\n            var view = base.CreateNativeControl();\r\n            view.DrawInBackground = true;             \r\n            return view;\r\n        }\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n \r\nThis works quite nicely and I achieve a very good performance. Futhermore, since this runs in a background thread I can retain the good performance even when the UI thread is busy with the UI of the application.  \r\n\r\nThe issue I am having is that **when the applicaiton runs for a very long time (more than 8 hours), the render threat simply stops** and the streaming signal is not updated anymore. **No exception is thrown, the draw method is simply not called anymore**.\r\n\r\nI looked at the SkiaSharp source code to possibly identify any issue I could find and found in SkiaSharp.Views\\SkiaSharp.Views.UWP\\AngleSwapChainPanel.cs those lines: \r\n\r\n\u0060\u0060\u0060\r\nprivate void RenderFrame()\r\n\t\t{\r\n                        \u003CSome source code leaft out\u003E \r\n\r\n\t\t\tOnRenderFrame(new Rect(0, 0, panelWidth, panelHeight));\r\n\r\n\t\t\tif (!glesContext.SwapBuffers())\r\n\t\t\t{\r\n\t\t\t\t// The call to eglSwapBuffers might not be successful (i.e. due to Device Lost)\r\n\t\t\t\t// If the call fails, then we must reinitialize EGL and the GL resources.\r\n\t\t\t}\r\n\t\t}\r\n\u0060\u0060\u0060\r\n I am wondering if glesContext.SwapBuffers() might fail at some point after the application was running for more than 8 hours and if that could explain why the render thread stops at some point. \r\n\r\n**Expected Behavior** \r\n\r\nThe render thread does not stop even when the application is running for a very long time. \r\n\r\n**Actual Behavior**\r\n\r\nThe render thread stops when the application is running for a very long time (draw callback is not called anymore).\r\n \r\n**Basic Information**\r\n\r\n- Version with issue:  SkiaSharp 2.88.0-preview.178 \r\n- Last known good version:  Unknown \r\n- IDE:  Visual Studio 2019\r\n- Platform Target Frameworks: 10.0.17763.0\r\n- UWP:  Windows 10, version 1809 \r\n- Target Devices:   Windows 10 \r\n  \r\nI was trying to debug this issue but unfortunately was unable (although I spend quiet some time on it) to build SkiaSharp on my Windows computer. I followed the information here https://github.com/mono/SkiaSharp/wiki/Building-SkiaSharp (VS 2019)\r\nand here https://github.com/mono/SkiaSharp/issues/2040 (VS 2022). \r\n\r\nI would like to contribute and try to fix this issue but unfortunately I can not build SkiaSharp. Which branch of SkiaSharp would be the most stable concerning the build ? Is there somewhere a more detailed explanation on how to build Skiasharp for Windows ? \r\n\r\nThanks for looking into this !  \r\n \r\n\u0060\u0060\u0060\r\n\r\nPASTE ANY DETAILED VERSION INFO HERE\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n**Reproduction Link**\r\n\r\n\u003C!-- please upload or provide a link to a reproduction case --\u003E\r\n\r\n",
  "author": {
    "login": "mblome",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-12-09T14:28:30",
  "updatedAt": "2025-06-09T08:23:21",
  "commentCount": 1,
  "reactionCount": 0
}