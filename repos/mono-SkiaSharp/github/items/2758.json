{
  "number": 2758,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Unable to load library \u0027libSkiaSharp\u0027.",
  "body": "### Description\r\n\r\nusing svg.skia on anASP.NET website i get the following error:\r\nException message: The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception.\r\nUnable to load library \u0027libSkiaSharp\u0027.\r\n\r\nThe strange thing is that debugging the code locally, it works, but when deploying it to a server it fails with this error.\r\nThe versions i an using:\r\nSvg.Skia: 1.0.0.13\r\nSkiaSharp: 2.88.6\r\nSkiaSharp.HarfBuzz: 2.88.6\r\nSkiaSharp.NativeAssets.macOS: 2.88.6\r\nSkiaSharp.NativeAssets.Win32: 2.88.6\r\n\r\nthe project is a .NET Framework 4.7.2\r\nI can\u0027t figure out why it can run locally and not remote.\r\n\r\n### Code\r\n\r\nThe best way to share code for larger projects is a link to a GitHub repository: https://github.com/user/repo/tree/bug-123\r\n\r\nBut, you can also share a short block of code here:\r\n\u0060\u0060\u0060cs\r\n// some C# code here\r\n\u0060\u0060\u0060\r\nYou can also share some XAML:\r\n\u0060\u0060\u0060xaml\r\n\u003C!-- xaml code here --\u003E\r\n\u0060\u0060\u0060\r\n\r\n\r\n### Expected Behavior\r\n\r\n_No response_\r\n\r\n### Actual Behavior\r\n\r\n_No response_\r\n\r\n### Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### IDE / Editor\r\n\r\nVisual Studio (Windows)\r\n\r\n### Platform / Operating System\r\n\r\nWindows\r\n\r\n### Platform / Operating System Version\r\n\r\nWindows Server 2016 v1607\r\n\r\n### Devices\r\n\r\n_No response_\r\n\r\n### Relevant Screenshots\r\n\r\n_No response_\r\n\r\n### Relevant Log Output\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "jakobeazy",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "status/needs-info",
      "color": "B8EC4A"
    },
    {
      "name": "status/no-recent-activity",
      "color": "B8EC4A"
    }
  ],
  "assignees": [],
  "createdAt": "2024-02-15T15:06:46",
  "updatedAt": "2024-12-06T01:32:16",
  "closedAt": "2024-12-06T01:32:16",
  "commentCount": 12,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T12:48:24.6700807Z",
    "reactions": [],
    "comments": [
      {
        "id": 1953635793,
        "author": "jakobeazy",
        "body": "This is the complete call stack:\r\n\r\nException information:\r\n\u0060\u0060\u0060\r\n    Exception type: TypeInitializationException\r\n    Exception message: The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception.\r\n   at Svg.Skia.SKSvgSettings..ctor()\r\n   at Svg.Skia.SKSvg..ctor()\r\n   at FaellesKode.Generelt.SvgConverter.SaveAsPng(Stream file, String filePath) in D:\\a\\1\\s\\EazyProjectCode\\EazyFaellesKode\\Generelt\\SvgConverter.cs:line 12\r\n   at EazyProject.WebForm236.GemLogo(FileUpload fileupload) in D:\\a\\1\\s\\EazyProjectCode\\EazyProject\\O_admin_faktura_setup.aspx.vb:line 270\r\n   at EazyProject.WebForm236.savelogo_Click(Object sender, EventArgs e) in D:\\a\\1\\s\\EazyProjectCode\\EazyProject\\O_admin_faktura_setup.aspx.vb:line 300\r\n   at System.Web.UI.WebControls.Button.OnClick(EventArgs e)\r\n   at System.Web.UI.WebControls.Button.RaisePostBackEvent(String eventArgument)\r\n   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\r\n\r\nUnable to load library \u0027libSkiaSharp\u0027.\r\n   at SkiaSharp.LibraryLoader.LoadLocalLibrary[T](String libraryName)\r\n   at System.Lazy\u00601.CreateValue()\r\n   at System.Lazy\u00601.LazyInitValue()\r\n   at SkiaSharp.SkiaApi.sk_colortype_get_default_8888()\r\n   at SkiaSharp.SKImageInfo..cctor()\r\n\u0060\u0060\u0060",
        "createdAt": "2024-02-20T07:39:27",
        "reactions": []
      },
      {
        "id": 1969903629,
        "author": "mattleibow",
        "body": "Is the libSkiaSharp.dll file in the bin folder somewhere? How are you publishing/deploying? Are you able to share a msbuild binlog so I can see why the native binary is not reaching the final output.\r\n\r\nIf you run the app locally after publishing, does it work?",
        "createdAt": "2024-02-28T20:56:23",
        "reactions": []
      },
      {
        "id": 1970080424,
        "author": "romansp",
        "body": "@mattleibow We\u0027re also seeing this error but when trying out \u00603.0 preview 2\u0060. \r\n\r\nIt\u0027s a \u0060browser-wasm\u0060 app on .Net 8. Loads fine on \u00602.88.7\u0060 and HarfBuzzSharp \u00607.3.0.1\u0060. We don\u0027t use Blazor but we do include reference to \u0060SkiaSharp.Views.Blazor\u0060 for \u0060InterceptGLObject\u0060 workaround and that\u0027s where it fails to load \u0060libSkiaSharp\u0060.\r\n\r\nHaven\u0027t tried publishing yet as we\u0027re seeing this error with regular \u0060dotnet build\u0060.\r\n\r\nDidn\u0027t want to bother early because it\u0027s still a preview. But can create a minimal repro if that\u0027s already expected to work properly.",
        "createdAt": "2024-02-28T23:19:35",
        "reactions": []
      },
      {
        "id": 1970519410,
        "author": "jakobeazy",
        "body": "hi\r\nI was actually using the svg.skia nuget package. Changing to use the svg package solved it for me.",
        "createdAt": "2024-02-29T06:53:14",
        "reactions": []
      },
      {
        "id": 2066731386,
        "author": "prashants7718",
        "body": "Hi @jakobeazy ,\r\n\r\nHow you have solved this issue, have you changed package and used another package for svg generation",
        "createdAt": "2024-04-19T14:42:59",
        "reactions": []
      },
      {
        "id": 2068555119,
        "author": "jakobeazy",
        "body": "Yes, i changed the nuget package from svg.skia to svg.",
        "createdAt": "2024-04-22T06:02:43",
        "reactions": []
      },
      {
        "id": 2070588446,
        "author": "mattleibow",
        "body": "@romansp it should be working since there should be no changes for wasm in 3.x Please attach a repro/sample so I can have a look.",
        "createdAt": "2024-04-22T18:37:35",
        "reactions": []
      },
      {
        "id": 2363940259,
        "author": "enghch",
        "body": "@mattleibow I have the same issue when trying to run a Wasi Console app that depends on SkiaSharp. It builds the single-file wasm just fine. But when attempting to run, it throws:\r\n\r\n\u0060\u0022System.TypeInitializationException: TypeInitialization_Type, SkiaSharp.SKImageInfo --- System.DllNotFoundException: libSkiaSharp   at SkiaSharp.SKImageInfo..cctor()\u0060\r\n\r\n\r\nI\u0027m on .NET 9 preview 6. Is there some workaround or something I\u0027m missing? I attached a small repro project. I included the wasm file in case that\u0027s useful. If you\u0027re not familiar with wasi or wasitime, see in the instructions in the readme.\r\n\r\n[WasiSkiaSharpRepro.zip](https://github.com/user-attachments/files/17076962/WasiSkiaSharpRepro.zip)\r\n",
        "createdAt": "2024-09-20T15:02:12",
        "reactions": []
      },
      {
        "id": 2501810786,
        "author": "mattleibow",
        "body": "~@enghch for wasi console, please open a new issue as this one is for ASP.NET Blazor things.~ I see you already did, thanks: https://github.com/mono/SkiaSharp/issues/3015",
        "createdAt": "2024-11-26T20:00:37",
        "reactions": []
      },
      {
        "id": 2501840322,
        "author": "mattleibow",
        "body": "I think this was fixed in the latest 2.x and 3.x releases. Please let me know if this is still happening.",
        "createdAt": "2024-11-26T20:19:21",
        "reactions": []
      },
      {
        "id": 2501840801,
        "author": "dotnet-policy-service[bot]",
        "body": "Hi @jakobeazy. We have added the \u0060status/needs-info\u0060 label to this issue, which indicates that we have an open question for you before we can take further action. This issue will be closed automatically in 7 days if we do not hear back from you by then - please feel free to re-open it if you come back to this issue after that time.\n\u003C!-- Policy app identification https://img.shields.io/static/v1?label=PullRequestIssueManagement. --\u003E",
        "createdAt": "2024-11-26T20:19:39",
        "reactions": []
      },
      {
        "id": 2510473291,
        "author": "dotnet-policy-service[bot]",
        "body": "This issue has been automatically marked as stale because it has been marked as requiring author feedback but has not had any activity for **4 days**. It will be closed if no further activity occurs **within 3 days of this comment**. If it *is* closed, feel free to comment when you are able to provide the additional information and we will re-investigate.\n\u003C!-- Policy app identification https://img.shields.io/static/v1?label=PullRequestIssueManagement. --\u003E",
        "createdAt": "2024-12-02T03:11:11",
        "reactions": []
      }
    ]
  }
}