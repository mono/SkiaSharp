{
  "number": 2377,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies on Linux",
  "body": "**Description**\r\n\r\nI\u0027ve built a .NET Core 6 application that runs without issue on my local Windows 11 machine.  I\u0027ve deployed it to an Ubuntu 20.04 server and I receive an error that it cannot load the libSkiaSharp shared library.  I\u0027ve seen other people report this issue but none of the suggestions are working for me.  I will preface this with this is my first foray into Linux servers so this has been a huge learning curve.  However, I\u0027ve spent days trying to resolve this now and I can\u0027t figure out what is wrong.\r\n\r\nI use SkiaSharp with text via SKTypeFace so I believe I need the SkiaSharp.NativeAssets.Linux package.  However, after trying other suggestions and those not working, I removed the package and installed SkiaSharp.NativeAssets.Linux.NoDependencies.  I\u0027m still receiving the error though.  My application takes user input to determine how SkiaSharp is used so I\u0027m not hitting any code that is using SKTypeFace and I\u0027m still receiving the same error while using the NoDependencies package.\r\n\r\nMy project has references to the following packages:\r\n![image](https://user-images.githubusercontent.com/19159582/217980370-fa9173f0-f0e5-4141-b962-b62d9d5d0893.png)\r\n\r\n\r\nI initially published the application with Target-Runtime = Portable but that didn\u0027t work.  I tried moving the LibSkiaSharp.so file from the Runtimes directory to my web applications directory and that didn\u0027t work.  I\u0027ve also tried updating my publish settings to Target-Runtime=linux-x64 as this puts all of the project files in the root directory, redeployed, restarted the apache server and still receive the error.  \r\n\r\nHere are the file permissions for the deployed libSkiaSharp.so:\r\n![image](https://user-images.githubusercontent.com/19159582/217980936-45ce88b6-d5ce-4e87-9269-b1683a6cf938.png)\r\n\r\n\r\nI\u0027ve run the ldd command and it appears to have all of the necessary dependencies for libSkiaSharp.so.\r\n![image](https://user-images.githubusercontent.com/19159582/217979149-46a7e579-07a0-40f9-a579-722b4e71dc02.png)\r\n\r\nI\u0027ve also run the command to install libfontconfig1 as well\r\n\r\n**Code**\r\n\u0060byte[] imageBytes = Convert.FromBase64String(details.ImageBase64);\r\n\r\nSKBitmap skBitmapOriginal = SKBitmap.Decode(imageBytes);\u0060\r\n\r\n**Expected Behavior**\r\n\r\nApplication is able to find the libSkiaSharp library when run in a Linux environment\r\n\r\n**Actual Behavior**\r\n\r\nError is received whenever SkiaSharp is used via code in a Linux environment\r\n![image](https://user-images.githubusercontent.com/19159582/217982016-5056f3e8-9a84-493c-bd5b-cd2a5e19add1.png)\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:       System.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKData\u0027 threw an exception.\r\n\u003Ce LD_DEBUG environment variable: liblibSkiaSharp: cannot open shared object file: No such file or directory\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]: fail: MyTest.Controllers.MyController[0]\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:       The type initializer for \u0027SkiaSharp.SKData\u0027 threw an exception.\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:       System.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKData\u0027 threw an exception.\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:        ---\u003E System.DllNotFoundException: Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: liblibSkiaSharp: cannot open shared object file: No such file or directory\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          at SkiaSharp.SkiaApi.sk_data_new_empty()\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          at SkiaSharp.SKData..cctor()\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          --- End of inner exception stack trace ---\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          at SkiaSharp.SKData.Create(IntPtr address, Int32 length)\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          at SkiaSharp.SKBitmap.Decode(ReadOnlySpan\u00601 buffer)\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          at SkiaSharp.SKBitmap.Decode(Byte[] buffer)\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          at Test.Common.Image.ImageManager.GenerateImage(ImageOptions MyPost, Details details) in C:\\Users\\TestUser\\source\\repos\\Test.Web.Main\\Test.Common.Image\\ImageManager.cs:line 109\r\nFeb  9 19:40:10 vmi1190349 dotnet-MyTest[9456]:          at MyTest.Controllers.MyController.Get(ImageOptions MyPost) in C:\\Users\\TestUser\\source\\repos\\Test.Web.Main\\MyTest\\Controllers\\MyController.cs:line 84\r\n\r\n\r\n### Here\u0027s the output from LD_DEBUG, which does have a reference where it says libSkiaSharp.so: command not found:\r\n\r\nroot@vmi1190349:/var/www/mytest.com/public_html# LD_DEBUG=libs libSkiaSharp.so\r\n     16710:     find library=libc.so.6 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libc.so.6\r\n     16710:\r\n     16710:     find library=libpthread.so.0 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libpthread.so.0\r\n     16710:\r\n     16710:     find library=libdl.so.2 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libdl.so.2\r\n     16710:\r\n     16710:     find library=libutil.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libutil.so.1\r\n     16710:\r\n     16710:     find library=libm.so.6 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libm.so.6\r\n     16710:\r\n     16710:     find library=libexpat.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libexpat.so.1\r\n     16710:\r\n     16710:     find library=libz.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libz.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libpthread.so.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libc.so.6\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libz.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libexpat.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libm.so.6\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libutil.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libdl.so.2\r\n     16710:\r\n     16710:\r\n     16710:     initialize program: /usr/bin/python3\r\n     16710:\r\n     16710:\r\n     16710:     transferring control: /usr/bin/python3\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /usr/lib/python3.8/lib-dynload/_json.cpython-38-x86_64-linux-gnu.so\r\n     16710:\r\n     16710:     find library=libsqlite3.so.0 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libsqlite3.so.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libsqlite3.so.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /usr/lib/python3.8/lib-dynload/_sqlite3.cpython-38-x86_64-linux-gnu.so\r\n     16710:\r\n     16710:     find library=libapt-pkg.so.6.0 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libapt-pkg.so.6.0\r\n     16710:\r\n     16710:     find library=libstdc\u002B\u002B.so.6 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libstdc\u002B\u002B.so.6\r\n     16710:\r\n     16710:     find library=libgcc_s.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libgcc_s.so.1\r\n     16710:\r\n     16710:     find library=libresolv.so.2 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libresolv.so.2\r\n     16710:\r\n     16710:     find library=libbz2.so.1.0 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libbz2.so.1.0\r\n     16710:\r\n     16710:     find library=liblzma.so.5 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/liblzma.so.5\r\n     16710:\r\n     16710:     find library=liblz4.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/liblz4.so.1\r\n     16710:\r\n     16710:     find library=libzstd.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libzstd.so.1\r\n     16710:\r\n     16710:     find library=libudev.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libudev.so.1\r\n     16710:\r\n     16710:     find library=libsystemd.so.0 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libsystemd.so.0\r\n     16710:\r\n     16710:     find library=libgcrypt.so.20 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libgcrypt.so.20\r\n     16710:\r\n     16710:     find library=librt.so.1 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/librt.so.1\r\n     16710:\r\n     16710:     find library=libgpg-error.so.0 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libgpg-error.so.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libgpg-error.so.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/librt.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libgcrypt.so.20\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/liblzma.so.5\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/liblz4.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libsystemd.so.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libudev.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libzstd.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libbz2.so.1.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libresolv.so.2\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libgcc_s.so.1\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libstdc\u002B\u002B.so.6\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libapt-pkg.so.6.0\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /usr/lib/python3/dist-packages/apt_pkg.cpython-38-x86_64-linux-gnu.so\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /usr/lib/python3.8/lib-dynload/_bz2.cpython-38-x86_64-linux-gnu.so\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /usr/lib/python3.8/lib-dynload/_lzma.cpython-38-x86_64-linux-gnu.so\r\n     16710:\r\n     16710:     find library=libnss_files.so.2 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libnss_files.so.2\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libnss_files.so.2\r\n     16710:\r\n     16710:     find library=libnss_systemd.so.2 [0]; searching\r\n     16710:      search cache=/etc/ld.so.cache\r\n     16710:       trying file=/lib/x86_64-linux-gnu/libnss_systemd.so.2\r\n     16710:\r\n     16710:\r\n     16710:     calling init: /lib/x86_64-linux-gnu/libnss_systemd.so.2\r\n     16710:\r\n**libSkiaSharp.so: command not found**\r\n     16710:\r\n     16710:     calling fini: /usr/bin/python3 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libutil.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libexpat.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /usr/lib/python3.8/lib-dynload/_json.cpython-38-x86_64-linux-gnu.so [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /usr/lib/python3.8/lib-dynload/_sqlite3.cpython-38-x86_64-linux-gnu.so [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libsqlite3.so.0 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libdl.so.2 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /usr/lib/python3/dist-packages/apt_pkg.cpython-38-x86_64-linux-gnu.so [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libapt-pkg.so.6.0 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libz.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libstdc\u002B\u002B.so.6 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libm.so.6 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libgcc_s.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libresolv.so.2 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libzstd.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libudev.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libsystemd.so.0 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/liblz4.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libgcrypt.so.20 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/librt.so.1 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libgpg-error.so.0 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /usr/lib/python3.8/lib-dynload/_bz2.cpython-38-x86_64-linux-gnu.so [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libbz2.so.1.0 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /usr/lib/python3.8/lib-dynload/_lzma.cpython-38-x86_64-linux-gnu.so [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/liblzma.so.5 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libnss_files.so.2 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libnss_systemd.so.2 [0]\r\n     16710:\r\n     16710:\r\n     16710:     calling fini: /lib/x86_64-linux-gnu/libpthread.so.0 [0]\r\n     16710:\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.88.3\r\n- IDE:  Visual Studio Professional v17.4.4\r\n- Platform Target Frameworks: \r\n- Linux:  Ubuntu 20.04 64Bit\r\n",
  "author": {
    "login": "Rudazzle",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2023-02-10T02:26:41",
  "updatedAt": "2023-09-07T12:25:27",
  "commentCount": 0,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:25:05.6670768Z",
    "reactions": [],
    "comments": []
  }
}