{
  "number": 2874,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Failed to decode png image",
  "body": "### Description\n\nI\u0027ve noticed that we have some decode issues in our app with some PNG images. For example this one: \r\n![temp](https://github.com/mono/SkiaSharp/assets/405031/7d7ee2d5-81e4-49e8-891b-eeb3dcde41a8)\r\n\r\nIt\u0027s loading fine in OS (Windows 11), but consistently failed to be loaded with \u0060SKBitmap.Decode\u0060 (it returns null).\r\n\r\nI\u0027ve tried \u00603.0.0-preview.3.1\u0060 version and \u00602.88.8\u0060. This issue exists both on Windows 11 and in Linux containers with NET 8.\n\n### Code\n\n\u0060\u0060\u0060cs\r\nusing var bitmap = SKBitmap.Decode(@\u0022c:\\Temp\\temp.png\u0022);\r\nif (bitmap is null)\r\n    Console.WriteLine(\u0022Failed to load image\u0022);\r\n\u0060\u0060\u0060\r\n\n\n### Expected Behavior\n\nImage loaded successfully.\n\n### Actual Behavior\n\n\u0060SKBitmap.Decode\u0060 returns null.\n\n### Version of SkiaSharp\n\n3.x (Alpha)\n\n### Last Known Good Version of SkiaSharp\n\nOther (Please indicate in the description)\n\n### IDE / Editor\n\nOther (Please indicate in the description)\n\n### Platform / Operating System\n\nLinux, Windows\n\n### Platform / Operating System Version\n\nWindows 11\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "MichaelLogutov",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2024-05-30T07:12:35",
  "updatedAt": "2025-01-20T10:35:53",
  "commentCount": 7,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T12:47:37.7964819Z",
    "reactions": [],
    "comments": [
      {
        "id": 2146710144,
        "author": "MichaelLogutov",
        "body": "Is there any way I can diagnose that kind of problems and maybe direct bug to skia?",
        "createdAt": "2024-06-04T06:26:55",
        "reactions": [
          {
            "user": "lindexi",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:47:36.540097Z"
          }
        ]
      },
      {
        "id": 2147397844,
        "author": "mattleibow",
        "body": "Skia is pretty secretive about the errors, but maybe you can try reading the file and properties using \u0060SKCodec\u0060. If that reads, then try reading the pixel data and see if it fails.\r\n\r\nAlso, is it possible to attach the image in a zip file? GitHub process images and usually changes metadata which may be important.\r\n\r\nCan you also try SKImage? I wonder if there is something bad with bitmap.",
        "createdAt": "2024-06-04T12:20:36",
        "reactions": []
      },
      {
        "id": 2149171368,
        "author": "MichaelLogutov",
        "body": "Tried with SKCodec with this:\r\n\u0060\u0060\u0060\r\nusing var codec = SKCodec.Create(@\u0022c:\\Temp\\temp.png\u0022);\r\nif (codec is null)\r\n    Console.WriteLine(\u0022Failed to get codec for image\u0022);\r\nelse\r\n    Console.WriteLine(\u0022GetPixels = {0}\u0022, codec.GetPixels(out _));\r\n\u0060\u0060\u0060\r\n\r\nResult:\r\n\u0060\u0060\u0060\r\nGetPixels = ErrorInInput\r\n\u0060\u0060\u0060\r\n\r\nHere is image in zip: [temp.zip](https://github.com/user-attachments/files/15580112/temp.zip)\r\n\r\n\r\n\r\n\u003E Can you also try SKImage? I wonder if there is something bad with bitmap.\r\n\r\nYou mean \u0060SKImage.FromBitmap\u0060 ?\r\n",
        "createdAt": "2024-06-05T08:15:02",
        "reactions": []
      },
      {
        "id": 2188729874,
        "author": "JimBobSquarePants",
        "body": "The PNG above contains a CRC mismatch in the IEND chunk. Does Skia expose options for determining whether validation is required? ",
        "createdAt": "2024-06-25T11:48:34",
        "reactions": []
      },
      {
        "id": 2194111002,
        "author": "MichaelLogutov",
        "body": "@JimBobSquarePants good question. It seems that skia in chrome browser somehow ignores CRC mismatch, so maybe there is a way.\r\n\r\nBtw, how did you managed to find about CRC mismatch?",
        "createdAt": "2024-06-27T08:35:25",
        "reactions": []
      },
      {
        "id": 2196126771,
        "author": "JimBobSquarePants",
        "body": "\u003EBtw, how did you managed to find about CRC mismatch?\r\n\r\nI used ImageSharp \uD83D\uDE09 ",
        "createdAt": "2024-06-28T04:40:01",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "heart",
            "createdAt": "2026-02-06T12:47:37.5317579Z"
          },
          {
            "user": "MichaelLogutov",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:47:37.5317581Z"
          }
        ]
      },
      {
        "id": 2602046256,
        "author": "MichaelLogutov",
        "body": "Hello again. We\u0027re still experiencing this issue. Maybe there is there a way to force SkiaSharp to ignore CRC mismatch?",
        "createdAt": "2025-01-20T10:35:51",
        "reactions": []
      }
    ]
  }
}