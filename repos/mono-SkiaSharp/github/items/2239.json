{
  "number": 2239,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Alpha8 GPU image draws incorrectly",
  "body": "**Description**\r\n\r\nAlpha8 GPU color does not match Alpha8 CPU color\r\n\r\n**Code**\r\n\r\n\u003Cdetails\u003E\r\n\r\n\u0060\u0060\u0060cs\r\nstring tmp_string;\r\n\r\nSKImageInfo IMAGE_INFO = new(1, 1, SKColorType.Alpha8);\r\nvar color = new SKColor(25, 0, 0, 50);\r\n\r\n\r\nusing SKBitmap bitmap = new(IMAGE_INFO);\r\nusing SKCanvas canvas_ = new(bitmap);\r\ncanvas_.Clear(color);\r\nvar BITMAP_BYTES = bitmap.Bytes;\r\n\r\nConsole.WriteLine(\u0022BITMAP BYTES LENGTH: \u0022 \u002B BITMAP_BYTES.Length);\r\ntmp_string = \u0022BITMAP BYTES CONTENT: \u0022;\r\nfor (int i = 0; i \u003C BITMAP_BYTES.Length; i\u002B\u002B)\r\n{\r\n    tmp_string \u002B= BITMAP_BYTES[i];\r\n    if ((i \u002B 1) != BITMAP_BYTES.Length)\r\n    {\r\n        tmp_string \u002B= \u0022, \u0022;\r\n    }\r\n}\r\nConsole.WriteLine(tmp_string);\r\n\r\nvar bitmap_surface = SKSurface.Create(IMAGE_INFO);\r\nusing SKCanvas canvas_surface = bitmap_surface.Canvas;\r\ncanvas_surface.Clear(color);\r\nusing var bitmap_p = bitmap_surface.PeekPixels();\r\nvar BITMAP_SURFACE_BYTES = bitmap_p.GetPixelSpan();\r\n\r\nConsole.WriteLine(\u0022BITMAP SURFACE BYTES LENGTH: \u0022 \u002B BITMAP_SURFACE_BYTES.Length);\r\ntmp_string = \u0022BITMAP SURFACE BYTES CONTENT: \u0022;\r\nfor (int i = 0; i \u003C BITMAP_SURFACE_BYTES.Length; i\u002B\u002B)\r\n{\r\n    tmp_string \u002B= BITMAP_SURFACE_BYTES[i];\r\n    if ((i \u002B 1) != BITMAP_SURFACE_BYTES.Length)\r\n    {\r\n        tmp_string \u002B= \u0022, \u0022;\r\n    }\r\n}\r\nConsole.WriteLine(tmp_string);\r\n\r\nusing var SURFACE_CPU = SKSurface.Create(IMAGE_INFO);\r\nSURFACE_CPU.Canvas.Clear(color);\r\nSURFACE_CPU.Canvas.Flush();\r\nSURFACE_CPU.Flush(true, true); // submit, synchronous\r\nusing var PIXMAP_CPU = SURFACE_CPU.PeekPixels();\r\nusing var IMAGE_CPU = SKImage.FromPixels(PIXMAP_CPU);\r\nusing var BITMAP_CPU = SKBitmap.FromImage(IMAGE_CPU);\r\nvar CPU_BYTES = BITMAP_CPU.Bytes;\r\n\r\nusing var SURFACE_GPU = SKSurface.Create(context, false, IMAGE_INFO);\r\nSURFACE_GPU.Canvas.Clear(color);\r\nSURFACE_GPU.Canvas.Flush();\r\nSURFACE_GPU.Flush(true, true); // submit, synchronous\r\nusing var IMAGE_GPU = SURFACE_GPU.Snapshot();\r\nusing var BITMAP_GPU = SKBitmap.FromImage(IMAGE_GPU);\r\nvar GPU_BYTES = BITMAP_GPU.Bytes;\r\n\r\nConsole.WriteLine(\u0022CPU BYTES LENGTH: \u0022 \u002B CPU_BYTES.Length);\r\ntmp_string = \u0022CPU BYTES CONTENT: \u0022;\r\nfor (int i = 0; i \u003C CPU_BYTES.Length; i\u002B\u002B)\r\n{\r\n    tmp_string \u002B= CPU_BYTES[i];\r\n    if ((i \u002B 1) != CPU_BYTES.Length)\r\n    {\r\n        tmp_string \u002B= \u0022, \u0022;\r\n    }\r\n}\r\nConsole.WriteLine(tmp_string);\r\nConsole.WriteLine(\u0022GPU BYTES LENGTH: \u0022 \u002B GPU_BYTES.Length);\r\ntmp_string = \u0022GPU BYTES CONTENT: \u0022;\r\nfor (int i = 0; i \u003C GPU_BYTES.Length; i\u002B\u002B)\r\n{\r\n    tmp_string \u002B= GPU_BYTES[i];\r\n    if ((i \u002B 1) != GPU_BYTES.Length)\r\n    {\r\n        tmp_string \u002B= \u0022, \u0022;\r\n    }\r\n}\r\nConsole.WriteLine(tmp_string);\r\nSKImage raster = IMAGE_GPU;\r\nif (IMAGE_GPU.IsTextureBacked)\r\n{\r\n    raster = IMAGE_GPU.ToRasterImage();\r\n}\r\nvar pixmap = new SKPixmap();\r\nif (!raster.PeekPixels(pixmap))\r\n{\r\n    pixmap.Dispose();\r\n    pixmap = null;\r\n}\r\nif (pixmap != null)\r\n{\r\n    IntPtr pixels = pixmap.GetPixels();\r\n    using SKData pixelData = SKData.Create(pixels, pixmap.BytesSize);\r\n    Console.WriteLine(\u0022GPU PIXEL SPAN LENGTH: \u0022 \u002B pixelData.Span.Length);\r\n    tmp_string = \u0022GPU PIXEL SPAN CONTENT: \u0022;\r\n    for (int i = 0; i \u003C pixelData.Span.Length; i\u002B\u002B)\r\n    {\r\n        tmp_string \u002B= pixelData.Span[i];\r\n        if ((i \u002B 1) != pixelData.Span.Length)\r\n        {\r\n            tmp_string \u002B= \u0022, \u0022;\r\n        }\r\n    }\r\n    Console.WriteLine(tmp_string);\r\n    pixmap.Dispose();\r\n}\r\n\u0060\u0060\u0060\r\n\r\n\u003C/details\u003E\r\n\r\n**Expected Behavior**\r\n\u0060\u0060\u0060\r\nBITMAP BYTES LENGTH: 1\r\nBITMAP BYTES CONTENT: 50\r\nBITMAP SURFACE BYTES LENGTH: 1\r\nBITMAP SURFACE BYTES CONTENT: 50\r\nCPU BYTES LENGTH: 4\r\nCPU BYTES CONTENT: 0, 0, 0, 50\r\nGPU BYTES LENGTH: 4\r\nGPU BYTES CONTENT: 0, 0, 0, 50\r\nGPU PIXEL SPAN LENGTH: 1\r\nGPU PIXEL SPAN CONTENT: 50\r\n\u0060\u0060\u0060\r\n\r\n**Actual Behavior**\r\n\u0060\u0060\u0060\r\nBITMAP BYTES LENGTH: 1\r\nBITMAP BYTES CONTENT: 50\r\nBITMAP SURFACE BYTES LENGTH: 1\r\nBITMAP SURFACE BYTES CONTENT: 50\r\nCPU BYTES LENGTH: 4\r\nCPU BYTES CONTENT: 0, 0, 0, 50\r\nGPU BYTES LENGTH: 4\r\nGPU BYTES CONTENT: 0, 0, 0, 5\r\nGPU PIXEL SPAN LENGTH: 1\r\nGPU PIXEL SPAN CONTENT: 5\r\n\u0060\u0060\u0060\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  Skia 2.88.1\r\n- Last known good version:  unknown\r\n- IDE:  Visual Studio\r\n- Platform Target Frameworks:\r\n  - Windows Classic:  Windows 10 WPF\r\n  \r\n\u003Cdetails\u003E\r\n\r\n\u0060\u0060\u0060\r\nMicrosoft Visual Studio Community 2022\r\nVersion 17.3.2\r\nVisualStudio.17.Release/17.3.2\u002B32819.101\r\nMicrosoft .NET Framework\r\nVersion 4.8.09037\r\n\r\nInstalled Version: Community\r\n\r\nVisual C\u002B\u002B 2022   00482-90000-00000-AA910\r\nMicrosoft Visual C\u002B\u002B 2022\r\n\r\nADL Tools Service Provider   1.0\r\nThis package contains services used by Data Lake tools\r\n\r\nASA Service Provider   1.0\r\n\r\nASP.NET and Web Tools   17.3.376.3011\r\nASP.NET and Web Tools\r\n\r\nASP.NET Web Frameworks and Tools 2012   17.3.376.3011\r\nFor additional information, visit https://www.asp.net/\r\n\r\nAzure App Service Tools v3.0.0   17.3.376.3011\r\nAzure App Service Tools v3.0.0\r\n\r\nAzure Data Lake Tools for Visual Studio   2.6.5000.0\r\nMicrosoft Azure Data Lake Tools for Visual Studio\r\n\r\nAzure Stream Analytics Tools for Visual Studio   2.6.5000.0\r\nMicrosoft Azure Stream Analytics Tools for Visual Studio\r\n\r\nC# Tools   4.3.0-3.22412.4\u002Bc97184bafab9a34d61e85f1c1ef34f25283ce9ba\r\nC# components used in the IDE. Depending on your project type and settings, a different version of the compiler may be used.\r\n\r\nCommon Azure Tools   1.10\r\nProvides common services for use by Azure Mobile Services and Microsoft Azure Tools.\r\n\r\nCookiecutter   17.0.22179.3\r\nProvides tools for finding, instantiating and customizing templates in cookiecutter format.\r\n\r\nDotfuscator Community Edition   6.5.0\u002B76d4669002\r\nPreEmptive Protection - Dotfuscator CE\r\n\r\nExtensibility Message Bus   1.2.6 (master@34d6af2)\r\nProvides common messaging-based MEF services for loosely coupled Visual Studio extension components communication and integration.\r\n\r\nIncrediBuild Build Acceleration   1.6.0.2\r\nIncrediBuild effectively reduces compilation and development times by up to 90%.\r\n\r\nLinux Core Dump Debugging   1.0.9.32708\r\nEnables debugging of Linux core dumps.\r\n\r\nMicrosoft Azure Hive Query Language Service   2.6.5000.0\r\nLanguage service for Hive query\r\n\r\nMicrosoft Azure Stream Analytics Language Service   2.6.5000.0\r\nLanguage service for Azure Stream Analytics\r\n\r\nMicrosoft JVM Debugger   1.0\r\nProvides support for connecting the Visual Studio debugger to JDWP compatible Java Virtual Machines\r\n\r\nMono Debugging for Visual Studio   17.3.20 (3f4cb00)\r\nSupport for debugging Mono processes with Visual Studio.\r\n\r\nNuGet Package Manager   6.3.0\r\nNuGet Package Manager in Visual Studio. For more information about NuGet, visit https://docs.nuget.org/\r\n\r\nOffice Developer Tools for Visual Studio   17.0.32616.00\r\nMicrosoft Office Developer Tools for Visual Studio\r\n\r\nPython - Django support   17.0.22179.3\r\nProvides templates and integration for the Django web framework.\r\n\r\nPython - Profiling support   17.0.22179.3\r\nProfiling support for Python projects.\r\n\r\nPython with Pylance   17.0.22179.3\r\nProvides IntelliSense, projects, templates, debugging, interactive windows, and other support for Python developers.\r\n\r\nRazor (ASP.NET Core)   17.0.0.2232702\u002Be1d654e792aa2fe6646a6935bcca80ff0aff4387\r\nProvides languages services for ASP.NET Core Razor.\r\n\r\nSQL Server Data Tools   17.0.62207.04100\r\nMicrosoft SQL Server Data Tools\r\n\r\nSyntax Visualizer   1.0\r\nAn extension for visualizing Roslyn SyntaxTrees.\r\n\r\nTest Adapter for Boost.Test   1.0\r\nEnables Visual Studio\u0027s testing tools with unit tests written for Boost.Test.  The use terms and Third Party Notices are available in the extension installation directory.\r\n\r\nTest Adapter for Google Test   1.0\r\nEnables Visual Studio\u0027s testing tools with unit tests written for Google Test.  The use terms and Third Party Notices are available in the extension installation directory.\r\n\r\nToolWindowHostedEditor   1.0\r\nHosting json editor into a tool window\r\n\r\nTypeScript Tools   17.0.10701.2001\r\nTypeScript Tools for Microsoft Visual Studio\r\n\r\nVisual Basic Tools   4.3.0-3.22412.4\u002Bc97184bafab9a34d61e85f1c1ef34f25283ce9ba\r\nVisual Basic components used in the IDE. Depending on your project type and settings, a different version of the compiler may be used.\r\n\r\nVisual C\u002B\u002B for Cross Platform Mobile Development (Android)   17.0.32708.82\r\nVisual C\u002B\u002B for Cross Platform Mobile Development (Android)\r\n\r\nVisual C\u002B\u002B for Linux Development   1.0.9.32708\r\nVisual C\u002B\u002B for Linux Development\r\n\r\nVisual F# Tools   17.1.0-beta.22363.4\u002B1b94f89d4d1f41f20f9be73c76f4b229d4e49078\r\nMicrosoft Visual F# Tools\r\n\r\nVisual Studio IntelliCode   2.2\r\nAI-assisted development for Visual Studio.\r\n\r\nVisualStudio.DeviceLog   1.0\r\nInformation about my package\r\n\r\nVisualStudio.Mac   1.0\r\nMac Extension for Visual Studio\r\n\r\nVSPackage Extension   1.0\r\nVSPackage Visual Studio Extension Detailed Info\r\n\r\nWorkflow Manager Tools 1.0   1.0\r\nThis package contains the necessary Visual Studio integration components for Workflow Manager.\r\n\r\nXamarin   17.3.0.296 (d17-3@a0ff24b)\r\nVisual Studio extension to enable development for Xamarin.iOS and Xamarin.Android.\r\n\r\nXamarin Designer   17.3.0.208 (remotes/origin/d17-3@e4f67afef)\r\nVisual Studio extension to enable Xamarin Designer tools in Visual Studio.\r\n\r\nXamarin Templates   17.2.28 (9b3d244)\r\nTemplates for building iOS, Android, and Windows apps with Xamarin and Xamarin.Forms.\r\n\r\nXamarin.Android SDK   13.0.0.0 (d17-3/030cd63)\r\nXamarin.Android Reference Assemblies and MSBuild support.\r\n    Mono: dffa5ab\r\n    Java.Interop: xamarin/java.interop/d17-3@7716ae53\r\n    SQLite: xamarin/sqlite/3.38.5@df4deab\r\n    Xamarin.Android Tools: xamarin/xamarin-android-tools/main@14076a6\r\n\r\n\r\nXamarin.iOS and Xamarin.Mac SDK   15.12.0.2 (87f98a75e)\r\nXamarin.iOS and Xamarin.Mac Reference Assemblies and MSBuild support.\r\n\u0060\u0060\u0060\r\n\r\n\u003C/details\u003E\r\n\r\n\r\n**Reproduction Link**\r\n\r\n[Skia TestBed.zip](https://github.com/mono/SkiaSharp/files/9484517/Skia.TestBed.zip)\r\n",
  "author": {
    "login": "mgood7123",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-09-04T11:07:53",
  "updatedAt": "2022-09-05T01:54:17",
  "commentCount": 1,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:31:22.4986237Z",
    "reactions": [],
    "comments": [
      {
        "id": 1236473957,
        "author": "mgood7123",
        "createdAt": "2022-09-05T01:53:57",
        "reactions": []
      }
    ]
  }
}