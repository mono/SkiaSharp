{
  "number": 2650,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] SkiaSharp version 2.88.6 has mosaics when loading images in .NET 7 and the background becomes dark.",
  "body": "### Description\n\nSkiaSharp version 2.88.6 has mosaics when loading images in .NET 7 and the background becomes dark.\r\n\r\n![QQ\u56FE\u724720231018151428](https://github.com/mono/SkiaSharp/assets/114386814/ffec1555-8876-4251-ae34-5182477252a6)\r\n\r\nTested SkiaSharp version 2.88.5 without this problem\n\n### Code\n\nThe best way to share code for larger projects is a link to a GitHub repository: https://github.com/user/repo/tree/bug-123\r\n\r\nBut, you can also share a short block of code here:\r\n\u0060\u0060\u0060cs\r\n// some C# code here\r\n\u0060\u0060\u0060\r\nYou can also share some XAML:\r\n\u0060\u0060\u0060xaml\r\n\u003C!-- xaml code here --\u003E\r\n\u0060\u0060\u0060\r\n\n\n### Expected Behavior\n\n_No response_\n\n### Actual Behavior\n\n_No response_\n\n### Version of SkiaSharp\n\n2.88.3 (Current)\n\n### Last Known Good Version of SkiaSharp\n\n2.88.2 (Previous)\n\n### IDE / Editor\n\nVisual Studio Code (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\n_No response_\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n![QQ\u56FE\u724720231018151428](https://github.com/mono/SkiaSharp/assets/114386814/ca53f9ee-23ed-4106-80ff-d8cbf77351f7)\r\n![QQ\u56FE\u724720231018151733](https://github.com/mono/SkiaSharp/assets/114386814/e1d89c24-b0b5-4a0e-959b-f8a0ae11552a)\r\n\n\n### Relevant Log Output\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "e8-HaopuWang",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2023-10-18T07:19:07",
  "updatedAt": "2024-02-09T00:00:26",
  "closedAt": "2024-01-09T21:39:56",
  "commentCount": 13,
  "reactionCount": 4,
  "engagement": {
    "syncedAt": "2026-02-06T13:40:44.9841791Z",
    "reactions": [
      {
        "user": "Timur-Filatov",
        "content": "rocket",
        "createdAt": "2026-02-06T13:40:44.9841825Z"
      },
      {
        "user": "r-work",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:40:44.9841831Z"
      },
      {
        "user": "AlexGoOn",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:40:44.9841834Z"
      },
      {
        "user": "vividos",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:40:44.9841837Z"
      }
    ],
    "comments": [
      {
        "id": 1770116643,
        "author": "NovaKs68",
        "body": "It seems to be the same bug as in this ticket #2643 ",
        "createdAt": "2023-10-19T06:00:45",
        "reactions": []
      },
      {
        "id": 1781519996,
        "author": "IainS1986",
        "body": "I might be seeing a similar issues with PDF documents, all DrawBitmap calls are coming out with corrupted images very similar to what you\u0027re seeing.\n\nGoing to raise a bug tomorrow once I investigate a bit more. Are you using jpgs by any chance? I have my suspicions it\u0027s jpg encoding that\u0027s broken (and in my case there\u0027s no work around as pdf documents convert internal image data to JPGs)",
        "createdAt": "2023-10-26T17:12:30",
        "reactions": []
      },
      {
        "id": 1781968854,
        "author": "IainS1986",
        "body": "I could be going down a dead end here but do your images above have alpha channels?\n\nI had a test where I saw some images come out fine, and some corrupt. The corrupt images were all RGB and the fine ones were RGBA.\n\nWhen I saved one of the fine images to just be RGB, they then also appeared corrupt.\n\nBe good to know if you are using RGB images, and if adding an alpha channel makes any difference.",
        "createdAt": "2023-10-26T22:19:31",
        "reactions": []
      },
      {
        "id": 1822302011,
        "author": "edobnet",
        "body": "How do I update?",
        "createdAt": "2023-11-22T08:20:27",
        "reactions": []
      },
      {
        "id": 1829578606,
        "author": "e1em3ntoDX",
        "body": "Hi, \r\n\r\nMultiple commercial products at DevExpress also rely on the functionality offered by the SkiaSharp library and we experience similar issues in apps with our tools deployed to macOS/iOS after upgrading to v2.88.6. Downgrading is a no-go for us due to the [vulnerability](https://github.com/mono/SkiaSharp/issues/2608). Is there any ETA of the fix?  \r\n\r\n@mattleibow any chance you can look into this and share some details/future plans? ",
        "createdAt": "2023-11-28T10:55:10",
        "reactions": [
          {
            "user": "AlexGoOn",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:43.2754067Z"
          },
          {
            "user": "AntonKosenkoPro",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:43.275407Z"
          },
          {
            "user": "r-work",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:43.2754072Z"
          },
          {
            "user": "pKravchenko",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:43.2754073Z"
          },
          {
            "user": "jasoncodematic",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:43.2754074Z"
          },
          {
            "user": "IainS1986",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:43.2754075Z"
          },
          {
            "user": "vividos",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:43.2754076Z"
          }
        ]
      },
      {
        "id": 1850786634,
        "author": "jasoncodematic",
        "body": "We are using another library which has a dependency on SkiaSharp and this bug is causing lots of issues. Downgrading is also not a great option for us either. Is there anyone currently looking to fix this?",
        "createdAt": "2023-12-11T19:55:59",
        "reactions": []
      },
      {
        "id": 1864295622,
        "author": "AndyG74",
        "body": "after downgrade to 2.88.5 it works, but there is a security issue:\r\n![image](https://github.com/mono/SkiaSharp/assets/61390650/6363b0c6-4a22-4e92-94ef-f3303dee2a43)\r\n",
        "createdAt": "2023-12-20T11:14:51",
        "reactions": []
      },
      {
        "id": 1864310076,
        "author": "e8-HaopuWang",
        "body": "This issue was solved after saving the image in PNG format",
        "createdAt": "2023-12-20T11:25:08",
        "reactions": []
      },
      {
        "id": 1864314568,
        "author": "AndyG74",
        "body": "ok, thats fine but i need the image as JPEG\r\n![image](https://github.com/mono/SkiaSharp/assets/61390650/cf6facab-fc29-4a69-8605-043760d615f2)\r\n",
        "createdAt": "2023-12-20T11:28:27",
        "reactions": []
      },
      {
        "id": 1864315989,
        "author": "IainS1986",
        "body": "@e8-HaopuWang \r\n\r\nThis is in no way \u0027closed\u0027. ",
        "createdAt": "2023-12-20T11:29:31",
        "reactions": []
      },
      {
        "id": 1864323799,
        "author": "e8-HaopuWang",
        "body": "@AndyG74  I also use JPEG format in versions below 2.88.6, but saving the image as JPEG in version 2.88.6 will be damaged.  After testing, there is no problem in using PNG format.",
        "createdAt": "2023-12-20T11:35:42",
        "reactions": [
          {
            "user": "AndyG74",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:44.4681729Z"
          },
          {
            "user": "e1em3ntoDX",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:40:44.4681734Z"
          }
        ]
      },
      {
        "id": 1883760933,
        "author": "mattleibow",
        "body": "I tested 3.0.1 and the latest main and I think this is an issue in libjpeg-turbo. For now I am reverting to the latest 2.x series.\r\n\r\nI had a look at the original security issue and it does not affect the 2.x series because 12-bit jpegs are not actually supported in our build. The 2.x series required the entire library to be either 8-bit or 12-bit, and we use 8-bit. The 3.x series allowed for both simultaneously.\r\n\r\nThe security issue was just reported for 2.1.90 (which seems like a 2.x series but is actually a 3.0 beta). The current stable version is 2.1.5.1 which is on a separate branch.\r\n\r\nI have opened an issue in libjpeg-turbo where I will try and determine the real cause and where this issue should live: https://github.com/libjpeg-turbo/libjpeg-turbo/issues/741",
        "createdAt": "2024-01-09T20:40:49",
        "reactions": []
      },
      {
        "id": 1883841603,
        "author": "mattleibow",
        "body": "Duplicate of https://github.com/mono/SkiaSharp/issues/2643",
        "createdAt": "2024-01-09T21:39:54",
        "reactions": []
      }
    ]
  }
}