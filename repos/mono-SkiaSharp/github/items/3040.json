{
  "number": 3040,
  "type": "issue",
  "state": "open",
  "title": "Unable to load DLL \u0027libSkiaSharp\u0027 - Python wrapper based Web API",
  "body": "### Description\r\n\r\nWe are creating python wrapper based Web API to call C# method via python. While using SkiaSharp related code, we facing errors even loaded the SkiaSharp dlls in python.\r\n\r\nTarget: .NET Standard 2.0\r\nPython version : 3.9\r\n\r\n**Any workaround also helpful.** \r\n\r\n### Code\r\n\r\nPython:\r\n\u0060\u0060\u0060\r\nimport clr #import clr from pythonnet\r\nimport os\r\n\r\n#Get the DLL and input file path in string\r\ndll_path = r\u0027D:\\\\Python\\Python\\.NET Standard Wrapper Library\\SkiaSharpApp\\SkiaSharpApp\\bin\\Debug\\netstandard2.0\\SkiaSharpApp.dll\u0027\r\nharbuzzSharp_dll= r\u0027C:\\Users\\Admin\\.nuget\\packages\\harfbuzzsharp\\7.3.0.2\\lib\\netstandard2.0\\HarfBuzzSharp.dll\u0027\r\nskiasharpHarfbuzz_dll= r\u0027C:\\Users\\ Admin \\.nuget\\packages\\skiasharp.harfbuzz\\2.88.8\\lib\\netstandard2.0\\SkiaSharp.HarfBuzz.dll\u0027\r\nskiasharp_dll= r\u0027C:\\Users\\ Admin \\.nuget\\packages\\skiasharp\\2.88.8\\lib\\netstandard2.0\\SkiaSharp.dll\u0027\r\n\r\n#Verify the path\r\nif dll_path not in os.sys.path:     \r\n    os.sys.path.append(dll_path)\r\n    os.sys.path.append(harbuzzSharp_dll)\r\n    os.sys.path.append(skiasharpHarfbuzz_dll)\r\n    os.sys.path.append(skiasharp_dll)\r\n    print(\u0022Checking path\u0022)\r\n\r\n#load our dll file(mine is in my C:// folder)\r\ntry: \r\n    clr.AddReference(dll_path)\r\n    clr.AddReference(harbuzzSharp_dll)\r\n    clr.AddReference(skiasharpHarfbuzz_dll)\r\n    clr.AddReference(skiasharp_dll)\r\n    print (\u0022Load success\u0022)\r\nexcept Exception as e:\r\n    print(\u0022Fail to load\u0022)\r\n\r\nfrom SKiaSharpApp import Test\r\n\r\ntest = Test() #create  object\r\n\r\nprint(\u0022Open and Save status: \u0022\u002Bstr(test.SkiaSharpSample()))\r\n\r\n\u0060\u0060\u0060\r\n\r\nC#:\r\n\u0060\u0060\u0060\r\nusing SkiaSharp;\r\nusing System.IO;\r\n\r\nnamespace SKiaSharpApp\r\n{\r\n    public class Test\r\n    {\r\n\r\n        public string SkiaSharpSample()\r\n        {\r\n            //Define the image dimensions\r\n            int width = 800;\r\n            int height = 600;\r\n            string base64String;\r\n\r\n            //Create a new bitmap\r\n            using (var bitmap = new SKBitmap(width, height))\r\n            {\r\n                // Create a canvas to draw on the bitmap\r\n                using (var canvas = new SKCanvas(bitmap))\r\n                {\r\n                    // Clear the canvas with a white color\r\n                    canvas.Clear(SKColors.White);\r\n\r\n                    // Define the paint for drawing shapes\r\n                    var paint = new SKPaint\r\n                    {\r\n                        Color = SKColors.Blue,\r\n                        IsAntialias = true,\r\n                        Style = SKPaintStyle.Stroke,\r\n                        StrokeWidth = 5\r\n                    };\r\n\r\n                    // Draw a rectangle\r\n                    var rect = new SKRect(100, 100, 300, 300);\r\n                    canvas.DrawRect(rect, paint);\r\n\r\n                    // Draw a circle\r\n                    paint.Color = SKColors.Red;\r\n                    canvas.DrawCircle(400, 400, 100, paint);\r\n\r\n                    // Draw a line\r\n                    paint.Color = SKColors.Green;\r\n                    canvas.DrawLine(500, 100, 700, 300, paint);\r\n\r\n                    // Save the bitmap to a file\r\n                    using (var image = SKImage.FromBitmap(bitmap))\r\n                    using (var data = image.Encode(SKEncodedImageFormat.Png, 100))\r\n\r\n                    using (var memoryStream = new MemoryStream())\r\n                    {\r\n                        data.SaveTo(memoryStream);\r\n\r\n\r\n                    }\r\n                }\r\n            }\r\n            return \u0022Success\u0022;\r\n        }\r\n    }\r\n}\r\n\r\n\u0060\u0060\u0060\r\n### Replication steps\r\n1. Create .NET Standard 2.0 library project and compile above C# code.\r\n2. Create python file and use the dll path from bin folder of C# app in python.\r\n3. Similarly edit harbuzzSharp_dll and skiasharp_dll path in python as per your .nuget folder path.\r\n4. Run python\r\n5. You will receive an error from SkiaSharp\r\n\r\n### Expected Behavior\r\n\r\nWork properly\r\n\r\n### Actual Behavior\r\n\r\nException\r\n\r\n### Version of SkiaSharp\r\n\r\nSkiaSharp.HarfBuzz,\u00222.88.8\u0022\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\n6.88.6 (Deprecated)\r\n\r\n### IDE / Editor\r\n\r\nVisual Studio Code (Windows)\r\n\r\n### Platform / Operating System\r\n\r\nWindows\r\n\r\n\r\n\r\n### Relevant Log Output\r\n\r\n\u0060\u0060\u0060shell\r\nPS D:\\ Python\\Python\\API files in Python\u003E python TestSkia.py   \r\nChecking path\r\nLoad success\r\nSystem.DllNotFoundException: Unable to load DLL \u0027libSkiaSharp\u0027: The specified module could not be found. (Exception from HRESULT: 0x8007007E)\r\n   at SkiaSharp.SkiaApi.sk_colortype_get_default_8888()\r\n   at SkiaSharp.SKImageInfo..cctor()\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \u0022D \\Python\\Python\\API files in Python\\TestSkia.py\u0022, line 32, in \u003Cmodule\u003E\r\n    print(\u0022Open and Save status: \u0022\u002Bstr(test.SkiaSharpSample()))\r\nSystem.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKImageInfo\u0027 threw an exception. ---\u003E System.DllNotFoundException: Unable to load DLL \u0027libSkiaSharp\u0027: The specified module could not be found. (Exception from HRESULT: 0x8007007E)\r\n   at SkiaSharp.SkiaApi.sk_colortype_get_default_8888()\r\n   at SkiaSharp.SKImageInfo..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at SkiaSharp.SKBitmap..ctor(Int32 width, Int32 height, Boolean isOpaque)\r\n   at SKiaSharpApp.Test.SkiaSharpSample()\r\n\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for \u0027SkiaSharp.SKObject\u0027 threw an exception. ---\u003E System.DllNotFoundException: Unable to load DLL \u0027libSkiaSharp\u0027: The specified module could not be found. (Exception from HRESULT: 0x8007007E)\r\n   at SkiaSharp.SkiaApi.sk_version_get_milestone()\r\n   at SkiaSharp.SkiaSharpVersion.get_Native()\r\n   at SkiaSharp.SkiaSharpVersion.CheckNativeLibraryCompatible(Boolean throwIfIncompatible)\r\n   at SkiaSharp.SKObject..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at SkiaSharp.SKObject.get_Handle()\r\n   at SkiaSharp.SKNativeObject.Dispose(Boolean disposing)\r\n   at SkiaSharp.SKBitmap.Dispose(Boolean disposing)\r\n   at SkiaSharp.SKNativeObject.Finalize()\r\n\u0060\u0060\u0060\r\n\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "MohanaselvamJ",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "status/needs-attention",
      "color": "B8EC4A"
    }
  ],
  "assignees": [],
  "createdAt": "2024-10-16T18:31:27",
  "updatedAt": "2024-12-09T09:42:02",
  "commentCount": 6,
  "reactionCount": 0
}