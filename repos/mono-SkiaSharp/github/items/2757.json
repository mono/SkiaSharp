{
  "number": 2757,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Simple encoding (i.e jpeg to png) is 3-4 times slower than Microsoft\u0027s System.Drawing on Windows",
  "body": "### Description\n\nHi!\r\n\r\nMicrosoft recommends moving on to SkiaSharp.\r\nI\u0027ve tested some code, but no matter what I encode and how, it always comes out at least 3-4 times slower than Gdi.\r\nIs there something I missing? Gdi using GPU and Skia not?\r\nAny known workarounds?\r\n\r\nThank you\n\n### Code\n\n\r\n\u0060\u0060\u0060cs\r\nusing var skImage = SKImage.FromBitmap(SKBitmap.Decode(\u0022D:\\\\Downloads\\\\test.jpg\u0022));\r\nusing var stream = File.Create(\u0022D:\\\\Downloads\\\\test.png\u0022);\r\nimageData.Encode(SKEncodedImageFormat.Png, 100).SaveTo(stream);\r\n\u0060\u0060\u0060\r\n\n\n### Expected Behavior\n\nSomewhat comparable performance, if not better\n\n### Actual Behavior\n\nWorse, so much worse\n\n### Version of SkiaSharp\n\n2.88.3 (Current)\n\n### Last Known Good Version of SkiaSharp\n\nOther (Please indicate in the description)\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\nWindows 11\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "danielgindi",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2024-02-15T12:27:49",
  "updatedAt": "2025-08-21T21:44:18",
  "commentCount": 6,
  "reactionCount": 2,
  "engagement": {
    "syncedAt": "2026-02-06T12:42:26.3150651Z",
    "reactions": [
      {
        "user": "mjblacker",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:42:26.3150706Z"
      },
      {
        "user": "thomasouvre",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:42:26.3150712Z"
      }
    ],
    "comments": [
      {
        "id": 2423834308,
        "author": "mjblacker",
        "body": "We are also having this issue with around the same regression in performance of 4x slower.\r\n\r\nIt is only for the SKImage.Encode call that appears to be slow.",
        "createdAt": "2024-10-19T12:57:57",
        "reactions": [
          {
            "user": "danielgindi",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:42:25.2404229Z"
          }
        ]
      },
      {
        "id": 2424337566,
        "author": "mjblacker",
        "body": "Found a workaround for now that seems to get much closer in performance. ~10-20% slower so close enough\r\n\r\nYou need to manually handle the encoding and set lower compression and no filters.\r\n\r\nI\u0027m using F# instead but it would be used very much the same way in C#\r\n\u0060\u0060\u0060fsharp\r\nuse image = SKImage.FromEncodedData(imageBytes)\r\n\r\nuse memoryStream = new MemoryStream()\r\nuse pixmap = image.PeekPixels()\r\npixmap.Encode(memoryStream, SKPngEncoderOptions(FilterFlags = SKPngEncoderFilterFlags.None, ZLibLevel = 1)) |\u003E ignore\r\n\r\nlet imageData = memoryStream.ToArray() // I want this as a bytearray\r\n\u0060\u0060\u0060",
        "createdAt": "2024-10-20T00:27:49",
        "reactions": [
          {
            "user": "0-CAT",
            "content": "heart",
            "createdAt": "2026-02-06T12:42:25.5052092Z"
          },
          {
            "user": "markusrt",
            "content": "heart",
            "createdAt": "2026-02-06T12:42:25.5052096Z"
          },
          {
            "user": "molesmoke",
            "content": "heart",
            "createdAt": "2026-02-06T12:42:25.5052097Z"
          }
        ]
      },
      {
        "id": 2472139910,
        "author": "kesshei",
        "body": "\r\nStill very slow, saving an image of approximately 1920 * 1080 size takes 100ms\r\n\u0060\u0060\u0060\r\nusing var surface = SKSurface.Create(new SKImageInfo(width, height) { ColorType = SKColorType.Rgba8888 });\r\nvar canvas = surface.Canvas;\r\n var paint = new SKPaint()\r\n {\r\n     Color = SKColors.Black,\r\n     IsAntialias = true, \r\n     Style = SKPaintStyle.Fill,\r\n     TextAlign = SKTextAlign.Center,\r\n     TextSize = 23,\r\n     Typeface = SKTypeface.FromFamilyName(\u0022Microsoft YaHei\u0022, SKFontStyle.Bold)\r\n };\r\n var coord = new SKPoint(200, 200);\r\n var str = DateTime.Now.ToString(\u0022yyyy-MM-dd hh:mm:ss fff\u0022);\r\n canvas.DrawText(str, coord, paint);\r\nusing var image = surface.Snapshot();\r\nusing var stream = new MemoryStream();\r\nimage.Encode(SKEncodedImageFormat.Png, 100).SaveTo(stream); // This place takes the longest time\r\n\u0060\u0060\u0060",
        "createdAt": "2024-11-13T01:44:32",
        "reactions": []
      },
      {
        "id": 2709573640,
        "author": "Yaavannvignesh",
        "body": "\u003Chtml xmlns:o=\u0022urn:schemas-microsoft-com:office:office\u0022\nxmlns:dt=\u0022uuid:C2F41010-65B3-11d1-A29F-00AA00C14882\u0022\nxmlns=\u0022http://www.w3.org/TR/REC-html40\u0022\u003E\n\n\u003Chead\u003E\n\n\u003Cmeta name=ProgId content=OneNote.File\u003E\n\u003Cmeta name=Generator content=\u0022Microsoft OneNote 15\u0022\u003E\n\u003C/head\u003E\n\n\u003Cbody lang=en-US style=\u0027font-family:Calibri;font-size:11.0pt\u0027\u003E\n\u003C!--StartFragment--\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003EHi,\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003E\u0026nbsp;\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003EWe are experiencing\nsignificant performance delays when encoding images in PNG format using\nSkiaSharp. We need to encode more than 100 images, and the process is much\nslower compared to JPEG encoding\u2014approximately 5 times slower.\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003E\u0026nbsp;\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003EHere are our\nobservations:\u003C/p\u003E\n\n\u003Cul type=disc style=\u0027direction:ltr;unicode-bidi:embed;margin-top:0in;\n margin-bottom:0in\u0027\u003E\n \u003Cli style=\u0027margin-top:0;margin-bottom:0;vertical-align:middle\u0027\u003E\u003Cspan\n     style=\u0027font-family:Calibri;font-size:11.0pt\u0027\u003EJPEG Encoding:\u003Cspan\n     style=\u0027mso-spacerun:yes\u0027\u003E\u00A0 \u003C/span\u003E1.2 seconds\u003C/span\u003E\u003C/li\u003E\n \u003Cli style=\u0027margin-top:0;margin-bottom:0;vertical-align:middle\u0027\u003E\u003Cspan\n     style=\u0027font-family:Calibri;font-size:11.0pt\u0027\u003EPNG Encoding:\u003Cspan\n     style=\u0027mso-spacerun:yes\u0027\u003E\u00A0 \u003C/span\u003E5.6 seconds\u003C/span\u003E\u003C/li\u003E\n\u003C/ul\u003E\n\n\u003Cp style=\u0027margin:0in;margin-left:.375in;font-family:Calibri;font-size:11.0pt\u0027\u003E\u0026nbsp;\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003EWe are using the\nfollowing code for PNG encoding:\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003E\u0026nbsp;\u003C/p\u003E\n\n\n\nSKImageInfo   imageInfo = new SKImageInfo(bitmap.Width, bitmap.Height); \n using SKSurface   surface = SKSurface.Create(imageInfo); \n  surface.Canvas.DrawBitmap(bitmap,   0, 0); \n SKImage image =   surface.Snapshot(); \n  SKData data =   image.Encode(SKEncodedImageFormat.Png,100);\n--\n\n\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003E\u0026nbsp;\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003EIs there any\nrecommended way to improve performance?\u003C/p\u003E\n\n\u003Cp style=\u0027margin:0in;font-family:Calibri;font-size:11.0pt\u0027\u003EThanks.\u003C/p\u003E\n\n\u003C!--EndFragment--\u003E\n\u003C/body\u003E\n\n\u003C/html\u003E\n\n",
        "createdAt": "2025-03-10T06:37:57",
        "reactions": []
      },
      {
        "id": 3210066624,
        "author": "markusrt",
        "body": "I can confirm the workaround from @mjblacker \n\nIt, in my case, increased PNG encoding speed by factor 2, without any change to the output file.",
        "createdAt": "2025-08-21T11:04:38",
        "reactions": [
          {
            "user": "molesmoke",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:42:26.0626807Z"
          }
        ]
      },
      {
        "id": 3212168472,
        "author": "molesmoke",
        "body": "Good to have a workaround and example of configuring the encoder, but this appears to be Skia behavior rather than a SkiaSharp issue (since SkiaSharp is just following the Skia defaults). i.e. there doesn\u0027t appear to be anything that SkiaSharp itself is doing that\u0027s the cause of the slowness. The comparison posted probably isn\u0027t an apples-to-apples comparison, since the encoder defaults are quite likely and reasonably different between the two frameworks.\n\nI haven\u0027t tried it, but I would also expect that WebP would give better results than PNG both in terms encoding time and file size if that\u0027s a viable option.",
        "createdAt": "2025-08-21T21:44:18",
        "reactions": []
      }
    ]
  }
}