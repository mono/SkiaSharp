{
  "number": 2495,
  "type": "pr",
  "state": "closed",
  "title": "fix(wasm): Enable Wasm EH and SIMD in all configurations for net8\u002B",
  "body": "**Description of Change**\r\n\r\nEnables Wasm EH and SIMD by default for Emscripten 3.1.34 (net8)\r\n\r\n**Bugs Fixed**\r\n\r\n- Fixes https://github.com/mono/SkiaSharp/issues/2494\r\n\r\n\u003C!-- Provide links to issues here. Ensure that a GitHub issue was created for your feature or bug fix before sending PR. --\u003E\r\n\r\n**API Changes**\r\n\r\nNone.\r\n\r\n\u003C!-- REPLACE THIS COMMENT\r\n\r\nList all API changes here (or just put None), example:\r\n\r\nAdded: \r\n \r\n- \u0060string Class.Property { get; set; }\u0060\r\n- \u0060void Class.Method();\u0060\r\n\r\nChanged:\r\n\r\n - \u0060object Cell.OldPropertyName =\u003E object Cell.NewPropertyName\u0060\r\n\r\n--\u003E\r\n\r\n**Behavioral Changes**\r\n\r\nNone.\r\n\r\n\u003C!-- Describe any non-bug related behavioral changes that may change how users app behaves when upgrading to this version of the codebase. --\u003E\r\n\r\n**Required skia PR**\r\n\r\nNone.\r\n\r\n\u003C!-- Replace this with the full URL to the skia PR. --\u003E\r\n\r\n**PR Checklist**\r\n\r\n- [ ] Has tests (if omitted, state reason in description)\r\n- [ ] Rebased on top of main at time of PR\r\n- [ ] Merged related skia PRs\r\n- [ ] Changes adhere to coding standard\r\n- [ ] Updated documentation\r\n",
  "author": {
    "login": "jeromelaban",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "milestone": "v2.88.4",
  "createdAt": "2023-06-16T18:10:33",
  "updatedAt": "2023-06-19T17:44:49",
  "closedAt": "2023-06-19T08:39:56",
  "commentCount": 5,
  "reactionCount": 0,
  "draft": false,
  "merged": true,
  "mergedAt": "2023-06-19T08:39:56",
  "mergeableState": "unknown",
  "baseBranch": "main",
  "headBranch": "dev/jela/net8-wasm-eh",
  "additions": 24,
  "deletions": 19,
  "changedFiles": 2,
  "commits": 4,
  "reviews": [
    {
      "author": "KirillKornienko",
      "state": "COMMENTED",
      "submittedAt": "2023-06-17T07:06:09"
    },
    {
      "author": "jeromelaban",
      "state": "COMMENTED",
      "submittedAt": "2023-06-17T16:32:33"
    }
  ],
  "engagement": {
    "syncedAt": "2026-02-06T13:45:52.1032021Z",
    "reactions": [],
    "comments": [
      {
        "id": 1595649862,
        "author": "KirillKornienko",
        "body": "Looks like the same error\r\n\r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EMy .csproj:\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060\r\n\u003CProject Sdk=\u0022Microsoft.NET.Sdk.BlazorWebAssembly\u0022\u003E\r\n\r\n  \u003CPropertyGroup\u003E\r\n    \u003CTargetFramework\u003Enet8.0\u003C/TargetFramework\u003E\r\n  \u003C/PropertyGroup\u003E\r\n\r\n  \u003CItemGroup\u003E\r\n    \u003CPackageReference Include=\u0022Microsoft.AspNetCore.Components.WebAssembly\u0022 Version=\u00228.0.0-preview.5.23302.2\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022Microsoft.AspNetCore.Components.WebAssembly.DevServer\u0022 Version=\u00228.0.0-preview.5.23302.2\u0022 PrivateAssets=\u0022all\u0022 /\u003E\r\n    \r\n    \u003CPackageReference Include=\u0022SkiaSharp\u0022 Version=\u00222.88.4-preview.72\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022SkiaSharp.HarfBuzz\u0022 Version=\u00222.88.4-preview.72\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022SkiaSharp.NativeAssets.WebAssembly\u0022 Version=\u00222.88.4-preview.72\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022HarfBuzzSharp.NativeAssets.WebAssembly\u0022 Version=\u00222.8.2.4-preview.72\u0022 /\u003E\r\n  \u003C/ItemGroup\u003E\r\n\r\n  \u003CItemGroup\u003E\r\n    \u003CNativeFileReference Include=\u0022$(HarfBuzzSharpStaticLibraryPath)\\3.1.34\\st\\*.a\u0022 /\u003E\r\n    \u003CNativeFileReference Include=\u0022$(SkiaSharpStaticLibraryPath)\\3.1.34\\st\\*.a\u0022 /\u003E\r\n  \u003C/ItemGroup\u003E\r\n\u003C/Project\u003E\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EBuild output:\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060\r\n1\u003ECompiling native assets with emcc with -O0. This may take a while ...\r\n1\u003E[2/3] skipped unchanged files\r\n1\u003E[3/3] pinvoke.c -\u003E pinvoke.o [took 0,52s]\r\n1\u003ELinking for initial memory $(EmccInitialHeapSize)=26279936 bytes. Set this msbuild property to change the value.\r\n1\u003ELinking with emcc with -O0. This may take a while ...\r\n1\u003E \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Node.win-x64\\8.0.0-preview.5.23275.2\\tools\\bin\\node.exe\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Sdk.win-x64\\8.0.0-preview.5.23275.2\\tools\\emscripten\\src\\compiler.js\u0022 C:\\Users\\kirea\\AppData\\Local\\Temp\\tmpznp9s5wy.json --symbols-only\r\n1\u003E \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Sdk.win-x64\\8.0.0-preview.5.23275.2\\tools\\bin\\wasm-ld.exe\u0022 -o C:\\Users\\kirea\\source\\repos\\fastreport_net2\\Tools\\DebugApps\\BlazorAppWasm8\\obj\\Debug\\net8.0\\wasm\\for-build\\dotnet.native.wasm C:\\Users\\kirea\\.nuget\\packages\\harfbuzzsharp.nativeassets.webassembly\\2.8.2.4-preview.72\\buildTransitive\\netstandard1.0\\..\\..\\build\\netstandard1.0\\libHarfBuzzSharp.a\\3.1.34\\st\\libHarfBuzzSharp.a C:\\Users\\kirea\\.nuget\\packages\\skiasharp.nativeassets.webassembly\\2.88.4-preview.72\\buildTransitive\\netstandard1.0\\..\\..\\build\\netstandard1.0\\libSkiaSharp.a\\3.1.34\\st\\libSkiaSharp.a C:\\Users\\kirea\\source\\repos\\fastreport_net2\\Tools\\DebugApps\\BlazorAppWasm8\\obj\\Debug\\net8.0\\wasm\\for-build\\pinvoke.o C:\\Users\\kirea\\source\\repos\\fastreport_net2\\Tools\\DebugApps\\BlazorAppWasm8\\obj\\Debug\\net8.0\\wasm\\for-build\\driver.o C:\\Users\\kirea\\source\\repos\\fastreport_net2\\Tools\\DebugApps\\BlazorAppWasm8\\obj\\Debug\\net8.0\\wasm\\for-build\\corebindings.o \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libicudata.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libicui18n.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libicuuc.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-component-debugger-static.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-component-diagnostics_tracing-stub-static.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-component-hot_reload-static.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-component-marshal-ilgen-static.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-ee-interp.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-icall-table.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-profiler-aot.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-profiler-browser.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmono-wasm-eh-wasm.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libmonosgen-2.0.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libSystem.Globalization.Native.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libSystem.IO.Compression.Native.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\libSystem.Native.a\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\wasm-bundled-timezones.a\u0022 \u0022-LC:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Cache.win-x64\\8.0.0-preview.5.23275.2\\tools\\emscripten\\cache\\sysroot\\lib\\wasm32-emscripten\u0022 -lGL -lal -lhtml5 -lstubs-debug -lnoexit -lc-debug -ldlmalloc -lcompiler_rt-wasm-sjlj -lc\u002B\u002B-except -lc\u002B\u002Babi-debug-except -lunwind-except -lsockets -mllvm -combiner-global-alias-analysis=false -mllvm -wasm-enable-sjlj -mllvm -disable-lsr -mllvm -wasm-enable-eh -mllvm -exception-model=wasm --allow-undefined-file=C:\\Users\\kirea\\AppData\\Local\\Temp\\tmp_r9qv8uf.undefined --export-if-defined=malloc --export-if-defined=memalign --export-if-defined=htons --export-if-defined=ntohs --export-if-defined=fmod --export-if-defined=atan2 --export-if-defined=fma --export-if-defined=pow --export-if-defined=fmodf --export-if-defined=atan2f --export-if-defined=fmaf --export-if-defined=powf --export-if-defined=asin --export-if-defined=asinh --export-if-defined=acos --export-if-defined=acosh --export-if-defined=atan --export-if-defined=atanh --export-if-defined=cbrt --export-if-defined=cos --export-if-defined=cosh --export-if-defined=exp --export-if-defined=log --export-if-defined=log2 --export-if-defined=log10 --export-if-defined=sin --export-if-defined=sinh --export-if-defined=tan --export-if-defined=tanh --export-if-defined=asinf --export-if-defined=asinhf --export-if-defined=acosf --export-if-defined=acoshf --export-if-defined=atanf --export-if-defined=atanhf --export-if-defined=cbrtf --export-if-defined=cosf --export-if-defined=coshf --export-if-defined=expf --export-if-defined=logf --export-if-defined=log2f --export-if-defined=log10f --export-if-defined=sinf --export-if-defined=sinhf --export-if-defined=tanf --export-if-defined=tanhf --export-if-defined=memset --export-if-defined=stackSave --export-if-defined=stackRestore --export-if-defined=stackAlloc --export-if-defined=free --export-if-defined=__get_exception_message --export-if-defined=__cpp_exception --export-if-defined=__cxa_increment_exception_refcount --export-if-defined=__cxa_decrement_exception_refcount --export-if-defined=__thrown_object_from_unwind_exception --export-if-defined=__start_em_asm --export-if-defined=__stop_em_asm --export-if-defined=__start_em_lib_deps --export-if-defined=__stop_em_lib_deps --export-if-defined=__start_em_js --export-if-defined=__stop_em_js --export-if-defined=fflush --export=emscripten_stack_get_end --export=emscripten_stack_get_free --export=emscripten_stack_get_base --export=emscripten_stack_get_current --export=emscripten_stack_init --export=stackSave --export=stackRestore --export=stackAlloc --export=__errno_location --export=malloc --export=free --export=__trap --export=__wasm_call_ctors --export=emscripten_builtin_memalign --export=__dl_seterr --export=saveSetjmp --export=setThrew --export=htonl --export=htons --export=ntohs --export-table --growable-table -z stack-size=5242880 --initial-memory=26279936 --no-entry --max-memory=2147483648 --stack-first\r\n1\u003E \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Node.win-x64\\8.0.0-preview.5.23275.2\\tools\\bin\\node.exe\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Sdk.win-x64\\8.0.0-preview.5.23275.2\\tools\\emscripten\\src\\compiler.js\u0022 C:\\Users\\kirea\\AppData\\Local\\Temp\\tmpa26g2pq4.json\r\n1\u003EEXEC : error : undefined symbol: emscripten_longjmp (referenced by top-level compiled C/C\u002B\u002B code)\r\n1\u003EEXEC : warning : To disable errors for undefined symbols use \u0060-sERROR_ON_UNDEFINED_SYMBOLS=0\u0060\r\n1\u003EEXEC : warning : _emscripten_longjmp may need to be added to EXPORTED_FUNCTIONS if it arrives from a system library\r\n1\u003EEXEC : error : Aborting compilation due to previous errors\r\n1\u003Eemcc : error : \u0027\u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Node.win-x64\\8.0.0-preview.5.23275.2\\tools\\bin\\node.exe\u0022 \u0022C:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.Emscripten.3.1.34.Sdk.win-x64\\8.0.0-preview.5.23275.2\\tools\\emscripten\\src\\compiler.js\u0022 C:\\Users\\kirea\\AppData\\Local\\Temp\\tmpa26g2pq4.json\u0027 failed (returned 1)\r\n1\u003EC:\\Program Files\\dotnet\\packs\\Microsoft.NET.Runtime.WebAssembly.Sdk\\8.0.0-preview.5.23280.8\\Sdk\\WasmApp.Native.targets(476,5): error MSB3073: The command \u0022emcc \u0022@C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\src\\emcc-default.rsp\u0022 \u0022@C:\\Program Files\\dotnet\\packs\\Microsoft.NETCore.App.Runtime.Mono.browser-wasm\\8.0.0-preview.5.23280.8\\runtimes\\browser-wasm\\native\\src\\emcc-link.rsp\u0022 \u0022@C:\\Users\\kirea\\source\\repos\\fastreport_net2\\Tools\\DebugApps\\BlazorAppWasm8\\obj\\Debug\\net8.0\\wasm\\for-build\\emcc-link.rsp\u0022\u0022 exited with code 1.\r\n1\u003EDone building project \u0022BlazorAppWasm8.csproj\u0022 -- FAILED.\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n",
        "createdAt": "2023-06-17T06:59:10",
        "reactions": []
      },
      {
        "id": 1595929975,
        "author": "jeromelaban",
        "body": "@KirillKornienko I\u0027ve been able to build and run using this PR\u0027s packages using net8\u0027s Uno Platform bootstrapper, could you try with blazor net8 and let me know if it works for you?",
        "createdAt": "2023-06-18T02:38:17",
        "reactions": []
      },
      {
        "id": 1596023222,
        "author": "KirillKornienko",
        "body": "\u003E @KirillKornienko I\u0027ve been able to build and run using this PR\u0027s packages using net8\u0027s Uno Platform bootstrapper, could you try with blazor net8 and let me know if it works for you?\r\n\r\nSure, where can I find the artifacts, attached to this PR? On https://dev.azure.com/xamarin/public/_artifacts/feed/SkiaSharp I see only \u0060-preview72\u0060 version, which isn\u0027t the latest version.",
        "createdAt": "2023-06-18T08:08:51",
        "reactions": []
      },
      {
        "id": 1596167826,
        "author": "jeromelaban",
        "body": "@KirillKornienko you can find the nuget packages in the Artifacts section of the build, [here](https://dev.azure.com/xamarin/public/_build/results?buildId=88761\u0026view=artifacts\u0026pathAsName=false\u0026type=publishedArtifacts). Make sure to use the versions with \u0060pr\u0060 in it.",
        "createdAt": "2023-06-18T14:27:26",
        "reactions": []
      },
      {
        "id": 1596210722,
        "author": "KirillKornienko",
        "body": "\u003E @KirillKornienko you can find the nuget packages in the Artifacts section of the build, [here](https://dev.azure.com/xamarin/public/_build/results?buildId=88761\u0026view=artifacts\u0026pathAsName=false\u0026type=publishedArtifacts). Make sure to use the versions with \u0060pr\u0060 in it.\r\n\r\nYes, everything is good, thanks!",
        "createdAt": "2023-06-18T17:09:12",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "heart",
            "createdAt": "2026-02-06T13:45:52.0530057Z"
          }
        ]
      }
    ]
  }
}