{
  "number": 1812,
  "type": "pr",
  "state": "closed",
  "title": "[android] eliminate lots of fields in Resource.designer.cs",
  "body": "**Description of Change**\r\n\r\nContext: https://github.com/jonathanpeppers/CustomResourceDesigner\r\nContext: https://github.com/xamarin/xamarin-android/issues/6310\r\n\r\nWe found a case where a .NET MAUI app that included SkiaSharp and\r\nTelerik controls was setting ~90,000 fields at startup in the\r\n\u0060Resource.designer.cs\u0060 file via the \u0060UpdateIdValues()\u0060 method.\r\n\r\nThis also would happen in any Xamarin.Android class library:\r\n\r\n* Include AndroidX \u0026 Google Material\r\n* Include at least one \u0060@(AndroidResource)\u0060 and use the ID from C#\r\n* \u0060Resource.designer.cs\u0060 has 2,700\u002B fields\r\n\r\nSo SkiaSharp is not unique to the problem here...\r\n\r\nReviewing the SkiaSharp fields, I found:\r\n\r\n    source\\SkiaSharp.Views.Maui\\SkiaSharp.Views.Maui.Controls\\obj\\Debug\\net6.0-android\\Resource.designer.cs\r\n    5335 fields\r\n    source\\SkiaSharp.Views.Maui\\SkiaSharp.Views.Maui.Core\\obj\\Debug\\net6.0-android\\Resource.designer.cs\r\n    5313 fields\r\n    source\\SkiaSharp.Views.Maui\\SkiaSharp.Views.Maui.Controls.Compatibility\\obj\\Debug\\net6.0-android\\Resource.designer.cs\r\n    5335 fields\r\n\r\nWe can simply set \u0060$(AndroidGenerateResourceDesigner)\u0060 to \u0060false\u0060 in\r\nthese projects, as they do not use any of the fields. This will\r\nprevent .NET 6 apps using these libraries from setting 16,005 fields\r\nat startup.\r\n\r\nI also did a spot check on \u0060SkiaSharp.Views.Android\u0060, but it\u0027s OK --\r\nit only has 3 fields:\r\n\r\n    public class Resource\r\n    {\r\n        public class Attribute\r\n        {\r\n            public static int ignorePixelScaling;\r\n            //...\r\n        }\r\n        public class Styleable\r\n        {\r\n            public static int[] SKCanvasView;\r\n            public static int SKCanvasView_ignorePixelScaling;\r\n            //...\r\n        }\r\n        //...\r\n    }\r\n\r\nWe are working on a long-term solution for this issue in\r\nXamarin.Android, but we can do a simple workaround in SkiaSharp for\r\nnow.\r\n\r\n**Bugs Fixed**\r\n\r\nn/a\r\n\r\n**API Changes**\r\n\r\nNone\r\n\r\n**Behavioral Changes**\r\n\r\nIf the three projects require usage of \u0060Resource.designer.cs\u0060 in the future, we could follow the pattern here:\r\n\r\nhttps://github.com/jonathanpeppers/CustomResourceDesigner\r\n\r\n**PR Checklist**\r\n\r\n- [ ] Has tests (if omitted, state reason in description)\r\n- [ ] Rebased on top of main at time of PR\r\n- [ ] Changes adhere to coding standard\r\n- [ ] Updated documentation\r\n",
  "author": {
    "login": "jonathanpeppers",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2021-09-20T17:59:59",
  "updatedAt": "2021-09-23T16:18:15",
  "closedAt": "2021-09-23T15:33:52",
  "commentCount": 6,
  "reactionCount": 0,
  "draft": false,
  "merged": true,
  "mergedAt": "2021-09-23T15:33:52",
  "mergeableState": "unknown",
  "baseBranch": "main",
  "headBranch": "androidgenerateresourcedesigner",
  "additions": 3,
  "deletions": 0,
  "changedFiles": 3,
  "commits": 1,
  "reviews": [
    {
      "author": "mattleibow",
      "state": "APPROVED",
      "submittedAt": "2021-09-20T18:08:08"
    }
  ],
  "engagement": {
    "syncedAt": "2026-02-06T14:23:53.898436Z",
    "reactions": [],
    "comments": [
      {
        "id": 923152511,
        "author": "jonathanpeppers",
        "body": "/cc @mattleibow I guess I don\u0027t have permission to ask for a review?",
        "createdAt": "2021-09-20T18:01:15",
        "reactions": []
      },
      {
        "id": 923158874,
        "author": "mattleibow",
        "body": "Thanks for the PR. Looks good and once CI is green I\u0027ll merge.",
        "createdAt": "2021-09-20T18:09:01",
        "reactions": []
      },
      {
        "id": 923176382,
        "author": "jonathanpeppers",
        "body": "@mattleibow \u0060$(AndroidGenerateResourceDesigner)\u0060 was introduced with .NET 6 RC1. So as long as you\u0027re building SkiaSharp with RC1, this will work.",
        "createdAt": "2021-09-20T18:31:55",
        "reactions": []
      },
      {
        "id": 923176881,
        "author": "jonathanpeppers",
        "body": "Oh looks like you\u0027re already all set:\r\nhttps://github.com/mono/SkiaSharp/blob/68e80fa1762a292de1f7829d2c361f2a1be93d9c/scripts/azure-pipelines.yml#L29-L30\r\n",
        "createdAt": "2021-09-20T18:32:37",
        "reactions": []
      },
      {
        "id": 924073727,
        "author": "jonathanpeppers",
        "body": "@mattleibow are my test failures here OK?\r\n\r\n\u0060\u0060\u0060\r\nImageScalingMultipleThreadsTest\r\n\r\nSystem.AggregateException : One or more errors occurred. (Object reference not set to an instance of an object.)\r\n---- System.NullReferenceException : Object reference not set to an instance of an object.\r\n\u0060\u0060\u0060",
        "createdAt": "2021-09-21T15:00:09",
        "reactions": []
      },
      {
        "id": 925926409,
        "author": "mattleibow",
        "body": "I think that is just a flakey test. I spin up like 100 threads and sometimes it fails. It used to always fail so I fixed a bug and now it is at 1% failure. So a win?",
        "createdAt": "2021-09-23T15:34:43",
        "reactions": []
      }
    ]
  }
}