{
  "number": 1193,
  "type": "pr",
  "state": "closed",
  "title": "Remove reflection usage for most SKObject",
  "body": "**Description of Change**\r\n\r\nThis PR tries to remove the performance impact that comes from reflection usage within the SKObject.GetObject factory\r\n\r\n**Bugs Fixed**\r\n\r\n- Related to issue #\r\n\r\nProvide links to issues here. Ensure that a GitHub issue was created for your feature or bug fix before sending PR.\r\n\r\n**API Changes**\r\n\r\nList all API changes here (or just put None), example:\r\n\r\nAdded: \r\n \r\n- \u0060string Class.Property { get; set; }\u0060\r\n- \u0060void Class.Method();\u0060\r\n\r\nChanged:\r\n\r\n - \u0060object Cell.OldPropertyName =\u003E object Cell.NewPropertyName\u0060\r\n\r\n**Behavioral Changes**\r\n\r\nDescribe any non-bug related behavioral changes that may change how users app behaves when upgrading to this version of the codebase.\r\n\r\n**PR Checklist**\r\n\r\n- [ ] Has tests (if omitted, state reason in description)\r\n- [ ] Rebased on top of master at time of PR\r\n- [ ] Changes adhere to coding standard\r\n- [ ] Updated documentation\r\n",
  "author": {
    "login": "Gillibald",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2020-03-27T11:59:37",
  "updatedAt": "2020-03-31T08:06:00",
  "closedAt": "2020-03-31T08:06:00",
  "commentCount": 4,
  "reactionCount": 2,
  "draft": false,
  "mergeable": false,
  "merged": false,
  "mergeableState": "dirty",
  "baseBranch": "master",
  "headBranch": "removeReflectionForSKObject",
  "additions": 693,
  "deletions": 193,
  "changedFiles": 32,
  "commits": 4,
  "reviews": [],
  "engagement": {
    "syncedAt": "2026-02-06T14:31:10.9618364Z",
    "reactions": [
      {
        "user": "jmacato",
        "content": "hooray",
        "createdAt": "2026-02-06T14:31:10.9618521Z"
      },
      {
        "user": "jmacato",
        "content": "rocket",
        "createdAt": "2026-02-06T14:31:10.9618528Z"
      }
    ],
    "comments": [
      {
        "id": 604972620,
        "author": "Gillibald",
        "body": "Only objects that are using \u0060internal static TSkiaObject GetObject\u003CTSkiaObject, TSkiaImplementation\u003E\u0060 create their instances via reflection. I wasn\u0027t sure how the concrete implementations of SKStream are working.\r\n\r\nI would love to know what you think about these changes @mattleibow",
        "createdAt": "2020-03-27T12:28:00",
        "reactions": []
      },
      {
        "id": 605898709,
        "author": "mattleibow",
        "body": "I have been thinking about this for some time now, so it is great that you are having a look too.\r\n\r\nI am not a total fan of duplicating the logic in each class, especially when it comes to changes - such as #1200. Is there a way we can use delegates or another means to specify a constructor? Basically, instead of duplicating code, or using reflection, we pass a cached delegate in (this code will be in the new HandleDictionary, but just a demo):\r\n\r\n\u0060\u0060\u0060csharp\r\nclass SKObject {\r\n    internal static TSkiaObject GetObject\u003CTSkiaObject, TSkiaImplementation\u003E (\r\n        IntPtr handle, bool owns = true, bool unrefExisting = true, bool refNew = false, Func\u003CIntPtr, bool, TSkiaObject\u003E ctorDel = null)\r\n    {\r\n        if (GetInstance(out instance))\r\n            return instance;\r\n        if (ctorDel != null)\r\n            return ctorDel(handle);\r\n        // do reflection\r\n    }\r\n} \r\n\u0060\u0060\u0060\r\n\r\nThen in the usage, we can do something similar to what you did with adding a method to each type:\r\n\r\n\u0060\u0060\u0060csharp\r\nclass SKSurface {\r\n    public SKCanvas Canvas =\u003E SKCanvas.GetObject(sk_surface_canvas());\r\n}\r\n\r\nclass SKCanvas {\r\n    internal static SKCanvas GetObject (IntPtr handle, bool owns = true, bool unrefExisting = true, bool refNew = false) =\u003E\r\n        SKObject.GetObject\u003CSKCanvas\u003E(handle, owns, unref, ref, (h, o) =\u003E new SKCanvas(h, o));\r\n}\r\n\u0060\u0060\u0060\r\n\r\nThis way, there is no code duplication (better for maintenance) and no reflection (perf).\r\n\r\nThis is just me thinking here, so you may spot some issues or maybe improve on this?",
        "createdAt": "2020-03-30T09:48:33",
        "reactions": [
          {
            "user": "Gillibald",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:31:10.3148791Z"
          }
        ]
      },
      {
        "id": 605909484,
        "author": "Gillibald",
        "body": "Your solution is indeed more maintainable. Will adapt the delegate approach in this PR and benchmark it.",
        "createdAt": "2020-03-30T10:09:21",
        "reactions": []
      },
      {
        "id": 606468077,
        "author": "Gillibald",
        "body": "Closing this in favor of the concurrency PR. Will work in this when that is finished. ",
        "createdAt": "2020-03-31T08:06:00",
        "reactions": []
      }
    ]
  }
}