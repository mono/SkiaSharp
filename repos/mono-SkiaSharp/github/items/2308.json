{
  "number": 2308,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Cleartype / subpixel text rendering still broken?",
  "body": "**Description**\r\n\r\nCleartype / subpixel text rendering seems to (still) be broken.\r\nLast Update I\u0027ve seen is #830 from August, but the issue was already brought up in January.\r\nAs far as I can tell the entire 2.88.p1 - 2.88.3 version of SkiaSharp is affected.\r\nIs there any news on if / when this issue might get fixed?\r\n\r\n**Very simple WPF Desktop example**\r\n\u0060\u0060\u0060\r\nusing System.Windows;\r\nusing SkiaSharp;\r\nusing SkiaSharp.Views.Desktop;\r\n\r\nnamespace ClearType\r\n{\r\n    /// \u003Csummary\u003E\r\n    /// Interaction logic for MainWindow.xaml\r\n    /// \u003C/summary\u003E\r\n    public partial class MainWindow : Window\r\n    {\r\n\tpublic MainWindow()\r\n\t{\r\n\t\tInitializeComponent();\r\n\t}\r\n\r\n\tprivate void OnPaintSurface(object sender, SKPaintSurfaceEventArgs e)\r\n\t{\r\n\t\t// the the canvas and properties\r\n\t\tvar canvas = e.Surface.Canvas;\r\n\r\n\t\t// get the screen density for scaling\r\n\t\tvar scale = 1f;\r\n\t\tvar scaledSize = new SKSize(e.Info.Width / scale, e.Info.Height / scale);\r\n\r\n\t\t// handle the device screen density\r\n\t\tcanvas.Scale(scale);\r\n\r\n\t\t// make sure the canvas is blank\r\n\t\tcanvas.Clear(SKColors.White);\r\n\r\n\t\t// draw some text\r\n\t\tvar paint = new SKPaint\r\n\t\t{\r\n\t\t\tColor = SKColors.Black,\r\n\t\t\tIsAntialias = true,\r\n\t\t\tStyle = SKPaintStyle.Fill,\r\n\t\t\tTextAlign = SKTextAlign.Center,\r\n\t\t\tTextSize = 24\r\n\t\t};\r\n\r\n\t\tvar font = new SKFont\r\n\t\t{\r\n\t\t\tEdging = SKFontEdging.SubpixelAntialias,\r\n\t\t\tSize = 24\r\n\t\t};\r\n\r\n\t\tcanvas.DrawText(\r\n\t\t\t\u0022SkiaSharp\u0022,\r\n\t\t\tscaledSize.Width / 2,\r\n\t\t\t(scaledSize.Height \u002B paint.TextSize) / 2,\r\n\t\t\tfont,\r\n\t\t\tpaint);\r\n\t}\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\n**Expected Behavior**\r\n\r\nWhen I\u0027m running the old UWP example posted by @cilliemalan #830 \r\n(Or if I downgrade my SkiaSharp version to 2.80.4)\r\nSubpixel AA text rendering works as expected. (zoomed in):\r\n![Expected](https://user-images.githubusercontent.com/7701826/201118236-7f474afb-68f6-4bc6-9fe8-6e4d8f43aecd.png)\r\n\r\n**Actual Behavior**\r\n\r\nWhen I\u0027m running my ported WPF example (using the same code above)\r\nText ist rendered using standard AA (zoomed in):\r\n![Result](https://user-images.githubusercontent.com/7701826/201117803-ba5f8e69-faec-4eaa-a501-1a2c9840c51f.png)\r\n\r\n**Basic Information**\r\n\r\n- Version with issue: 2.88.3\r\n- Last known good version: 2.80.4\r\n- IDE: Visual Studio 2022\r\n- Platform Target Frameworks: Windows 10\r\n",
  "author": {
    "login": "AquilaAbriel",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-11-10T15:17:48",
  "updatedAt": "2023-01-01T18:00:48",
  "closedAt": "2022-12-02T15:29:00",
  "commentCount": 6,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:47:26.7172225Z",
    "reactions": [],
    "comments": [
      {
        "id": 1328363832,
        "author": "themcoo",
        "body": "The change was actually done in google/skia, related to https://bugs.chromium.org/p/skia/issues/detail?id=3934\r\n\r\nSo in short words the \u0060PixelGeometry\u0060 on created surface is now defaulting to \u0060Unknown\u0060 instead of \u0060RgbHorizontal\u0060. To bring back the default behaviour the \u0060SKSurface\u0060 ctor must be provided \u0060SKSurfaceProperties\u0060 with \u0060SKPixelGeometry.RgbHorizontal\u0060, e.g.:\r\n\r\n\u0060using var surface = SKSurface.Create(imageInfo, new SKSurfaceProperties(SKPixelGeometry.RgbHorizontal));\u0060",
        "createdAt": "2022-11-27T23:09:47",
        "reactions": [
          {
            "user": "michaldobrodenka",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:47:25.6157157Z"
          }
        ]
      },
      {
        "id": 1328427486,
        "author": "AquilaAbriel",
        "body": "Thank you very much, for your response and for the insight into this problem!\r\nBut I\u0027m still wondering how to specify the surface properties on creation...\r\nI\u0027m using the (winforms) SKGL Control, which as far as I can tell, creates its internal surface automatically.\r\nThe SKGLControl doesn\u0027t seem to accept any parameters which specify the surface properties.\r\n\r\nP.s.\r\nOkay, I think I found a bypass... and subpixel AA finally works.\r\nIf I create an additional SKSurface and use it as a rendertarget, I can specify its SKPixelGeometry.\r\nAll I have to do, is to draw into that offscreen rendertarget and later redraw that surface onto the SKGL surface.\r\nBut I\u0027m still wondering, if there is a way to tell the SKGLControl to use a different SKPixelGeometry for its surface.\r\n\r\nI would consider this issue closed then.",
        "createdAt": "2022-11-28T01:58:30",
        "reactions": []
      },
      {
        "id": 1328659046,
        "author": "themcoo",
        "body": "Well I haven\u0027t used any skiasharp views, but just going through the code I don\u0027t see a possibility currently to hook up with different pixel geometry. Glad that at least you could find a workaround",
        "createdAt": "2022-11-28T07:35:43",
        "reactions": []
      },
      {
        "id": 1328716555,
        "author": "michaldobrodenka",
        "body": "@themcoo Thank you! Good news is that I tried it and it works! I\u0027m rendering text for embedded devices, so I\u0027m rendering to ram and I can create surface I want. In order to work, only few types of SKColorTypes are supported (parameter of SKImageInfo ctor which is parameter of SKSurface.Create() ). I found only SKColorType.Bgra8888 for be working - default on windows. (not even SKColorType.Rgba8888, 565 etc)\r\n\r\nBad news is that I can\u0027t get vertical SKPixelGeometry font edging to work. (My device display is 90 rotated)",
        "createdAt": "2022-11-28T08:35:44",
        "reactions": []
      },
      {
        "id": 1328788983,
        "author": "themcoo",
        "body": "Indeed vertial geometry is somewhat ignored. But that\u0027s too deep in glyph rendering engine in google/skia for me to find time to investigate. For another workaround you could render everything on you offscreen canvas rotated -90 degrees and then render the canvas rotated 90 degrees back :)",
        "createdAt": "2022-11-28T09:38:56",
        "reactions": [
          {
            "user": "michaldobrodenka",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:47:26.4496993Z"
          }
        ]
      },
      {
        "id": 1328848511,
        "author": "michaldobrodenka",
        "body": "It would be nice if I could set for WPF SKElement (and also on other platforms) Pixel geometry other than unknown",
        "createdAt": "2022-11-28T10:26:31",
        "reactions": []
      }
    ]
  }
}