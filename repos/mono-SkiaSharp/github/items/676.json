{
  "number": 676,
  "type": "issue",
  "state": "closed",
  "title": "Support Windows Nano Server",
  "body": "### Description\r\n\r\nWindows Nano Server is missing some dlls, so SkiaSharp does not work. Related to https://github.com/mono/SkiaSharp/issues/591\r\n\r\n\r\nHaving a look at Nano Server... Ran the \u0060NanoServerApiScan.exe\u0060 tool from: https://blogs.technet.microsoft.com/nanoserver/2016/04/27/nanoserverapiscan-exe-updated-for-tp5/\r\n\r\n\u0060\u0060\u0060\r\n=== libSkiaSharp.dll ===\r\n\r\nERRORS:\r\n\r\n  FONTSUB.dll\r\n    CreateFontPackage(Proc not found)\r\n  USER32.dll\r\n    SystemParametersInfoW(Proc not found)\r\n  MSVCP140.dll\r\n    \u2026\r\n    \u2026\r\n    \u2026\r\n      Please copy Nano Server compliant MSVCP140.dll from %ProgramFiles(x86)%\\Microsoft Visual Studio 14.0\\VC\\redist\\onecore\\x64\\Microsoft.VC140.CRT\\\r\n  VCRUNTIME140.dll\r\n    \u2026\r\n    \u2026\r\n    \u2026\r\n      Please copy Nano Server compliant VCRUNTIME140.dll from %ProgramFiles(x86)%\\Microsoft Visual Studio 14.0\\VC\\redist\\onecore\\x64\\Microsoft.VC140.CRT\\\r\n\u0060\u0060\u0060\r\n\r\nI need to investigate the 2 usages that appear to be bad:\r\n\r\n - FONTSUB.dll (CreateFontPackage)\r\n - USER32.dll (SystemParametersInfoW)\r\n\r\n---\r\n\r\nJust did some investigation :)\r\n\r\n\u0060CreateFontPackage\u0060 from FONTSUB.dll is just for XPS support - and this is also just for font subsetting. The UWP build does not have this at all, so I could just remove it for a nano build.\r\n\r\n\u0060SystemParametersInfoW\u0060 from USER32.dll is also not too essential - it is just for determining the default font. Again, this is not available for UWP - we just pick the \u0022Segoe UI\u0022 which we know is available by default.\r\n\r\nNano Server support could very well be possible in the near future - just have to check priorities.\r\n\r\nAdd your vote to this issue so we can prioritize this issue.\n\n\u003E VS bug [#727251](https://devdiv.visualstudio.com/DevDiv/_workitems/edit/727251)",
  "author": {
    "login": "mattleibow",
    "type": "User"
  },
  "labels": [
    {
      "name": "status/low-priority",
      "color": "B8EC4A"
    },
    {
      "name": "os/Windows-Classic",
      "color": "fbca04"
    },
    {
      "name": "area/SkiaSharp",
      "color": "0052cc"
    },
    {
      "name": "area/libSkiaSharp.native",
      "color": "0052cc"
    },
    {
      "name": "type/feature-request",
      "color": "ededed"
    }
  ],
  "assignees": [
    {
      "login": "mattleibow",
      "type": "User"
    }
  ],
  "milestone": "v1.68.1.1",
  "createdAt": "2018-11-06T17:55:48",
  "updatedAt": "2022-08-19T12:02:48",
  "closedAt": "2019-12-04T01:12:15",
  "commentCount": 13,
  "reactionCount": 41,
  "engagement": {
    "syncedAt": "2026-02-06T14:05:02.1454846Z",
    "reactions": [
      {
        "user": "iamcarbon",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454882Z"
      },
      {
        "user": "cschwarz",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454889Z"
      },
      {
        "user": "evgeny-kuleshov",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.145489Z"
      },
      {
        "user": "kain-tm",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454891Z"
      },
      {
        "user": "edward-raven",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454892Z"
      },
      {
        "user": "btolfa",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454894Z"
      },
      {
        "user": "dumka",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454895Z"
      },
      {
        "user": "sakozlov-r62",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454896Z"
      },
      {
        "user": "inavrotskiy",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454897Z"
      },
      {
        "user": "AndreyNNN",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454898Z"
      },
      {
        "user": "Norfo",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.14549Z"
      },
      {
        "user": "EatenHardship",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454901Z"
      },
      {
        "user": "DVorobyev",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454902Z"
      },
      {
        "user": "Artblack",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454904Z"
      },
      {
        "user": "i-mochalov",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454905Z"
      },
      {
        "user": "SML-DmitrySokolov",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454906Z"
      },
      {
        "user": "falleretic",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454907Z"
      },
      {
        "user": "alexeybut",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454908Z"
      },
      {
        "user": "stdstring",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454909Z"
      },
      {
        "user": "dvdarkin",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.145491Z"
      },
      {
        "user": "vchebotok",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454911Z"
      },
      {
        "user": "mattleibow",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454912Z"
      },
      {
        "user": "romans91",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454913Z"
      },
      {
        "user": "azhilt",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454914Z"
      },
      {
        "user": "timcovar",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454915Z"
      },
      {
        "user": "konst-tin",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454917Z"
      },
      {
        "user": "sdfleod",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454918Z"
      },
      {
        "user": "steffenloesch",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454919Z"
      },
      {
        "user": "ilyaegorov",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.145492Z"
      },
      {
        "user": "jewijaya",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454921Z"
      },
      {
        "user": "Starkie",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454923Z"
      },
      {
        "user": "ADD-Juan-Perez",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454924Z"
      },
      {
        "user": "VictorIranzo",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454925Z"
      },
      {
        "user": "Suriman",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454926Z"
      },
      {
        "user": "slakul",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454927Z"
      },
      {
        "user": "warrenxxx",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454929Z"
      },
      {
        "user": "3xanimo",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.145493Z"
      },
      {
        "user": "AlexNosk",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454931Z"
      },
      {
        "user": "dennisbot",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454932Z"
      },
      {
        "user": "jeffska",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454935Z"
      },
      {
        "user": "OPSnake",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:05:02.1454937Z"
      }
    ],
    "comments": [
      {
        "id": 477163433,
        "author": "Starkie",
        "body": "We just ran into this issue while trying to deploy an ASP.Net Core microservice dependent on SkiaSharp with the \u0060microsoft/dotnet:2.2-aspnetcore-runtime\u0060 image.\r\n\r\nAre there any news regarding this? \uD83D\uDE22",
        "createdAt": "2019-03-27T13:49:49",
        "reactions": [
          {
            "user": "VictorIranzo",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:04:59.4812245Z"
          },
          {
            "user": "Suriman",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:04:59.481225Z"
          },
          {
            "user": "ADD-Juan-Perez",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:04:59.4812251Z"
          },
          {
            "user": "dennisbot",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:04:59.4812252Z"
          }
        ]
      },
      {
        "id": 546279695,
        "author": "VictorIranzo",
        "body": "@mattleibow Are there any news or other issues to follow related with this?",
        "createdAt": "2019-10-25T09:30:07",
        "reactions": []
      },
      {
        "id": 552796253,
        "author": "AlexNosk",
        "body": "@mattleibow We encountered the same problem when deploying Azure Functions. Are there any news about this? ",
        "createdAt": "2019-11-12T08:53:53",
        "reactions": []
      },
      {
        "id": 554214894,
        "author": "vijayasurya20",
        "body": "Hi Team,\r\n\r\nAre there any news regarding this?\r\n\r\nRegards,\r\nVijayasurya A\r\n",
        "createdAt": "2019-11-15T05:10:01",
        "reactions": []
      },
      {
        "id": 554235377,
        "author": "Gillibald",
        "body": "Sounds like we just need a new target \u0060externals-nano-server\u0060 and leave out the parts that depend on not supported api. So in the end this is mostly how the UWP build works.",
        "createdAt": "2019-11-15T06:43:53",
        "reactions": []
      },
      {
        "id": 554669755,
        "author": "mattleibow",
        "body": "We just need to figure out how we would actually package this. Right now the Win32 is in the main NuGet. We might need to see how devs would use this. Will they use VS on Windows and do testing, and then deploy to Nano? If so, we need to find a way to have dotnet publish (and similar) to actually use the Nano binaries. That will probably be the hardest part - how do we distinguish between desktop vs nano Win32? NuGet has RIDs, but this is just win-xxx versions. Unless there is a more specific one for Nano?\r\n\r\nI feel like I opened an issue for this already... somewhere...\r\n\r\nFound it: https://github.com/NuGet/Home/issues/7375 Seems they closed it and want me to do the work. Not going to happen \uD83D\uDE09 They must step up to make the NuGet feature actually not just a patch-job for UWP.",
        "createdAt": "2019-11-16T20:06:28",
        "reactions": []
      },
      {
        "id": 554684127,
        "author": "mattleibow",
        "body": "Just wrapped the \u0060NanoServerApiScan\u0060 tool in a nice .NET Core tool: https://github.com/mattleibow/nano-api-scan\r\n\r\n\u0060\u0060\u0060\r\nnano-api-scan path/to/libSkiaSharp.dll\r\n\u0060\u0060\u0060\r\n\r\nAfter switching to static builds and Clang, we now only have a single method that we have to worry about:\r\n\r\n\u0060\u0060\u0060\r\n=== libSkiaSharp.dll ===\r\n\r\nERRORS:\r\n\r\n  FONTSUB.dll\r\n    CreateFontPackage(Proc not found)\r\n\u0060\u0060\u0060",
        "createdAt": "2019-11-16T23:25:52",
        "reactions": []
      },
      {
        "id": 554700005,
        "author": "mattleibow",
        "body": "Good news! I think we can get Nano Server in for the next release I am planning next week if this build goes well: https://github.com/mono/SkiaSharp/pull/1013/commits/b265b430f098259fc5bba2d4b8531cec1c37d311\r\n\r\nPretty much, I can exclude the usage in the comment above and no one woulds care - that is just for the experimental XPS document type subsetter. I have no numbers, but I don\u0027t think anyone would use that as we have better PDF support. Who uses XPS anyway? Hoping that the logic that I have for the \u0022no dependencies\u0022 build of linux can be reused to created a \u0022nano server\u0022 build.\r\n\r\nFrom what I can see so far, we could get this working. Not going to be the prettiest at the moment because of the way the PackageReference and things work - and the open issue on NuGet (https://github.com/NuGet/Home/issues/7375) makes is messy.\r\n\r\nBut, the usage looks to be:\r\n\r\n\u0060\u0060\u0060xml\r\n\u003CPackageReference Include=\u0022SkiaSharp\u0022 ExcludeAssets=\u0022native\u0022 /\u003E\r\n\u003CPackageReference Include=\u0022SkiaSharp.NativeAssets.NanoServer\u0022 /\u003E\r\n\u0060\u0060\u0060\r\n\r\nThis is basically saying work as normal, but instead of using the native runtime bits from \u0022SkiaSharp\u0022, ignore it and use the \u0022SkiaSharp.NativeAssets.NanoServer\u0022 instead. This only has to be done on the top-level app as the runtimes are only used on dotnet run and dotnet publish.\r\n\r\nNot sure if this will work nicely, need to do a bit of testing. Fingers crossed.",
        "createdAt": "2019-11-17T03:31:30",
        "reactions": []
      },
      {
        "id": 554700486,
        "author": "mattleibow",
        "body": "Heh, I think I was getting ahead of myself... next week is like Wednesday and there is no way a reasonable person should go stable with just a weekend hack :) Moved it out to a new PR #1014 that I will merge after I release. I want to try and get a more frequent release cadence with SkiaSharp - and give people more time to actually test Nano Server.",
        "createdAt": "2019-11-17T03:38:15",
        "reactions": []
      },
      {
        "id": 554759976,
        "author": "mattleibow",
        "body": "Check out this build\u0027s artifacts: https://dev.azure.com/xamarin/public/_build/results?buildId=9982\u0026view=results",
        "createdAt": "2019-11-17T15:59:56",
        "reactions": []
      },
      {
        "id": 561395767,
        "author": "mattleibow",
        "body": "I think I am almost ready to get this in with #1040 So far, Nano Server seems to be working\r\n",
        "createdAt": "2019-12-03T22:59:06",
        "reactions": []
      },
      {
        "id": 561430401,
        "author": "mattleibow",
        "body": "Merged into master! Will push out some packages to the early-access feed as soon as CI is done. Also hope to go public preview soon as well.",
        "createdAt": "2019-12-04T01:15:37",
        "reactions": [
          {
            "user": "daltonks",
            "content": "hooray",
            "createdAt": "2026-02-06T14:05:01.874089Z"
          },
          {
            "user": "AlexNosk",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:05:01.8740894Z"
          },
          {
            "user": "Starkie",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:05:01.8740895Z"
          }
        ]
      },
      {
        "id": 563479999,
        "author": "mattleibow",
        "body": "Just linking this new issue : https://github.com/NuGet/Home/issues/8894",
        "createdAt": "2019-12-09T23:02:09",
        "reactions": []
      }
    ]
  }
}