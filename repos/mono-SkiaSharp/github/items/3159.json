{
  "number": 3159,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SKBitmap.ScalePixels - image downsizing. Quality regression.",
  "body": "### Description\n\nBitmap downsizing using SKBitmap.ScalePixels in version 3.116.1 produces images of a larger size and of a lower quality compared to version 2.88.9\n\nOriginal image (1440X720): https://ptdt.azureedge.net/data/test/large.png\nResized using v2.88.9 (480X240): https://ptdt.azureedge.net/data/test/small_v2.webp\nResized using v3.116.1 (480X240): https://ptdt.azureedge.net/data/test/small_v3.webp\n\n### Code\n\n// version 2.88.9\nbitmapSrc.ScalePixels(bitmapDst, SKFilterQuality.High);\nskDataWebp = bitmapDst.Encode(SKEncodedImageFormat.Webp, 75); // convert to webp format\n\n// version 3.116.1 - SKFilterQuality is obsolete\n// use SKSamplingOptions variant equivalent to SKFilterQuality.High\nSKSamplingOptions samplingOptions = new SKSamplingOptions(resampler: SKCubicResampler.Mitchell);\nbitmapSrc.ScalePixels(bitmapDst, samplingOptions);\nskDataWebp = bitmapDst.Encode(SKEncodedImageFormat.Webp, 75); // convert to webp format\n\n\n### Expected Behavior\n\nThe downsized image is expected to be of the same quality and size.  \n\n### Actual Behavior\n\nThe downsized image is larger and of inferior quality.  \n\n### Version of SkiaSharp\n\n3.116.0 (Current)\n\n### Last Known Good Version of SkiaSharp\n\n2.88.9 (Previous)\n\n### IDE / Editor\n\nVisual Studio (Windows), Visual Studio Code (macOS)\n\n### Platform / Operating System\n\nWindows, Mac Catalyst\n\n### Platform / Operating System Version\n\nWindows 11 24H2, macOS 15.1.1\n\n### Devices\n\nDesktop\n\n### Relevant Screenshots\n\nOriginal image (1440X720): https://ptdt.azureedge.net/data/test/large.png\nResized using v2.88.9 (480X240): https://ptdt.azureedge.net/data/test/small_v2.webp\nResized using v3.116.1 (480X240): https://ptdt.azureedge.net/data/test/small_v3.webp\n\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\n\n\u0060\u0060\u0060\n\n### Code of Conduct\n\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "paratype-fonts",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2025-02-08T01:00:25",
  "updatedAt": "2025-07-05T05:03:57",
  "commentCount": 2,
  "reactionCount": 6,
  "engagement": {
    "syncedAt": "2026-02-06T13:26:12.0787074Z",
    "reactions": [
      {
        "user": "CePur",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:26:12.0787137Z"
      },
      {
        "user": "danielcaceresm",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:26:12.0787146Z"
      },
      {
        "user": "vitalii-sitnikov",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:26:12.078715Z"
      },
      {
        "user": "codelovercc",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:26:12.0787153Z"
      },
      {
        "user": "taublast",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:26:12.0787157Z"
      },
      {
        "user": "dpvq",
        "content": "\u002B1",
        "createdAt": "2026-02-06T13:26:12.0787159Z"
      }
    ],
    "comments": [
      {
        "id": 2888746726,
        "author": "gnattu",
        "body": "Late to the party, but I will post what the actual problem is and how we resolved our issue here.\n\nGoogle\u0027s API implementation has a leaky abstraction. That is, you have to change your behavior to match its old API internal implementation to have the same result.\n\nAlthough \u0060SKFilterQuality.High\u0060 used to imply \u0060SKCubicResampler.Mitchell\u0060, but **this is only the case for up-sampling**.\n\nIf you specified \u0060SKFilterQuality.High\u0060 and you are actually down-sampling, the image like we are doing here, skia would switch back to \u0060SKFilterQuality.Medium\u0060 internally which does not use cubic resampler at all, but instead, a bilinear filter plus mipmaps: \u0060new SKSamplingOptions(SKFilterMode.Linear, SKMipmapMode.Linear)\u0060.\n\nTo migrate to this new API and retaining the quality for downsized images, you have to check if the resizing is actually upscaling and select the ideal sampling option.\n\nAfter changing our code to use \u0060new SKSamplingOptions(SKFilterMode.Linear, SKMipmapMode.Linear)\u0060 when downscaling, we are getting the results same as the old API. ",
        "createdAt": "2025-05-18T03:46:29",
        "reactions": [
          {
            "user": "taublast",
            "content": "heart",
            "createdAt": "2026-02-06T13:26:11.8094182Z"
          },
          {
            "user": "Dblm0",
            "content": "heart",
            "createdAt": "2026-02-06T13:26:11.8094186Z"
          },
          {
            "user": "snowflysky",
            "content": "heart",
            "createdAt": "2026-02-06T13:26:11.8094187Z"
          },
          {
            "user": "MrJul",
            "content": "heart",
            "createdAt": "2026-02-06T13:26:11.8094188Z"
          }
        ]
      },
      {
        "id": 3037162785,
        "author": "taublast",
        "body": "@gnattu awesome, thanks for sharing!\n\n\u0060\u0060\u0060csharp\n// For upscaling - use cubic\nvar upsampleOptions = new SKSamplingOptions(SkCubicResampler.Mitchell);\n\n// For downscaling - consider using linear with mipmaps instead\nvar downsampleOptions = new SKSamplingOptions(SKFilterMode.Linear, SKMipmapMode.Linear);\n\n// Combined  \nbool isUpscaling = targetSize \u003E sourceSize;\nvar samplingOptions = isUpscaling \n    ? new SKSamplingOptions(SkCubicResampler.Mitchell)\n    : new SKSamplingOptions(SKFilterMode.Linear, SKMipmapMode.Linear);\n\u0060\u0060\u0060",
        "createdAt": "2025-07-04T20:02:27",
        "reactions": []
      }
    ]
  }
}