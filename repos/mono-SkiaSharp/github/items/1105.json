{
  "number": 1105,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SKTypeface cannot be created in a Windows Nano Server Docker container",
  "body": "**Description**\r\n\r\nSkTypeface cannot be created in Windows Docker container. It simply returns null. I use SkiaSharp 1.68.1.1 version and SkiaSharp.NativeAssets.NanoServer 1.68.1.1 version. .csproj file is modified as required\r\n\r\n  \u003CItemGroup\u003E\r\n    \u003CPackageReference Include=\u0022SkiaSharp\u0022 ExcludeAssets=\u0022native\u0022 Version=\u00221.68.1.1\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022SkiaSharp.NativeAssets.NanoServer\u0022 Version=\u00221.68.1.1\u0022 /\u003E\r\n  \u003C/ItemGroup\u003E\r\n\r\nI tried creating SkTypeface from file, stream, family name with the same result - SkTypeface is null. Also SkTypeface.CreateDefault() returns SkTypeface that is not null, but FamilyName is empty.\r\n\r\n**Code**\r\n\r\n            SKTypeface typeface = SKTypeface.FromFamilyName(\u0022Lucida Console\u0022, SKFontStyleWeight.Normal, SKFontStyleWidth.Normal, SKFontStyleSlant.Upright);\r\n            Console.WriteLine(\u0022SkSKTypeface created from family name - {0}\u0022, typeface != null);\r\n\r\n            const string fontFileName = @\u0022C:\\Windows\\Fonts\\lucon.ttf\u0022;\r\n            typeface = SKTypeface.FromFile(fontFileName);\r\n            Console.WriteLine(\u0022SkSKTypeface created from file name - {0}\u0022, typeface != null);\r\n\r\n            using (FileStream fs = File.OpenRead(fontFileName))\r\n            {\r\n                typeface = SKTypeface.FromStream(fs);\r\n                Console.WriteLine(\u0022SkSKTypeface created from stream - {0}\u0022, typeface != null);\r\n            }\r\n\r\n            typeface = SKTypeface.CreateDefault();\r\n            Console.WriteLine(typeface.FamilyName);\r\n\r\n",
  "author": {
    "login": "AlexNosk",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2020-01-16T12:19:21",
  "updatedAt": "2024-03-01T12:13:21",
  "commentCount": 25,
  "reactionCount": 1,
  "engagement": {
    "syncedAt": "2026-02-06T12:56:49.6701103Z",
    "reactions": [
      {
        "user": "RamarajMarimuthu",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:56:49.6701151Z"
      }
    ],
    "comments": [
      {
        "id": 575137645,
        "author": "Gillibald",
        "body": "What yields https://docs.microsoft.com/en-us/dotnet/api/skiasharp.skfontmanager.fontfamilies?view=skiasharp-1.68.1#SkiaSharp_SKFontManager_FontFamilies for you? Does it contain any font family? ",
        "createdAt": "2020-01-16T12:52:10",
        "reactions": []
      },
      {
        "id": 575143845,
        "author": "AlexNosk",
        "body": "@Gillibald  \r\nSKFontManager.Default.FontFamilyCount returns zero and SKFontManager.Default.FontFamilies is empty.",
        "createdAt": "2020-01-16T13:10:27",
        "reactions": []
      },
      {
        "id": 575156866,
        "author": "Gillibald",
        "body": "I guess the nano server build has no font manager implementation https://github.com/google/skia/blob/master/src/core/SkFontMgr.cpp\r\n\r\nhttps://github.com/google/skia/blob/master/src/core/SkFontMgr.cpp#L80 for example returns nullptr if not overridden. ",
        "createdAt": "2020-01-16T13:43:14",
        "reactions": []
      },
      {
        "id": 575948098,
        "author": "mattleibow",
        "body": "The facts. The Nano Server dll is actually working. It really is just the same as the Win32 dll, except that there is a single method that is a no-op for XPS type subsetting. That is the only difference. You can actually use the Nano Server dll on full Windows to test.\r\n\r\nSo, why is it not working? Well, guess what - the required dwrite.dll for DirectWrite is missing on Nano Server. This file \u0060C:\\Windows\\System32\\DWrite.dll\u0060\r\n\r\nI did not expect that. Not sure why that is not in the docker images. I see this list of APIs does not have it there either: https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/mt588480(v=vs.85)\r\n\r\nI am not sure how we are supposed to draw text on Nano Server... I thought DirectWrite was the way forward. I will have to check to see what is going on.\r\n\r\nThis is the line that is failing: \r\nhttps://github.com/mono/skia/blob/xamarin-mobile-bindings/src/utils/win/SkDWrite.cpp#L31\r\n\r\n\u0060\u0060\u0060cpp\r\nGetProcAddress(LoadLibraryW(L\u0022dwrite.dll\u0022), \u0022DWriteCreateFactory\u0022));\r\n\u0060\u0060\u0060\r\n\r\nIt is because this returns null \u0060LoadLibraryW(L\u0022dwrite.dll\u0022)\u0060.",
        "createdAt": "2020-01-18T23:32:20",
        "reactions": []
      },
      {
        "id": 575953371,
        "author": "Gillibald",
        "body": "Might GDI work?\r\n\r\nThis would involve a custom font manager implementation probably the directory font manager.",
        "createdAt": "2020-01-19T00:50:49",
        "reactions": []
      },
      {
        "id": 577018025,
        "author": "RamarajMarimuthu",
        "body": "Hi Guys,\r\n\r\nWe are also facing the same issue while creating a SkTypeface in Windows Nano Server with Docker. Could you please help me to resolve this.\r\n\r\n**FYI** - \u201CSKTypeface.Default\u201D static property return a SkTypeface object with empty font name in Nano server, which is return \u0022Segoe UI\u0022 font in windows.\r\n\r\nThanks in advance.\r\n\r\nThanks,\r\nRamaraj Marimuthu.",
        "createdAt": "2020-01-22T05:44:14",
        "reactions": [
          {
            "user": "Prakash222",
            "content": "\u002B1",
            "createdAt": "2026-02-06T12:56:45.8884134Z"
          }
        ]
      },
      {
        "id": 577431058,
        "author": "mattleibow",
        "body": "@Gillibald sooooooo. I tried the GDI font manager, and that works locally. But, not on Nano Server. The entire usp10.dll is missing... I feel fear!",
        "createdAt": "2020-01-22T23:15:19",
        "reactions": []
      },
      {
        "id": 577453359,
        "author": "mattleibow",
        "body": "I will need to investigate this more as I have nothing at this point. What a bummer.",
        "createdAt": "2020-01-23T00:40:44",
        "reactions": []
      },
      {
        "id": 577499515,
        "author": "Gillibald",
        "body": "Probably time to invite Freetype to the party. Not sure how hard that would be to build for Windows. Freetype \u002B DirectoryFontManager",
        "createdAt": "2020-01-23T04:32:55",
        "reactions": []
      },
      {
        "id": 577777316,
        "author": "mattleibow",
        "body": "Yeah. Same results on Twitter and here: https://groups.google.com/forum/#!topic/skia-discuss/cfgRsNWcm6Q\r\n\r\nThe code is there and is used on linux/android, so hopefully only a small bit of work...",
        "createdAt": "2020-01-23T17:09:07",
        "reactions": []
      },
      {
        "id": 577799111,
        "author": "Gillibald",
        "body": "I am still dreaming about a customizable font rendering backend for SkiaSharp so users can supply managed implementations for the font manager etc. That way we could use Freetype bindings etc. But that is just some dream \uD83D\uDE00",
        "createdAt": "2020-01-23T18:03:41",
        "reactions": []
      },
      {
        "id": 585064722,
        "author": "RamarajMarimuthu",
        "body": "Hi Guys,\r\n\r\nAny update on this. We are eagerly waiting for the solution.\r\n\r\nThanks in advance.\r\n\r\nThanks,\r\nRamaraj Marimuthu.",
        "createdAt": "2020-02-12T07:15:29",
        "reactions": []
      },
      {
        "id": 585072519,
        "author": "Gillibald",
        "body": "We can\u0027t build Skia in combination with Freetype for the \u0060m68\u0060 release of \u0060Skia\u0060. The next major release of SkiaSharp will support this. We just need an extra build target for \u0060windows-externals-freetype\u0060 or something. This will support rendering with \u0060Freetype\u0060 but you have to use a dictionary font manager.\r\n@mattleibow https://github.com/google/skia/blob/master/BUILD.gn#L274",
        "createdAt": "2020-02-12T07:38:52",
        "reactions": []
      },
      {
        "id": 585073280,
        "author": "mattleibow",
        "body": "@RamarajMarimuthu unfortunately no good feedback. But, if you are not using any windows specific features, you might try the Linux containers.\r\n\r\nThe plus side to Linux is that they are smaller and can run side by side with the windows containers. \r\n\r\nNot the greatest answer, but we are still working on this. ",
        "createdAt": "2020-02-12T07:41:15",
        "reactions": []
      },
      {
        "id": 586581032,
        "author": "mattleibow",
        "body": "Just adding a note that Windows Server Core can still be used [like this example](https://github.com/mono/SkiaSharp/tree/master/samples/Basic/Docker/WebApi)",
        "createdAt": "2020-02-15T11:30:49",
        "reactions": []
      },
      {
        "id": 664956531,
        "author": "AlexNosk",
        "body": "@mattleibow Rechecked this with the latest stable SkiaSharp version and the problem is still there. By the way example you provided in the latest answer does not work. The created image does not contain text.",
        "createdAt": "2020-07-28T10:15:19",
        "reactions": []
      },
      {
        "id": 670379534,
        "author": "MadhanKumarasamy",
        "body": "@mattleibow If we can create the SKTypeface in Windows Docker Container and kindly mentioned the SkiaSharp version. So, that I can use the correct SkiaSharp version in my project.",
        "createdAt": "2020-08-07T07:42:40",
        "reactions": []
      },
      {
        "id": 670502308,
        "author": "mattleibow",
        "body": "@AlexNosk @MadhanKumarasamy  The issue here is that Windows Nano Server does not support the text drawing mechanisms required by SkiaSharp. I haven\u0027t yet gotten to trying out a build with FreeType, so for now the only option is to either use a Linux container or use Windows Server Core.\r\n\r\n@Gillibald did you ever get to try out a build with FreeType?",
        "createdAt": "2020-08-07T12:55:27",
        "reactions": []
      },
      {
        "id": 1023289277,
        "author": "milivojm",
        "body": "Hi,\r\n\r\nSixLabor.Fonts with fonts packed in Docker container built on Nano Server works. We have to measure rendered text length for some internal purpose. Give it a try -\u003E https://docs.sixlabors.com/articles/fonts/gettingstarted.html#expanded-example\r\n\r\nWe use aspnet:5.0.13-nanoserver-1809 as base image. **Do not to forget to pack font(s) with the application to docker image**.",
        "createdAt": "2022-01-27T14:50:26",
        "reactions": []
      },
      {
        "id": 1321486306,
        "author": "Ramaraj-Marimuthu",
        "body": "Hi @mattleibow \u0026 @Gillibald,\r\n\r\nAny update in this? Still we are waiting to use **SKTypeface** (SkiaSharp) in Windows Nano Server and Docker Windows Container.\r\n\r\nDo we have any plan to provide this support in SkiaSharp?\r\n\r\nThanks in advance.",
        "createdAt": "2022-11-21T05:29:06",
        "reactions": []
      },
      {
        "id": 1804166427,
        "author": "SevcikMichal",
        "body": "In case anyone stumble upon this.. \r\n\r\nIt is possible to copy the DWrite.dll to the final build of windows nano server container and then even the text rendering is working.\r\n\r\nI am not sure how robust/safe this solution is but at least for simple text rendering it works.",
        "createdAt": "2023-11-09T16:34:10",
        "reactions": []
      },
      {
        "id": 1846598173,
        "author": "AkashArul26",
        "body": "Hi @mattleibow \u0026 @Gillibald ,\r\n\r\nAny update on this? Still SKTypeFace (SkiaSharp) that we created using a stream is null and the default SKTypeFace is empty in Windows Container.\r\n\r\nAny solution for this?\r\n\r\nRegards,\r\nAkash.",
        "createdAt": "2023-12-08T06:09:50",
        "reactions": []
      },
      {
        "id": 1905392635,
        "author": "AkashArul26",
        "body": "Hi @mattleibow \u0026 @Gillibald ,\r\n\r\nAny update on this?\r\n\r\nRegards,\r\nAkash.",
        "createdAt": "2024-01-23T06:53:42",
        "reactions": []
      },
      {
        "id": 1973026038,
        "author": "mudderklirren",
        "body": "We also needs this, please get it fixed.",
        "createdAt": "2024-03-01T11:33:34",
        "reactions": []
      },
      {
        "id": 1973082415,
        "author": "Gillibald",
        "body": "There is nothing to fix here. Limitation of the platform.",
        "createdAt": "2024-03-01T12:13:20",
        "reactions": []
      }
    ]
  }
}