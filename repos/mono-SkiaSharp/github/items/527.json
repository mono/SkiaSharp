{
  "number": 527,
  "type": "issue",
  "state": "closed",
  "title": "Understanding PixelScaling",
  "body": "### Description\r\n\r\nI am somewhat confused about the system scale in Skia. Below is a sample that draws a line diagonally across the screen to the lower right corner (see screenshot). It does not end there because of the windows screen scale (of 1.25  in this case). I can compensate for this in two ways (see \u0027solution\u0027 in code comments). \r\n\r\n1. Ignore pixel scaling\r\n2. Scale the canvas\r\n\r\nMy question is, are these methods equivalent, or will one or the other work with a bigger bitmap in the background? \r\n\r\nAlso, I don\u0027t really understand why I, as a user, need to deal with the windows scaling at all. Should there perhaps be a way to set the dpi of the canvas instead, and keep the coordinate system intact at all times, unless the user explicitly scales the canvas?\r\n\r\n### Code\r\n\r\n\u0060\u0060\u0060c#\r\nusing System;\r\nusing System.Windows;\r\nusing System.Windows.Media;\r\nusing SkiaSharp;\r\nusing SkiaSharp.Views.Desktop;\r\n\r\nnamespace WpfScaleIssue\r\n{\r\n    /// \u003Csummary\u003E\r\n    /// Interaction logic for MainWindow.xaml\r\n    /// \u003C/summary\u003E\r\n    public partial class MainWindow\r\n    {\r\n        private float _scale;\r\n        private float _width;\r\n        private float _height;\r\n\r\n        public MainWindow()\r\n        {\r\n            InitializeComponent();\r\n\r\n            // Solution 1) Ignore pixel scaling\r\n            // SkiaCanvas.IgnorePixelScaling = true;\r\n\r\n            SkiaCanvas.PaintSurface \u002B= SkiaCanvasOnPaintSurface;\r\n            CompositionTarget.Rendering \u002B= (sender, args) =\u003E InvalidateVisual();\r\n\r\n            SizeChanged \u002B= (sender, args) =\u003E\r\n            {\r\n                _scale = DetermineSkiaScale();\r\n                _width = (float)SkiaCanvas.ActualWidth;\r\n                _height = (float)SkiaCanvas.ActualHeight;\r\n            };\r\n        }\r\n\r\n        private void SkiaCanvasOnPaintSurface(object sender, SKPaintSurfaceEventArgs args)\r\n        {\r\n            // Solution 2) Scale the canvas\r\n            // args.Surface.Canvas.SetMatrix(SKMatrix.MakeScale(_scale, _scale));\r\n            \r\n            Draw(args.Surface.Canvas);\r\n        }\r\n\r\n        private void Draw(SKCanvas canvas)\r\n        {\r\n            canvas.Clear(SKColors.LightPink);\r\n            canvas.DrawLine(0, 0, _width, _height, new SKPaint { Color = SKColors.Red });\r\n            canvas.DrawCircle(_width, _height, 10, new SKPaint { Color = SKColors.Red });\r\n        }\r\n\r\n        private float DetermineSkiaScale()\r\n        {\r\n            var presentationSource = PresentationSource.FromVisual(this);\r\n            if (presentationSource == null) throw new Exception(\u0022PresentationSource is null\u0022);\r\n            var compositionTarget = presentationSource.CompositionTarget;\r\n            if (compositionTarget == null) throw new Exception(\u0022CompositionTarget is null\u0022);\r\n\r\n            var matrix = compositionTarget.TransformToDevice;\r\n\r\n            var dpiX = matrix.M11;\r\n            var dpiY = matrix.M22;\r\n\r\n            if (dpiX != dpiY) throw new ArgumentException();\r\n\r\n            return (float)dpiX;\r\n        }\r\n    }\r\n}\r\n\r\n\u0060\u0060\u0060\r\n### Basic Information\r\n\r\n- Version with issue:  1.60.1\r\n- Last known good version:  All the same\r\n- IDE:  Visual Studio\r\n- Platform Target Frameworks: WPF\r\n\r\n### Screenshots\r\n\r\n![image](https://user-images.githubusercontent.com/963462/40476122-8a03dd9e-5f43-11e8-88f8-4e84559cdb39.png)\r\n\r\n### Reproduction Link\r\n\r\nhttps://github.com/pauldendulk/SkiaSharpPlayGround\r\n",
  "author": {
    "login": "pauldendulk",
    "type": "User"
  },
  "labels": [
    {
      "name": "area/Docs",
      "color": "0052cc"
    }
  ],
  "assignees": [],
  "createdAt": "2018-05-24T12:16:20",
  "updatedAt": "2022-08-19T15:02:28",
  "closedAt": "2020-03-08T07:50:38",
  "commentCount": 4,
  "reactionCount": 1,
  "engagement": {
    "syncedAt": "2026-02-06T14:02:57.0232322Z",
    "reactions": [
      {
        "user": "mgnslndh",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:02:57.0232397Z"
      }
    ],
    "comments": [
      {
        "id": 393033293,
        "author": "pauldendulk",
        "body": "There is some information in this article: [Pixels and Device-Independent Units](https://docs.microsoft.com/en-us/xamarin/xamarin-forms/user-interface/graphics/skiasharp/basics/pixels).\r\n\r\nI don\u0027t work with Forms so measured the above values in WPF and Android.\r\n\r\n**WPF with IgnorePixelScale = false**\r\n- SkiaCanvas.ActualWidth = 785\r\n- SkiaCanvas.CanvasSize.Width = 982\r\n- args.Info.Width = 982\r\n\r\n**WPF with IgnorePixelScale = true**\r\n- SkiaCanvas.ActualWidth = 785\r\n- SkiaCanvas.CanvasSize.Width = 785\r\n- args.Info.Width = 785\r\n\r\nI think UWP it has the same pattern. On Android the pattern is different however.\r\n\r\n**Android with IgnorePixelScale = false**\r\n- _skCanvasView.Width = 1080\r\n- _skCanvasView.CanvasSize.Width = 1080\r\n- args.Info.Width = 1080\r\n\r\n**Android with IgnorePixelScale = true**\r\n- _skCanvasView.Width = 1080\r\n- _skCanvasView.CanvasSize.Width = 360\r\n- args.Info.Width = 360\r\n\r\nI now understand part of my confusion. On Android I get coordinates in device pixels and on the other platforms I get device independent units. This is why I failed to implement my platforms in a consistent way. \r\n\r\nThe article above states\r\n\r\n\u003E If you\u0027d prefer to work entirely in device-independent units, you can do so by setting the IgnorePixelScaling property of the SKCanvasView to true. However, you might not like the results. SkiaSharp renders the graphics on a smaller device surface, with a pixel size equal to the size of the view in device-independent units. \r\n\r\nSo, is it correct to say that IgnorePixelScale could be read as UseDeviceIndependentUnits? \r\n\r\nWhat I also find confusing is that with something called \u0027Ignore...\u0027 I expect things to stay the same, but on Android I does actually alter my coordinate system.\r\n\r\n \r\n \r\n\r\n\r\n\r\n\r\n",
        "createdAt": "2018-05-30T05:17:18",
        "reactions": []
      },
      {
        "id": 596176954,
        "author": "pauldendulk",
        "body": "For me this item can be closed. There is documentation here on IgnorePixelScaling.\r\nhttps://docs.microsoft.com/en-us/dotnet/api/skiasharp.views.ios.skcanvasview.ignorepixelscaling?view=skiasharp-views-1.68.1.\r\n\r\nFor our purposes in Mapsui IgnorePixelScaling was just the wrong way of scaling. It caused pixelation as described in the docs. We use SKCanvas.Scale(float sx, float sy) instead.\r\n\r\nAnother part of the confusion was that on Android we get coordinates in device pixels and on the other platforms we get coordinates in device independent units. We correct for this with our PixelDensity field.\r\n\r\n",
        "createdAt": "2020-03-08T07:50:38",
        "reactions": []
      },
      {
        "id": 599263529,
        "author": "mattleibow",
        "body": "@pauldendulk yeah... unfortunately I made bad decisions about that one. No idea why I did it that way, it was always bad.\r\n\r\nI am thinking of re-working that one maybe in the v2 release. This should be the same code, but the correct implementation. Effectively transparent to the user.",
        "createdAt": "2020-03-15T20:56:10",
        "reactions": [
          {
            "user": "pauldendulk",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:02:56.7758169Z"
          }
        ]
      },
      {
        "id": 599412792,
        "author": "pauldendulk",
        "body": "\u003E I am thinking of re-working that one maybe in the v2 release. This should be the same code, but the correct implementation. Effectively transparent to the user.\r\n\r\nah, great. I also found the name IgnorePixelScaling not very clear. Perhaps something like AutoScale would be better. ",
        "createdAt": "2020-03-16T08:44:14",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:02:56.9729225Z"
          }
        ]
      }
    ]
  }
}