{
  "number": 1039,
  "type": "pr",
  "state": "closed",
  "title": "TryRemove SKObject.instances WeakReferences",
  "body": "**Description of Change**\r\n\r\n\u0060SKObject.DeregisterHandle(...)\u0060 now uses \u0060TryRemove\u0060 in order to remove handles from the \u0060ConcurrentDictionary\u0060. I kept the logic the same otherwise.\r\n\r\nShould there be tests for this besides those that already exist? I might be able to add something if so. Don\u0027t know the codebase too well.\r\n\r\n**Bugs Fixed**\r\n\r\n- #1032 \u0022Possible Leak with static Dictionary SKObject.instances\u0022\r\n\r\n**API Changes**\r\n\r\nNone\r\n\r\n**Behavioral Changes**\r\n\r\nNone\r\n\r\n**PR Checklist**\r\n\r\n- [ ] Has tests (if omitted, state reason in description)\r\n- [X] Rebased on top of master at time of PR\r\n- [X] Changes adhere to coding standard\r\n- [ ] Updated documentation\r\n",
  "author": {
    "login": "daltonks",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "milestone": "v1.68.1.1",
  "createdAt": "2019-12-01T02:31:15",
  "updatedAt": "2020-01-01T22:57:19",
  "closedAt": "2019-12-02T00:31:48",
  "commentCount": 4,
  "reactionCount": 0,
  "draft": false,
  "mergeable": false,
  "merged": true,
  "mergedAt": "2019-12-02T00:31:48",
  "mergeableState": "dirty",
  "baseBranch": "master",
  "headBranch": "dev/tryremove-weakreferences",
  "additions": 8,
  "deletions": 10,
  "changedFiles": 1,
  "commits": 1,
  "reviews": [
    {
      "author": "mattleibow",
      "state": "APPROVED",
      "submittedAt": "2019-12-01T12:59:51"
    },
    {
      "author": "daltonks",
      "state": "COMMENTED",
      "submittedAt": "2019-12-01T14:55:27"
    },
    {
      "author": "daltonks",
      "state": "COMMENTED",
      "submittedAt": "2019-12-01T15:16:02"
    },
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2019-12-01T17:27:27"
    },
    {
      "author": "daltonks",
      "state": "COMMENTED",
      "submittedAt": "2019-12-01T17:43:40"
    }
  ],
  "engagement": {
    "syncedAt": "2026-02-06T14:31:23.6712968Z",
    "reactions": [],
    "comments": [
      {
        "id": 560042667,
        "author": "msftclas",
        "body": "[![CLA assistant check](https://cla.opensource.microsoft.com/pull/badge/signed)](https://cla.opensource.microsoft.com/mono/SkiaSharp?pullRequest=1039) \u003Cbr/\u003EAll CLA requirements met.",
        "createdAt": "2019-12-01T02:31:28",
        "reactions": []
      },
      {
        "id": 560105413,
        "author": "mattleibow",
        "body": "The failing build is just because the internal iOS build does not have access to the secure signing keys.",
        "createdAt": "2019-12-01T13:01:46",
        "reactions": []
      },
      {
        "id": 560109170,
        "author": "Gillibald",
        "body": "Register handle can deal with the case that an object is being disposed during the derigest. In the register method you just do the same check for IsDisposed == true and do nothing in that case. AddOrUpdate is the wrong approach because there are cases that an object is no longer valid during register and unregister. If you wanted to keep AddOrUpdate you have to scan the dictionary for dead references regularly. ",
        "createdAt": "2019-12-01T13:35:39",
        "reactions": [
          {
            "user": "daltonks",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:31:23.3604314Z"
          },
          {
            "user": "mattleibow",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:31:23.3604319Z"
          }
        ]
      },
      {
        "id": 560395709,
        "author": "mattleibow",
        "body": "I just pushed the NuGets to the preview feed:\r\nhttps://nugetized.blob.core.windows.net/skiasharp-eap/index.json\r\n\r\n1.68.2-preview.5",
        "createdAt": "2019-12-02T13:26:23",
        "reactions": [
          {
            "user": "Gillibald",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:31:23.6210601Z"
          }
        ]
      }
    ]
  }
}