{
  "number": 692,
  "type": "issue",
  "state": "closed",
  "title": "Add SkiaTextBox to simplify text rendering and layouting",
  "body": "### Description\r\n\r\nThe SkiaTextBox is a C# version of [SKTextBox](https://github.com/servo/skia/blob/master/src/views/SkTextBox.cpp) that provies a simple API to help layouting text with SkiaSharp.\r\nWould you consider it for inclusing in SkiaSharp?\r\n\r\n### Code\r\n\r\n\u0060\u0060\u0060\r\n/// \u003Csummary\u003E\r\n\t/// A text box that handles multi-line text wrapping and layout.\r\n\t/// \u003C/summary\u003E\r\n\tpublic static class SkiaTextBox\r\n\t{\r\n\t\t/// \u003Csummary\u003E\r\n\t\t/// Draw the specified text in the region defined by x, y, width, height wrapping and breaking lines\r\n\t\t/// to fit in that region\r\n\t\t/// \u003C/summary\u003E\r\n\t\t/// \u003Creturns\u003EThe draw.\u003C/returns\u003E\r\n\t\t/// \u003Cparam name=\u0022text\u0022\u003EText.\u003C/param\u003E\r\n\t\t/// \u003Cparam name=\u0022x\u0022\u003EThe x coordinate.\u003C/param\u003E\r\n\t\t/// \u003Cparam name=\u0022y\u0022\u003EThe y coordinate.\u003C/param\u003E\r\n\t\t/// \u003Cparam name=\u0022width\u0022\u003EWidth.\u003C/param\u003E\r\n\t\t/// \u003Cparam name=\u0022height\u0022\u003EHeight.\u003C/param\u003E\r\n\t\t/// \u003Cparam name=\u0022canvas\u0022\u003ECanvas.\u003C/param\u003E\r\n\t\t/// \u003Cparam name=\u0022paint\u0022\u003EPaint.\u003C/param\u003E\r\n\t\tpublic static void Draw (string text, double x, double y, double width, double height, SKCanvas canvas, SKPaint paint, bool ellipsize)\r\n\t\t{\r\n\t\t\tif (text == null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdouble textY = 0, textX = 0;\r\n\r\n\t\t\tswitch (paint.TextAlign) {\r\n\t\t\tcase SKTextAlign.Center:\r\n\t\t\t\ttextX = x \u002B width / 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase SKTextAlign.Left:\r\n\t\t\t\ttextX = x;\r\n\t\t\t\tbreak;\r\n\t\t\tcase SKTextAlign.Right:\r\n\t\t\t\ttextX = x \u002B width;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvar lines = BreakLines (text, paint, width);\r\n\r\n\t\t\tvar metrics = paint.FontMetrics;\r\n\t\t\tvar lineHeight = metrics.Bottom - metrics.Top;\r\n\r\n\t\t\tfloat textHeight = lines.Count * lineHeight - metrics.Leading;\r\n\r\n\t\t\tif (textHeight \u003E height) {\r\n\t\t\t\ttextY = y - metrics.Top;\r\n\t\t\t} else {\r\n\t\t\t\ttextY = y - metrics.Top \u002B (height - textHeight) / 2;\r\n\t\t\t}\r\n\t\t\tif (ellipsize \u0026\u0026 lines.Count \u003E height / lineHeight) {\r\n\t\t\t\tvar ellipsizedLine = $\u0022{lines.FirstOrDefault ()}...\u0022;\r\n\t\t\t\tcanvas.DrawText (ellipsizedLine, (float)textX, (float)textY, paint);\r\n\t\t\t} else {\r\n\t\t\t\tfor (int i = 0; i \u003C lines.Count; i\u002B\u002B) {\r\n\t\t\t\t\tcanvas.DrawText (lines [i], (float)textX, (float)textY, paint);\r\n\t\t\t\t\ttextY \u002B= lineHeight;\r\n\t\t\t\t\tif (textY \u002B metrics.Descent \u003E y \u002B height) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic List\u003Cstring\u003E BreakLines (string text, SKPaint paint, double width)\r\n\t\t{\r\n\t\t\tList\u003Cstring\u003E lines = new List\u003Cstring\u003E ();\r\n\r\n\t\t\tstring remainingText = text.Trim ();\r\n\r\n\t\t\tdo {\r\n\t\t\t\tint idx = LineBreak (remainingText, paint, width);\r\n\t\t\t\tif (idx == 0) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar lastLine = remainingText.Substring (0, idx).Trim ();\r\n\t\t\t\tlines.Add (lastLine);\r\n\t\t\t\tremainingText = remainingText.Substring (idx).Trim ();\r\n\t\t\t} while (!string.IsNullOrEmpty (remainingText));\r\n\t\t\treturn lines;\r\n\t\t}\r\n\r\n\t\tstatic int LineBreak (string text, SKPaint paint, double width)\r\n\t\t{\r\n\t\t\tint idx = 0, last = 0;\r\n\t\t\tint lengthBreak = (int)paint.BreakText (text, (float)width);\r\n\r\n\t\t\twhile (idx \u003C text.Length) {\r\n\t\t\t\tint next = text.IndexOfAny (new char [] { \u0027 \u0027, \u0027\\n\u0027 }, idx);\r\n\t\t\t\tif (next == -1) {\r\n\t\t\t\t\tif (idx == 0) {\r\n\t\t\t\t\t\t// Word is too long, we will have to break it\r\n\t\t\t\t\t\treturn lengthBreak;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Ellipsize if it\u0027s the last line\r\n\t\t\t\t\t\tif (lengthBreak == text.Length\r\n\t\t\t\t\t\t// || text.IndexOfAny (new char [] { \u0027 \u0027, \u0027\\n\u0027 }, lengthBreak \u002B 1) == -1\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\treturn lengthBreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Split at the last word;\r\n\t\t\t\t\t\treturn last;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (text [idx] == \u0027\\n\u0027) {\r\n\t\t\t\t\treturn idx;\r\n\t\t\t\t}\r\n\t\t\t\tif (next \u003E lengthBreak) {\r\n\t\t\t\t\treturn idx;\r\n\t\t\t\t}\r\n\t\t\t\tlast = next;\r\n\t\t\t\tidx = next \u002B 1;\r\n\t\t\t}\r\n\t\t\treturn last;\r\n\t\t}\r\n\t}\r\n\u0060\u0060\u0060\r\n",
  "author": {
    "login": "ylatuya",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2018-11-19T20:59:36",
  "updatedAt": "2022-08-19T12:02:36",
  "closedAt": "2018-12-04T17:05:11",
  "commentCount": 5,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:05:18.5322651Z",
    "reactions": [],
    "comments": [
      {
        "id": 440664089,
        "author": "Gillibald",
        "body": "I am currently working on a text layout for SkiaSharp that can be used for more advanced scenarios.\r\n\r\nhttps://github.com/Gillibald/Avalonia/blob/feature/SkiaTextLayout/src/Skia/Avalonia.Skia/Text/SKTextLayout.cs",
        "createdAt": "2018-11-21T13:36:09",
        "reactions": [
          {
            "user": "ylatuya",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:05:17.6632406Z"
          }
        ]
      },
      {
        "id": 443295319,
        "author": "mattleibow",
        "body": "Thanks for bringing this up. I have been looking into rendering text with SkiaSharp. Things are changing with text rendering and Google gives an indication that they are working on creating a proper text layout engine: https://groups.google.com/forum/#!topic/skia-discuss/qRARbUW2qhw\r\n\r\nIn the meantime, I am looking into doing something as an interim solution. Whether or not I include this in the main SkiaSharp repo is still under discussion - google may also create a type called \u0060SKTextBox\u0060 and this will result in a conflict. We do have a second https://github.com/mono/SkiaSharp.Extended repo with SkiaSharp\u002B\u002B features. Right now it is just SVG, iconography, and some geometry. But extra \u0022controls\u0022 such as a text box or text layout is on the cards.\r\n",
        "createdAt": "2018-11-30T18:28:31",
        "reactions": []
      },
      {
        "id": 443295515,
        "author": "mattleibow",
        "body": "I believe this is the issue: https://github.com/mono/SkiaSharp.Extended/issues/28",
        "createdAt": "2018-11-30T18:29:16",
        "reactions": []
      },
      {
        "id": 443302599,
        "author": "ylatuya",
        "body": "Thanks for the information, I think this can be closed and tracked in the issue you linked :)",
        "createdAt": "2018-11-30T18:53:21",
        "reactions": []
      },
      {
        "id": 581091046,
        "author": "ryancheung",
        "body": "https://github.com/ryancheung/SkiaTextRenderer\r\nI just made it.",
        "createdAt": "2020-02-02T02:38:29",
        "reactions": []
      }
    ]
  }
}