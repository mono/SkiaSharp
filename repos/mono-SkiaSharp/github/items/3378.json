{
  "number": 3378,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SKShader doesn\u0027t release all memory on Dispose()",
  "body": "### Description\n\nI think the bug is in ToHarfBuzzBlob() extension - it doesn\u0027t dispose SKStreamAsset in all paths.\n\n### Code\n\nIt seems that this code leaks SKStreamAssets even if properly disposed:\n\n\u0060\u0060\u0060    class TextSegmentShaper : IDisposable\n    {\n        public SKPaint Paint { get; set; }\n        public SKShaper Shaper { get; set; }\n\n        private bool disposedValue;\n\n        public TextSegmentShaper(SKTypeface typeface, SKPaint fromPaint)\n        {\n            Paint = new SKPaint()\n            {\n                Style = fromPaint.Style,\n                IsAntialias = fromPaint.IsAntialias,\n                Color = fromPaint.Color,\n                Typeface = typeface,\n                TextSize = fromPaint.TextSize,\n                TextAlign = fromPaint.TextAlign,\n                SubpixelText = fromPaint.SubpixelText,\n            };\n\n            Shaper = new SKShaper(typeface);\n        }\n\n        protected virtual void Dispose(bool disposing)\n        {\n            if (!disposedValue)\n            {\n                Paint?.Dispose();\n                Shaper?.Dispose();\n\n                Paint = null;\n                Shaper = null;\n\n                disposedValue = true;\n            }\n        }\u0060\u0060\u0060\n\n### Expected Behavior\n\n_No response_\n\n### Actual Behavior\n\n_No response_\n\n### Version of SkiaSharp\n\n3.116.0 (Current)\n\n### Last Known Good Version of SkiaSharp\n\nOther (Please indicate in the description)\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\nFirst observed bug on Android, but seems to be a problem also on Windows.\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\n\n\u0060\u0060\u0060\n\n### Code of Conduct\n\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "michaldobrodenka",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "os/Windows-Classic",
      "color": "fbca04"
    },
    {
      "name": "os/Android",
      "color": "fbca04"
    },
    {
      "name": "area/SkiaSharp",
      "color": "0052cc"
    },
    {
      "name": "backend/Metal",
      "color": "1acea7"
    },
    {
      "name": "tenet/reliability",
      "color": "BFD4F2"
    },
    {
      "name": "backend/Android",
      "color": "ededed"
    }
  ],
  "assignees": [],
  "createdAt": "2025-10-06T07:51:55",
  "updatedAt": "2025-10-06T07:52:31",
  "commentCount": 1,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:23:32.398403Z",
    "reactions": [],
    "comments": [
      {
        "id": 3370353625,
        "author": "github-actions[bot]",
        "body": "**Triage Summary**  \n\nLabels will be applied to indicate the affected backends (Android and Metal), specific areas (SkiaSharp), reliability concerns, and operating systems (Windows-Classic and Android).\n\nThis issue is not identified as a regression; it appears to be a new bug related to memory management.\n\nAdditional remarks:\n* The issue involves a memory leak with SKShader and SKStreamAsset, potentially causing reliability issues due to failure to release memory.\n\n\u003Cdetails\u003E\n\u003Csummary\u003EDetailed Summary and Actions\u003C/summary\u003E\n\nSummary of the triage:\n\n- The issue affects the Android backend, indicating a specific platform relevance.\n- It also pertains to Metal\u0027s rendering performance, suggesting broader implications for graphics.\n- The memory leak is tied to the SkiaSharp library, particularly with SKShader and SKStreamAsset.\n- This issue has reliability implications due to memory not being released properly, possibly causing crashes.\n- A specific instance on Windows-Classic is also mentioned, connecting the issue to different operating systems.\n\nSummary of the actions that will be performed:\n\n| Action         | Item              | Description                                                                 |\n| :------------- | :---------------- | :-------------------------------------------------------------------------- |\n| Apply Label    | backend/Android   | The issue was first observed on Android, indicating relevancy to the backend. |\n| Apply Label    | backend/Metal     | The bug may affect rendering performance on Metal, relating to resource management. |\n| Apply Label    | area/SkiaSharp    | The issue pertains to a memory leak involving SKShader and SKStreamAsset in SkiaSharp. |\n| Apply Label    | tenet/reliability | The issue describes a memory management bug that could lead to crashes or leaks, impacting reliability. |\n| Apply Label    | os/Windows-Classic| The memory leak in question is noted in the context of Windows, particularly with Visual Studio. |\n| Apply Label    | os/Android        | The bug was first observed on Android, suggesting it may also affect users of this platform. |\n\n\u003C/details\u003E\n\n\n\n_This entire triage process was automated by AI and mistakes may have been made. Please let us know so we can continue to improve._",
        "createdAt": "2025-10-06T07:52:31",
        "reactions": []
      }
    ]
  }
}