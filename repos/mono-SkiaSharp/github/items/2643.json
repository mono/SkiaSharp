{
  "number": 2643,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Xamarin : Broken Bitmap.Encode on real devices",
  "body": "### Description\r\n\r\nThe image is darkened when encoded by SkiaSharp.\r\nThis behavior occurs on physicals devices, but not on :\r\n- Android emulator\r\n- iOS emulator\r\n\r\nSo I want to be able to Decode an image and Encode it with SkiaSharp without changing the color. \r\n\r\n**Version of Skiasharp:** 2.88.6\r\n**Last Known Good Version of SkiaSharp:** 2.88.5\r\n\r\n### Code\r\n\r\nLink to a reproduction project repository: https://github.com/NovaKs68/bug-skiasharp\r\n\r\nThe following two code blocks modify the image color:\r\n\u0060\u0060\u0060cs\r\nusing (var stream = File.OpenRead(imagePath))\r\n{\r\n    SKImage img = SKImage.FromEncodedData(stream);\r\n    SKBitmap bitmap = SKBitmap.FromImage(img);\r\n\r\n    using (MemoryStream memStream = new MemoryStream())\r\n    using (SKManagedWStream wstream = new SKManagedWStream(memStream))\r\n    {\r\n        bitmap.Encode(wstream, SKEncodedImageFormat.Jpeg, 100);\r\n        imageCompressedView.Source = ImageSource.FromStream(() =\u003E new MemoryStream(memStream.ToArray()));\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\n\u0060\u0060\u0060cs\r\nvar codec = SKCodec.Create(imagePath);\r\nvar skImage = SKBitmap.Decode(codec);\r\n\r\nusing (MemoryStream memStream = new MemoryStream())\r\nusing (SKManagedWStream wstream = new SKManagedWStream(memStream))\r\n{\r\n    skImage.Encode(wstream, SKEncodedImageFormat.Jpeg, 100);\r\n    imageCompressedView.Source = ImageSource.FromStream(() =\u003E new MemoryStream(memStream.ToArray()));\r\n}\r\n\u0060\u0060\u0060\r\n\r\n### Expected Behavior\r\n\r\nThe result image should be similar to the input image.\r\n\r\n### Actual Behavior\r\n\r\nThe result image is darker than the input image (see screenshots).\r\n\r\n### Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### IDE / Editor\r\n\r\nVisual Studio (Windows)\r\n\r\n### Platform / Operating System\r\n\r\nAndroid, iOS\r\n\r\n### Platform / Operating System Version\r\n\r\n- Android 11\r\n- iOS 17.0.3\r\n\r\n### Devices\r\n\r\n- Xiaomi Redmi 11 Pro\r\n- IPhone 12 Pro Max\r\n\r\n### Relevant Screenshots\r\n\r\nOn iOS:\r\n![MicrosoftTeams-image (18)](https://github.com/mono/SkiaSharp/assets/55892105/7791d69d-0077-41f7-8f03-4fd918aa0d59)\r\n\r\nOn Android:\r\n![2023-10-10_11-49-33](https://github.com/mono/SkiaSharp/assets/55892105/6bb33e39-5dda-44e7-8e4d-2e43cad19e5f)\r\n\r\n\r\n### Relevant Log Output\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "NovaKs68",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2023-10-10T11:59:49",
  "updatedAt": "2024-02-09T12:00:26",
  "closedAt": "2024-01-10T09:28:51",
  "commentCount": 32,
  "reactionCount": 6,
  "engagement": {
    "syncedAt": "2026-02-04T20:22:40.6661958Z",
    "reactions": [
      {
        "user": "Brosten",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:22:40.6662016Z"
      },
      {
        "user": "FedericoNembrini",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:22:40.6662026Z"
      },
      {
        "user": "AlexGoOn",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:22:40.6662029Z"
      },
      {
        "user": "jsgg25",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:22:40.6662032Z"
      },
      {
        "user": "vividos",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:22:40.6662036Z"
      },
      {
        "user": "snailb1007",
        "content": "eyes",
        "createdAt": "2026-02-04T20:22:40.6662039Z"
      }
    ],
    "comments": [
      {
        "id": 1756244772,
        "author": "espenrl",
        "createdAt": "2023-10-10T20:58:25",
        "reactions": [
          {
            "user": "Sylv1F",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:34.710128Z"
          },
          {
            "user": "Denver0716",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:34.7101284Z"
          },
          {
            "user": "gench23",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:34.7101285Z"
          }
        ]
      },
      {
        "id": 1756861598,
        "author": "Thibault-Vellicus",
        "createdAt": "2023-10-11T06:04:59",
        "reactions": [
          {
            "user": "Timur-Filatov",
            "content": "confused",
            "createdAt": "2026-02-04T20:22:34.8805401Z"
          },
          {
            "user": "Denver0716",
            "content": "confused",
            "createdAt": "2026-02-04T20:22:34.8805403Z"
          }
        ]
      },
      {
        "id": 1759636966,
        "author": "jhariel8",
        "createdAt": "2023-10-12T13:41:10",
        "reactions": [
          {
            "user": "Timur-Filatov",
            "content": "rocket",
            "createdAt": "2026-02-04T20:22:35.0447823Z"
          }
        ]
      },
      {
        "id": 1760927223,
        "author": "jonmdev",
        "createdAt": "2023-10-13T05:56:17",
        "reactions": [
          {
            "user": "Timur-Filatov",
            "content": "rocket",
            "createdAt": "2026-02-04T20:22:35.2493798Z"
          }
        ]
      },
      {
        "id": 1774535866,
        "author": "e8-ZimingLiu",
        "createdAt": "2023-10-23T06:49:04",
        "reactions": []
      },
      {
        "id": 1781973800,
        "author": "IainS1986",
        "createdAt": "2023-10-26T22:24:44",
        "reactions": []
      },
      {
        "id": 1790192427,
        "author": "NovaKs68",
        "createdAt": "2023-11-02T07:15:45",
        "reactions": []
      },
      {
        "id": 1790211933,
        "author": "IainS1986",
        "createdAt": "2023-11-02T07:32:58",
        "reactions": [
          {
            "user": "NovaKs68",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:35.9192917Z"
          }
        ]
      },
      {
        "id": 1791890144,
        "author": "beeradmoore",
        "createdAt": "2023-11-03T04:48:49",
        "reactions": []
      },
      {
        "id": 1791890279,
        "author": "KRA2008",
        "createdAt": "2023-11-03T04:49:09",
        "reactions": []
      },
      {
        "id": 1793565678,
        "author": "IainS1986",
        "createdAt": "2023-11-04T22:03:51",
        "reactions": []
      },
      {
        "id": 1800398213,
        "author": "IainS1986",
        "createdAt": "2023-11-07T23:22:32",
        "reactions": []
      },
      {
        "id": 1805446387,
        "author": "MFinkBK",
        "createdAt": "2023-11-10T10:11:32",
        "reactions": []
      },
      {
        "id": 1807234263,
        "author": "MarcinZiabek",
        "createdAt": "2023-11-12T20:44:46",
        "reactions": []
      },
      {
        "id": 1807239358,
        "author": "IainS1986",
        "createdAt": "2023-11-12T21:06:13",
        "reactions": []
      },
      {
        "id": 1807266840,
        "author": "MarcinZiabek",
        "createdAt": "2023-11-12T22:43:59",
        "reactions": []
      },
      {
        "id": 1807269039,
        "author": "MarcinZiabek",
        "createdAt": "2023-11-12T22:52:16",
        "reactions": [
          {
            "user": "andressbarajas",
            "content": "heart",
            "createdAt": "2026-02-04T20:22:37.7988515Z"
          },
          {
            "user": "Simo4565",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:37.7988518Z"
          }
        ]
      },
      {
        "id": 1807278827,
        "author": "IainS1986",
        "createdAt": "2023-11-12T23:25:05",
        "reactions": []
      },
      {
        "id": 1817481971,
        "author": "SeriousM",
        "createdAt": "2023-11-18T11:24:11",
        "reactions": [
          {
            "user": "IainS1986",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:38.186309Z"
          },
          {
            "user": "ekeneduru",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:38.1863092Z"
          }
        ]
      },
      {
        "id": 1822440903,
        "author": "ispysoftware",
        "createdAt": "2023-11-22T09:53:37",
        "reactions": []
      },
      {
        "id": 1830353244,
        "author": "Denver0716",
        "createdAt": "2023-11-28T17:30:05",
        "reactions": []
      },
      {
        "id": 1830484640,
        "author": "mlancione",
        "createdAt": "2023-11-28T18:53:32",
        "reactions": []
      },
      {
        "id": 1831374768,
        "author": "r-work",
        "createdAt": "2023-11-29T07:44:51",
        "reactions": []
      },
      {
        "id": 1850823299,
        "author": "jasoncodematic",
        "createdAt": "2023-12-11T20:18:37",
        "reactions": []
      },
      {
        "id": 1850917726,
        "author": "IainS1986",
        "createdAt": "2023-12-11T21:28:58",
        "reactions": [
          {
            "user": "jasoncodematic",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.2875652Z"
          },
          {
            "user": "MarcinZiabek",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.2875656Z"
          },
          {
            "user": "samuelGrahame",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.28758Z"
          },
          {
            "user": "mjsb212",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.2875802Z"
          }
        ]
      },
      {
        "id": 1860085074,
        "author": "Simo4565",
        "createdAt": "2023-12-18T10:44:03",
        "reactions": []
      },
      {
        "id": 1861951665,
        "author": "ispysoftware",
        "createdAt": "2023-12-19T01:26:07",
        "reactions": [
          {
            "user": "OlofBlomqvist",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.6220143Z"
          },
          {
            "user": "MarcinZiabek",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.6220148Z"
          },
          {
            "user": "Simo4565",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.6220149Z"
          },
          {
            "user": "samuelGrahame",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:39.622015Z"
          }
        ]
      },
      {
        "id": 1868537405,
        "author": "orwo1",
        "createdAt": "2023-12-24T15:05:00",
        "reactions": []
      },
      {
        "id": 1880400958,
        "author": "mjsb212",
        "createdAt": "2024-01-08T05:22:15",
        "reactions": []
      },
      {
        "id": 1882911701,
        "author": "stoff99",
        "createdAt": "2024-01-09T11:37:57",
        "reactions": []
      },
      {
        "id": 1883761108,
        "author": "mattleibow",
        "createdAt": "2024-01-09T20:40:58",
        "reactions": [
          {
            "user": "ispysoftware",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:40.4273654Z"
          },
          {
            "user": "Thibault-Vellicus",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:40.427366Z"
          },
          {
            "user": "beeradmoore",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:40.4273662Z"
          },
          {
            "user": "taublast",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:40.4273663Z"
          },
          {
            "user": "NovaKs68",
            "content": "\u002B1",
            "createdAt": "2026-02-04T20:22:40.4273664Z"
          }
        ]
      },
      {
        "id": 1883767509,
        "author": "KRA2008",
        "createdAt": "2024-01-09T20:46:30",
        "reactions": []
      }
    ]
  }
}