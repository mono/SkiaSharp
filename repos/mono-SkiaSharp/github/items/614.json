{
  "number": 614,
  "type": "issue",
  "state": "closed",
  "title": "Can I combine OpenGL 3D drawing with SkiaSharp?",
  "body": "### Description\r\n\r\nI\u0027m using SkiaSharp with OpenTK on a Window desktop, but if I try to draw into the OpenGL context directly, both the OpenGL and SkiaSharp drawing is corrupted. I am guessing that they are trampling each other\u0027s GL states.\r\n\r\n### Code\r\n\r\nCan\u0027t share any code right now, there isn\u0027t anything in the documentation showing whether this is even allowed.\r\n\r\n### Expected Behavior\r\n\r\nExpected that I can draw something in 3D, call GrContext.ResetContext or similar function, then draw in 2D with SkiaSharp. (Or vice versa, 2D than 3D. Either is fine.)\r\n\r\n### Actual Behavior\r\n\r\nWhen I add our existing 3D code to the prototype SkiaSharp project, the 3D scene is not drawn, and the SkiaSharp 2D drawing is \u0027corrupted\u0027, i.e., text is not drawn, some objects are missing, a square appears where a square shouldn\u0027t be.\r\n\r\nI can\u0027t call GrContext.ResetContext, because SKGlControl.grContext is private.\r\n\r\n### Basic Information\r\n\r\n- Version with issue:  v1.60.2 of SkiaSharp and SkiaSharp.Views, from NuGet.\r\n- Last known good version:  This is the first time I have tried SkiaSharp.\r\n- IDE:  Visual Studio\r\n- Platform Target Frameworks: .NET Framework 4.5.2\r\n  - Android: N/A\r\n  - iOS:  N/A\r\n  - Linux:  Not yet\r\n  - macOS:  N/A\r\n  - Tizen:  N/A\r\n  - tvOS:  N/A\r\n  - UWP:  N/A\r\n  - watchOS:  N/A\r\n  - Windows Classic:  Windows 10\r\n- Target Devices:\r\n  -   Acer laptop\r\n\r\n### Screenshots\r\n\r\n![image](https://user-images.githubusercontent.com/13400041/43979809-8b81da3a-9cb1-11e8-80f2-3a7c586a8db3.png)\r\n\r\nThis is the title bar for our app. If I just have OpenGL clear the viewport to purple, then have Skia render, it\u0027s okay. (Top) If I have OpenGL actually draw things, then the Home button and title text disappears and I get that grey box. (Bottom)\r\n\r\nI could try to manually guess what OpenGL state needs to be corrected, but that sounds fragile.\r\n\r\n### Reproduction Link\r\n\r\nI can make up a reproduction case if the issue isn\u0027t clear, but this is more of a question of \u0022Can I even do this?\u0022 and not \u0022Is this broken?\u0022\r\n",
  "author": {
    "login": "ReactorScram",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2018-08-10T20:27:22",
  "updatedAt": "2022-08-19T15:01:47",
  "closedAt": "2018-08-13T16:05:33",
  "commentCount": 5,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:04:00.5956031Z",
    "reactions": [],
    "comments": [
      {
        "id": 412271459,
        "author": "Ollhax",
        "body": "I\u0027m rendering OpenGL and using SkiaSharp for creating UI, and the best way I\u0027ve found to deal with this is to reset the OpenGL state manually after Skia is done. There are occasional issues when I hit some new setting I forgot to reset, but using Renderdoc or just guesswork to debug those problems is not overly difficult.\r\n\r\nNote that this isn\u0027t really a SkiaSharp error, it\u0027s just how Skia works. See here: https://groups.google.com/forum/#!searchin/skia-discuss/gpu$20state%7Csort:relevance/skia-discuss/pj8lF9aHJ3Y/X7oHGhpkE8gJ - the author also posted a list of states he found were changed by Skia, which I found very useful when getting this to work myself. You probably also want to reset the texture unit, e.g. \u0060GL.ActiveTexture(TextureUnit.Texture0);\u0060\r\n\r\nYou do need to be able to call GrContext.ResetContext before rendering Skia surfaces, though. If you cannot access the GrContext, I recommend filing a separate report for that, and perhaps for now just use some reflection magic to access it.",
        "createdAt": "2018-08-11T12:15:28",
        "reactions": [
          {
            "user": "entdark",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:03:59.7224116Z"
          },
          {
            "user": "bozonsky",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:03:59.7224651Z"
          }
        ]
      },
      {
        "id": 412271630,
        "author": "Ollhax",
        "body": "In case it\u0027s useful, this is what I use right now:\r\n\r\n\u0060\u0060\u0060\r\n// Prepare\r\ngrContext.ResetContext(GRGlBackendState.All);\r\n\r\n// (Draw canvas)\r\n\r\n// Reset (using OpenTK\u0027s GL bindings)\r\nGL.Disable(EnableCap.Blend);\r\nGL.Disable(EnableCap.VertexProgramPointSize);\r\nGL.BindVertexArray(vertexArrayObject); // Restore default VAO \r\nGL.FrontFace(FrontFaceDirection.Cw);\r\nGL.Enable(EnableCap.FramebufferSrgb);\r\nGL.ActiveTexture(TextureUnit.Texture0);\r\nGL.PixelStore(PixelStoreParameter.UnpackAlignment, 4);\r\nGL.BindFramebuffer(FramebufferTarget.ReadFramebuffer, 0);\r\nGL.BindFramebuffer(FramebufferTarget.DrawFramebuffer, 0);\r\nGL.BindFramebuffer(FramebufferTarget.Framebuffer, 0);\r\nGL.BindFramebuffer(FramebufferTarget.FramebufferExt, 0);\r\nGL.UseProgram(0);\r\nGL.BindBuffer(BufferTarget.ElementArrayBuffer, 0);\r\nGL.BindBuffer(BufferTarget.ArrayBuffer, 0);\r\nGL.DrawBuffer(DrawBufferMode.Back);\r\nGL.Enable(EnableCap.Dither);\r\nGL.DepthMask(true);\r\nGL.Enable(EnableCap.Multisample);\r\nGL.Disable(EnableCap.ScissorTest);\r\n\u0060\u0060\u0060",
        "createdAt": "2018-08-11T12:19:18",
        "reactions": [
          {
            "user": "wangii",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:03:59.9447238Z"
          },
          {
            "user": "AlexVestin",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:03:59.944724Z"
          },
          {
            "user": "xtuzy",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:03:59.9447241Z"
          }
        ]
      },
      {
        "id": 412571478,
        "author": "ReactorScram",
        "body": "Thanks, Ollhax, it was the \u0022DisableVertexAttribArray\u0022 from your Google Groups link that I was missing.\r\n\r\nThe 3D code I have is legacy - It uses a mix of GL 1 and 2 rendering, so OpenGL must have been trying to send the generic vertex attributes when my code was only sending the fixed vertex and texcoord attributes.\r\n\r\nI couldn\u0027t get Renderdoc to work for some reason. The last time I had this issue, I was on Linux so I just used apitrace there. I know this is a common issue anywhere 2 different codebases have to share an OpenGL state, imgui has a similar reset () function and a list of GL state that the user must reset themselves.\r\n\r\nI\u0027ll close it since we all agree it\u0027s not technically a bug. Hopefully the next person with this problem finds this thread useful.",
        "createdAt": "2018-08-13T16:05:33",
        "reactions": [
          {
            "user": "eltiare",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:04:00.1266091Z"
          }
        ]
      },
      {
        "id": 914105040,
        "author": "KnIfER",
        "body": "how to combine OpenGL 3D with Skia in C\u002B\u002B?\r\n",
        "createdAt": "2021-09-07T08:34:26",
        "reactions": []
      },
      {
        "id": 914232425,
        "author": "KnIfER",
        "body": "some problem...\r\n\r\nhttps://user-images.githubusercontent.com/11593903/132338844-ab9b0a37-8ec1-4b46-ace6-f68ba53239ac.mp4\r\n\r\n\r\nhttps://groups.google.com/g/skia-discuss/c/3bl1U3D9a_Q\r\n",
        "createdAt": "2021-09-07T11:42:39",
        "reactions": []
      }
    ]
  }
}