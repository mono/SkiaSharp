{
  "number": 1573,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] In UWP, navigating between two pages containing an SKSwapChainPanel raises exception: Failed to create GL surface",
  "body": "**Description**\r\n\r\n In UWP, navigating between two pages containing an SKSwapChainPanel raises exception: Failed to create GL surface.\r\nThis could have a timing component, since sometimes it does not occur.\r\n\r\n**Code**\r\n\r\nGiven two pages that contain an SKSwapChainPanel, performaing a simple navigation:\r\n\u0060\u0060\u0060cs\r\nFrame.Navigate(typeof(Page2));\r\n\u0060\u0060\u0060\r\ncan cause this exception (not 100% of the time):\r\n\u0060\u0060\u0060\r\nSystem.Exception: Failed to create EGL surface\r\n   at SkiaSharp.Views.GlesInterop.GlesContext.CreateSurface(SwapChainPanel panel, Nullable\u00601 renderSurfaceSize, Nullable\u00601 resolutionScale)\r\n   at SkiaSharp.Views.UWP.AngleSwapChainPanel.EnsureRenderSurface()\r\n   at SkiaSharp.Views.UWP.AngleSwapChainPanel.OnCompositionChanged(SwapChainPanel sender, Object args)\r\n\u0060\u0060\u0060\r\n\r\n\r\n**Expected Behavior**\r\n\r\nNo exception should be raised.\r\n\r\n**Actual Behavior**\r\n\r\nThe aforementioned exception is raised.\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.80.3-preview.18 (but also in latest stable)\r\n- Last known good version:  unknown\r\n- IDE:  Visual Studio 2019\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - UWP:  \u003C!-- the version of the UWP SDK you are compiling against, e.g. 16299 --\u003E\r\n- Target Devices:   \u003C!-- the devices that you noticed this on, e.g. iPhone X --\u003E\r\n  - Windows 10 PC\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nPASTE ANY DETAILED VERSION INFO HERE\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n**Reproduction Link**\r\n\r\n\u003C!-- please upload or provide a link to a reproduction case --\u003E\r\n\r\n",
  "author": {
    "login": "gmurray81",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2021-01-04T16:18:03",
  "updatedAt": "2022-08-19T03:01:22",
  "closedAt": "2021-03-30T15:50:52",
  "commentCount": 13,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:16:48.5307222Z",
    "reactions": [],
    "comments": [
      {
        "id": 754071202,
        "author": "gmurray81",
        "body": "For ease of reproduction:\r\n\r\nMainPage.xaml:\r\n\u0060\u0060\u0060xml\r\n\u003CPage\r\n    x:Class=\u0022SkiaBug.MainPage\u0022\r\n    xmlns=\u0022http://schemas.microsoft.com/winfx/2006/xaml/presentation\u0022\r\n    xmlns:x=\u0022http://schemas.microsoft.com/winfx/2006/xaml\u0022\r\n    xmlns:local=\u0022using:SkiaBug\u0022\r\n    xmlns:d=\u0022http://schemas.microsoft.com/expression/blend/2008\u0022\r\n    xmlns:mc=\u0022http://schemas.openxmlformats.org/markup-compatibility/2006\u0022\r\n    mc:Ignorable=\u0022d\u0022\r\n    xmlns:sk=\u0022using:SkiaSharp.Views.UWP\u0022\r\n    Background=\u0022{ThemeResource ApplicationPageBackgroundThemeBrush}\u0022\u003E\r\n\r\n    \u003CGrid\u003E\r\n        \u003CGrid.RowDefinitions\u003E\r\n            \u003CRowDefinition Height=\u0022Auto\u0022\u003E\u003C/RowDefinition\u003E\r\n            \u003CRowDefinition\u003E\u003C/RowDefinition\u003E\r\n        \u003C/Grid.RowDefinitions\u003E\r\n        \u003CButton Content=\u0022Click\u0022 Click=\u0022Button_Click\u0022\u003E\u003C/Button\u003E\r\n        \u003Csk:SKSwapChainPanel Grid.Row=\u00221\u0022\u003E\u003C/sk:SKSwapChainPanel\u003E        \r\n    \u003C/Grid\u003E\r\n\u003C/Page\u003E\r\n\u0060\u0060\u0060\r\n\r\nMainPage.xaml.cs:\r\n\u0060\u0060\u0060cs\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.IO;\r\nusing System.Linq;\r\nusing System.Runtime.InteropServices.WindowsRuntime;\r\nusing Windows.Foundation;\r\nusing Windows.Foundation.Collections;\r\nusing Windows.UI.Xaml;\r\nusing Windows.UI.Xaml.Controls;\r\nusing Windows.UI.Xaml.Controls.Primitives;\r\nusing Windows.UI.Xaml.Data;\r\nusing Windows.UI.Xaml.Input;\r\nusing Windows.UI.Xaml.Media;\r\nusing Windows.UI.Xaml.Navigation;\r\n\r\n// The Blank Page item template is documented at https://go.microsoft.com/fwlink/?LinkId=402352\u0026clcid=0x409\r\n\r\nnamespace SkiaBug\r\n{\r\n    /// \u003Csummary\u003E\r\n    /// An empty page that can be used on its own or navigated to within a Frame.\r\n    /// \u003C/summary\u003E\r\n    public sealed partial class MainPage : Page\r\n    {\r\n        public MainPage()\r\n        {\r\n            this.InitializeComponent();\r\n        }\r\n\r\n        private void Button_Click(object sender, RoutedEventArgs e)\r\n        {\r\n            Frame.Navigate(typeof(Page2));\r\n        }\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\nPage2.xaml:\r\n\u0060\u0060\u0060xml\r\n\u003CPage\r\n    x:Class=\u0022SkiaBug.Page2\u0022\r\n    xmlns=\u0022http://schemas.microsoft.com/winfx/2006/xaml/presentation\u0022\r\n    xmlns:x=\u0022http://schemas.microsoft.com/winfx/2006/xaml\u0022\r\n    xmlns:local=\u0022using:SkiaBug\u0022\r\n    xmlns:d=\u0022http://schemas.microsoft.com/expression/blend/2008\u0022\r\n    xmlns:mc=\u0022http://schemas.openxmlformats.org/markup-compatibility/2006\u0022\r\n    mc:Ignorable=\u0022d\u0022\r\n    xmlns:sk=\u0022using:SkiaSharp.Views.UWP\u0022\r\n    Background=\u0022{ThemeResource ApplicationPageBackgroundThemeBrush}\u0022\r\n    \u003E\r\n\r\n    \r\n    \u003CGrid\u003E\r\n        \u003Csk:SKSwapChainPanel\u003E\u003C/sk:SKSwapChainPanel\u003E\r\n    \u003C/Grid\u003E\r\n\u003C/Page\u003E\r\n\u0060\u0060\u0060",
        "createdAt": "2021-01-04T16:20:49",
        "reactions": []
      },
      {
        "id": 783839520,
        "author": "gmurray81",
        "body": "I suspect that this issue is occurring due to how the setup/teardown of the SKSwapChainPanel\u0027s are interleaving.\r\n\r\nThis is the sequence that causes trouble:\r\n\r\n- page1 panel is loaded\r\n- page1 panel received CompositionScaleChanged\r\n- navigation occurs\r\n- page2 panel is loaded\r\n- page1 panel is unloaded\r\n- page2 panel received CompositionScaleChanged\r\n\r\nI think its the page1 panel being destroyed between the page 2 panel being loaded and the composition scale changing that is causing the problem. If I inject a delay such that the panel on page1 is fully unloaded before I start to load page2\u0027s panel, the issue does not ocurr.\r\n",
        "createdAt": "2021-02-23T02:47:52",
        "reactions": []
      },
      {
        "id": 784223231,
        "author": "gmurray81",
        "body": "@mattleibow poking around a bit, may it be that both contexts are winding up with the same display handle? And something bad happens when one of the contexts terminates the handle? Maybe it needs to do some ref counting? Or maybe there\u0027s a way to check the display handle is still valid before trying to create a surface?",
        "createdAt": "2021-02-23T14:01:19",
        "reactions": []
      },
      {
        "id": 784229793,
        "author": "gmurray81",
        "body": "from poking round, it seems like while eglTerminate might do some internal ref counting specifically for Android, this may not be the case elsewhere. So that interleaved eglTerminate is probably freeing the display resources before the last CompositionScaleChanged tries to recreate the surface.",
        "createdAt": "2021-02-23T14:10:51",
        "reactions": []
      },
      {
        "id": 784344058,
        "author": "gmurray81",
        "body": "Debugging it a bit locally. If I ref count the display, it gets around this error, but something bad happens when it destroys the GRContext for the old panel after the new panel has initialized but before it gets a composition scale change.",
        "createdAt": "2021-02-23T16:50:20",
        "reactions": []
      },
      {
        "id": 784430587,
        "author": "gmurray81",
        "body": "Remaining issue is caused when it releases the resources associated with the GrContext:\r\n\r\n\u0060\u0060\u0060cs\r\ncontext?.AbandonContext(true);\r\n\u0060\u0060\u0060\r\n\r\nIf I change that to false, so that it only abandons the context then all is ok, but I\u0027m not familiar enough with that Skia resources are being managed here to know if that would be leaking stuff. I assume so :) \r\n\r\n",
        "createdAt": "2021-02-23T18:52:11",
        "reactions": []
      },
      {
        "id": 784431237,
        "author": "gmurray81",
        "body": "BTW, I assume the reason this doesn\u0027t come up in the UWP samples is that they just reuse an \u0060SKSwapChainPanel\u0060.",
        "createdAt": "2021-02-23T18:53:19",
        "reactions": []
      },
      {
        "id": 784545047,
        "author": "gmurray81",
        "body": "I created a PR with my current investigation. It is not complete as I can\u0027t imagine its valid to omit the cleanup of the GRContext in the panel, but I\u0027m doing it by way of demonstration as to which portion of the cleanup appears to be invalidating shared resources that the other panels can\u0027t recover from.",
        "createdAt": "2021-02-23T22:03:41",
        "reactions": []
      },
      {
        "id": 784551994,
        "author": "gmurray81",
        "body": "Note, it seemed like there was some unnecessary churn to the surface since it wasn\u0027t checking to see if the composition scale had actually mutated before re-creating, and this was exacerbating things, is the rationale behind the mutation tracking of the composition scale.",
        "createdAt": "2021-02-23T22:15:45",
        "reactions": []
      },
      {
        "id": 785129316,
        "author": "gmurray81",
        "body": "Also note, the cleanup issue is definitely timing dependent. I keep spamming a button that swaps in a new panel, with the panels rendering a background. Sometimes the new panel will come up blank. It thinks it has a valid context/rendertarget/surface, but something internal to the chain is rejecting the painting.\r\n\r\nMainPage.xaml:\r\n\r\n\u0060\u0060\u0060xml\r\n\u003CPage\r\n    x:Class=\u0022SkiaBug.MainPage\u0022\r\n    xmlns=\u0022http://schemas.microsoft.com/winfx/2006/xaml/presentation\u0022\r\n    xmlns:x=\u0022http://schemas.microsoft.com/winfx/2006/xaml\u0022\r\n    xmlns:local=\u0022using:SkiaBug\u0022\r\n    xmlns:d=\u0022http://schemas.microsoft.com/expression/blend/2008\u0022\r\n    xmlns:mc=\u0022http://schemas.openxmlformats.org/markup-compatibility/2006\u0022\r\n    mc:Ignorable=\u0022d\u0022\r\n    xmlns:sk=\u0022using:SkiaSharp.Views.UWP\u0022\r\n    Background=\u0022{ThemeResource ApplicationPageBackgroundThemeBrush}\u0022\u003E\r\n\r\n    \u003CGrid x:Name=\u0022grid\u0022\u003E\r\n        \u003CGrid.RowDefinitions\u003E\r\n            \u003CRowDefinition Height=\u0022Auto\u0022\u003E\u003C/RowDefinition\u003E\r\n            \u003CRowDefinition\u003E\u003C/RowDefinition\u003E\r\n        \u003C/Grid.RowDefinitions\u003E\r\n        \u003CStackPanel Orientation=\u0022Horizontal\u0022\u003E\r\n        \u003CButton Content=\u0022Click\u0022 Click=\u0022Button_Click\u0022\u003E\u003C/Button\u003E\r\n            \u003CButton Content=\u0022DPI\u0022 Click=\u0022Button_Click_1\u0022\u003E\u003C/Button\u003E\r\n        \u003C/StackPanel\u003E\r\n        \u003C!--\u003Csk:SKSwapChainPanel Grid.Row=\u00221\u0022 Tag=\u0022TEST1\u0022 PaintSurface=\u0022SKSwapChainPanel_PaintSurface\u0022\u003E\u003C/sk:SKSwapChainPanel\u003E--\u003E\r\n        \r\n        \u003CContentControl x:Name=\u0022PageContent\u0022 HorizontalContentAlignment=\u0022Stretch\u0022 VerticalContentAlignment=\u0022Stretch\u0022 Grid.Row=\u00221\u0022\u003E\r\n            \u003CContentControl.Content\u003E\r\n                \u003Csk:SKSwapChainPanel Grid.Row=\u00221\u0022 Tag=\u0022TEST1\u0022 PaintSurface=\u0022SKSwapChainPanel_PaintSurface\u0022\r\n                                     Loaded=\u0022SKSwapChainPanel_Loaded\u0022\r\n                                     Unloaded=\u0022SKSwapChainPanel_Unloaded\u0022\r\n                                     CompositionScaleChanged=\u0022SKSwapChainPanel_CompositionScaleChanged\u0022\r\n                                     \u003E\u003C/sk:SKSwapChainPanel\u003E\r\n                \u003C!--\u003CSwapChainPanel x:Name=\u0022swap1\u0022\r\n                        Loaded=\u0022swap1_Loaded\u0022\r\n                        Unloaded=\u0022swap1_Unloaded\u0022\r\n                        CompositionScaleChanged=\u0022SwapChainPanel_CompositionScaleChanged\u0022\u003E\u003C/SwapChainPanel\u003E--\u003E\r\n            \u003C/ContentControl.Content\u003E\r\n        \u003C/ContentControl\u003E\r\n    \u003C/Grid\u003E\r\n\u003C/Page\u003E\r\n\u0060\u0060\u0060\r\n\r\nMainPage.xaml.cs:\r\n\r\n\u0060\u0060\u0060cs\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.IO;\r\nusing System.Linq;\r\nusing System.Runtime.InteropServices.WindowsRuntime;\r\nusing System.Threading.Tasks;\r\nusing Windows.Foundation;\r\nusing Windows.Foundation.Collections;\r\nusing Windows.UI.Core;\r\nusing Windows.UI.Xaml;\r\nusing Windows.UI.Xaml.Controls;\r\nusing Windows.UI.Xaml.Controls.Primitives;\r\nusing Windows.UI.Xaml.Data;\r\nusing Windows.UI.Xaml.Input;\r\nusing Windows.UI.Xaml.Media;\r\nusing Windows.UI.Xaml.Navigation;\r\n\r\n// The Blank Page item template is documented at https://go.microsoft.com/fwlink/?LinkId=402352\u0026clcid=0x409\r\n\r\nnamespace SkiaBug\r\n{\r\n    /// \u003Csummary\u003E\r\n    /// An empty page that can be used on its own or navigated to within a Frame.\r\n    /// \u003C/summary\u003E\r\n    public sealed partial class MainPage : Page\r\n    {\r\n        public MainPage()\r\n        {\r\n            this.InitializeComponent();\r\n            //System.Diagnostics.Debug.WriteLine(\u0022swap1: \u0022 \u002B swap1.CompositionScaleX);\r\n        }\r\n\r\n        private void Button_Click(object sender, RoutedEventArgs e)\r\n        {\r\n            //PageContent.Children.Clear();\r\n            PageContent.Content = null;\r\n            PageContent.Content = new Page2();\r\n            //Task.Delay(0).ContinueWith((t) =\u003E\r\n            //{\r\n            //    Dispatcher.RunAsync(\r\n            //        Windows.UI.Core.CoreDispatcherPriority.Normal,\r\n            //        (DispatchedHandler)(() =\u003E\r\n            //    {\r\n            //        PageContent.Content = (new Page2());\r\n            //    }));\r\n            //});\r\n            //PageContent.ContentTransitions.Add(new Vector3Transition())\r\n            //Frame.ContentTransitions = null;\r\n            //Frame.Content = new Page2(); //Navigate(typeof(Page2), null, new Windows.UI.Xaml.Media.Animation.SuppressNavigationTransitionInfo() );\r\n        }\r\n\r\n        private void SKSwapChainPanel_PaintSurface(object sender, SkiaSharp.Views.UWP.SKPaintGLSurfaceEventArgs e)\r\n        {\r\n            e.Surface.Canvas.Clear(new SkiaSharp.SKColor(255, 0, 0));\r\n        }\r\n\r\n        private void SwapChainPanel_CompositionScaleChanged(SwapChainPanel sender, object args)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022main composition changed: \u0022 \u002B sender.CompositionScaleX);\r\n        }\r\n\r\n        private void swap1_Loaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022main loaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n        }\r\n\r\n        private void swap1_Unloaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022main unloaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n            \r\n        }\r\n\r\n        private void SKSwapChainPanel_Loaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022main loaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n            System.Diagnostics.Debug.WriteLine(\u0022thread: \u0022 \u002B System.Threading.Thread.CurrentThread.ManagedThreadId);\r\n        }\r\n\r\n        private void SKSwapChainPanel_Unloaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022main unloaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n            System.Diagnostics.Debug.WriteLine(\u0022thread: \u0022 \u002B System.Threading.Thread.CurrentThread.ManagedThreadId);\r\n            //PageContent.Content = (new Page2());\r\n            //Task.Delay(0).ContinueWith((t) =\u003E\r\n            //{\r\n            //    Dispatcher.RunAsync(\r\n            //        Windows.UI.Core.CoreDispatcherPriority.Normal,\r\n            //        (DispatchedHandler)(() =\u003E\r\n            //        {\r\n            //            System.Diagnostics.Debug.WriteLine(\u0022here: \u0022);\r\n\r\n\r\n            //        }));\r\n            //});\r\n        }\r\n\r\n        private void SKSwapChainPanel_CompositionScaleChanged(SwapChainPanel sender, object args)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022main composition changed: \u0022 \u002B sender.CompositionScaleX);\r\n            System.Diagnostics.Debug.WriteLine(\u0022thread: \u0022 \u002B System.Threading.Thread.CurrentThread.ManagedThreadId);\r\n        }\r\n\r\n        private bool normal = true;\r\n        private void Button_Click_1(object sender, RoutedEventArgs e)\r\n        {\r\n            if (normal)\r\n            {\r\n                normal = !normal;\r\n                grid.RenderTransform = new ScaleTransform() { ScaleX = 2, ScaleY = 2, CenterX = 0, CenterY = 0 } ;\r\n            }\r\n            else\r\n            {\r\n                normal = !normal;\r\n                grid.RenderTransform = null;\r\n            }\r\n        }\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\nPage2.xaml:\r\n\r\n\u0060\u0060\u0060xml\r\n\u003CPage\r\n    x:Class=\u0022SkiaBug.Page2\u0022\r\n    xmlns=\u0022http://schemas.microsoft.com/winfx/2006/xaml/presentation\u0022\r\n    xmlns:x=\u0022http://schemas.microsoft.com/winfx/2006/xaml\u0022\r\n    xmlns:local=\u0022using:SkiaBug\u0022\r\n    xmlns:d=\u0022http://schemas.microsoft.com/expression/blend/2008\u0022\r\n    xmlns:mc=\u0022http://schemas.openxmlformats.org/markup-compatibility/2006\u0022\r\n    mc:Ignorable=\u0022d\u0022\r\n    xmlns:sk=\u0022using:SkiaSharp.Views.UWP\u0022\r\n    Background=\u0022{ThemeResource ApplicationPageBackgroundThemeBrush}\u0022\r\n    \u003E\r\n\r\n    \r\n    \u003CGrid\u003E\r\n        \u003Csk:SKSwapChainPanel Tag=\u0022TEST2\u0022 PaintSurface=\u0022SKSwapChainPanel_PaintSurface\u0022\r\n                             CompositionScaleChanged=\u0022SKSwapChainPanel_CompositionScaleChanged\u0022\r\n                             Loaded=\u0022SKSwapChainPanel_Loaded\u0022\r\n                             Unloaded=\u0022SKSwapChainPanel_Unloaded\u0022\r\n                             \u003E\u003C/sk:SKSwapChainPanel\u003E\r\n        \u003C!--\u003CSwapChainPanel CompositionScaleChanged=\u0022SwapChainPanel_CompositionScaleChanged\u0022\r\n                        Loaded=\u0022SwapChainPanel_Loaded\u0022\r\n                        Unloaded=\u0022SwapChainPanel_Unloaded\u0022\u003E\u003C/SwapChainPanel\u003E--\u003E\r\n    \u003C/Grid\u003E\r\n\u003C/Page\u003E\r\n\u0060\u0060\u0060\r\n\r\nPage2.xaml.cs:\r\n\r\n\u0060\u0060\u0060cs\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.IO;\r\nusing System.Linq;\r\nusing System.Runtime.InteropServices.WindowsRuntime;\r\nusing Windows.Foundation;\r\nusing Windows.Foundation.Collections;\r\nusing Windows.UI.Xaml;\r\nusing Windows.UI.Xaml.Controls;\r\nusing Windows.UI.Xaml.Controls.Primitives;\r\nusing Windows.UI.Xaml.Data;\r\nusing Windows.UI.Xaml.Input;\r\nusing Windows.UI.Xaml.Media;\r\nusing Windows.UI.Xaml.Navigation;\r\n\r\n// The Blank Page item template is documented at https://go.microsoft.com/fwlink/?LinkId=234238\r\n\r\nnamespace SkiaBug\r\n{\r\n    /// \u003Csummary\u003E\r\n    /// An empty page that can be used on its own or navigated to within a Frame.\r\n    /// \u003C/summary\u003E\r\n    public sealed partial class Page2 : Page\r\n    {\r\n        public Page2()\r\n        {\r\n            this.InitializeComponent();\r\n        }\r\n\r\n        private void SKSwapChainPanel_PaintSurface(object sender, SkiaSharp.Views.UWP.SKPaintGLSurfaceEventArgs e)\r\n        {\r\n            e.Surface.Canvas.Clear(new SkiaSharp.SKColor(0, 255, 0));\r\n        }\r\n\r\n        private void SwapChainPanel_CompositionScaleChanged(SwapChainPanel sender, object args)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022page2 composition changed: \u0022 \u002B sender.CompositionScaleX);\r\n        }\r\n\r\n        private void SwapChainPanel_Loaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022page2 loaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n        }\r\n\r\n        private void SwapChainPanel_Unloaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022page2 unloaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n        }\r\n\r\n        private void SKSwapChainPanel_CompositionScaleChanged(SwapChainPanel sender, object args)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022page2 composition changed: \u0022 \u002B sender.CompositionScaleX);\r\n            System.Diagnostics.Debug.WriteLine(\u0022thread: \u0022 \u002B System.Threading.Thread.CurrentThread.ManagedThreadId);\r\n        }\r\n\r\n        private void SKSwapChainPanel_Loaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022page2 loaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n            System.Diagnostics.Debug.WriteLine(\u0022thread: \u0022 \u002B System.Threading.Thread.CurrentThread.ManagedThreadId);\r\n        }\r\n\r\n        private void SKSwapChainPanel_Unloaded(object sender, RoutedEventArgs e)\r\n        {\r\n            System.Diagnostics.Debug.WriteLine(\u0022page2 unloaded: \u0022 \u002B ((SwapChainPanel)sender).CompositionScaleX);\r\n            System.Diagnostics.Debug.WriteLine(\u0022thread: \u0022 \u002B System.Threading.Thread.CurrentThread.ManagedThreadId);\r\n        }\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\n\r\nYou\u0027ll note that Frame.Navigate doesn\u0027t even seem necessary, I think it just exacerbated the timing elements, or perhaps resulted in more composition scale changes, or different timing of said.\r\n\r\n",
        "createdAt": "2021-02-24T14:50:57",
        "reactions": []
      },
      {
        "id": 785141038,
        "author": "gmurray81",
        "body": "to elaborate, if only applying the refcounting fix, you can still get an issue if you spam the button in the above sample, where sometimes it will stop being able to paint the surface. The AbandonContext(true =\u003E false)  appears to resolve that aspect of it.",
        "createdAt": "2021-02-24T15:07:26",
        "reactions": []
      },
      {
        "id": 788691918,
        "author": "mgierlasinski",
        "body": "@gmurray81 @mattleibow It also crashes in Xamarin.Forms 5.0.0.1931/SkiaSharp.Views.Forms 2.80.2, making impossible to use \u0060SKGLView\u0060 on UWP :(",
        "createdAt": "2021-03-02T07:40:59",
        "reactions": []
      },
      {
        "id": 788982294,
        "author": "gmurray81",
        "body": "@mgierlasinski if you have the time and means, you could try building my PR branch #1642 and see if it resolves the issue for you.\r\nI\u0027m not certain if its doing the right cleanup as I haven\u0027t poked around much in the Skia internals yet, so may need some feedback from @mattleibow ",
        "createdAt": "2021-03-02T15:15:28",
        "reactions": []
      }
    ]
  }
}