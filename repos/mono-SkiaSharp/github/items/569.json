{
  "number": 569,
  "type": "issue",
  "state": "closed",
  "title": "v1.6, CreateSweepGradient, iOS crash",
  "body": "### Description\r\n\r\nA crash occurs on iOS only when using CreateSweepGradient SkiaSharp/SkiaSharp.Forms v1.6\u002B to draw a path with DrawPath.  The issue does not occur on Android or for SkiaSharp/SkiaSharp.Forms 1.5.  The issue only seems to occur if more than 2 colors/points are specified in the gradient.\r\n\r\n### Code\r\n\r\n\u0060\u0060\u0060csharp\r\n\r\nSKPath lArcPatch = new SKPath();\r\nlArcPatch.AddArc(\r\n    new SKRect(\r\n        mCenterX - (mInnerRadius - mArcOffset), \r\n        mCenterY - (mInnerRadius - mArcOffset), \r\n        mCenterX \u002B (mInnerRadius - mArcOffset), \r\n        mCenterY \u002B (mInnerRadius - mArcOffset)), \r\n    90 \u002B ((360 - mArcDegrees) / 2),\r\n    mArcDegrees);\r\n\r\n\r\nSKShader lArcShader = SKShader.CreateSweepGradient(\r\n    new SKPoint(mCenterX, mCenterY),\r\n    new SKColor[] \r\n    {\r\n        SKColors.Red, SKColors.Red,\r\n        new SKColor(0x00, 0xff, 0x00),\r\n        SKColors.Red, SKColors.Red\r\n    },\r\n    new float[]\r\n    {\r\n        (float)0.0 \u002B lPositionAddr,\r\n        lMinWarnInArc \u002B lPositionAddr,\r\n        (float)((lMaxWarnInArc \u002B lMinWarnInArc) / 2.0) \u002B lPositionAddr,\r\n        lMaxWarnInArc \u002B lPositionAddr,\r\n        (float)1.0\r\n    });\r\n\r\ne.Surface.Canvas.DrawPath(\r\n    lArcPatch, \r\n    new SKPaint() { Style=SKPaintStyle.Stroke, Shader = lArcShader, StrokeWidth = mArcWidth, IsAntialias = true });\r\n\u0060\u0060\u0060\r\n\r\n### Expected Behavior\r\n\r\nThe path draws with the given gradient.\r\n\r\n### Actual Behavior\r\n\r\nApplication crashes\r\n\r\n\u0060\u0060\u0060\r\n2018-06-27 13:21:41.121 MMR.iOS[4532:7618522] critical: Stacktrace:\r\n\r\n2018-06-27 13:21:41.121 MMR.iOS[4532:7618522] critical:   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n2018-06-27 13:21:41.121 MMR.iOS[4532:7618522] critical:   at (wrapper managed-to-native) SkiaSharp.SkiaApi.sk_canvas_draw_path (intptr,intptr,intptr) \u003C0x00007\u003E\r\n2018-06-27 13:21:41.121 MMR.iOS[4532:7618522] critical:   at SkiaSharp.SKCanvas.DrawPath (SkiaSharp.SKPath,SkiaSharp.SKPaint) [0x0002e] in \u003Cdda4dd89ebba425f9972e6db0728b9e9#F95EFE24-1F0F-8FFF-FCDC-11423293DE24\u003E:0\r\n2018-06-27 13:21:41.121 MMR.iOS[4532:7618522] critical:   at XamarinHelpers.Controls.NepGauge.OnPaintSurface (SkiaSharp.Views.Forms.SKPaintSurfaceEventArgs) [0x00609] in C:\\Users\\jnisewonder\\source\\repos\\CSharp\\CommonLibraries\\XamarinHelpers\\Controls\\NepGauge.cs:188\r\n2018-06-27 13:21:41.121 MMR.iOS[4532:7618522] critical:   at SkiaSharp.Views.Forms.SKCanvasView.SkiaSharp.Views.Forms.ISKCanvasViewController.OnPaintSurface (SkiaSharp.Views.Forms.SKPaintSurfaceEventArgs) [0x00002] in \u003C506b88fe480b428d8aa18dffa13375f7#F95EFE24-1F0F-8FFF-FCDC-11423293DE24\u003E:0\r\n2018-06-27 13:21:41.121 MMR.iOS[4532:7618522] critical:   at SkiaSharp.Views.Forms.SKCanvasViewRendererBase\u00602\u003CTFormsView_REF, TNativeView_REF\u003E.OnPaintSurface (object,SkiaSharp.Views.iOS.SKPaintSurfaceEventArgs) [0x00021] in \u003C506b88fe480b428d8aa18dffa13\r\n375f7#F95EFE24-1F0F-8FFF-FCDC-11423293DE24\u003E:0\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at SkiaSharp.Views.iOS.SKCanvasView.DrawInSurface (SkiaSharp.SKSurface,SkiaSharp.SKImageInfo) [0x00013] in \u003C6bb7f15ce3894ef3bd7d052a3b2395f2#F95EFE24-1F0F-8FFF-FCDC-11423293DE24\u003E:0\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at SkiaSharp.Views.iOS.SKCanvasView.Draw (CoreGraphics.CGRect) [0x0004b] in \u003C6bb7f15ce3894ef3bd7d052a3b2395f2#F95EFE24-1F0F-8FFF-FCDC-11423293DE24\u003E:0\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at (wrapper runtime-invoke) object.runtime_invoke_dynamic (intptr,intptr,intptr,intptr) [0x0001e] in \u003Cb238a3153e534349ad10ed0787f2157a#F95EFE24-1F0F-8FFF-FCDC-11423293DE24\u003E:0\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at \u003Cunknown\u003E \u003C0xffffffff\u003E\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at (wrapper managed-to-native) UIKit.UIApplication.UIApplicationMain (int,string[],intptr,intptr) \u003C0x00007\u003E\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] cr\r\nitical:   at UIKit.UIApplication.Main (string[],intptr,intptr) [0x00005] in /Library/Frameworks/Xamarin.iOS.framework/Versions/11.12.0.4/src/Xamarin.iOS/UIKit/UIApplication.cs:79\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at UIKit.UIApplication.Main (string[],string,string) [0x0002c] in /Library/Frameworks/Xamarin.iOS.framework/Versions/11.12.0.4/src/Xamarin.iOS/UIKit/UIApplication.cs:63\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at MMR.iOS.Application.Main (string[]) [0x00001] in C:\\Users\\jnisewonder\\source\\repos\\CSharp\\MobileMeterReading\\MMR\\MMR.iOS\\Main.cs:17\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical:   at (wrapper runtime-invoke) object.runtime_invoke_dynamic (intptr,intptr,intptr,intptr) [0x0001e] in \u003Cb238a3153e534349ad10ed0787f2157a#F95EFE24-1F0F-8FFF-FCDC-11423293DE24\u003E:0\r\n2018-06-27 13:21:41.122 MMR.iOS[4532:7618522] critical: \r\nNative stacktrace:\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t0   MMR.iOS                             0x0000000104bf4a40 MMR.iOS \u002B 42912320\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t1   MMR.iOS                             0x0000000104bffe5c mono_pmip \u002B 9944\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t2   libsystem_platform.dylib            0x0000000182097b50 _sigtramp \u002B 52\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t3   libSkiaSharp                        0x0000000105511ce0 gr_glinterface_has_extension \u002B 1347152\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t4   libSkiaSharp                        0x0000000105498124 gr_glinterface_has_extension \u002B 848532\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t5   libSkiaSharp                        0x0000000105498028 gr_glinterface_has_extension \u002B 848280\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t6   libSkiaSharp                        0x00000001054adc4c gr_glinterface_has_extension \u002B 937404\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t7   libSkiaSharp                        0x000000010543e0b4 gr_glinterface_has_extensio\r\nn \u002B 479780\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t8   libSkiaSharp                        0x000000010543e38c gr_glinterface_has_extension \u002B 480508\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t9   libSkiaSharp                        0x00000001053d0e90 gr_glinterface_has_extension \u002B 32768\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t10  libSkiaSharp                        0x00000001053e7600 gr_glinterface_has_extension \u002B 124784\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t11  MMR.iOS                             0x00000001039283c0 MMR.iOS \u002B 23200704\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t12  MMR.iOS                             0x00000001038eb1b0 MMR.iOS \u002B 22950320\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t13  MMR.iOS                             0x00000001023bfbf0 MMR.iOS \u002B 752624\r\n2018-06-27 13:21:41.125 MMR.iOS[4532:7618522] critical: \t14  MMR.iOS                             0x00000001039535f0 MMR.iOS \u002B 23377392\r\n2018-06-27 13:\r\n21:41.126 MMR.iOS[4532:7618522] critical: \t15  MMR.iOS                             0x0000000103958968 MMR.iOS \u002B 23398760\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t16  MMR.iOS                             0x000000010396efb4 MMR.iOS \u002B 23490484\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t17  MMR.iOS                             0x000000010396e780 MMR.iOS \u002B 23488384\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t18  MMR.iOS                             0x0000000102a41b48 MMR.iOS \u002B 7576392\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t19  MMR.iOS                             0x0000000104c02eb0 mono_pmip \u002B 22316\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t20  MMR.iOS                             0x0000000104c6aac4 mono_pmip \u002B 447296\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t21  MMR.iOS                             0x0000000104c6e084 mono_pmip \u002B 461056\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t22  MMR.iOS                           \r\n  0x000000010231070c MMR.iOS \u002B 34572\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t23  MMR.iOS                             0x000000010233520c MMR.iOS \u002B 184844\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t24  UIKit                               0x000000018baaec74 \u003Credacted\u003E \u002B 408\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t25  QuartzCore                          0x00000001864b751c \u003Credacted\u003E \u002B 296\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t26  QuartzCore                          0x00000001863ae954 \u003Credacted\u003E \u002B 232\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t27  QuartzCore                          0x00000001864bd2ac \u003Credacted\u003E \u002B 52\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t28  QuartzCore                          0x00000001864b6f48 \u003Credacted\u003E \u002B 1672\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t29  QuartzCore                          0x00000001864283d4 \u003Credacted\u003E \u002B 520\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \r\n\t30  QuartzCore                          0x000000018644fb40 \u003Credacted\u003E \u002B 540\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t31  QuartzCore                          0x00000001863a174c \u003Credacted\u003E \u002B 928\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t32  QuartzCore                          0x0000000186455c0c \u003Credacted\u003E \u002B 240\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t33  CoreFoundation                      0x0000000182401090 \u003Credacted\u003E \u002B 188\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t34  CoreFoundation                      0x000000018241be00 \u003Credacted\u003E \u002B 56\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t35  CoreFoundation                      0x000000018241b504 \u003Credacted\u003E \u002B 440\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t36  CoreFoundation                      0x0000000182418fd8 \u003Credacted\u003E \u002B 2196\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t37  CoreFoundation                      0x0000000182338c58 CFRunLoopRunSpecific \u002B 436\r\n2018-0\r\n6-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t38  GraphicsServices                    0x00000001841e4f84 GSEventRunModal \u002B 100\r\n2018-06-27 13:21:41.126 MMR.iOS[4532:7618522] critical: \t39  UIKit                               0x000000018ba915c4 UIApplicationMain \u002B 236\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t40  MMR.iOS                             0x00000001036b2cd0 MMR.iOS \u002B 20622544\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t41  MMR.iOS                             0x000000010363991c MMR.iOS \u002B 20125980\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t42  MMR.iOS                             0x00000001036398dc MMR.iOS \u002B 20125916\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t43  MMR.iOS                             0x0000000102683d80 MMR.iOS \u002B 3652992\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t44  MMR.iOS                             0x0000000102a41b48 MMR.iOS \u002B 7576392\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t45  MMR.iOS           \r\n                  0x0000000104c02eb0 mono_pmip \u002B 22316\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t46  MMR.iOS                             0x0000000104c6aac4 mono_pmip \u002B 447296\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t47  MMR.iOS                             0x0000000104c6fcc8 mono_pmip \u002B 468292\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t48  MMR.iOS                             0x0000000104beb300 MMR.iOS \u002B 42873600\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t49  MMR.iOS                             0x0000000104d14fbc _Z9__isctypeim \u002B 47160\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t50  MMR.iOS                             0x0000000102339014 MMR.iOS \u002B 200724\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \t51  libdyld.dylib                       0x0000000181e5856c \u003Credacted\u003E \u002B 4\r\n2018-06-27 13:21:41.127 MMR.iOS[4532:7618522] critical: \r\n=================================================================\r\nGot a SIGSEGV while executing native c\r\node. This usually indicates\r\na fatal error in the mono runtime or one of the native libraries \r\nused by your application.\r\n=================================================================\r\n\u0060\u0060\u0060\r\n\r\n### Basic Information\r\n\r\n- Version with issue:  1.60.1\r\n- Last known good version:  1.59.3\r\n- IDE:  Visual Studio 2017\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - iOS:  11.1\r\n- Target Devices:\r\niPad Pro\r\n\r\n### Screenshots\r\n\r\n### Reproduction Link\n\n\u003E VS bug [#738687](https://devdiv.visualstudio.com/DevDiv/_workitems/edit/738687)",
  "author": {
    "login": "jnisewonder",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [
    {
      "login": "mattleibow",
      "type": "User"
    }
  ],
  "createdAt": "2018-06-27T17:22:16",
  "updatedAt": "2022-08-19T15:02:12",
  "closedAt": "2018-12-29T16:04:17",
  "commentCount": 16,
  "reactionCount": 2
}