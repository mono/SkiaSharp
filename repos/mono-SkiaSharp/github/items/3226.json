{
  "number": 3226,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SKMatrix44 Matrix Property Incorrect In SkiaSharp 3.0",
  "body": "### Description\n\nThe SKMatrix44 Matrix property in SkiaSharp 3.0 is incorrectly building the SKMatrix.\n\nThe previous implementation in v2 was performing the conversion in the native Skia library which was using the SkMatrix::get9() method:\nhttps://api.skia.org/classSkMatrix.html#aa49a9684efff87a979f8e26607bd2932\n\nThe description for the get9() method defines the order of the parameters:\nCopies nine scalar values contained by [SkMatrix](https://api.skia.org/classSkMatrix.html) into buffer, in member value ascending order: kMScaleX, kMSkewX, kMTransX, kMSkewY, kMScaleY, kMTransY, kMPersp0, kMPersp1, kMPersp2.\n\nThe SKMatrix constructor defines the same order:\n\u0060\u0060\u0060cs\npublic SKMatrix(float scaleX, float skewX, float transX, float skewY, float scaleY, float transY, float persp0, float persp1, float persp2);\n\u0060\u0060\u0060\n\nHowever, the current Matrix property is passing in the parameters in the wrong order:\n\u0060\u0060\u0060cs\npublic SKMatrix Matrix =\u003E\n\tnew SKMatrix (\n\t\tm00, m10, m30,\n\t\tm01, m11, m31,\n\t\tm03, m13, m33);\n\u0060\u0060\u0060\n\n### Code\n\nTherefore, the corrected Matrix property should be:\n\n\u0060\u0060\u0060cs\npublic SKMatrix Matrix =\u003E\n\tnew SKMatrix (\n\t\tm00, m01, m03,\n\t\tm10, m11, m13,\n\t\tm30, m31, m33);\n\n\u0060\u0060\u0060\n\n\n### Expected Behavior\n\n_No response_\n\n### Actual Behavior\n\n_No response_\n\n### Version of SkiaSharp\n\n3.116.0 (Current)\n\n### Last Known Good Version of SkiaSharp\n\n2.88.9 (Previous)\n\n### IDE / Editor\n\nVisual Studio Code (macOS)\n\n### Platform / Operating System\n\niOS\n\n### Platform / Operating System Version\n\n_No response_\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\n\n\u0060\u0060\u0060\n\n### Code of Conduct\n\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "mlancione",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2025-04-02T23:49:05",
  "updatedAt": "2025-08-07T23:12:00",
  "commentCount": 7,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:25:32.7114267Z",
    "reactions": [],
    "comments": [
      {
        "id": 2775466210,
        "author": "mattleibow",
        "body": "I have a to matrix and then also a to matrix44\n\nIs that one also wrong? I feel like I have a test that checks a cycle so both may be wrong. ",
        "createdAt": "2025-04-03T11:33:02",
        "reactions": []
      },
      {
        "id": 2775865871,
        "author": "mlancione",
        "body": "The Implicit operator in SKMatrix44 is also wrong:\n\nCurrent Implementation:\n\u0060\u0060\u0060cs\n\t\tpublic static implicit operator SKMatrix44 (SKMatrix matrix) =\u003E\n\t\t\tnew SKMatrix44 (\n\t\t\t\tmatrix.ScaleX, matrix.SkewY, 0, matrix.Persp0,\n\t\t\t\tmatrix.SkewX, matrix.ScaleY, 0, matrix.Persp1,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\tmatrix.TransX, matrix.TransY, 0, matrix.Persp2);\n\u0060\u0060\u0060\n\nCorrect Implementation:\n\u0060\u0060\u0060cs\n\t\tpublic static implicit operator SKMatrix44 (SKMatrix matrix) =\u003E\n\t\t\tnew SKMatrix44 (\n\t\t\t\tmatrix.ScaleX, matrix.SkewX, 0, matrix.TransX,\n\t\t\t\tmatrix.SkewY, matrix.ScaleY, 0, matrix.TransY,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\tmatrix.Persp0, matrix.Persp1, 0, matrix.Persp2);\n\u0060\u0060\u0060\n\nWhere are the ToMatrix and ToMatrix44 methods? I can\u0027t find them.",
        "createdAt": "2025-04-03T13:52:06",
        "reactions": []
      },
      {
        "id": 2872994270,
        "author": "mlancione",
        "body": "Any update on this issue?",
        "createdAt": "2025-05-12T15:18:49",
        "reactions": []
      },
      {
        "id": 3161731914,
        "author": "mlancione",
        "body": "No update on this fix?",
        "createdAt": "2025-08-06T21:49:06",
        "reactions": []
      },
      {
        "id": 3162413910,
        "author": "molesmoke",
        "body": "This doesn\u0027t sound/feel right... \u0060Canvas.SetMatrix\u0060 uses the implicit operator if you provide it an SKMatrix, and it gives the output I expect. If it were switched to your suggested implementation then it wouldn\u0027t. Consider doing it explicitly (e.g. with the WinForms sample for simplicity):\n\n\u0060\u0060\u0060\nSKMatrix m = SKMatrix.CreateTranslation(100, 0);\nSKMatrix4x4 m4 = (SKMatrix44)m;\ncanvas.SetMatrix(m4);\n\u0060\u0060\u0060\n\nSince nobody has complained that SKCanvas transforms are hideously broken, and the unit tests cover the round trip between the two types, it seems likely that the current implementation is correct.",
        "createdAt": "2025-08-07T04:30:40",
        "reactions": []
      },
      {
        "id": 3165604662,
        "author": "mlancione",
        "body": "@molesmoke Are you referring to my original post? The SKMatrix44.Matrix property is definitely wrong as I indicated in the post.\n\nI listed the correct order of the elements with a link to the skia documentation.",
        "createdAt": "2025-08-07T20:26:08",
        "reactions": []
      },
      {
        "id": 3166101005,
        "author": "molesmoke",
        "body": "AFAICT, \u0060SkMatrix::get9\u0060 wasn\u0027t used in 2.88.9 for conversions (although the conversion was performed natively).\n\nI don\u0027t mind helping out, but could you perhaps provide the additional details that bug reports requests? What you did, what happened, what you expected? That way we could eliminate API usage and/or expectations being at fault. I note that both Skia and SkiaSharp sometimes use row-major and sometimes use column-major, perhaps that\u0027s a point of confusion here?\n\nI provided a reasonably straightforward method for you to be able to verify that your suggested changes would make transforms give incorrect output without needing to compile SkiaSharp. Did you try it out? If so, what were your results?\n",
        "createdAt": "2025-08-07T23:12:00",
        "reactions": []
      }
    ]
  }
}