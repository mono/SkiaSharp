{
  "number": 2439,
  "type": "issue",
  "state": "open",
  "title": "[BUG] SkiaSharp 2.88.0 PackageReference break csproj pack logic",
  "body": "**Description**\r\n\r\nWhen referencing the SkiaSharp package (2.88.0) in a csproj where NuGet pack is enabled using \r\n\u0060\u0060\u0060\r\n\u003CGeneratePackageOnBuild\u003Etrue\u003C/GeneratePackageOnBuild\u003E\r\n\u0060\u0060\u0060\r\nThe following errors are generated\r\n\r\n\u0060\u0060\u0060\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-x86\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027content\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-x86\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-x64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027content\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-x64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-x64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027content\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-x64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-arm64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027content\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-arm64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-arm64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027content\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\skiasharp.nativeassets.win32\\2.88.0\\runtimes\\win-arm64\\native\\libSkiaSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libSkiaSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-x86\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027content\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-x86\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-x64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027content\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-x64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-x64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027content\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-x64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-arm64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027content\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-arm64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-arm64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027content\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5118: File \u0027C:\\Users\\username\\.nuget\\packages\\harfbuzzsharp.nativeassets.win32\\2.8.2.3\\runtimes\\win-arm64\\native\\libHarfBuzzSharp.dll\u0027 is not added because the package already contains file \u0027contentFiles\\any\\net472\\libHarfBuzzSharp.dll\u0027\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5100: The assembly \u0027content\\libSkiaSharp.dll\u0027 is not inside the \u0027lib\u0027 folder and hence it won\u0027t be added as a reference when the package is installed into a project. Move it into the \u0027lib\u0027 folder if it needs to be referenced.\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5100: The assembly \u0027contentFiles\\any\\net472\\libSkiaSharp.dll\u0027 is not inside the \u0027lib\u0027 folder and hence it won\u0027t be added as a reference when the package is installed into a project. Move it into the \u0027lib\u0027 folder if it needs to be referenced.\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5100: The assembly \u0027content\\libHarfBuzzSharp.dll\u0027 is not inside the \u0027lib\u0027 folder and hence it won\u0027t be added as a reference when the package is installed into a project. Move it into the \u0027lib\u0027 folder if it needs to be referenced.\r\nC:\\Program Files\\dotnet\\sdk\\6.0.407\\Sdks\\NuGet.Build.Tasks.Pack\\build\\NuGet.Build.Tasks.Pack.targets(221,5): error NU5100: The assembly \u0027contentFiles\\any\\net472\\libHarfBuzzSharp.dll\u0027 is not inside the \u0027lib\u0027 folder and hence it won\u0027t be added as a reference when the package is installed into a project. Move it into the \u0027lib\u0027 folder if it needs to be referenced.\r\n    0 Warning(s)\r\n    24 Error(s)\r\n\u0060\u0060\u0060\r\n\r\n**Code**\r\n\r\n\u0060\u0060\u0060\r\n  \u003CItemGroup\u003E\r\n    \u003CPackageReference Include=\u0022HarfBuzzSharp\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022ReactiveUI\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022SkiaSharp\u0022 /\u003E\r\n    \u003CPackageReference Include=\u0022Topten.RichTextKit\u0022 /\u003E\r\n  \u003C/ItemGroup\u003E\r\n\r\n  \u003CPropertyGroup\u003E\r\n    \u003CGeneratePackageOnBuild\u003Etrue\u003C/GeneratePackageOnBuild\u003E\r\n  \u003C/PropertyGroup\u003E\r\n\r\n\u0060\u0060\u0060\r\n\r\n**Workarround**\r\nAdding these properties to my csproj ensure the native files are not added as content\r\n\u0060\u0060\u0060\r\n    \u003C!-- Workarround to ensure the Native files of SkiaSharp and Harfbuzz are not included in the package --\u003E\r\n    \u003CShouldIncludeNativeSkiaSharp\u003EFalse\u003C/ShouldIncludeNativeSkiaSharp\u003E\r\n    \u003CShouldIncludeNativeHarfBuzzSharp\u003EFalse\u003C/ShouldIncludeNativeHarfBuzzSharp\u003E\r\n\u0060\u0060\u0060\r\n**Expected Behavior**\r\n\r\nI expect a NuGet package of my assembly is generated containing my assembly and a dependency on the SkiaSharp package.\r\nThe assemblies part of the SkiaSharp and Harfbuzz packages should not be considered as input files to pack.\r\n\r\n**Actual Behavior**\r\n\r\nMSBuild fails with the below error. The SkiaSharp (and HarfBuzz) win32 package is injecting the native assemblies as content. Which is picked up by MSBuild.\r\n\r\n**Possible solution**\r\n\r\nThe build targets included in the package contain logic to have it included as content.\r\nOne solution could be to use a None include instead of a Content included\r\nAnother solution could be to also set the Pack attribute, to ensure the content files is not considered as a file to pack.\r\n\u0060\u0060\u0060\r\n        \u003C!-- include everything --\u003E\r\n        \u003CContent Include=\u0022@(_NativeSkiaSharpFile)\u0022\u003E\r\n            \u003CLink\u003E%(Dir)%(Filename)%(Extension)\u003C/Link\u003E\r\n            \u003CVisible\u003EFalse\u003C/Visible\u003E\r\n            \u003CCopyToOutputDirectory\u003EPreserveNewest\u003C/CopyToOutputDirectory\u003E\r\n            \u003CPack\u003EFalse\u003C/Pack\u003E\r\n        \u003C/Content\u003E\r\n\r\n\u0060\u0060\u0060\r\n**Basic information**\r\nUsing Visual Studio 2022 17.4 and .NET 6 SDK version 6.0.407\r\n\r\n",
  "author": {
    "login": "bh-sijtnic",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2023-04-11T12:33:33",
  "updatedAt": "2023-12-11T05:42:43",
  "commentCount": 3,
  "reactionCount": 2,
  "engagement": {
    "syncedAt": "2026-02-06T13:41:55.7705996Z",
    "reactions": [
      {
        "user": "asidorowicz",
        "content": "eyes",
        "createdAt": "2026-02-06T13:41:55.7706066Z"
      },
      {
        "user": "mattleibow",
        "content": "eyes",
        "createdAt": "2026-02-06T13:41:55.7706076Z"
      }
    ],
    "comments": [
      {
        "id": 1553206018,
        "author": "asidorowicz",
        "body": "I have a similar behavior with the native SkiaSharp libraries being included throughout all transitive dependencies\r\nEx:\r\nAppA -\u003E LibA -\u003E LibB -\u003E SkiaSharp\r\n\r\nAppA, LibA and LibB will all embed the native dependencies in the nupkg, even when AppA end LibA are pulling it transitively",
        "createdAt": "2023-05-18T15:07:32",
        "reactions": []
      },
      {
        "id": 1607260028,
        "author": "SimonWeinbergerEnscape",
        "body": "I also just stumbled upon this issue.\r\n\r\nI have added the following code to \u0060Directory.Build.targets\u0060, but would prefer to have the \u0060Pack\u0060 property set in the nuget\u0027s \u0060.props\u0060 file, as is outlined in the bug report as a possible solution.\r\n\r\n\u0060\u0060\u0060xml\r\n  \u003CItemGroup\u003E\r\n    \u003CContent Update=\u0022@(_NativeSkiaSharpFile)\u0022\u003E\r\n      \u003CPack\u003EFalse\u003C/Pack\u003E\r\n    \u003C/Content\u003E\r\n  \u003C/ItemGroup\u003E\r\n\u0060\u0060\u0060\r\n\r\nSetting \u0060ShouldIncludeNativeSkiaSharp\u0060 to \u0060False\u0060 is not an option in my case because I need to run my application from the bin folder.",
        "createdAt": "2023-06-26T11:19:20",
        "reactions": []
      },
      {
        "id": 1849363246,
        "author": "SebastianSchumann",
        "body": "This problem still occurs when building NuGet-Packages. I\u0027m using version 2.88.6.\r\nSometimes, but not always, an error occurs during compilation when the compiler tries to copy the DLLs into the bin directory.\r\n\r\nWe also have to start our application from the bin folder, but we also pack NuGet packages for some assemblies. \r\n\r\nIs there a satisfying solution for this?\r\n",
        "createdAt": "2023-12-11T05:42:42",
        "reactions": []
      }
    ]
  }
}