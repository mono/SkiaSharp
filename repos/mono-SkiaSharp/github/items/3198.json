{
  "number": 3198,
  "type": "pr",
  "state": "closed",
  "title": "Add LoongArch64 build support",
  "body": "**Description of Change**\r\n\r\nAdd LoongArch64 build support, LoongArch64 is a **new** ISA Cored By [Loongson Technology LLC](https://www.loongson.cn/EN).\r\n\r\n**Bugs Fixed**\r\n\r\n- Fixes https://github.com/mono/SkiaSharp/issues/3197\r\n\r\n**API Changes**\r\n\r\nNone.\r\n\r\n\u003C!-- REPLACE THIS COMMENT\r\n\r\nList all API changes here (or just put None), example:\r\n\r\nAdded: \r\n \r\n- \u0060string Class.Property { get; set; }\u0060\r\n- \u0060void Class.Method();\u0060\r\n\r\nChanged:\r\n\r\n - \u0060object Cell.OldPropertyName =\u003E object Cell.NewPropertyName\u0060\r\n\r\n--\u003E\r\n\r\n**Behavioral Changes**\r\n\r\nNone.\r\n\r\n\u003C!-- Describe any non-bug related behavioral changes that may change how users app behaves when upgrading to this version of the codebase. --\u003E\r\n\r\n**Required skia PR**\r\n\r\nNone.\r\n\r\n\u003C!-- Replace this with the full URL to the skia PR. --\u003E\r\n\r\n**PR Checklist**\r\n\r\n- [\u221A] Has tests (if omitted, state reason in description)\r\n- [\u221A] Rebased on top of main at time of PR\r\n- [\u221A] Merged related skia PRs\r\n- [\u221A] Changes adhere to coding standard\r\n- [\u221A] Updated documentation\r\n",
  "author": {
    "login": "4Darmygeometry",
    "type": "User"
  },
  "labels": [
    {
      "name": "community \u2728",
      "color": "ededed"
    }
  ],
  "assignees": [],
  "createdAt": "2025-03-13T09:51:49",
  "updatedAt": "2025-03-26T10:01:37",
  "closedAt": "2025-03-24T19:54:20",
  "commentCount": 42,
  "reactionCount": 0,
  "draft": false,
  "merged": true,
  "mergedAt": "2025-03-24T19:54:20",
  "mergeableState": "unknown",
  "baseBranch": "main",
  "headBranch": "main",
  "additions": 154,
  "deletions": 22,
  "changedFiles": 14,
  "commits": 36,
  "reviews": [
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:27:02"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:27:22"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:27:50"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:28:00"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:28:27"
    },
    {
      "author": "kasperk81",
      "state": "APPROVED",
      "submittedAt": "2025-03-22T17:28:35"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:34:21"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:35:48"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:39:26"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:41:26"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:41:40"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:45:59"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:49:41"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:52:18"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:53:16"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:55:00"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:56:21"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T17:58:21"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T18:01:30"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T18:24:37"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T18:24:48"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-22T18:25:06"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-23T05:17:12"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-23T05:17:19"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-23T05:17:35"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-23T18:48:20"
    },
    {
      "author": "kasperk81",
      "state": "COMMENTED",
      "submittedAt": "2025-03-23T19:51:55"
    },
    {
      "author": "mattleibow",
      "state": "APPROVED",
      "submittedAt": "2025-03-23T21:25:28"
    },
    {
      "author": "mattleibow",
      "state": "CHANGES_REQUESTED",
      "submittedAt": "2025-03-23T22:01:37"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-24T03:11:49"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-24T03:12:28"
    },
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2025-03-24T03:59:56"
    },
    {
      "author": "mattleibow",
      "state": "DISMISSED",
      "submittedAt": "2025-03-24T04:12:31"
    },
    {
      "author": "mattleibow",
      "state": "CHANGES_REQUESTED",
      "submittedAt": "2025-03-24T09:15:21"
    },
    {
      "author": "4Darmygeometry",
      "state": "COMMENTED",
      "submittedAt": "2025-03-24T10:01:20"
    },
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2025-03-24T11:39:37"
    }
  ],
  "engagement": {
    "syncedAt": "2026-02-06T13:28:23.2655199Z",
    "reactions": [],
    "comments": [
      {
        "id": 2720656112,
        "author": "4Darmygeometry",
        "body": "\u003E @4Darmygeometry please read the following Contributor License Agreement(CLA). If you agree with the CLA, please reply with the following information.\r\n\u003E \r\n\u003E \u0060\u0060\u0060\r\n\u003E @dotnet-policy-service agree [company=\u0022{your company}\u0022]\r\n\u003E \u0060\u0060\u0060\r\n\u003E \r\n\u003E \u003E Options:\r\n\u003E \u003E \r\n\u003E \u003E * (default - no company specified) I have sole ownership of intellectual property rights to my Submissions and I am not making Submissions in the course of work for my employer.\r\n\u003E \u003E \r\n\u003E \u003E \u0060\u0060\u0060\r\n\u003E \u003E @dotnet-policy-service agree\r\n\u003E \u003E \u0060\u0060\u0060\r\n\u003E \u003E \r\n\u003E \u003E \r\n\u003E \u003E     \r\n\u003E \u003E       \r\n\u003E \u003E     \r\n\u003E \u003E \r\n\u003E \u003E       \r\n\u003E \u003E     \r\n\u003E \u003E \r\n\u003E \u003E     \r\n\u003E \u003E   \r\n\u003E \u003E \r\n\u003E \u003E * (when company given) I am making Submissions in the course of work for my employer (or my employer has intellectual property rights in my Submissions by contract or applicable law). I have permission from my employer to make Submissions and enter into this Agreement on behalf of my employer. By signing below, the defined term \u201CYou\u201D includes me and my employer.\r\n\u003E \u003E \r\n\u003E \u003E \u0060\u0060\u0060\r\n\u003E \u003E @dotnet-policy-service agree company=\u0022Microsoft\u0022\r\n\u003E \u003E \u0060\u0060\u0060\r\n\u003E \r\n\u003E Contributor License Agreement\r\n\u003E ### Contribution License Agreement\r\n\u003E This Contribution License Agreement ( **\u201CAgreement\u201D** ) is agreed to by the party signing below ( **\u201CYou\u201D** ), and conveys certain license rights to the .NET Foundation ( **\u201C.NET Foundation\u201D** ) for Your contributions to .NET Foundation open source projects. This Agreement is effective as of the latest signature date below.\r\n\u003E \r\n\u003E **1. Definitions.**\r\n\u003E \r\n\u003E **\u201CCode\u201D** means the computer software code, whether in human-readable or machine-executable form, that is delivered by You to .NET Foundation under this Agreement.\r\n\u003E \r\n\u003E **\u201CProject\u201D** means any of the projects owned or managed by .NET Foundation and offered under a license approved by the Open Source Initiative ([www.opensource.org](http://www.opensource.org)).\r\n\u003E \r\n\u003E **\u201CSubmit\u201D** is the act of uploading, submitting, transmitting, or distributing code or other content to any Project, including but not limited to communication on electronic mailing lists, source code control systems, and issue tracking systems that are managed by, or on behalf of, the Project for the purpose of discussing and improving that Project, but excluding communication that is conspicuously marked or otherwise designated in writing by You as \u201CNot a Submission.\u201D\r\n\u003E \r\n\u003E **\u201CSubmission\u201D** means the Code and any other copyrightable material Submitted by You, including any associated comments and documentation.\r\n\u003E \r\n\u003E **2. Your Submission.** You must agree to the terms of this Agreement before making a Submission to any Project. This Agreement covers any and all Submissions that You, now or in the future (except as described in Section 4 below), Submit to any Project.\r\n\u003E \r\n\u003E **3. Originality of Work.** You represent that each of Your Submissions is entirely Your original work. Should You wish to Submit materials that are not Your original work, You may Submit them separately to the Project if You (a) retain all copyright and license information that was in the materials as you received them, (b) in the description accompanying your Submission, include the phrase \u0022Submission containing materials of a third party:\u0022 followed by the names of the third party and any licenses or other restrictions of which You are aware, and (c) follow any other instructions in the Project\u0027s written guidelines concerning Submissions.\r\n\u003E \r\n\u003E **4. Your Employer.** References to \u201Cemployer\u201D in this Agreement include Your employer or anyone else for whom You are acting in making Your Submission, e.g. as a contractor, vendor, or agent. If Your Submission is made in the course of Your work for an employer or Your employer has intellectual property rights in Your Submission by contract or applicable law, You must secure permission from Your employer to make the Submission before signing this Agreement. In that case, the term \u201CYou\u201D in this Agreement will refer to You and the employer collectively. If You change employers in the future and desire to Submit additional Submissions for the new employer, then You agree to sign a new Agreement and secure permission from the new employer before Submitting those Submissions.\r\n\u003E \r\n\u003E **5. Licenses.**\r\n\u003E \r\n\u003E **a. Copyright License.** You grant .NET Foundation, and those who receive the Submission directly or indirectly from .NET Foundation, a perpetual, worldwide, non-exclusive, royalty-free, irrevocable license in the Submission to reproduce, prepare derivative works of, publicly display, publicly perform, and distribute the Submission and such derivative works, and to sublicense any or all of the foregoing rights to third parties.\r\n\u003E \r\n\u003E **b. Patent License.** You grant .NET Foundation, and those who receive the Submission directly or indirectly from .NET Foundation, a perpetual, worldwide, non-exclusive, royalty-free, irrevocable license under Your patent claims that are necessarily infringed by the Submission or the combination of the Submission with the Project to which it was Submitted to make, have made, use, offer to sell, sell and import or otherwise dispose of the Submission alone or with the Project.\r\n\u003E \r\n\u003E **c. Other Rights Reserved.** Each party reserves all rights not expressly granted in this Agreement. No additional licenses or rights whatsoever (including, without limitation, any implied licenses) are granted by implication, exhaustion, estoppel or otherwise.\r\n\u003E \r\n\u003E **6. Representations and Warranties.** You represent that You are legally entitled to grant the above licenses. You represent that each of Your Submissions is entirely Your original work (except as You may have disclosed under Section 3 ). You represent that You have secured permission from Your employer to make the Submission in cases where Your Submission is made in the course of Your work for Your employer or Your employer has intellectual property rights in Your Submission by contract or applicable law. If You are signing this Agreement on behalf of Your employer, You represent and warrant that You have the necessary authority to bind the listed employer to the obligations contained in this Agreement. You are not expected to provide support for Your Submission, unless You choose to do so. UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING, AND EXCEPT FOR THE WARRANTIES EXPRESSLY STATED IN SECTIONS 3, 4, AND 6 , THE SUBMISSION PROVIDED UNDER THIS AGREEMENT IS PROVIDED WITHOUT WARRANTY OF ANY KIND, INCLUDING, BUT NOT LIMITED TO, ANY WARRANTY OF NONINFRINGEMENT, MERCHANTABILITY, OR FITNESS FOR A PARTICULAR PURPOSE.\r\n\u003E \r\n\u003E **7. Notice to .NET Foundation.** You agree to notify .NET Foundation in writing of any facts or circumstances of which You later become aware that would make Your representations in this Agreement inaccurate in any respect.\r\n\u003E \r\n\u003E **8. Information about Submissions.** You agree that contributions to Projects and information about contributions may be maintained indefinitely and disclosed publicly, including Your name and other information that You submit with Your Submission.\r\n\u003E \r\n\u003E **9. Governing Law/Jurisdiction.** This Agreement is governed by the laws of the State of Washington, and the parties consent to exclusive jurisdiction and venue in the federal courts sitting in King County, Washington, unless no federal subject matter jurisdiction exists, in which case the parties consent to exclusive jurisdiction and venue in the Superior Court of King County, Washington. The parties waive all defenses of lack of personal jurisdiction and forum non-conveniens.\r\n\u003E \r\n\u003E **10. Entire Agreement/Assignment.** This Agreement is the entire agreement between the parties, and supersedes any and all prior agreements, understandings or communications, written or oral, between the parties relating to the subject matter hereof. This Agreement may be assigned by .NET Foundation.\r\n\u003E \r\n\u003E _.NET Foundation dedicates this Contribution License Agreement to the public domain according to the Creative Commons CC0 1._\r\n\r\n@dotnet-policy-service agree company=\u0022Jiangsu Zhengqi Fanxing Technology LLC(\u6C5F\u82CF\u84B8\u6C7D\u51E1\u661F\u79D1\u6280\u6709\u9650\u516C\u53F8)\u0022",
        "createdAt": "2025-03-13T09:58:42",
        "reactions": []
      },
      {
        "id": 2722091556,
        "author": "kasperk81",
        "body": "it will be much easier to add this arch after https://github.com/mono/SkiaSharp/pull/3200 goes in",
        "createdAt": "2025-03-13T17:25:23",
        "reactions": [
          {
            "user": "4Darmygeometry",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:28:12.9659135Z"
          }
        ]
      },
      {
        "id": 2722105752,
        "author": "4Darmygeometry",
        "body": "\u003E it will be much easier to add this arch after https://github.com/mono/SkiaSharp/pull/3200 goes in\n\nSuggest adding RISC-V 64 and LoongArch64 simultaneously",
        "createdAt": "2025-03-13T17:29:05",
        "reactions": []
      },
      {
        "id": 2723376148,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nCommenter does not have sufficient privileges for PR 3198 in repo mono/SkiaSharp\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-14T04:08:06",
        "reactions": []
      },
      {
        "id": 2723817705,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2025-03-14T07:02:01",
        "reactions": []
      },
      {
        "id": 2723817845,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-14T07:02:09",
        "reactions": []
      },
      {
        "id": 2723893240,
        "author": "mattleibow",
        "body": "/azp run ",
        "createdAt": "2025-03-14T07:50:08",
        "reactions": []
      },
      {
        "id": 2723893468,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-14T07:50:16",
        "reactions": []
      },
      {
        "id": 2723896157,
        "author": "kasperk81",
        "body": "@mattleibow are you planning to merge this before https://github.com/mono/SkiaSharp/pull/3200?",
        "createdAt": "2025-03-14T07:51:20",
        "reactions": []
      },
      {
        "id": 2723899335,
        "author": "kasperk81",
        "body": "i started this work before them and they are just piggybacking. the decent thing to do is to wait for my work to finish..",
        "createdAt": "2025-03-14T07:52:36",
        "reactions": []
      },
      {
        "id": 2724357119,
        "author": "mattleibow",
        "body": "I am not merging yet. I am just checking the build.\n@4Darmygeometry can keep this open and rebase already on the PR by @kasperk81\n\nOnce we merge that, the diff will suddenly shrink. ",
        "createdAt": "2025-03-14T11:10:26",
        "reactions": [
          {
            "user": "4Darmygeometry",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:28:15.3879205Z"
          }
        ]
      },
      {
        "id": 2746130907,
        "author": "kasperk81",
        "body": "@mattleibow i suggest merge this pr and publish the next release to nuget.org. there hasn\u0027t been a release pushed there in the first quarter of the year, so timing couldn\u0027t be better. further refactorings https://github.com/mono/SkiaSharp/pull/3209 etc. can continue later",
        "createdAt": "2025-03-23T10:16:48",
        "reactions": [
          {
            "user": "4Darmygeometry",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:28:15.6457743Z"
          },
          {
            "user": "RigoLigoRLC",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:28:15.6457748Z"
          }
        ]
      },
      {
        "id": 2746473955,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2025-03-23T21:23:38",
        "reactions": []
      },
      {
        "id": 2746474004,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-23T21:23:46",
        "reactions": []
      },
      {
        "id": 2746474822,
        "author": "mattleibow",
        "body": "Thanks for this PR. Always nice to see skia on more things. ",
        "createdAt": "2025-03-23T21:25:55",
        "reactions": []
      },
      {
        "id": 2746838285,
        "author": "mattleibow",
        "body": "/azp run\r\n",
        "createdAt": "2025-03-24T04:15:47",
        "reactions": []
      },
      {
        "id": 2746838417,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-24T04:15:54",
        "reactions": []
      },
      {
        "id": 2746872657,
        "author": "mattleibow",
        "body": "There is an error: \u0060can\u0027t read /usr/loongarch64-linux-gnu/lib/libpthread.so: No such file or directory\u0060 Is that file called something different or in a different location?\r\n\r\n\u0060\u0060\u0060\r\n#10 [ 5/10] RUN . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/13 /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\r\n#10 0.180 sed: can\u0027t read /usr/loongarch64-linux-gnu/lib/libpthread.so: No such file or directory\r\n#10 ERROR: process \u0022/bin/sh -c . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/${TOOLCHAIN_VERSION} /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\u0022 did not complete successfully: exit code: 2\r\n------\r\n \u003E [ 5/10] RUN . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/13 /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so:\r\n0.180 sed: can\u0027t read /usr/loongarch64-linux-gnu/lib/libpthread.so: No such file or directory\r\n------\r\nDockerfile:45\r\n--------------------\r\n  44 |     # Make the script more flexible and use \u0022current\u0022 instead of the actual version\r\n  45 | \u003E\u003E\u003E RUN . /etc/skia-env \\\r\n  46 | \u003E\u003E\u003E     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027) \\\r\n  47 | \u003E\u003E\u003E     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/${TOOLCHAIN_VERSION} /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current \\\r\n  48 | \u003E\u003E\u003E     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so \\\r\n  49 | \u003E\u003E\u003E     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\r\n  50 |     \r\n--------------------\r\nERROR: failed to solve: process \u0022/bin/sh -c . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/${TOOLCHAIN_VERSION} /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\u0022 did not complete successfully: exit code: 2\r\n\u0060\u0060\u0060",
        "createdAt": "2025-03-24T04:48:01",
        "reactions": []
      },
      {
        "id": 2746890232,
        "author": "4Darmygeometry",
        "body": "\u003E There is an error: \u0060can\u0027t read /usr/loongarch64-linux-gnu/lib/libpthread.so: No such file or directory\u0060 Is that file called something different or in a different location?\n\u003E \n\u003E \u0060\u0060\u0060\n\u003E #10 [ 5/10] RUN . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/13 /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\n\u003E #10 0.180 sed: can\u0027t read /usr/loongarch64-linux-gnu/lib/libpthread.so: No such file or directory\n\u003E #10 ERROR: process \u0022/bin/sh -c . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/${TOOLCHAIN_VERSION} /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\u0022 did not complete successfully: exit code: 2\n\u003E ------\n\u003E  \u003E [ 5/10] RUN . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/13 /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so:\n\u003E 0.180 sed: can\u0027t read /usr/loongarch64-linux-gnu/lib/libpthread.so: No such file or directory\n\u003E ------\n\u003E Dockerfile:45\n\u003E --------------------\n\u003E   44 |     # Make the script more flexible and use \u0022current\u0022 instead of the actual version\n\u003E   45 | \u003E\u003E\u003E RUN . /etc/skia-env \\\n\u003E   46 | \u003E\u003E\u003E     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027) \\\n\u003E   47 | \u003E\u003E\u003E     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/${TOOLCHAIN_VERSION} /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current \\\n\u003E   48 | \u003E\u003E\u003E     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so \\\n\u003E   49 | \u003E\u003E\u003E     \u0026\u0026 sed -i \u0022s/\\/usr\\/${TOOLCHAIN_ARCH}\\/lib\\///g\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\n\u003E   50 |     \n\u003E --------------------\n\u003E ERROR: failed to solve: process \u0022/bin/sh -c . /etc/skia-env     \u0026\u0026 TOOLCHAIN_ARCH=$(echo ${TOOLCHAIN_ARCH} | sed \u0027s/x86-64/x86_64/g\u0027)     \u0026\u0026 ln -s /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/${TOOLCHAIN_VERSION} /usr/${TOOLCHAIN_ARCH}/include/c\u002B\u002B/current     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libpthread.so     \u0026\u0026 sed -i \\\u0022s/\\\\/usr\\\\/${TOOLCHAIN_ARCH}\\\\/lib\\\\///g\\\u0022 /usr/${TOOLCHAIN_ARCH}/lib/libc.so\u0022 did not complete successfully: exit code: 2\n\u003E \u0060\u0060\u0060\n\nIt is called libpthread.so.0 in /usr/loongarch64-linux-gnu/lib/libpthread.so.0 https://packages.debian.org/trixie/all/libc6-loong64-cross/filelist",
        "createdAt": "2025-03-24T05:00:32",
        "reactions": []
      },
      {
        "id": 2747050471,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2025-03-24T06:44:28",
        "reactions": []
      },
      {
        "id": 2747050708,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-24T06:44:37",
        "reactions": []
      },
      {
        "id": 2747480369,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2025-03-24T09:39:03",
        "reactions": []
      },
      {
        "id": 2747480709,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-24T09:39:11",
        "reactions": []
      },
      {
        "id": 2747789932,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2025-03-24T11:23:38",
        "reactions": []
      },
      {
        "id": 2747790284,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-24T11:23:47",
        "reactions": []
      },
      {
        "id": 2748197232,
        "author": "mattleibow",
        "body": "woohoo, all green now: \r\n![image](https://github.com/user-attachments/assets/6d1700a4-c359-482e-93d5-32595dd9b8c4)\r\n",
        "createdAt": "2025-03-24T13:48:52",
        "reactions": []
      },
      {
        "id": 2748200828,
        "author": "mattleibow",
        "body": "We don\u0027t need the Deepin changes! CI was just being difficult. Could we revert those changes for now up to the merge main as it was green then.",
        "createdAt": "2025-03-24T13:49:46",
        "reactions": []
      },
      {
        "id": 2748216507,
        "author": "4Darmygeometry",
        "body": "\u003E woohoo, all green now: \n\u003E ![image](https://github.com/user-attachments/assets/6d1700a4-c359-482e-93d5-32595dd9b8c4)\n\u003E \n\nUse Debian Trixie or Deepin 23?",
        "createdAt": "2025-03-24T13:54:58",
        "reactions": []
      },
      {
        "id": 2748250850,
        "author": "4Darmygeometry",
        "body": "\u003E We don\u0027t need the Deepin changes! CI was just being difficult. Could we revert those changes for now up to the merge main as it was green then.\r\n\r\nHas been revert to Debian Trixie",
        "createdAt": "2025-03-24T14:06:08",
        "reactions": []
      },
      {
        "id": 2748360418,
        "author": "mattleibow",
        "body": "/azp run",
        "createdAt": "2025-03-24T14:39:00",
        "reactions": []
      },
      {
        "id": 2748360835,
        "author": "azure-pipelines[bot]",
        "body": "\u003Csamp\u003E\nAzure Pipelines could not run because the pipeline triggers exclude this branch/path.\u003Cbr\u003E\r\n\n\u003C/samp\u003E",
        "createdAt": "2025-03-24T14:39:08",
        "reactions": []
      },
      {
        "id": 2749296283,
        "author": "mattleibow",
        "body": "Thanks @4Darmygeometry for the work getting this ready to be merged. Looking forward to hearing stories about the users of LoongArch64 chips!",
        "createdAt": "2025-03-24T20:18:13",
        "reactions": []
      },
      {
        "id": 2749787870,
        "author": "4Darmygeometry",
        "body": "Reference code:\r\nhttps://github.com/mono/SkiaSharp/pull/3192\r\nhttps://github.com/mono/SkiaSharp/pull/3200",
        "createdAt": "2025-03-25T01:15:41",
        "reactions": []
      },
      {
        "id": 2750230102,
        "author": "mattleibow",
        "body": "Hi folks,\r\n\r\nThe builds are now available on the preview feed: https://aka.ms/skiasharp-eap/index.json\r\nLet me know if version **3.119.0-preview.0.38** is now working again for you.\r\n\r\nAs soon as you let me know, I can release this to NuGet and then hopefully a stable version shortly afterwards.",
        "createdAt": "2025-03-25T06:36:21",
        "reactions": []
      },
      {
        "id": 2750815264,
        "author": "4Darmygeometry",
        "body": "\u003E Hi folks,\r\n\u003E \r\n\u003E The builds are now available on the preview feed: https://aka.ms/skiasharp-eap/index.json Let me know if version **3.119.0-preview.0.38** is now working again for you.\r\n\u003E \r\n\u003E As soon as you let me know, I can release this to NuGet and then hopefully a stable version shortly afterwards.\r\n\r\nSuccessfully download and use, can release this to NuGet, thanks.\r\nlinux-loongarch64\r\n\r\nskiasharp.nativeassets.linux/3.119.0-preview.0.38/runtimes/linux-loongarch64/native/libSkiaSharp.so and skiasharp.nativeassets.linux/3.119.0-preview.0.38/runtimes/linux-musl-loongarch64/native/ packaged normally and able to use normally.\r\n\u0060\u0060\u0060\r\ngamma@gamma-pc [ ~ ] ! nuget install SkiaSharp.NativeAssets.Linux -Version 3.119.0-preview.0.38 -Source https://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/index.json\r\nFeeds used:\r\n  /home/gamma/.nuget/packages/\r\n  https://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/index.json\r\n\r\n\r\n\r\nAttempting to gather dependency information for package \u0027SkiaSharp.NativeAssets.Linux.3.119.0-preview.0.38\u0027 with respect to project \u0027/home/gamma\u0027, targeting \u0027Any,Version=v0.0\u0027\r\nGathering dependency information took 1.13 sec\r\nAttempting to resolve dependencies for package \u0027SkiaSharp.NativeAssets.Linux.3.119.0-preview.0.38\u0027 with DependencyBehavior \u0027Lowest\u0027\r\nResolving dependency information took 0 ms\r\nResolving actions to install package \u0027SkiaSharp.NativeAssets.Linux.3.119.0-preview.0.38\u0027\r\nResolved actions to install package \u0027SkiaSharp.NativeAssets.Linux.3.119.0-preview.0.38\u0027\r\nRetrieving package \u0027SkiaSharp.NativeAssets.Linux 3.119.0-preview.0.38\u0027 from \u0027https://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/index.json\u0027.\r\n  GET https://pkgs.dev.azure.com/xamarin/6fd3d886-57a5-4e31-8db7-52a1b47c07a8/_packaging/737d9830-bed0-4b55-8699-c93e7b529ed0/nuget/v3/flat2/skiasharp.nativeassets.linux/3.119.0-preview.0.38/skiasharp.nativeassets.linux.3.119.0-preview.0.38.nupkg\r\n  OK https://pkgs.dev.azure.com/xamarin/6fd3d886-57a5-4e31-8db7-52a1b47c07a8/_packaging/737d9830-bed0-4b55-8699-c93e7b529ed0/nuget/v3/flat2/skiasharp.nativeassets.linux/3.119.0-preview.0.38/skiasharp.nativeassets.linux.3.119.0-preview.0.38.nupkg 1429ms\r\nInstalling SkiaSharp.NativeAssets.Linux 3.119.0-preview.0.38.\r\nAdding package \u0027SkiaSharp.NativeAssets.Linux.3.119.0-preview.0.38\u0027 to folder \u0027/home/gamma\u0027\r\nAdded package \u0027SkiaSharp.NativeAssets.Linux.3.119.0-preview.0.38\u0027 to folder \u0027/home/gamma\u0027\r\nSuccessfully installed \u0027SkiaSharp.NativeAssets.Linux 3.119.0-preview.0.38\u0027 to /home/gamma\r\nExecuting nuget actions took 29.87 sec\r\n\u0060\u0060\u0060\r\n",
        "createdAt": "2025-03-25T10:35:47",
        "reactions": []
      },
      {
        "id": 2750822463,
        "author": "4Darmygeometry",
        "body": "\u003E Hi folks,\r\n\u003E \r\n\u003E The builds are now available on the preview feed: https://aka.ms/skiasharp-eap/index.json Let me know if version **3.119.0-preview.0.38** is now working again for you.\r\n\u003E \r\n\u003E As soon as you let me know, I can release this to NuGet and then hopefully a stable version shortly afterwards.\r\n\r\n\r\nBut only the latest compiled SkiaSharp, not HarfBuzzSharp\r\n\r\nI want to use the latest built SkiaSharp.NativeAssets.Linux and HarfBuzzSharp.NativeAssets.Linux NuGet packages to support LoongArch64. However, the HarfBuzzSharp.NativeAssets.Linux NuGet package I found was built in December 2024, which is four months ago; only the SkiaSharp.NativeAssets.Linux NuGet package has the latest build in March 2025\r\nhttps://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/registrations2-semver2/HarfbuzzSharp.NativeAssets.Linux/index.json",
        "createdAt": "2025-03-25T10:38:47",
        "reactions": []
      },
      {
        "id": 2750957557,
        "author": "mattleibow",
        "body": "\r\n\u003E But only the latest compiled SkiaSharp, not HarfBuzzSharp\r\n\r\nIs there an issue with harfbuzz?",
        "createdAt": "2025-03-25T11:31:14",
        "reactions": []
      },
      {
        "id": 2750967805,
        "author": "4Darmygeometry",
        "body": "\u003E \n\u003E \u003E But only the latest compiled SkiaSharp, not HarfBuzzSharp\n\u003E \n\u003E Is there an issue with harfbuzz?\n\nhttps://github.com/mono/SkiaSharp/issues/3197",
        "createdAt": "2025-03-25T11:35:36",
        "reactions": []
      },
      {
        "id": 2751638493,
        "author": "mattleibow",
        "body": "I am not sure what you mean... Your PR also includes harfbuzz binaries. Or maybe you linked to a different issue? ",
        "createdAt": "2025-03-25T15:22:11",
        "reactions": []
      },
      {
        "id": 2751715340,
        "author": "4Darmygeometry",
        "body": "\u003E I am not sure what you mean... Your PR also includes harfbuzz binaries. Or maybe you linked to a different issue?\r\n\r\nI want to use the latest built SkiaSharp.NativeAssets.Linux and HarfBuzzSharp.NativeAssets.Linux NuGet packages to support LoongArch64.  However, the HarfBuzzSharp.NativeAssets.Linux NuGet package I found was built in December 2024, which is four months ago;  only the SkiaSharp.NativeAssets.Linux NuGet package has the latest build in March 2025\r\nhttps://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/registrations2-semver2/HarfbuzzSharp.NativeAssets.Linux/index.json",
        "createdAt": "2025-03-25T15:45:19",
        "reactions": []
      },
      {
        "id": 2751966667,
        "author": "mattleibow",
        "body": "I see. The versions are a bit mixed up in order as main builds are preview.0 but we have a preview.2 out. This build (8.3.1-preview.0.38) is actually there about halfway down the page: https://dev.azure.com/xamarin/public/_artifacts/feed/SkiaSharp/NuGet/HarfBuzzSharp.NativeAssets.Linux/overview/8.3.1-preview.0.38\r\n\r\nOnce I branch for release, it will get a real number.",
        "createdAt": "2025-03-25T17:07:34",
        "reactions": [
          {
            "user": "4Darmygeometry",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:28:22.9299774Z"
          }
        ]
      },
      {
        "id": 2752001080,
        "author": "4Darmygeometry",
        "body": "\u003E I see. The versions are a bit mixed up in order as main builds are preview.0 but we have a preview.2 out. This build (8.3.1-preview.0.38) is actually there about halfway down the page: https://dev.azure.com/xamarin/public/_artifacts/feed/SkiaSharp/NuGet/HarfBuzzSharp.NativeAssets.Linux/overview/8.3.1-preview.0.38\r\n\u003E \r\n\u003E Once I branch for release, it will get a real number.\r\n\r\nSuccessfully to download and use, can branch for release and put it and SkiaSharp into nuget.org, thanks.\r\n\u0060\u0060\u0060\r\ngamma@gamma-pc [ ~ ] $ nuget install HarfBuzzSharp.NativeAssets.Linux -Version 8.3.1-preview.0.38 -Source https://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/index.json\r\nFeeds used:\r\n  /home/gamma/.nuget/packages/\r\n  https://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/index.json\r\n\r\n\r\n\r\nAttempting to gather dependency information for package \u0027HarfBuzzSharp.NativeAssets.Linux.8.3.1-preview.0.38\u0027 with respect to project \u0027/home/gamma\u0027, targeting \u0027Any,Version=v0.0\u0027\r\nGathering dependency information took 3.14 sec\r\nAttempting to resolve dependencies for package \u0027HarfBuzzSharp.NativeAssets.Linux.8.3.1-preview.0.38\u0027 with DependencyBehavior \u0027Lowest\u0027\r\nResolving dependency information took 0 ms\r\nResolving actions to install package \u0027HarfBuzzSharp.NativeAssets.Linux.8.3.1-preview.0.38\u0027\r\nResolved actions to install package \u0027HarfBuzzSharp.NativeAssets.Linux.8.3.1-preview.0.38\u0027\r\nRetrieving package \u0027HarfBuzzSharp.NativeAssets.Linux 8.3.1-preview.0.38\u0027 from \u0027https://pkgs.dev.azure.com/xamarin/public/_packaging/SkiaSharp/nuget/v3/index.json\u0027.\r\n  GET https://pkgs.dev.azure.com/xamarin/6fd3d886-57a5-4e31-8db7-52a1b47c07a8/_packaging/737d9830-bed0-4b55-8699-c93e7b529ed0/nuget/v3/flat2/harfbuzzsharp.nativeassets.linux/8.3.1-preview.0.38/harfbuzzsharp.nativeassets.linux.8.3.1-preview.0.38.nupkg\r\n  OK https://pkgs.dev.azure.com/xamarin/6fd3d886-57a5-4e31-8db7-52a1b47c07a8/_packaging/737d9830-bed0-4b55-8699-c93e7b529ed0/nuget/v3/flat2/harfbuzzsharp.nativeassets.linux/8.3.1-preview.0.38/harfbuzzsharp.nativeassets.linux.8.3.1-preview.0.38.nupkg 2146ms\r\nInstalling HarfBuzzSharp.NativeAssets.Linux 8.3.1-preview.0.38.\r\nAdding package \u0027HarfBuzzSharp.NativeAssets.Linux.8.3.1-preview.0.38\u0027 to folder \u0027/home/gamma\u0027\r\nAdded package \u0027HarfBuzzSharp.NativeAssets.Linux.8.3.1-preview.0.38\u0027 to folder \u0027/home/gamma\u0027\r\nSuccessfully installed \u0027HarfBuzzSharp.NativeAssets.Linux 8.3.1-preview.0.38\u0027 to /home/gamma\r\nExecuting nuget actions took 8.39 sec\r\n\u0060\u0060\u0060",
        "createdAt": "2025-03-25T17:20:27",
        "reactions": []
      }
    ]
  }
}