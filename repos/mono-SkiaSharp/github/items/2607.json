{
  "number": 2607,
  "type": "issue",
  "state": "open",
  "title": "[BUG]  The type initializer for \u0027SkiaSharp.SKData\u0027 threw an exception (even after applying the solution of issue #2124).",
  "body": "### Description\r\n\r\nI\u0027m trying to resize images (actually making thumbnail of 200x150) using SkiaSharp. The code works fine in my local setup which has \u0060Visual Studio Code 1.77.3\u0060,  \u0060.NET 7.0.400\u0060 and \u0060Windows 10 OS\u0060.  But when I deply the build of the code to \u0060Google Cloud Plateform (GCP)\u0060 with docker, the above mentioned exception occurs. \r\n\r\nI tried the GCP deployment with following packages:\r\nNote:  The deployed code was written in \u0060Microsoft Visual Studio Community 2022 (64 bit)\u0060, \u0060 .NET 6\u0060, \u0060Windows 10\u0060.\r\n\r\n\u003E SkiaSharp (2.88.5)\r\n\u003E SkiaSharp.Views.Blazor (2.88.5) (Solution for issue #2124)\r\n\u003E SkiaSharp.NativeAssets.Linux (2.88.5)\r\n\u003E SkiaSharp.NativeAssets.Linux.NoDependencies (2.88.5)\r\n\u003E SkiaSharp.NativeAssets.WebAsssembly (2.88.5)\r\n\r\nOn my local, the \u0060SkiaSharp (2.88.5)\u0060 alone worked.\r\n\r\n### Code\r\n\r\n\r\n\u0060\u0060\u0060cs\r\npublic IFormFile getThumbnailFromBase64(string base64String)\r\n{\r\n    byte[] imageBytes = Convert.FromBase64String(base64String);\r\n\r\n    SKImage image = SKImage.FromEncodedData(imageBytes);\r\n    SKBitmap imageBitmap = SKBitmap.FromImage(image);\r\n\r\n    SKImageInfo info = new SKImageInfo(200, 150);\r\n    SKFilterQuality quality = SKFilterQuality.High;\r\n\r\n    SKBitmap thumbnail = imageBitmap.Resize(imageInfo, quality);\r\n    SKData thumbData = thumbnail.Encode(SKEncodedImageFormat.Jpeg, 100);\r\n\r\n    byte[] thumbByte = thumbData.ToArray();\r\n    var stream = new MemoryStream(thumbByte);\r\n    IformFile thumbFile = new FormFile(stream, 0, thumbByte.Length, \u0022ImageFile\u0022, \u0022ImageFile\u0022);\r\n\r\n    return thumbFile;\r\n}\r\n\u0060\u0060\u0060\r\n\r\n\r\n### Expected Behavior\r\n\r\nThe code should take \u0060base64\u0060 image string and return an object of \u0060IFormFile\u0060 after deploying to GCP.\r\n\r\nAlso the exception should give more description or reason of the error and possible suggestions.\r\n\r\nWhat this \u0022type initializer\u0022 means in the exception?\r\n\r\n### Actual Behavior\r\n\r\nI put logger after each line of the above code. The only logger output I got is after \u0060byte[] imageBytes = Convert.FromBase64String(base64String);\u0060 line. I my thinking the exception \u0060The type initializer for \u0027SkiaSharp.SKData\u0027 threw an exception\u0060 occured at the line where I used \u0060SKImage\u0060 class.\r\n\r\n### Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### Last Known Good Version of SkiaSharp\r\n\r\nOther (Please indicate in the description)\r\n\r\n### IDE / Editor\r\n\r\nVisual Studio (Windows)\r\n\r\n### Platform / Operating System\r\n\r\nLinux, Windows, Other (Please indicate in the description)\r\n\r\n### Platform / Operating System Version\r\n\r\n- Google Cloud Plateform (Linux OS)\r\n\r\n### Devices\r\n\r\n- Cloud Server (GCP)\r\n\r\n### Relevant Screenshots\r\n\r\n..\r\n\r\n### Relevant Log Output\r\n\r\n\u0060\u0060\u0060shell\r\nThe type initializer for \u0027SkiaSharp.SKData\u0027 threw an exception.\r\n\u0060\u0060\u0060\r\n\r\n\r\n### Code of Conduct\r\n\r\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "ak4shp",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "createdAt": "2023-09-13T20:50:43",
  "updatedAt": "2024-01-21T19:15:57",
  "commentCount": 8,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:41:23.8260217Z",
    "reactions": [],
    "comments": [
      {
        "id": 1724326577,
        "author": "mattleibow",
        "body": "The \u0022type initializer\u0022 is just the runtime component that constructs objects. So, the error is saying there was an exception in the constructor.\r\n\r\nSo, this exception is saying it was unable to load the libSkiaSharp native binary.\r\n\r\nAre you specifically using Blazor? Or, just web assembly?\r\n\r\nOr, is this a native Linux app running in docker and the exception is happening on the server?",
        "createdAt": "2023-09-18T20:30:25",
        "reactions": [
          {
            "user": "ak4shp",
            "content": "eyes",
            "createdAt": "2026-02-06T13:41:22.3988741Z"
          }
        ]
      },
      {
        "id": 1724549251,
        "author": "ak4shp",
        "body": "Hi @mattleibow,\r\nThanks for the quick look up on the issue. \r\n\r\nI am not using Blazor or Web assembly specifically. The same code with _only_ \u0060SkiaSharp (2.88.5)\u0060 is working as expected on my Windows 10 console app with .NET 6. As per the suggestions across the web, I added all above mentioned SkiaSharp packages hoping atleast any of them might be the right one. \r\n\r\nYes, it is deployed to GCP (Google cloud platforms) Container Registry and build with docker. The exception is happening only on the server i.e GCP. \r\n\r\nAm I referencing to a wrong packege ? Or some plateform compatibility issues?",
        "createdAt": "2023-09-18T22:29:45",
        "reactions": []
      },
      {
        "id": 1732111019,
        "author": "ghost",
        "body": "This issue has been automatically marked as stale because it has been marked as requiring author feedback but has not had any activity for **4 days**. It will be closed if no further activity occurs **within 3 days of this comment**. If it *is* closed, feel free to comment when you are able to provide the additional information and we will re-investigate.",
        "createdAt": "2023-09-22T23:00:28",
        "reactions": []
      },
      {
        "id": 1749762268,
        "author": "fjpging8908",
        "body": "I have the same problem... the only difference is that i\u0027am running my api in AWS ECS (Docker). i\u0027ve installed the same SkiaSharp.NativeAssets.Linux and my docker file contain this:\r\nRUN apt-get install -y libfontconfig1\r\nRUN apt-get update \u0026\u0026 apt-get install -y apt-utils libgdiplus libc6-dev\r\n\r\nI don\u0027t know what to do else. ",
        "createdAt": "2023-10-05T22:51:27",
        "reactions": []
      },
      {
        "id": 1812437697,
        "author": "filipecarneiro",
        "body": "You should add reference to SkiaSharp.NativeAssets.Linux.**NoDependencies**: [SkiaSharp.NativeAssets.Linux.NoDependencies](https://www.nuget.org/packages/SkiaSharp.NativeAssets.Linux.NoDependencies).",
        "createdAt": "2023-11-15T12:17:44",
        "reactions": [
          {
            "user": "asushkov-github",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:41:23.2225498Z"
          },
          {
            "user": "atakane",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:41:23.2225502Z"
          },
          {
            "user": "masterlifting",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:41:23.2225503Z"
          }
        ]
      },
      {
        "id": 1863861772,
        "author": "narojay",
        "body": "\u003E You should add reference to SkiaSharp.NativeAssets.Linux.**NoDependencies**: [SkiaSharp.NativeAssets.Linux.NoDependencies](https://www.nuget.org/packages/SkiaSharp.NativeAssets.Linux.NoDependencies).\r\n\r\nnot work",
        "createdAt": "2023-12-20T05:09:15",
        "reactions": []
      },
      {
        "id": 1897830156,
        "author": "atakane",
        "body": "\u003E You should add reference to SkiaSharp.NativeAssets.Linux.**NoDependencies**: [SkiaSharp.NativeAssets.Linux.NoDependencies](https://www.nuget.org/packages/SkiaSharp.NativeAssets.Linux.NoDependencies).\r\n\r\nThis worked for me after adding missing 2 libs (in case)\r\n\u0060\u0060\u0060RUN apt-get update \u0026\u0026 apt-get install -y \\\r\n    libfontconfig1 \\\r\n    libfreetype6 \\\r\n    \u0026\u0026 rm -rf /var/lib/apt/lists/*\u0060\u0060\u0060 \r\n    into the DockerFile.",
        "createdAt": "2024-01-18T05:33:18",
        "reactions": [
          {
            "user": "Khobolov",
            "content": "rocket",
            "createdAt": "2026-02-06T13:41:23.5894525Z"
          },
          {
            "user": "Pietervdw",
            "content": "heart",
            "createdAt": "2026-02-06T13:41:23.589453Z"
          },
          {
            "user": "iquadrat-barcelona",
            "content": "heart",
            "createdAt": "2026-02-06T13:41:23.5894531Z"
          }
        ]
      },
      {
        "id": 1902732831,
        "author": "fjpging8908",
        "body": "Thanks, a fixed de problem with your recommendation.  very kind of you\r\n\r\nEl jue, 18 ene 2024 a las 0:33, Atakan Eser ***@***.***\u003E)\r\nescribi\u00F3:\r\n\r\n\u003E You should add reference to SkiaSharp.NativeAssets.Linux.*NoDependencies*:\r\n\u003E SkiaSharp.NativeAssets.Linux.NoDependencies\r\n\u003E \u003Chttps://www.nuget.org/packages/SkiaSharp.NativeAssets.Linux.NoDependencies\u003E\r\n\u003E .\r\n\u003E\r\n\u003E This worked for me after adding missing 2 libs (in case)\r\n\u003E\r\n\u003E     libfontconfig1 \\\r\n\u003E     libfreetype6 \\\r\n\u003E     \u0026\u0026 rm -rf /var/lib/apt/lists/*\u0060\u0060\u0060\r\n\u003E     into the DockerFile.\r\n\u003E\r\n\u003E \u2014\r\n\u003E Reply to this email directly, view it on GitHub\r\n\u003E \u003Chttps://github.com/mono/SkiaSharp/issues/2607#issuecomment-1897830156\u003E,\r\n\u003E or unsubscribe\r\n\u003E \u003Chttps://github.com/notifications/unsubscribe-auth/AKLZFU54NRSLVY3J6SSPGVDYPCX2RAVCNFSM6AAAAAA4XCQM22VHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMYTQOJXHAZTAMJVGY\u003E\r\n\u003E .\r\n\u003E You are receiving this because you commented.Message ID:\r\n\u003E ***@***.***\u003E\r\n\u003E\r\n",
        "createdAt": "2024-01-21T19:15:56",
        "reactions": [
          {
            "user": "atakane",
            "content": "hooray",
            "createdAt": "2026-02-06T13:41:23.7759511Z"
          },
          {
            "user": "Adil530000",
            "content": "hooray",
            "createdAt": "2026-02-06T13:41:23.7759514Z"
          }
        ]
      }
    ]
  }
}