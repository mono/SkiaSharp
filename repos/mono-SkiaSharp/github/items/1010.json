{
  "number": 1010,
  "type": "pr",
  "state": "closed",
  "title": "Vulkan Support for Win32 (and APIs for everyone as well)",
  "body": "**Description of Change**\r\n\r\nThis is the workspace for Vulkan dev. \r\n\r\nThis PR has the support for Win32 builds. Android and Linux are in this PR: #1287\r\n\r\nThe native PR is https://github.com/mono/skia/pull/69\r\n\r\nNew tests were added in a separate project so that they can be run separately (or ignored on platforms that don\u0027t support Vulkan) as well as to work around the fact that the library we use to set up the Vulkan surfaces [SharpVk](https://github.com/FacticiusVir/SharpVk) not strong named.\r\n\r\n**Building Vulkan**\r\n\r\nIn order to build SkiaSharp with Vulkan support, either set the environment variable \u0060SUPPORT_VULKAN\u0060 or the command line arguments \u0060--supportVulkan\u0060 to \u0060true\u0060 or \u00601\u0060.\r\n\r\n\u003E The Vulkan headers ship with the skia project source, so no need to install and SDKs.\r\n\r\n**Bugs Fixed**\r\n\r\n- Related to #252\r\n- Related to #897 (thanks to @tuccio) \r\n- Fixes #1222\r\n\r\n**API Changes**\r\n\r\n - Adding the Vulkan support APIs:\r\n    - new class: \u0060GRSharpVkBackendContext\u0060\r\n    - new class: \u0060GRVkBackendContext\u0060\r\n    - new class: \u0060GRVkExtensions\u0060\r\n    - new method: \u0060GRContext.CreateVulkan(GRVkBackendContext)\u0060\r\n    - new ctor: \u0060GRBackendTexture(int, int, GRVkImageInfo)\u0060\r\n    - new ctor: \u0060GRBackendRenderTarget(int, int, int, GRVkImageInfo)\u0060\r\n    - new struct: \u0060GRVkAlloc\u0060\r\n    - new struct: \u0060GRVkImageInfo\u0060\r\n    - new struct: \u0060GrVkYcbcrConversionInfo\u0060\r\n - Renames the \u0060SKColorType\u0060 enum values (#1222)  \r\n    - \u0060Unnormalized\u0060 suffix was incorrect (should be \u0022unsigned normalized\u0022) and is the default, so remove it\r\n    - \u0060RgbaF16Normalized\u0060 was not a correct \u0022normalization\u0022 and is actually clamped\r\n    - Rename the new values to follow the pattern:  \r\n      integral: \u0060\u003Ccomponents\u003E\u003Csizes\u003E\u0060 (RGB 565 = Rgb565)\r\n      floating: \u0060\u003Ccomponent\u003EF\u003Ccomponent size\u003E\u0060 (RGBA half-float = RgbaF16)\r\n- Obsoletes and hide the \u0060GRPixelConfig\u0060 as that is now private API\r\n    - Remove the mapping code that used to pass through this type\r\n\r\n**Behavioral Changes**\r\n\r\nNew members to use the Vulkan APIs. No changes to functionality.\r\n\r\n**PR Checklist**\r\n\r\n- [x] Has tests (if omitted, state reason in description)\r\n- [x] Rebased on top of master at time of PR\r\n- [x] Changes adhere to coding standard\r\n- [x] ~~Updated documentation~~ _(in a separate PR)_\r\n",
  "author": {
    "login": "mattleibow",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "milestone": "v2.80.0",
  "createdAt": "2019-11-14T22:25:43",
  "updatedAt": "2020-07-09T02:18:26",
  "closedAt": "2020-05-14T01:01:39",
  "commentCount": 8,
  "reactionCount": 31,
  "draft": false,
  "merged": true,
  "mergedAt": "2020-05-14T01:01:39",
  "mergeableState": "unknown",
  "baseBranch": "develop",
  "headBranch": "dev/vulkan",
  "additions": 1836,
  "deletions": 295,
  "changedFiles": 56,
  "commits": 53,
  "reviews": [
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2019-11-14T22:45:45"
    },
    {
      "author": "mattleibow",
      "state": "COMMENTED",
      "submittedAt": "2019-11-14T22:46:43"
    },
    {
      "author": "tuccio",
      "state": "COMMENTED",
      "submittedAt": "2019-11-15T13:11:48"
    },
    {
      "author": "tuccio",
      "state": "COMMENTED",
      "submittedAt": "2019-11-15T13:15:36"
    },
    {
      "author": "tuccio",
      "state": "APPROVED",
      "submittedAt": "2019-11-15T17:26:41"
    },
    {
      "author": "tuccio",
      "state": "DISMISSED",
      "submittedAt": "2019-11-15T17:28:12"
    }
  ],
  "engagement": {
    "syncedAt": "2026-02-06T14:28:23.0932719Z",
    "reactions": [
      {
        "user": "mattleibow",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932753Z"
      },
      {
        "user": "wieslawsoltes",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932759Z"
      },
      {
        "user": "wieslawsoltes",
        "content": "hooray",
        "createdAt": "2026-02-06T14:28:23.0932762Z"
      },
      {
        "user": "wieslawsoltes",
        "content": "rocket",
        "createdAt": "2026-02-06T14:28:23.0932766Z"
      },
      {
        "user": "wieslawsoltes",
        "content": "heart",
        "createdAt": "2026-02-06T14:28:23.0932769Z"
      },
      {
        "user": "MarchingCube",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932894Z"
      },
      {
        "user": "tuccio",
        "content": "hooray",
        "createdAt": "2026-02-06T14:28:23.0932898Z"
      },
      {
        "user": "OndrejRitomsky",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932901Z"
      },
      {
        "user": "kekekeks",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932904Z"
      },
      {
        "user": "pr8x",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932908Z"
      },
      {
        "user": "pr8x",
        "content": "rocket",
        "createdAt": "2026-02-06T14:28:23.093291Z"
      },
      {
        "user": "pr8x",
        "content": "hooray",
        "createdAt": "2026-02-06T14:28:23.0932913Z"
      },
      {
        "user": "pr8x",
        "content": "heart",
        "createdAt": "2026-02-06T14:28:23.0932916Z"
      },
      {
        "user": "Michron",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932918Z"
      },
      {
        "user": "HyDr0x",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.093292Z"
      },
      {
        "user": "HyDr0x",
        "content": "hooray",
        "createdAt": "2026-02-06T14:28:23.0932925Z"
      },
      {
        "user": "HyDr0x",
        "content": "heart",
        "createdAt": "2026-02-06T14:28:23.0932927Z"
      },
      {
        "user": "HyDr0x",
        "content": "rocket",
        "createdAt": "2026-02-06T14:28:23.093293Z"
      },
      {
        "user": "pinki",
        "content": "hooray",
        "createdAt": "2026-02-06T14:28:23.0932933Z"
      },
      {
        "user": "ahopper",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932934Z"
      },
      {
        "user": "FoggyFinder",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932936Z"
      },
      {
        "user": "FoggyFinder",
        "content": "hooray",
        "createdAt": "2026-02-06T14:28:23.0932937Z"
      },
      {
        "user": "mgnslndh",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932939Z"
      },
      {
        "user": "he55",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932941Z"
      },
      {
        "user": "JoAlli",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932942Z"
      },
      {
        "user": "cyraid",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932943Z"
      },
      {
        "user": "Mikolaytis",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932944Z"
      },
      {
        "user": "Mikolaytis",
        "content": "hooray",
        "createdAt": "2026-02-06T14:28:23.0932946Z"
      },
      {
        "user": "Mikolaytis",
        "content": "rocket",
        "createdAt": "2026-02-06T14:28:23.0932947Z"
      },
      {
        "user": "Mikolaytis",
        "content": "heart",
        "createdAt": "2026-02-06T14:28:23.0932949Z"
      },
      {
        "user": "ryanelian",
        "content": "\u002B1",
        "createdAt": "2026-02-06T14:28:23.0932951Z"
      }
    ],
    "comments": [
      {
        "id": 554453813,
        "author": "tuccio",
        "body": "As mentioned in the issue, in my company we have been running with those changes for a few months without problems. I built and tested this branch as well today and everything seems in order.",
        "createdAt": "2019-11-15T17:31:10",
        "reactions": []
      },
      {
        "id": 554470015,
        "author": "mattleibow",
        "body": "Hmm, looking at the state today, I see the whole API has changed: https://github.com/google/skia/tree/chrome/m79/include/gpu/vk\r\n\r\nI think this PR will only get merged after I get the m79 branch merged. I don\u0027t want to implement a feature in a minor version, and then break it in the next stable.",
        "createdAt": "2019-11-15T18:14:02",
        "reactions": []
      },
      {
        "id": 562843039,
        "author": "MarchingCube",
        "body": "@mattleibow Can you merge latest master again into this branch? We would like to update again (to get recent memory fix) sometime next week.\r\n\r\nAnd I agree that we should wait for m79 to proceed with this PR. Do you have an estimate when this will happen (since we would help with exposing new API) ?",
        "createdAt": "2019-12-07T11:32:18",
        "reactions": []
      },
      {
        "id": 562880671,
        "author": "mattleibow",
        "body": "@MarchingCube updated - took a bit of a while as I was failing with my machine and Docker containers :( All fixed now so we have nice Docker samples :)\r\n\r\nI can\u0027t give any dates with m79 because I got pulled off for a few days. I really hope to get it done soon - trying for January. The main issue is there is a fair bit of breaking changes, so we are going to have to do a v2 release and pretty much nothing will work. SKPaint is now two separate objects and that is going to be fun for everyone. It makes technical sense, but so do vaccines - but they also hurt :P ",
        "createdAt": "2019-12-07T19:46:57",
        "reactions": []
      },
      {
        "id": 622935742,
        "author": "MarchingCube",
        "body": "@mattleibow Since there was progress on getting m80 up and running - what would be the action plan for this PR? I guess it should \u0060target\u0060 develop now and it would be really good to get this in sometime so we won\u0027t have to keep a fork running for another year :)",
        "createdAt": "2020-05-02T11:02:20",
        "reactions": []
      },
      {
        "id": 622944828,
        "author": "mattleibow",
        "body": "@MarchingCube @tuccio I updated the code! It doesn\u0027t actually compile anymore since they changed a whole bunch. But, you should now be able to work from this and make the same changes.",
        "createdAt": "2020-05-02T12:17:22",
        "reactions": [
          {
            "user": "MarchingCube",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:28:22.5395553Z"
          }
        ]
      },
      {
        "id": 627297645,
        "author": "mattleibow",
        "body": "This has been pushed to the preview feed for initial testing:\r\n - feed: https://aka.ms/skiasharp-eap/index.json\r\n - version: **2.80.0-pr.1010.14**\r\n - packages: **SkiaSharp** and **SkiaSharp.Vulkan.SharpVk**",
        "createdAt": "2020-05-12T11:57:29",
        "reactions": []
      },
      {
        "id": 627298828,
        "author": "mattleibow",
        "body": "One thing that I am not sure on yet is the namespace in the \u0022SkiaSharp.Vulkan.SharpVk\u0022 package... I am using \u0060SkiaSharp.Vulkan.SharpVk\u0060. This is going to make the types harder to find, and the types are very few (only 2) so it is not going to clutter the namespace.\r\n\r\nShould I just keep it in the root \u0060SkiaSharp\u0060?",
        "createdAt": "2020-05-12T12:00:29",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:28:23.0430952Z"
          },
          {
            "user": "mattleibow",
            "content": "-1",
            "createdAt": "2026-02-06T14:28:23.0430959Z"
          },
          {
            "user": "Gillibald",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:28:23.0430961Z"
          },
          {
            "user": "MarchingCube",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:28:23.0430962Z"
          }
        ]
      }
    ]
  }
}