{
  "number": 2379,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies on M1 Mac",
  "body": "**Description**\r\n\r\nUsing SkiaSharp on a M1 Max MacBook Pro is not possible because the runtime isn\u0027t able to load the shared library \u0027libSkiaSharp\u0027.\r\n\r\n**Code**\r\n\r\n\u0060\u0060\u0060csharp\r\nusing var sourceBitmap = SKBitmap.Decode(imageStream);\r\n\u0060\u0060\u0060\r\n\r\n**Expected Behavior**\r\n\r\nUsing SkiaSharp on the M1 Mac works as expected without throwing that error.\r\n\r\n**Actual Behavior**\r\n\r\nA TypeInitializationException is thrown because the libSkiaSharp.dylib isn\u0027t found, probably because it isn\u0027t copied to the bin/debug/net6.0/runtimes\r\n\r\nSystem.DllNotFoundException: Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies. In order to help diagnose loading problems, consider setting the DYLD_PRINT_LIBRARIES environment variable: dlopen(liblibSkiaSharp, 0x0001): tried: \u0027liblibSkiaSharp\u0027 (no such file), \u0027/System/Volumes/Preboot/Cryptexes/OSliblibSkiaSharp\u0027 (no such file), \u0027/usr/lib/liblibSkiaSharp\u0027 (no such file, not in dyld cache), \u0027liblibSkiaSharp\u0027 (no such file), \u0027/usr/local/lib/liblibSkiaSharp\u0027 (no such file), \u0027/usr/lib/liblibSkiaSharp\u0027 (no such file, not in dyld cache)\r\n   at SkiaSharp.SkiaApi.sk_managedstream_set_procs(SKManagedStreamDelegates procs)\r\n   at SkiaSharp.SKAbstractManagedStream..cctor()\r\n\r\nThe type initializer for \u0027SkiaSharp.SKAbstractManagedStream\u0027 threw an exception.\r\n ---\u003E System.DllNotFoundException: Unable to load shared library \u0027libSkiaSharp\u0027 or one of its dependencies. In order to help diagnose loading problems, consider setting the DYLD_PRINT_LIBRARIES environment variable: dlopen(liblibSkiaSharp, 0x0001): tried: \u0027liblibSkiaSharp\u0027 (no such file), \u0027/System/Volumes/Preboot/Cryptexes/OSliblibSkiaSharp\u0027 (no such file), \u0027/usr/lib/liblibSkiaSharp\u0027 (no such file, not in dyld cache), \u0027liblibSkiaSharp\u0027 (no such file), \u0027/usr/local/lib/liblibSkiaSharp\u0027 (no such file), \u0027/usr/lib/liblibSkiaSharp\u0027 (no such file, not in dyld cache)\r\n   at SkiaSharp.SkiaApi.sk_managedstream_set_procs(SKManagedStreamDelegates procs)\r\n   at SkiaSharp.SKAbstractManagedStream..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at SkiaSharp.SKAbstractManagedStream..ctor(Boolean owns)\r\n   at SkiaSharp.SKManagedStream..ctor(Stream managedStream, Boolean disposeManagedStream)\r\n   at SkiaSharp.SKCodec.WrapManagedStream(Stream stream)\r\n   at SkiaSharp.SKCodec.Create(Stream stream, SKCodecResult\u0026 result)\r\n   at SkiaSharp.SKCodec.Create(Stream stream)\r\n   at SkiaSharp.SKBitmap.Decode(Stream stream)\r\n\r\n**Basic Information**\r\n\r\n- Version with issue: 2.88.3\r\n- Last known good version:  N/A\r\n- IDE:  JetBrains Rider\r\n- Platform Target Frameworks: \r\n  - macOS: latest\r\n  - dotnet: 6\r\n- Target Devices: MacBook Pro M1 Max\r\n \r\n\r\n",
  "author": {
    "login": "michaelschaffer-doka",
    "type": "User"
  },
  "labels": [
    {
      "name": "status/needs-info",
      "color": "B8EC4A"
    }
  ],
  "assignees": [],
  "createdAt": "2023-02-10T10:35:09",
  "updatedAt": "2024-07-23T22:24:42",
  "closedAt": "2023-06-26T00:00:52",
  "commentCount": 7,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T12:52:28.6234673Z",
    "reactions": [],
    "comments": [
      {
        "id": 1426192472,
        "author": "Rudazzle",
        "body": "If you manually copy the \u0027libSkiaSharp\u0027 dependency does it work?  I ask because I\u0027m having a similar issue via a Linux deployment but the library is copied there.  However, I\u0027m still getting an error that it was unable to load.",
        "createdAt": "2023-02-10T18:37:03",
        "reactions": []
      },
      {
        "id": 1427108873,
        "author": "michaelschaffer-doka",
        "body": "@Rudazzle The question is where exactly I have to copy the dependency to?",
        "createdAt": "2023-02-12T19:07:07",
        "reactions": []
      },
      {
        "id": 1427117985,
        "author": "Rudazzle",
        "body": "@michaelhahn-doka you can try copying it to the root directory where your application is running.  You shouldn\u0027t have to do that as the Runtime directory structure should pick up the appropriate DLL. ",
        "createdAt": "2023-02-12T19:55:05",
        "reactions": []
      },
      {
        "id": 1494678762,
        "author": "carolzbnbr",
        "body": "Having the same issue here on same machine (Architecture)\r\nWhere does the  libSkiaSharp resides so I can find and copy it?\r\n\r\n",
        "createdAt": "2023-04-03T17:04:19",
        "reactions": []
      },
      {
        "id": 1596229297,
        "author": "mattleibow",
        "body": "I just tested with .NET 7 and \u0060net7.0-macos\u0060 and ARM64 seems to be working for me. Are you able to attach a sample project or a binlog of the build?\r\n\r\nYou can also run \u0060lipo -info /path/to/things\u0060 and check to make sure the libSkiaSharp and the app are both arm64.\r\n\r\n\u003Cimg width=\u00221393\u0022 alt=\u0022Screenshot 2023-06-18 at 8 20 40 PM\u0022 src=\u0022https://github.com/mono/SkiaSharp/assets/1096616/fd0f3f7e-27a0-4d26-b8d9-134ba94c073a\u0022\u003E\r\n\r\n\u0060\u0060\u0060xml\r\n\u003CProject Sdk=\u0022Microsoft.NET.Sdk\u0022\u003E\r\n\r\n  \u003CPropertyGroup\u003E\r\n    \u003CTargetFramework\u003Enet7.0-macos\u003C/TargetFramework\u003E\r\n    \u003COutputType\u003EExe\u003C/OutputType\u003E\r\n    \u003CNullable\u003Eenable\u003C/Nullable\u003E\r\n    \u003CImplicitUsings\u003Etrue\u003C/ImplicitUsings\u003E\r\n    \u003CSupportedOSPlatformVersion\u003E10.14\u003C/SupportedOSPlatformVersion\u003E\r\n  \u003C/PropertyGroup\u003E\r\n\r\n  \u003CItemGroup\u003E\r\n    \u003CPackageReference Include=\u0022SkiaSharp.Views\u0022 Version=\u00222.88.3\u0022 /\u003E\r\n  \u003C/ItemGroup\u003E\r\n\r\n\u003C/Project\u003E\r\n\u0060\u0060\u0060",
        "createdAt": "2023-06-18T18:21:32",
        "reactions": []
      },
      {
        "id": 1603171160,
        "author": "ghost",
        "body": "This issue has been automatically marked as stale because it has been marked as requiring author feedback but has not had any activity for **4 days**. It will be closed if no further activity occurs **within 3 days of this comment**. If it *is* closed, feel free to comment when you are able to provide the additional information and we will re-investigate.",
        "createdAt": "2023-06-22T19:00:48",
        "reactions": []
      },
      {
        "id": 2246411970,
        "author": "mattleibow",
        "body": "Duplicate of https://github.com/mono/SkiaSharp/issues/2307",
        "createdAt": "2024-07-23T22:24:34",
        "reactions": []
      }
    ]
  }
}