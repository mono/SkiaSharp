{
  "number": 3375,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Windows App Crash - only on x86 - v3.116 or newer",
  "body": "### Description\n\nHi, we delop multiplatform (Windows, macOS) dotnet (9.0) application using Avalonia UI (11.3.6) which loads some DLLs in runtime from subdirectory. One of this DLL use SkiaSharp lib (3.116 or newer) for some image manupulation. When the application is compiled for x64 then everything is ok but when we compile the application for x86 then we are getting app crash (no event log, no dump). In case of x84, when we copy the DLLs from subdirectory to application root directory then the app crash is gone. When we rollback the SkiaSharp nuget to version 2.88.9 then DLLs loading from subdirectory also work as expected (x64, x86). Any ideas?\n\n### Code\n\nNo repro\n\n### Expected Behavior\n\nNo app crash\n\n### Actual Behavior\n\nApp crash\n\n### Version of SkiaSharp\n\n3.116.0 (Current)\n\n### Last Known Good Version of SkiaSharp\n\n2.88.9 (Previous)\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nWindows\n\n### Platform / Operating System Version\n\nMicrosoft Windows 11 Pro (ARM CPU), 23H2 (build 22631) \n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n\u0060\u0060\u0060shell\n\n\u0060\u0060\u0060\n\n### Code of Conduct\n\n- [x] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "viktorspacil",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "os/Windows-Classic",
      "color": "fbca04"
    },
    {
      "name": "area/SkiaSharp",
      "color": "0052cc"
    },
    {
      "name": "tenet/reliability",
      "color": "BFD4F2"
    }
  ],
  "assignees": [],
  "createdAt": "2025-09-25T20:10:51",
  "updatedAt": "2025-12-16T12:23:22",
  "commentCount": 2,
  "reactionCount": 1,
  "engagement": {
    "syncedAt": "2026-02-06T12:37:42.3805866Z",
    "reactions": [
      {
        "user": "dmitryvhf",
        "content": "\u002B1",
        "createdAt": "2026-02-06T12:37:42.3805888Z"
      }
    ],
    "comments": [
      {
        "id": 3335778660,
        "author": "github-actions[bot]",
        "body": "**Triage Summary**  \n\nLabels will be applied to indicate that the issue involves the SkiaSharp area and relates to reliability on a Windows-Classic platform due to a crash in a .NET application compiled for x86.\n\nThis issue is not explicitly mentioned as a regression but indicates unexpected behavior and reliability concerns.\n\nAdditional remarks:\n* The issue specifically deals with a crash in a multiplatform .NET application utilizing SkiaSharp for image manipulation, but the labels do not cover backends directly related to Windows x86.\n\n\u003Cdetails\u003E\n\u003Csummary\u003EDetailed Summary and Actions\u003C/summary\u003E\n\nSummary of the triage:\n\n- The issue pertains to a crash in a .NET application using SkiaSharp on Windows when compiled for x86.\n- It involves a change in behavior linked to different versions of the SkiaSharp library.\n- The problem arises in a Windows x86 environment, which is associated with reliability issues.\n\nSummary of the actions that will be performed:\n\n| Action   | Item                       | Description                                                                                                                 |\n| :------- | :------------------------- | :-------------------------------------------------------------------------------------------------------------------------- |\n| Apply Label | area/SkiaSharp          | The issue involves a crash when using SkiaSharp in a .NET application on Windows x86, specifically referencing behavior changes. |\n| Apply Label | tenet/reliability        | The issue describes an application crash in a Windows x86 environment, highlighting reliability problems.                      |\n| Apply Label | os/Windows-Classic       | The issue pertains to a bug occurring in a classic Windows environment utilizing Win32 APIs, indicating the specific OS context. |\n\n\u003C/details\u003E\n\n_This entire triage process was automated by AI and mistakes may have been made. Please let us know so we can continue to improve._",
        "createdAt": "2025-09-25T20:11:33",
        "reactions": []
      },
      {
        "id": 3660244821,
        "author": "TomPMoleman",
        "body": "I\u0027m facing the exact same issue. I build my library for netstandard2.0 so I can use it in a legacy net472 solution, as well as in a newer Net8.0 (currently only Windows) based solution.\n\n-  x86 \u002B net472: working\n-  x64 \u002B net472: working\n-  x86 \u002B Net8.0: ISSUE\n-  x64 \u002B Net8.0: working\n\nThe process (here my unit tests) is terminated with following exception:\n\n\u0060powershell.exe : The active test run was aborted. Reason: Test host process crashed : Stack overflow.\nAt [...].ps1:3 char:1\n\u002B \u0026 powershell -NoProfile -NonInteractive -ExecutionPolicy Bypass -Comm ...\n\u002B ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    \u002B CategoryInfo          : NotSpecified: (The active test...Stack overflow.    :String) [], RemoteException\n    \u002B FullyQualifiedErrorId : NativeCommandError\n \n   at SkiaSharp.SkiaApi.sk_bitmap_get_pixel_color(IntPtr, Int32, Int32)\n   [...]\n   at System.RuntimeMethodHandle.InvokeMethod(System.Object, Void**, System.Signature, Boolean)\n   at System.Reflection.MethodBaseInvoker.InterpretedInvoke_Method(System.Object, IntPtr*)\n   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(System.Object, System.Reflection.BindingFlags)\n   at System.Reflection.RuntimeMethodInfo.Invoke(System.Object, System.Reflection.BindingFlags, System.Reflection.Binder, System.Object[], System.Globalization.CultureInfo)\n   at System.Reflection.MethodBase.Invoke(System.Object, System.Object[])\n   at NUnit.Framework.Internal.Reflect.InvokeMethod(System.Reflection.MethodInfo, System.Object, System.Object[])\n   at NUnit.Framework.Internal.MethodWrapper.Invoke(System.Object, System.Object[])\n   at NUnit.Framework.Internal.Commands.TestMethodCommand.InvokeTestMethod(NUnit.Framework.Internal.TestExecutionContext)\n   at NUnit.Framework.Internal.Commands.TestMethodCommand.RunTestMethod(NUnit.Framework.Internal.TestExecutionContext)\n   at NUnit.Framework.Internal.Commands.TestMethodCommand.Execute(NUnit.Framework.Internal.TestExecutionContext)\n   at NUnit.Framework.Internal.Execution.SimpleWorkItem\u002B\u003C\u003Ec__DisplayClass4_0.\u003CPerformWork\u003Eb__0()\n   at NUnit.Framework.Internal.ContextUtils\u002B\u003C\u003Ec__DisplayClass1_0\u00601[[System.__Canon, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]].\u003CDoIsolated\u003Eb__0(System.Object)\n   at System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\n   at System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\n   at NUnit.Framework.Internal.ContextUtils.DoIsolated(System.Threading.ContextCallback, System.Object)\n   at NUnit.Framework.Internal.ContextUtils.DoIsolated[[System.__Canon, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]](System.Func\u00601\u003CSystem.__Canon\u003E)\n   at NUnit.Framework.Internal.Execution.SimpleWorkItem.PerformWork()\n   at NUnit.Framework.Internal.Execution.WorkItem.RunOnCurrentThread()\n   at NUnit.Framework.Internal.Execution.WorkItem.Execute()\n   at NUnit.Framework.Internal.Execution.ParallelWorkItemDispatcher.Dispatch(NUnit.Framework.Internal.Execution.WorkItem, NUnit.Framework.Internal.Execution.ParallelExecutionStrategy)\n   at NUnit.Framework.Internal.Execution.ParallelWorkItemDispatcher.Dispatch(NUnit.Framework.Internal.Execution.WorkItem)\n   at NUnit.Framework.Internal.Execution.CompositeWorkItem.RunChildren()\n   at NUnit.Framework.Internal.Execution.CompositeWorkItem.PerformWork()\n   at NUnit.Framework.Internal.Execution.WorkItem.RunOnCurrentThread()\n   at NUnit.Framework.Internal.Execution.WorkItem.Execute()\n   at NUnit.Framework.Internal.Execution.TestWorker.TestWorkerThreadProc()\n   at System.Threading.Thread\u002BStartHelper.Callback(System.Object)\n   at System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\n   at System.Threading.Thread.StartCallback()\nWarning: Parameter not found: enable_new_segsearch\u0060\n\nI\u0027ve checked the bin folder, and all Windows native libraries are in place inside the \u0027runtimes\u0027 folder. Also the suggestion as to copy the libSkiaSharp.dll next to the executable assembly as well has no effect sadly. And I guess the x86 libraries are not broken per se, as they are working fine for net472 =\u003E only in combination with Net8 (for ticket owner Net9.0) it seems to be troublesome.\n\nEDIT: Sorry, forgot to mentioned, version 3.119.1 is used.",
        "createdAt": "2025-12-16T12:20:18",
        "reactions": []
      }
    ]
  }
}