{
  "number": 1180,
  "type": "pr",
  "state": "closed",
  "title": "Re-work views to avoid incorrect disposal",
  "body": "**Description of Change**\r\n\r\nIn some instances, the managed canvas is being collected at the same time the new one is being created. This causes the the app to crash for some reason. The technically should not happen as the canvas is still valid - and we can see this when we set the canvas as a class field.\r\n\r\nBut, for now, just work around the issue by adding the canvas as a field.\r\n\r\nIn addition, do more granular construction of the GL objects, and then also reduce the amount of interop in the render loop.\r\n\r\n**Bugs Fixed**\r\n\r\n- Fixes #1121 \r\n- Fixes #910\r\n- Fixes #1173\r\n- Fixes #1168\r\n- Fixes #1144\r\n\r\n**API Changes**\r\n\r\nNone.\r\n\r\n**Behavioral Changes**\r\n\r\nSome fixes for crashes.\r\n\r\n**PR Checklist**\r\n\r\n- [ ] Has tests (if omitted, state reason in description)\r\n- [ ] Rebased on top of master at time of PR\r\n- [ ] Changes adhere to coding standard\r\n- [ ] Updated documentation\r\n",
  "author": {
    "login": "mattleibow",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "milestone": "v1.68.2",
  "createdAt": "2020-03-19T16:19:24",
  "updatedAt": "2020-04-29T23:48:05",
  "closedAt": "2020-03-24T16:09:40",
  "commentCount": 13,
  "reactionCount": 0,
  "draft": false,
  "mergeable": false,
  "merged": true,
  "mergedAt": "2020-03-24T16:09:39",
  "mergeableState": "dirty",
  "baseBranch": "master",
  "headBranch": "dev/fix-1121",
  "additions": 290,
  "deletions": 126,
  "changedFiles": 11,
  "commits": 6,
  "reviews": [],
  "engagement": {
    "syncedAt": "2026-02-06T14:30:02.9803513Z",
    "reactions": [],
    "comments": [
      {
        "id": 603340068,
        "author": "mattleibow",
        "body": "Based on preliminary feedback, this looks to resolve the issue, so I am going to merge and publish the preview.",
        "createdAt": "2020-03-24T16:16:59",
        "reactions": []
      },
      {
        "id": 603341001,
        "author": "hajmajeboss",
        "body": "OK. Will be available on NuGet?",
        "createdAt": "2020-03-24T16:18:26",
        "reactions": []
      },
      {
        "id": 603341374,
        "author": "mattleibow",
        "body": "Yes. Just waiting on CI right now. If all goes well, then in 2 hours. I will tweet and update the issues.",
        "createdAt": "2020-03-24T16:19:00",
        "reactions": []
      },
      {
        "id": 603342315,
        "author": "hajmajeboss",
        "body": "OK, looking forward to it. Hope it\u0027s all fixed and stable, I just made a move to new Mapsui version which is dependent on SkiaSharp 1.68.1\u002B, so it really came in convenient time :-D \r\n\r\n",
        "createdAt": "2020-03-24T16:20:21",
        "reactions": []
      },
      {
        "id": 603344641,
        "author": "mattleibow",
        "body": "I think there is a new beta that is based on the PR nuget which has the fix. Have you tested that?\r\nBut, either way in an hour or so we shall have a new toy to ply with.",
        "createdAt": "2020-03-24T16:23:57",
        "reactions": []
      },
      {
        "id": 603347587,
        "author": "hajmajeboss",
        "body": "I tested preview43 and it still crashes, do you mean that?",
        "createdAt": "2020-03-24T16:28:13",
        "reactions": []
      },
      {
        "id": 603347655,
        "author": "mattleibow",
        "body": "Actually, this doesn\u0027t matter. You should be able to try out the things right now. I pushed **1.68.2-pr.1180.6** to the preview feed: https://aka.ms/skiasharp-eap/index.json",
        "createdAt": "2020-03-24T16:28:20",
        "reactions": []
      },
      {
        "id": 603351122,
        "author": "hajmajeboss",
        "body": "Ah, thanks, will try.",
        "createdAt": "2020-03-24T16:33:34",
        "reactions": []
      },
      {
        "id": 603358597,
        "author": "hajmajeboss",
        "body": "Got a crash already, nothing in logcat, the app just halted with no message.",
        "createdAt": "2020-03-24T16:44:49",
        "reactions": []
      },
      {
        "id": 603461293,
        "author": "hajmajeboss",
        "body": "Seems to be quite stable, got one crash in three hours. Good work there.",
        "createdAt": "2020-03-24T19:31:08",
        "reactions": []
      },
      {
        "id": 603503311,
        "author": "mattleibow",
        "body": "Hmmmm. A crash is still bad. What was happening at the time? This was Android?\r\n\r\nAlso, this should be the exact same code, but just in case, try the new preview 45 on NuGet.org. ",
        "createdAt": "2020-03-24T21:02:57",
        "reactions": []
      },
      {
        "id": 603506095,
        "author": "hajmajeboss",
        "body": "I don\u0027t know, just moving around the map when it crashed. MIUI gives me the crash report most of the time, including segfaults, none this time - like it was killed due lacking memory or something. No other crashes since then. ",
        "createdAt": "2020-03-24T21:09:23",
        "reactions": []
      },
      {
        "id": 608433946,
        "author": "mattleibow",
        "body": "Hey folks, it has been a long time coming and thanks to all the folks with your repros, samples and stack traces I think we have finally managed to fix those pesky crashes - at least the ones we know about. I have just pushed **1.68.2-preview.50** to NuGet so let me know if this fixes all the crashes you have ever had \uD83D\uDE04 ",
        "createdAt": "2020-04-03T13:29:16",
        "reactions": []
      }
    ]
  }
}