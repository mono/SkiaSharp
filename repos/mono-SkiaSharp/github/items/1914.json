{
  "number": 1914,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] sk_fontmgr_match_family_style must input family name argument by utf8 string",
  "body": "**Description**\r\n\r\nThe \u0060sk_fontmgr_match_family_style\u0060 must input the family name argument by utf8 string. But we will input the Unicode16 string to it.\r\n\r\nhttps://github.com/mono/SkiaSharp/blob/fffae82cf6ec1c4a6f490ddb780709ce9211725e/binding/Binding/SkiaApi.generated.cs#L12369-L12381\r\n\r\nIt means that we can not input any non-ascii font family name string to \u0060sk_fontmgr_match_family_style\u0060.\r\n\r\nReference: https://github.com/mono/SkiaSharp/issues/401\r\n\r\n**Code**\r\n\r\n\u0060\u0060\u0060csharp\r\nvar typeface2 = SKFontManager.Default.MatchFamily(\u0022Arial\u0022); // OK, because the \u0060Arial\u0060 is the ASCII string.\r\n\r\nvar typeface2 = SKFontManager.Default.MatchFamily(\u0022\u5B8B\u4F53\u0022); // Fail, because the \u0060\u5B8B\u4F53\u0060 is the Unicode string.\r\n\u0060\u0060\u0060\r\n\r\n**Expected Behavior**\r\n\r\nWe can input the font family name with the Unicode string.\r\n\r\n**Actual Behavior**\r\n\r\nIt always returns null when we input the font family name with the Unicode string.\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  \u003C!-- the version of SkiaSharp that has the issue --\u003E\r\n- Last known good version:  \u003C!-- the version of SkiaSharp that still working --\u003E\r\n- IDE:  \u003C!-- Visual Studio / Visual Studio for Mac / MonoDevelop / Visual Studio Code --\u003E\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - Android: \u003C!-- the version of the Android SDK you are compiling against, e.g. 7.1 --\u003E \r\n  - iOS:  \u003C!-- the version of the iOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - Linux:  \u003C!-- The version and distro of linux that you are building for, e.g. Ubuntu 16.04 --\u003E\r\n  - macOS:  \u003C!-- The version of macOS you are building for, e.g. 10.10 --\u003E\r\n  - Tizen:  \u003C!-- the version of the Tizen SDK you are compiling against, e.g. 4.0 --\u003E \r\n  - tvOS:  \u003C!-- the version of the tvOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - UWP:  \u003C!-- the version of the UWP SDK you are compiling against, e.g. 16299 --\u003E \r\n  - watchOS:  \u003C!-- the version of the watchOS SDK you are compiling against, e.g. 11.1 --\u003E\r\n  - Windows Classic:  \u003C!-- the version of Windows you are building for, e.g. Windows 7 --\u003E\r\n- Target Devices:   \u003C!-- the devices that you noticed this on, e.g. iPhone X --\u003E\r\n  - \u003C!-- Google Pixel 4 XL --\u003E\r\n  - \u003C!-- iPhone 11 --\u003E\r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nPASTE ANY DETAILED VERSION INFO HERE\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\n\r\n**Reproduction Link**\r\n\r\n\u003C!-- please upload or provide a link to a reproduction case --\u003E\r\n\r\n",
  "author": {
    "login": "lindexi",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2021-12-30T06:39:29",
  "updatedAt": "2022-09-08T00:01:16",
  "closedAt": "2022-08-08T22:43:53",
  "commentCount": 1,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:50:24.6946019Z",
    "reactions": [],
    "comments": [
      {
        "id": 1002896146,
        "author": "lindexi",
        "body": "How to fix it?\r\n\r\n**Solution1**:\r\n\r\nUsing \u0060UnmanagedType.LPUTF8Str\u0060 to replace \u0060UnmanagedType.LPStr\u0060:\r\n\r\n\u0060\u0060\u0060csharp\r\n[DllImport(\u0022libSkiaSharp\u0022, CallingConvention = CallingConvention.Cdecl)]\r\nstatic extern IntPtr sk_fontmgr_match_family_style(\r\n    IntPtr param0,\r\n    [MarshalAs(UnmanagedType.LPUTF8Str)] string familyName,\r\n    IntPtr style);\r\n\u0060\u0060\u0060\r\n\r\nBut we have to update the dotnet core to use it.\r\n\r\n![\u56FE\u7247](https://user-images.githubusercontent.com/16054566/147728437-28afc90c-e474-4e47-a04d-31fc3ad3bc03.png)\r\n\r\nCode: https://github.com/lindexi/lindexi_gd/blob/7a64eb6cca60c5bf0d4255089c24c01297094140/JaynawlifallnerBawhairchikel/JaynawlifallnerBawhairchikel/Program.cs\r\n\r\n\r\n**Solution2**:\r\n\r\nDefining the \u0060familyName\u0060 argument as IntPtr. And we input the utf8 string byte intptr.\r\n\r\n\u0060\u0060\u0060csharp\r\nvar utf8ByteList = Encoding.UTF8.GetBytes(\u0022\u5B8B\u4F53\u0022);\r\n\r\nIntPtr typefaceHandle;\r\nunsafe\r\n{\r\n    fixed (byte* p = utf8ByteList)\r\n    {\r\n        typefaceHandle =\r\n            sk_fontmgr_match_family_style(SKFontManager.Default.Handle, new IntPtr(p),SKFontStyle.Normal.Handle); // OK\r\n    }\r\n}\r\n\r\n[DllImport(\u0022libSkiaSharp\u0022, CallingConvention = CallingConvention.Cdecl)]\r\nstatic extern IntPtr sk_fontmgr_match_family_style(\r\n    IntPtr param0,\r\n    IntPtr familyName,\r\n    IntPtr style);\r\n\u0060\u0060\u0060\r\n\r\n![\u56FE\u7247](https://user-images.githubusercontent.com/16054566/147730292-e7ae2017-bc50-42fd-b08d-e0bd65efbb58.png)\r\n\r\nCode: https://github.com/lindexi/lindexi_gd/blob/4131429fe7cb66aa58c33ddfb96401455d933070/JaynawlifallnerBawhairchikel/JaynawlifallnerBawhairchikel/Program.cs",
        "createdAt": "2021-12-30T06:51:14",
        "reactions": []
      }
    ]
  }
}