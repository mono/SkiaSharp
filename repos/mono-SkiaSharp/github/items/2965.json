{
  "number": 2965,
  "type": "issue",
  "state": "closed",
  "title": "SKCanvasView IOS data does not update in the OnPaintSurface method",
  "body": "### Description\n\nGood morning. I am drawing a circle using SKCanvasView. On Android, everything works fine, but on iOS, the data does not update in the OnPaintSurface method, so the circle does not change its radius when the points are moved. If I change the visibility, the radius changes.\n\n### Code\n\n\r\n\u0060\u0060\u0060cs\r\npublic partial class NewContent1 : ContentView\r\n{\r\n    private IDraggableDotOffsetService DDOS;\r\n    private double startX, startY;\r\n    public float width;\r\n    public float height;\r\n    float halfPointSize = 9 \u002B 5;\r\n    public NewContent1()\r\n\t{\r\n\t\tInitializeComponent();\r\n        DDOS = IPlatformApplication.Current.Services.GetService\u003CIDraggableDotOffsetService\u003E();\r\n        PanGestureRecognizer onPanUpdatedCircle = new PanGestureRecognizer();\r\n        onPanUpdatedCircle.PanUpdated \u002B= (s, e) =\u003E OnPanUpdatedCircle(s, e);\r\n        DotCircleLayout1.GestureRecognizers.Add(onPanUpdatedCircle);\r\n        DotCircleLayout2.GestureRecognizers.Add(onPanUpdatedCircle);\r\n\r\n        DotCircleLayout1.Initialize();\r\n        DotCircleLayout2.Initialize();\r\n        DotCircleLayout1.TranslationX = DotCircleLayout1.iosX = 100;\r\n        DotCircleLayout1.TranslationY = DotCircleLayout1.iosY = 150;\r\n\r\n        DotCircleLayout2.TranslationX = DotCircleLayout2.iosX = 200;\r\n        DotCircleLayout2.TranslationY = DotCircleLayout2.iosY = 150;\r\n        UpdateCircle();\r\n    }\r\n    \r\n\r\n    public void OnPaintSurface(object sender, SKPaintSurfaceEventArgs e)\r\n    {\r\n        SKImageInfo info = e.Info;\r\n        SKSurface surface = e.Surface;\r\n        SKCanvas canvas = surface.Canvas;\r\n        canvas.Clear(SKColors.Transparent);\r\n\r\n        SKPaint paint = new SKPaint\r\n        {\r\n            Style = SKPaintStyle.Stroke,\r\n            Color = Color.FromRgb(255, 255, 255).ToSKColor(),\r\n            StrokeWidth = 6\r\n        };\r\n\r\n        canvas.DrawCircle(info.Width / 2, info.Height / 2, info.Width / 2 - 3, paint);\r\n    }\r\n    //---------------------------------------------------------\r\n    void OnPanUpdatedCircle(object sender, PanUpdatedEventArgs args)\r\n    {\r\n        var layout = (CustomAbsoluteLayout)sender;\r\n        float radius = (float)Math.Sqrt(Math.Pow(DotCircleLayout2.TranslationX - DotCircleLayout1.TranslationX, 2) \u002B Math.Pow(DotCircleLayout2.TranslationY - DotCircleLayout1.TranslationY, 2));\r\n        float angle = (float)Math.Atan2(DotCircleLayout2.TranslationY - DotCircleLayout1.TranslationY, DotCircleLayout2.TranslationX - DotCircleLayout1.TranslationX);\r\n\r\n        switch (args.StatusType)\r\n        {\r\n            case GestureStatus.Started:\r\n                (startX, startY) = DDOS.Started(args.TotalX, args.TotalY, layout.iosX, layout.iosY);\r\n                break;\r\n            case GestureStatus.Running:\r\n\r\n                if (layout == DotCircleLayout1)\r\n                {\r\n                    (var newCenterX, var newCenterY) = DDOS.Running(startX, startY, args.TotalX, args.TotalY, layout.TranslationX, layout.TranslationY);\r\n                    DotCircleLayout1.TranslationX = newCenterX;\r\n                    DotCircleLayout2.TranslationY = newCenterY;\r\n                    DotCircleLayout2.TranslationX = layout.TranslationX \u002B radius * Math.Cos(angle);\r\n                    DotCircleLayout2.TranslationY = layout.TranslationY \u002B radius * Math.Sin(angle);\r\n                }\r\n                else if (layout == DotCircleLayout2)\r\n                {\r\n                    (var newDot2X, var newDot2Y) = (layout.iosX, layout.iosY) = DDOS.Running(startX, startY, args.TotalX, args.TotalY, layout.TranslationX, layout.TranslationY);\r\n\r\n                    float newRadius = (float)Math.Sqrt(Math.Pow(newDot2X - DotCircleLayout1.TranslationX, 2) \u002B Math.Pow(newDot2Y - DotCircleLayout1.TranslationY, 2));\r\n                    radius = newRadius;\r\n                    // \u0423\u0441\u0442\u0430\u043D\u0430\u0432\u043B\u0438\u0432\u0430\u0435\u043C DotLayout2 \u043D\u0430 \u043D\u043E\u0432\u043E\u043C \u0440\u0430\u0434\u0438\u0443\u0441\u0435 \u043E\u0442 DotLayout1\r\n                    angle = (float)Math.Atan2(newDot2Y - DotCircleLayout1.TranslationY, newDot2X - DotCircleLayout1.TranslationX);\r\n                    DotCircleLayout2.TranslationX = DotCircleLayout1.TranslationX \u002B radius * Math.Cos(angle);\r\n                    DotCircleLayout2.TranslationY = DotCircleLayout1.TranslationY \u002B radius * Math.Sin(angle);\r\n                }\r\n                UpdateCircle();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private void Test_Clicked(object sender, EventArgs e)\r\n    {\r\n        canvas.IsVisible = DotCircleLayout1.IsVisible = DotCircleLayout2.IsVisible = !canvas.IsVisible;\r\n    }\r\n\r\n    //---------------------------------------------------------\r\n    private void UpdateCircle()\r\n    {\r\n        double radius = Math.Sqrt(Math.Pow((DotCircleLayout2.TranslationX \u002B halfPointSize) -\r\n            (DotCircleLayout1.TranslationX \u002B halfPointSize), 2) \u002B\r\n            Math.Pow((DotCircleLayout2.TranslationY \u002B halfPointSize) -\r\n            (DotCircleLayout1.TranslationY \u002B halfPointSize), 2));\r\n        canvas.WidthRequest = radius * 2;\r\n        canvas.HeightRequest = radius * 2;\r\n        canvas.TranslationX = DotCircleLayout1.TranslationX \u002B halfPointSize - radius;\r\n        canvas.TranslationY = DotCircleLayout1.TranslationY \u002B halfPointSize - radius;\r\n        canvas.InvalidateSurface();\r\n    }\r\n    //---------------------------------------------------------\r\n}\r\n\u0060\u0060\u0060\r\nYou can also share some XAML:\r\n\u0060\u0060\u0060xaml\r\n\u003CContentView xmlns=\u0022http://schemas.microsoft.com/dotnet/2021/maui\u0022\r\n             xmlns:x=\u0022http://schemas.microsoft.com/winfx/2009/xaml\u0022\r\n             x:Class=\u0022MauiApp1.NewContent1\u0022\r\n             xmlns:controls=\u0022clr-namespace:MauiApp1\u0022\r\n             xmlns:skia=\u0022clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls\u0022\u003E\r\n    \u003CAbsoluteLayout x:Name=\u0022AbsoluteLayoutContainer\u0022\u003E\r\n        \u003CButton x:Name=\u0022Test\u0022 Text=\u0022Click\u0022 Clicked=\u0022Test_Clicked\u0022 BackgroundColor=\u0022Blue\u0022/\u003E\r\n        \u003CAbsoluteLayout \r\n            AbsoluteLayout.LayoutBounds=\u00220,0,1,1\u0022\r\n            AbsoluteLayout.LayoutFlags=\u0022All\u0022\r\n            InputTransparent=\u0022True\u0022\u003E\r\n            \u003Cskia:SKCanvasView x:Name=\u0022canvas\u0022 PaintSurface=\u0022OnPaintSurface\u0022 BackgroundColor=\u0022Crimson\u0022/\u003E\r\n        \u003C/AbsoluteLayout\u003E\r\n        \u003Ccontrols:CustomAbsoluteLayout x:Name=\u0022DotCircleLayout1\u0022\r\n         WidthRequest=\u002228\u0022\r\n         HeightRequest=\u002228\u0022\r\n         TranslationX=\u002222\u0022\r\n         TranslationY=\u002222\u0022\u003E\r\n            \u003CEllipse WidthRequest=\u002210\u0022\r\n      HeightRequest=\u002210\u0022\r\n      Fill=\u0022Black\u0022\r\n      AbsoluteLayout.LayoutBounds=\u00229,9,10,10\u0022/\u003E\r\n            \u003CImage Source=\u0022dotnet_bot.svg\u0022\r\n    AbsoluteLayout.LayoutBounds=\u00225, 5, 18, 18\u0022\r\n    AbsoluteLayout.LayoutFlags=\u0022None\u0022\u003E\r\n            \u003C/Image\u003E\r\n        \u003C/controls:CustomAbsoluteLayout\u003E\r\n        \u003Ccontrols:CustomAbsoluteLayout x:Name=\u0022DotCircleLayout2\u0022\r\n         WidthRequest=\u002228\u0022\r\n         HeightRequest=\u002228\u0022\r\n         TranslationX=\u0022322\u0022\r\n         TranslationY=\u0022222\u0022\u003E\r\n            \u003CEllipse WidthRequest=\u002210\u0022\r\n      HeightRequest=\u002210\u0022\r\n      Fill=\u0022Black\u0022\r\n      AbsoluteLayout.LayoutBounds=\u00229,9,10,10\u0022/\u003E\r\n            \u003CImage Source=\u0022dotnet_bot.svg\u0022\r\n    AbsoluteLayout.LayoutBounds=\u00225, 5, 18, 18\u0022\r\n    AbsoluteLayout.LayoutFlags=\u0022None\u0022\u003E\r\n            \u003C/Image\u003E\r\n        \u003C/controls:CustomAbsoluteLayout\u003E\r\n    \u003C/AbsoluteLayout\u003E\r\n\u003C/ContentView\u003E\r\n\u0060\u0060\u0060\r\nDraggableDotOffsetService in IOS\r\n\u0060\u0060\u0060\r\nnamespace MauiApp1.iOS\r\n{\r\n    public class DraggableDotOffsetService : IDraggableDotOffsetService\r\n    {\r\n        public (double X, double Y) Running(double startX, double startY, double TotalX, double TotalY, double X, double Y)\r\n        {\r\n            return (startX \u002B TotalX, startY \u002B TotalY);\r\n        }\r\n\r\n        public (double X, double Y) Started(double startX, double startY, double iosX, double iosY)\r\n        {\r\n            return (iosX, iosY);\r\n        }\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\nIDraggableDotOffsetService.cs \r\n\u0060\u0060\u0060\r\nnamespace MauiApp1\r\n{\r\n    public interface IDraggableDotOffsetService\r\n    {\r\n        (double X, double Y) Running(double startX, double startY, double TotalX, double TotalY, double X, double Y);\r\n        (double X, double Y) Started(double startX, double startY, double iosX, double iosY);\r\n    }\r\n}\r\n\u0060\u0060\u0060\r\nCustomAbsoluteLayout.cs\r\n\u0060\u0060\u0060\r\nnamespace MauiApp1\r\n{\r\n    public class CustomAbsoluteLayout : AbsoluteLayout\r\n    {\r\n        public double iosX = 0;\r\n        public double iosY = 0;\r\n\r\n        public void Initialize()\r\n        {\r\n            iosX = TranslationX;\r\n            iosY = TranslationY;\r\n        }\r\n    }\r\n}\r\n\u0060\u0060\u0060\n\n### Expected Behavior\n\nI expect that the data will be updated in the OnPaintSurface method, similar to how it is done in Android.\n\n### Actual Behavior\n\nIn fact, the data in SKImageInfo is not being updated.\n\n### Version of SkiaSharp\n\n2.88.3 (Current)\n\n### Last Known Good Version of SkiaSharp\n\n2.88.2 (Previous)\n\n### IDE / Editor\n\nVisual Studio (Windows)\n\n### Platform / Operating System\n\nAndroid, iOS\n\n### Platform / Operating System Version\n\n_No response_\n\n### Devices\n\n_No response_\n\n### Relevant Screenshots\n\n_No response_\n\n### Relevant Log Output\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow this project\u0027s Code of Conduct",
  "author": {
    "login": "NastyaZorro169",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "status/no-recent-activity",
      "color": "B8EC4A"
    },
    {
      "name": "status/needs-repro",
      "color": "B8EC4A"
    }
  ],
  "assignees": [],
  "createdAt": "2024-08-01T10:56:54",
  "updatedAt": "2024-09-26T14:45:24",
  "closedAt": "2024-09-26T14:45:24",
  "commentCount": 4,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:11:30.3572616Z",
    "reactions": [],
    "comments": [
      {
        "id": 2358868802,
        "author": "mattleibow",
        "createdAt": "2024-09-18T16:04:25",
        "reactions": []
      },
      {
        "id": 2358869297,
        "author": "dotnet-policy-service[bot]",
        "createdAt": "2024-09-18T16:04:40",
        "reactions": []
      },
      {
        "id": 2358870905,
        "author": "mattleibow",
        "createdAt": "2024-09-18T16:05:26",
        "reactions": []
      },
      {
        "id": 2367261561,
        "author": "dotnet-policy-service[bot]",
        "createdAt": "2024-09-23T05:24:01",
        "reactions": []
      }
    ]
  }
}