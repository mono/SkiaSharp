{
  "number": 429,
  "type": "issue",
  "state": "closed",
  "title": "I can\u0027t dispose SKCanvasView, memory leaks",
  "body": "Hi, I created a grid populated with Icons, that are drawn using skia. When I want to clean grid, I would delete Icons, but seems that I can\u0027t dispose SKCanvasview using Dispose function at the end of the code. This issue imply a memory leaks every time I create new Icons. How can I dispose a SKCanvasView freeing up memory?\r\n\r\n\u0060\u0060\u0060csharp\r\n    public class IconWidget : SKCanvasView, IDisposable\r\n    {\r\n        public event EventHandler\u003CEventArgsGridItemClicked\u003E Tapped;\r\n\r\n        public EventHandler\u003CEventArgsGridItemClicked\u003E ItemClickedHandler { get; set; }\r\n\r\n        #region ModelProperty\r\n        public static readonly BindableProperty ModelProperty =\r\n            BindableProperty.Create\r\n            (\r\n                propertyName: \u0022Model\u0022,\r\n                returnType: typeof(IconWidgetModel),\r\n                declaringType: typeof(IconWidget),\r\n                defaultValue: new IconWidgetModel(IconWidgetState.Active, IconWidgetShape.Square, \u0022bcr_comanda\u0022, \u0022Default Main\u0022, false),\r\n                defaultBindingMode: BindingMode.OneWay,\r\n                propertyChanged: ModelPropertyChanged\r\n            );\r\n        public IconWidgetModel Model\r\n        {\r\n            get { return (IconWidgetModel)GetValue(ModelProperty); }\r\n            set { SetValue(ModelProperty, value); }\r\n        }\r\n        private static void ModelPropertyChanged(BindableObject bindable, object oldValue, object newValue)\r\n        {\r\n            var control = (IconWidget)bindable;\r\n            if (newValue != null)\r\n            {\r\n                control.Model = (IconWidgetModel)newValue;\r\n                control.Model.RedrawIcon \u002B= control.Model_ChangedStatus;\r\n\r\n                if (!control.Model.IsSideMenuIcon) {\r\n                    var tap = new TapGestureRecognizer();\r\n                    tap.Tapped \u002B= control.Tap_Tapped;\r\n                    control.GestureRecognizers.Add(tap);\r\n                }\r\n            }\r\n        }\r\n\r\n       \r\n\r\n        private void Model_ChangedStatus(object sender, EventArgs e)\r\n        {\r\n            Device.BeginInvokeOnMainThread(() =\u003E {\r\n                InvalidateSurface();\r\n            });\r\n        }\r\n        #endregion\r\n\r\n        SKSurface surface;\r\n        SKCanvas canvas;\r\n\r\n        public string FakeTopTitle { get; set; }\r\n        public bool IsOnlyOneElementInAggregator { get; set; }\r\n        public bool IsFirstAggregatorElement { get; set; }\r\n        public bool IsLastAggregatorElement { get; set; }\r\n        public bool IsCentralAggregatorElement { get; set; }\r\n\r\n        public IconWidget()\r\n        {\r\n            this.PaintSurface \u002B= CanvasView_PaintSurface;\r\n\r\n            //BackgroundColor = Color.Green;\r\n\r\n            VerticalOptions = LayoutOptions.FillAndExpand;\r\n            HorizontalOptions = LayoutOptions.FillAndExpand;\r\n\r\n            //Content = canvasView;\r\n            \r\n        }\r\n\r\n        private void Tap_Tapped(object sender, EventArgs e)\r\n        {\r\n            Tapped?.Invoke(this, new EventArgsGridItemClicked(Model));\r\n        }\r\n\r\n        private float infoHeight;\r\n        private float infoWidth;\r\n\r\n        private float percPadd = 0.078f;\r\n\r\n        protected virtual void CanvasView_PaintSurface(object sender, SKPaintSurfaceEventArgs e)\r\n        {\r\n            var canvas = e.Surface.Canvas;\r\n\r\n            surface = e.Surface;\r\n            canvas = surface.Canvas;\r\n\r\n            Color selectedBackground = (Color)Application.Current.Resources[\u0022DarkGray\u0022];\r\n            Color nonSelectedBackground = (Color)Application.Current.Resources[\u0022MediumGray\u0022];\r\n            var canvasColor = Model.IsSelected ? SKColors.Transparent : SKColors.Transparent;\r\n            canvas.Clear(canvasColor);\r\n\r\n            canvas.Translate(e.Info.Width / 2, e.Info.Height / 2);\r\n\r\n            using (SKPaint paint = new SKPaint())\r\n            {\r\n                paint.Style = Model.IsFilled ? SKPaintStyle.Fill : SKPaintStyle.Stroke;\r\n                paint.StrokeWidth = 3;\r\n                paint.StrokeJoin = SKStrokeJoin.Round;\r\n                paint.Color = Model.BackgroundColor;\r\n                paint.IsAntialias = true;\r\n                paint.IsDither = true;\r\n                paint.TextAlign = SKTextAlign.Center;\r\n                paint.TextSize = (int)(e.Info.Height * 0.13); \r\n                //paint.TextSize = (int) UIMeasure.SmallFontSize_Default;\r\n                \r\n\r\n                var height = e.Info.Height;\r\n                infoHeight = height;\r\n                infoWidth = e.Info.Width;\r\n\r\n                float radius = Math.Min(e.Info.Width, e.Info.Height) / 4.4f; // siccome per disegnare le icone non usiamo misure fisse come quelle da mockup\r\n                                                                             // ed ci \u00E8 statto segnalato che le misure sono leggermere piu grandi del 10%\r\n                                                                             // anziche dividere per 4 dividiamo per 4.4 (il 10%) cosi dovremmo avere le immagini\r\n                                                                             //della dimensione corretta.\r\n\r\n                if (Model.IsTrasparent)\r\n                {\r\n                    paint.Style = SKPaintStyle.Stroke;\r\n                    paint.Color = SKColors.White;\r\n                }\r\n\r\n                if (Model.IsTrasparent \u0026\u0026 Model.IsSelected)\r\n                    paint.Style = SKPaintStyle.StrokeAndFill;\r\n\r\n\r\n                DrawBackground(Model.Shape, canvas, paint, radius);\r\n\r\n\r\n\r\n                if (Model.IsTrasparent \u0026\u0026 Model.IsSelected)\r\n                    DrawSvg(canvas, paint, Model.SvgName, SKColors.Black, radius, e.Info);\r\n\r\n                else\r\n                    DrawSvg(canvas, paint, Model.SvgName, Model.SvgColor, radius, e.Info);\r\n\r\n                DrawTitle(canvas, paint, Model.Title, radius,e.Info.Width,(float)(e.Info.Height * 0.03));\r\n\r\n                \r\n                DrawTopTitle(canvas, paint, Model.TopTitle, radius, (int)(e.Info.Height * 0.03), e.Info.Width, e.Info.Height);\r\n\r\n            }\r\n        }\r\n \r\npublic void Dispose()\r\n        {\r\n            canvas?.Dispose();\r\n            surface?.Dispose();\r\n        }\r\n\u0060\u0060\u0060",
  "author": {
    "login": "niccolocapitelli",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    }
  ],
  "assignees": [],
  "milestone": "v1.60.2",
  "createdAt": "2018-01-18T17:05:19",
  "updatedAt": "2022-08-19T18:01:45",
  "closedAt": "2018-05-30T23:15:09",
  "commentCount": 9,
  "reactionCount": 2,
  "engagement": {
    "syncedAt": "2026-02-04T20:40:15.9851653Z",
    "reactions": [
      {
        "user": "nicolaveritas",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:40:15.9851874Z"
      },
      {
        "user": "michaldobrodenka",
        "content": "\u002B1",
        "createdAt": "2026-02-04T20:40:15.9851882Z"
      }
    ],
    "comments": [
      {
        "id": 358902548,
        "author": "niccolocapitelli",
        "createdAt": "2018-01-19T08:46:59",
        "reactions": []
      },
      {
        "id": 377536137,
        "author": "niccolocapitelli",
        "createdAt": "2018-03-30T14:29:46",
        "reactions": []
      },
      {
        "id": 377598647,
        "author": "mattleibow",
        "createdAt": "2018-03-30T19:06:41",
        "reactions": []
      },
      {
        "id": 377598842,
        "author": "mattleibow",
        "createdAt": "2018-03-30T19:07:37",
        "reactions": []
      },
      {
        "id": 392287484,
        "author": "rhussell",
        "createdAt": "2018-05-26T20:53:04",
        "reactions": []
      },
      {
        "id": 392339585,
        "author": "mattleibow",
        "createdAt": "2018-05-27T15:28:48",
        "reactions": []
      },
      {
        "id": 393342620,
        "author": "mattleibow",
        "createdAt": "2018-05-30T22:40:40",
        "reactions": []
      },
      {
        "id": 393349346,
        "author": "mattleibow",
        "createdAt": "2018-05-30T23:15:09",
        "reactions": []
      },
      {
        "id": 401159154,
        "author": "mattleibow",
        "createdAt": "2018-06-28T20:14:27",
        "reactions": []
      }
    ]
  }
}