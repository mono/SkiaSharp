{
  "number": 2249,
  "type": "issue",
  "state": "open",
  "title": "[BUG] Corrupted Image when loading from network stream, with 2.88.2.",
  "body": "**Description**\r\n\r\nIt rendered corrupted image when loading from network stream. It works fine in 2.80.2, not working in the current one 2.88.2. The following code can simply recreate it. \r\n\r\n**Code**\r\n // Below is the complete test code in VS2022 on .NET 6\r\n\r\n using System.Net;\r\n using SkiaSharp;\r\n\r\n await DownloadTile(\u0022https://tile.openstreetmap.org/1/0/0.png\u0022, @\u0022d:\\test\\test.png\u0022);\r\n\r\n static async Task DownloadTile(string uri, string path)\r\n  {\r\n\r\n  HttpWebRequest request = (HttpWebRequest)WebRequest.Create(uri);\r\n  request.Method = \u0022GET\u0022;\r\n  request.UserAgent = \u0022agent\u0022;\r\n\r\n  using var webResponse = await request.GetResponseAsync();\r\n  await using var input = webResponse.GetResponseStream();\r\n\r\n  await using var output = File.Create(path);\r\n  var bitmap = SKBitmap.Decode(input);\r\n\r\n  using var skImage = SKImage.FromBitmap(bitmap);\r\n  var skData = skImage.Encode(SKEncodedImageFormat.Png, 80);\r\n  skData.SaveTo(output);\r\n }\r\n\r\n**Expected Behavior**\r\n\r\nThe tile https://tile.openstreetmap.org/1/0/0.png is saved to d:\\test\\test.png\r\n\r\n**Actual Behavior**\r\n\r\nThe tile generated in d:\\test\\test.png is corrupted, only part of the image can be seen. V2.80.2 doesn\u0027t have this issue.\r\n\r\n**Basic Information**\r\nVersion with issue: 2.88.2\r\nLast known good version: 2.80.2\r\nIDE: Visual Studio 2022\r\nPlatform Target Frameworks: Tested in .NET Framework 4.8 and .NET 6\r\nTarget Devices: Windows Console.\r\n  \r\n**Screenshots**\r\n\u003Cimg width=\u0022289\u0022 alt=\u0022image\u0022 src=\u0022https://user-images.githubusercontent.com/15203030/189432370-d0d2e12b-f146-4564-8886-f249ff14b7ae.png\u0022\u003E\r\n\r\n\r\n",
  "author": {
    "login": "bymin",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2022-09-09T19:53:50",
  "updatedAt": "2023-05-11T21:22:32",
  "commentCount": 7,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T13:46:19.2233561Z",
    "reactions": [],
    "comments": [
      {
        "id": 1261326591,
        "author": "LukePulverenti",
        "body": "Just for information, if you load this same image from a file rather than a url, do you get corruption with that?",
        "createdAt": "2022-09-28T18:46:01",
        "reactions": []
      },
      {
        "id": 1266790165,
        "author": "mattleibow",
        "body": "Also, can you try the latest version. There was a bug that was corrupting the parsing of png data a few releases back.\n\n",
        "createdAt": "2022-10-04T11:14:59",
        "reactions": []
      },
      {
        "id": 1279995761,
        "author": "bymin",
        "body": "@mattleibow I see the same issue in the latest version, 2.88.3. Do you mean the problem of https://github.com/mono/SkiaSharp/issues/1981? It looks to me the case for the local stream is fixed, but not for the web stream. ",
        "createdAt": "2022-10-16T15:48:49",
        "reactions": []
      },
      {
        "id": 1279997073,
        "author": "bymin",
        "body": "@LukePulverenti It works if I load the same image from a file.  The issue in https://github.com/mono/SkiaSharp/issues/1981 is fixed for the local stream but still has problems for the web stream.",
        "createdAt": "2022-10-16T15:56:17",
        "reactions": []
      },
      {
        "id": 1299092095,
        "author": "bymin",
        "body": "This issue happens randomly, and a workaround is to copy the network stream to MemorySteam and then feed the SKBitmap. ",
        "createdAt": "2022-11-01T20:21:50",
        "reactions": [
          {
            "user": "chrisbillson",
            "content": "\u002B1",
            "createdAt": "2026-02-06T13:46:18.7860673Z"
          }
        ]
      },
      {
        "id": 1472064002,
        "author": "chrisbillson",
        "body": "I had the same issue as OP.\r\n\r\n\u002B1 for the workaround to copy the network stream to a memory stream, which fixed it for me.",
        "createdAt": "2023-03-16T14:15:04",
        "reactions": []
      },
      {
        "id": 1544698553,
        "author": "jhariel8",
        "body": "Also experiencing this with some image processing I\u0027m doing from remote blob storage. It would be awesome if we could see a fix for this soon!",
        "createdAt": "2023-05-11T21:22:32",
        "reactions": []
      }
    ]
  }
}