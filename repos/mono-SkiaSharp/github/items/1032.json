{
  "number": 1032,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Possible Leak with static Dictionary SKObject.instances",
  "body": "SKObject holds Handled to WeakReferences in an static Dictionary bit never removes entries.\r\n\r\nIn RegisterHandle a new Entry is created with the handle ob object to an WeakReference. In DeregisterHandle, the Entry will only updates with WeakReference(null) but never deleted. This leads to tons of entries with tons of  WeakReferences.\r\n\r\n**Expected Behavior**\r\n\r\nOn Dispose the handle need to be removed from SKObject.instances\r\n\r\n**Actual Behavior**\r\n\r\n- Version with issue:  1.68.1\r\n- Last known good version:  N/A\r\n- Platform Target Frameworks: Xamarin.Android\r\n  - Android: 29\r\n- Target Devices:   Pixel 2 XL\r\n\r\n**Screenshot**\r\n\r\n![skia](https://user-images.githubusercontent.com/58169312/69532581-6ac3dd00-0f76-11ea-922f-a1d1ae68aae9.png)\r\n",
  "author": {
    "login": "Knuddlbaer",
    "type": "Organization"
  },
  "labels": [],
  "assignees": [],
  "milestone": "v1.68.1.1",
  "createdAt": "2019-11-25T10:26:43",
  "updatedAt": "2022-08-19T09:01:56",
  "closedAt": "2019-12-02T00:32:15",
  "commentCount": 7,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:09:48.3851546Z",
    "reactions": [],
    "comments": [
      {
        "id": 560022302,
        "author": "MarchingCube",
        "body": "I\u0027ve noticed this in Avalonia (https://github.com/AvaloniaUI/Avalonia) as well, when we redraw we end up with a lot of \u0060ConcurrentDictionary\u0060 allocations coming from SkiaSharp.",
        "createdAt": "2019-11-30T21:21:44",
        "reactions": []
      },
      {
        "id": 560023641,
        "author": "Gillibald",
        "body": "I think the AddOrUpdate call is wrong in the method that is responsible for the unregister. Should be easy to fix but haven\u0027t found time yet.\r\n\r\nhttps://github.com/mono/SkiaSharp/blob/master/binding/Binding/SKObject.cs#L141",
        "createdAt": "2019-11-30T21:43:37",
        "reactions": []
      },
      {
        "id": 560032124,
        "author": "Knuddlbaer",
        "body": "AddOrUpdate do not remove the entry in the dictionary. If the SKObject is detroyed, the entry in dictionary is simple replaced by new weakreference. Instead the handle have to removed. ",
        "createdAt": "2019-12-01T00:07:16",
        "reactions": []
      },
      {
        "id": 560079427,
        "author": "FoggyFinder",
        "body": "@Knuddlbaer Why issue was closed?",
        "createdAt": "2019-12-01T09:02:27",
        "reactions": []
      },
      {
        "id": 560103275,
        "author": "mattleibow",
        "body": "Reopening so we can get this fixed.",
        "createdAt": "2019-12-01T12:41:42",
        "reactions": []
      },
      {
        "id": 560181305,
        "author": "mattleibow",
        "body": "Closed in #1039 ",
        "createdAt": "2019-12-02T00:32:15",
        "reactions": []
      },
      {
        "id": 560395781,
        "author": "mattleibow",
        "body": "I just pushed the NuGets to the preview feed:\r\nhttps://nugetized.blob.core.windows.net/skiasharp-eap/index.json\r\n\r\n1.68.2-preview.5",
        "createdAt": "2019-12-02T13:26:33",
        "reactions": []
      }
    ]
  }
}