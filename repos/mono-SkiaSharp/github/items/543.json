{
  "number": 543,
  "type": "issue",
  "state": "closed",
  "title": "SKShader performance hit in v1.60 and v1.61",
  "body": "### Description\r\n\r\nIt seems that versions 1.60 and 1.60.1 introduced a performance hit with\r\nSKShader.CreateSweepGradient rendering time.\r\nNot exactly the most precise method,\r\nbut there is some noticeable difference between SkiaSkarp versions.\r\n\r\n### XAML\r\n\u0060\u0060\u0060\r\n\u003CGrid\u003E\r\n        \u003CGrid.RowDefinitions\u003E\r\n            \u003CRowDefinition Height=\u0022*\u0022 /\u003E\r\n            \u003CRowDefinition Height=\u0022100\u0022 /\u003E\r\n        \u003C/Grid.RowDefinitions\u003E\r\n\r\n        \u003Cskia:SKCanvasView Grid.Row=\u00220\u0022\r\n                           x:Name=\u0022canvasView\u0022\r\n                           PaintSurface=\u0022OnPaintSurface\u0022\r\n                           EnableTouchEvents=\u0022True\u0022\r\n                           Touch=\u0022SkiaTouch\u0022 /\u003E\r\n\r\n        \u003CLabel Grid.Row=\u00221\u0022\r\n               x:Name=\u0022lblTimer\u0022\r\n               FontSize=\u002224\u0022\r\n               HorizontalTextAlignment=\u0022Center\u0022\r\n               VerticalTextAlignment=\u0022Center\u0022/\u003E\r\n\u003C/Grid\u003E\r\n\u0060\u0060\u0060\r\n### Code behind\r\n\u0060\u0060\u0060\r\npublic partial class MainPage : ContentPage\r\n    \r\n\t{\r\n        private int millis;\r\n        public MainPage()\r\n        {\r\n            InitializeComponent();\r\n            var touchTimer = new Timer { Interval = 1 };\r\n            touchTimer.Elapsed \u002B= ElapsedMillis;\r\n            touchTimer.Start();\r\n        }\r\n\r\n        private void ElapsedMillis(object sender, ElapsedEventArgs args)\r\n        {\r\n            millis\u002B\u002B;\r\n        }\r\n\r\n        private void OnPaintSurface(object sender, SKPaintSurfaceEventArgs args)\r\n        {\r\n            var canvas = args.Surface.Canvas;\r\n            var scale = (float)(args.Info.Width / canvasView.Width);\r\n            canvas.Scale(scale);\r\n            canvas.Clear(SKColors.White);\r\n\r\n            var width = canvas.LocalClipBounds.Width;\r\n            var height = canvas.LocalClipBounds.Height;\r\n\r\n            var defaultSkColors = new SKColor[4];\r\n            defaultSkColors[0] = new SKColor(255, 0, 0);\r\n            defaultSkColors[1] = new SKColor(0, 255, 0);\r\n            defaultSkColors[2] = new SKColor(0, 0, 255);\r\n            defaultSkColors[3] = new SKColor(255, 0, 0);\r\n\r\n            var centerPoint = new SKPoint(width / 2, height / 2);\r\n\r\n            var shader = SKShader.CreateSweepGradient(centerPoint, defaultSkColors, null);\r\n\r\n            SKPaint paint = new SKPaint\r\n            {\r\n                Style = SKPaintStyle.Stroke,\r\n                Shader = shader,\r\n                IsAntialias = true,\r\n                StrokeWidth = 150\r\n\r\n            };\r\n\r\n            canvas.DrawCircle(width / 2, height / 2, 100, paint);\r\n            lblTimer.Text = millis.ToString();\r\n        }\r\n\r\n        private void SkiaTouch(object sender, SKTouchEventArgs args)\r\n        {\r\n            if (args.ActionType != SKTouchAction.Pressed) return;\r\n            millis = 0;\r\n            canvasView.InvalidateSurface();\r\n        }\r\n\r\n    }\r\n\u0060\u0060\u0060\r\n### Behavior\r\nXamarin Forms: 3.0.0.482510\r\n\r\n**## HTC One X (Android 5.1) results:**\r\n\r\n**SkiaSharp version: 1.60.1**\r\nConfiguration: debug\r\nRendering time (avg of 5): 177ms\r\n\r\nConfiguration: release\r\nRendering time (avg of 5): 181ms\r\n\r\n**SkiaSharp version: 1.60**\r\nConfiguration: debug\r\nRendering time (avg of 5): 171ms\r\n\r\nConfiguration: release\r\nRendering time (avg of 5): 184ms\r\n\r\n**SkiaSharp version: 1.59.3**\r\nConfiguration: debug\r\nRendering time (avg of 5): 58ms\r\n\r\nConfiguration: release\r\nRendering time (avg of 5): 51ms\r\n\r\n\r\n**## Huawei Y6 (Android 8.0)\r\nNotice discrepancy between debug and release configurations**\r\n\r\n**SkiaSharp version: 1.60.1**\r\nConfiguration: debug\r\nRendering time (avg of 5): 28ms\r\n\r\nConfiguration: release\r\nRendering time (avg of 5): 196ms\r\n\r\n**SkiaSharp version: 1.60**\r\nConfiguration: debug\r\nRendering time (avg of 5): 29ms\r\n\r\nConfiguration: release\r\nRendering time (avg of 5): 198ms\r\n\r\n**SkiaSharp version: 1.59.3**\r\nConfiguration: debug\r\nRendering time (avg of 5): 56ms\r\n\r\nConfiguration: release\r\nRendering time (avg of 5): 50ms\r\n\r\n### Basic Information\r\n- Version with issue:  1.60 and 1.60.1\r\n- Last known good version:  1.59.3\r\n- IDE:  Visual Studio 2017\r\n- Platform Target Frameworks: \r\n  - Android: 8.0, 8.1 \r\n  \r\n- Target Devices:\r\n HTC One X, Huawei Y6\r\nCan test on more if needed\r\n\r\n",
  "author": {
    "login": "rvlajcev",
    "type": "User"
  },
  "labels": [],
  "assignees": [],
  "createdAt": "2018-06-02T21:47:32",
  "updatedAt": "2022-08-19T15:02:22",
  "closedAt": "2018-11-29T16:14:28",
  "commentCount": 1,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-04T20:42:09.1422824Z",
    "reactions": [],
    "comments": [
      {
        "id": 442893136,
        "author": "mattleibow",
        "createdAt": "2018-11-29T16:14:28",
        "reactions": []
      }
    ]
  }
}