{
  "number": 1433,
  "type": "issue",
  "state": "closed",
  "title": "[BUG] Font issue",
  "body": "**Description**\r\nI upgraded my app to 2.80.1 and then to 2.80.2-preview.9, and the way fonts work on Android seem to have changed. \r\nAlso tested on iOS 13.6 and fonts work as expected.\r\n\r\n\u003C!-- a general description goes here --\u003E\r\n\r\n**Code**\r\n\u003C!-- a snippet of code that demonstrates the issue --\u003E\r\nI determine the typeface as follows:\r\n\r\n\r\n                var sampleChar = \u0027A\u0027;\r\n                var fontManager = SKFontManager.Default;\r\n                var typeface = fontManager.MatchCharacter(sampleChar);\r\n\r\n\r\n                if (typeface == null)\r\n                {\r\n                    foreach (var font in fontManager.FontFamilies)\r\n                    {\r\n                        if (font.ToLower().Contains(\u0022helvetica\u0022))\r\n                        {\r\n                            typeface = fontManager.MatchFamily(font, SKFontStyle.Normal);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                _textPaint.Typeface = typeface;\r\n\r\n\r\nAnd then drawtext as follows:\r\n\r\n\u0060\u0060\u0060csharp\r\ncanvas.DrawText(textString,\r\n    -info.Width / (float) _canvasScale /\r\n    2 \u002B offset, // \u002B textString.Length * _textPaint.TextSize/2 /(float)scale ,\r\n    -info.Height / (float) _canvasScale / 2 \u002B _textPaint.TextSize * 1.1f,\r\n    _textPaint);\r\n\u0060\u0060\u0060\r\n\r\n**Expected Behavior**\r\n\u003C!-- a general description of what was the expected behavior or result --\u003E\r\nText should display the same as on 1.68.3\r\n\r\n**Actual Behavior**\r\nTypeface on Android change and text no longer displays as intended\r\n\r\n\u003C!-- a general description of what really happened --\u003E\r\n\r\n**Basic Information**\r\n\r\n- Version with issue:  2.80.1 and then to 2.80.2-preview.9 \u003C!-- the version of SkiaSharp that has the issue --\u003E\r\n- Last known good version: 1.68.3 \u003C!-- the version of SkiaSharp that still working --\u003E\r\n- IDE:  Microsoft Visual Studio 2019 Version 16.6.5 \u003C!-- Visual Studio / Visual Studio for Mac / MonoDevelop / Visual Studio Code --\u003E\r\n- Platform Target Frameworks: \u003C!-- all that apply, remove the platforms that aren\u0027t broken or haven\u0027t had any testing --\u003E\r\n  - Android: Android 10 API Level 29  \u003C!-- the version of the Android SDK you are compiling against, e.g. 7.1 --\u003E \r\n\r\n- Target Devices: \r\n\u003C!-- the devices that you noticed this on, e.g. iPhone X --\u003E\r\nPixel 2 Emulator running Android 10 \r\nSamsung S8 running Android 9  \r\n  \r\n\u003Cdetails\u003E\r\n  \u003Csummary\u003EDetailed IDE/OS information (click to expand)\u003C/summary\u003E\r\n  \r\n\u0060\u0060\u0060\r\n\r\nXamarin   16.6.000.1064 (d16-6@b03f31e)\r\nVisual Studio extension to enable development for Xamarin.iOS and Xamarin.Android.\r\n\r\nXamarin Designer   16.6.0.318 (remotes/origin/d16-6@66afc5421)\r\nVisual Studio extension to enable Xamarin Designer tools in Visual Studio.\r\n\r\nXamarin Templates   16.6.40 (1f1466f)\r\nTemplates for building iOS, Android, and Windows apps with Xamarin and Xamarin.Forms.\r\n\r\nXamarin.Android SDK   10.3.1.4 (d16-6/3a10de9)\r\nXamarin.Android Reference Assemblies and MSBuild support.\r\n    Mono: 165f4b0\r\n    Java.Interop: xamarin/java.interop/d16-6@2cab35c\r\n    ProGuard: xamarin/proguard/master@905836d\r\n    SQLite: xamarin/sqlite/3.31.1@49232bc\r\n    Xamarin.Android Tools: xamarin/xamarin-android-tools/d16-6@bfb66f3\r\n\r\n\r\nXamarin.iOS and Xamarin.Mac SDK   13.18.3.2 (ce0cc74)\r\nXamarin.iOS and Xamarin.Mac Reference Assemblies and MSBuild support.\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n**Screenshots**\r\n\u003C!-- if the issue is a visual issue, please include screenshots showing the problem if possible --\u003E\r\nAndroid Text display on 2.80.1 and then to 2.80.2-preview.9\r\n![image](https://user-images.githubusercontent.com/33708055/88864891-6f096e00-d25a-11ea-9f69-abf58ae37c66.png)\r\n\r\nAndroid Text display on 1.68.3\r\n![image](https://user-images.githubusercontent.com/33708055/88865113-0969b180-d25b-11ea-80d2-182128b99d2f.png)\r\n\r\n**Reproduction Link**\r\n\r\n\u003C!-- please upload or provide a link to a reproduction case --\u003E\r\n\r\n",
  "author": {
    "login": "DawidBester",
    "type": "User"
  },
  "labels": [
    {
      "name": "type/bug",
      "color": "fc2929"
    },
    {
      "name": "status/skia-update-required",
      "color": "B8EC4A"
    },
    {
      "name": "os/Linux",
      "color": "fbca04"
    },
    {
      "name": "os/Android",
      "color": "fbca04"
    }
  ],
  "assignees": [],
  "milestone": "v2.80.2",
  "createdAt": "2020-07-30T00:55:22",
  "updatedAt": "2022-08-19T03:02:22",
  "closedAt": "2020-08-01T11:15:46",
  "commentCount": 6,
  "reactionCount": 0,
  "engagement": {
    "syncedAt": "2026-02-06T14:15:17.3156624Z",
    "reactions": [],
    "comments": [
      {
        "id": 666699025,
        "author": "mattleibow",
        "body": "I am not able to reproduce this... I tried a few strings and all the fonts, but no luck.\r\n\r\nAre you able to attach an app with this happening? \r\n\r\n| Emulator (Pixel 2 v10) | Razor Phone (9.0) |\r\n| :---------: | :------------: |\r\n| ![image](https://user-images.githubusercontent.com/1096616/88974216-92630600-d2b8-11ea-9ab9-8176ed42c6ed.png) | ![image](https://user-images.githubusercontent.com/1096616/88974531-0e5d4e00-d2b9-11ea-97ca-b7547b927d69.png) |\r\n",
        "createdAt": "2020-07-30T21:04:52",
        "reactions": []
      },
      {
        "id": 666846877,
        "author": "DawidBester",
        "body": "Sample app attached.\r\n[PlotTextTest.zip](https://github.com/mono/SkiaSharp/files/5004374/PlotTextTest.zip)\r\n\r\nWith 2.80.2-preview.9 sample app output as follows on Pixel 2 Emulator running Android 10 and Samsung S8 running Android 9:\r\n![image](https://user-images.githubusercontent.com/33708055/88986871-4c458b00-d328-11ea-8e77-0dc7f19e6b81.png)\r\n\r\nWith 1.68.3 sample app output as follows on Pixel 2 Emulator running Android 10 and Samsung S8 running Android 9:\r\n![image](https://user-images.githubusercontent.com/33708055/88987684-d5f65800-d32a-11ea-99d5-074e02e26dcc.png)\r\n\r\n\r\nFYI: While creating the attached sample also experience [ #1395](https://github.com/mono/SkiaSharp/issues/1395) and had to install SkiaSharp package in addition to SkiSharp.View.Forms for 2.80.2-preview.9 to function without crashing. Crash as follows:\r\n\r\n\r\n**System.DllNotFoundException:** \u0027libSkiaSharp.so assembly:\u003Cunknown assembly\u003E type:\u003Cunknown type\u003E member:(null)\u0027\r\n\r\n07-31 12:36:17.577 E/mono    ( 8291): \r\n07-31 12:36:17.577 E/mono    ( 8291): Unhandled Exception:\r\n07-31 12:36:17.577 E/mono    ( 8291): System.DllNotFoundException: libSkiaSharp.so assembly:\u003Cunknown assembly\u003E type:\u003Cunknown type\u003E member:(null)\r\n07-31 12:36:17.577 E/mono    ( 8291):   at (wrapper dynamic-method) Android.Runtime.DynamicMethodNameCounter.7(intptr,intptr,intptr)\r\n07-31 12:36:17.577 E/mono    ( 8291):   at (wrapper native-to-managed) Android.Runtime.DynamicMethodNameCounter.7(intptr,intptr,intptr)\r\n07-31 12:36:17.578 E/mono-rt ( 8291): [ERROR] FATAL UNHANDLED EXCEPTION: System.DllNotFoundException: libSkiaSharp.so assembly:\u003Cunknown assembly\u003E type:\u003Cunknown type\u003E member:(null)\r\n07-31 12:36:17.578 E/mono-rt ( 8291):   at (wrapper dynamic-method) Android.Runtime.DynamicMethodNameCounter.7(intptr,intptr,intptr)\r\n07-31 12:36:17.578 E/mono-rt ( 8291):   at (wrapper native-to-managed) Android.Runtime.DynamicMethodNameCounter.7(intptr,intptr,intptr)\r\n",
        "createdAt": "2020-07-31T00:49:41",
        "reactions": [
          {
            "user": "mattleibow",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:15:16.448178Z"
          }
        ]
      },
      {
        "id": 667059706,
        "author": "mattleibow",
        "body": "I am looking at the issue, and I think it _cause_ is due to the small font size and the new way skia calculates things.\r\n\r\nGoogle has this problem too: https://fiddle.skia.org/c/7ca3e587eeac78b4054ee40f409a5fe1\r\n\r\nI will communicate with them and see what the fix is.\r\n\r\n![image](https://user-images.githubusercontent.com/1096616/89028625-0b9c4080-d32d-11ea-9f4c-ad5e682b96ce.png)\r\n",
        "createdAt": "2020-07-31T10:47:13",
        "reactions": []
      },
      {
        "id": 667073749,
        "author": "mattleibow",
        "body": "I started a discussion about this: https://groups.google.com/g/skia-discuss/c/Qx7brrWyv9Y\r\n\r\nSeems to be just Android and Linux - or FreeType.",
        "createdAt": "2020-07-31T11:27:29",
        "reactions": []
      },
      {
        "id": 667154923,
        "author": "daltonks",
        "body": "@DawidBester I came across this same issue. Adding HarfBuzzSharp and using \u0060canvas.DrawShapedText\u0060 fixed it for me. Maybe it\u0027ll help in your case too?\r\n\r\nhttps://www.nuget.org/packages/HarfBuzzSharp",
        "createdAt": "2020-07-31T14:41:15",
        "reactions": []
      },
      {
        "id": 667425943,
        "author": "DawidBester",
        "body": "@daltonks Thanks, your workaround works! \r\n\r\nJust added SkiaSharp.HarfBuzz 2.80.2-preview.9 with canvas.DrawShapedText to the sample app, and the text displays correctly on an Android 10 Emulator. \r\n\r\nThe preference is to try to avoid adding another NuGet with code changes in the production app, but this will be my fallback.\r\n\r\n![image](https://user-images.githubusercontent.com/33708055/89087341-1c5dbc80-d3e8-11ea-9ee0-ea066077c288.png)\r\n\r\n\r\n",
        "createdAt": "2020-07-31T23:30:14",
        "reactions": [
          {
            "user": "daltonks",
            "content": "\u002B1",
            "createdAt": "2026-02-06T14:15:17.2662688Z"
          }
        ]
      }
    ]
  }
}