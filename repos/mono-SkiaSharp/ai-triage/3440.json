{
  "meta": {
    "schemaVersion": "3.0",
    "number": 3440,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-10T12:00:00Z"
  },
  "summary": "MAUI app crashes on certain Windows 11 systems with COMException in PropertySetExtensions WinRT activation during ANGLE surface creation",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.97
    },
    "area": {
      "value": "area/views.maui",
      "confidence": 0.9
    },
    "platforms": [
      "os/Windows-WinUI"
    ],
    "backends": [
      "backend/OpenGL"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "stepsToReproduce": [
        "Create a MAUI app with LiveCharts2 that uses SkiaSharp 3.119.1 for chart rendering",
        "Deploy the app to a Windows 11 system (reported: Lenovo 83C4, Windows 11 10.0.26100.7462)",
        "Launch the app — crashes when AngleSwapChainPanel loads and attempts to create the ANGLE render surface"
      ],
      "environmentDetails": "Windows 11 (10.0.26100.7462), Lenovo 83C4, SkiaSharp 3.119.1, MAUI app with LiveCharts2. Tried with HA (Hardware Acceleration) enabled and disabled — same result.",
      "codeSnippets": [
        "xml: <liveCharts:CartesianChart x:Name=\"Graph\"\n                                   AbsoluteLayout.LayoutBounds=\"0,0,1,1\"\n                                   AbsoluteLayout.LayoutFlags=\"PositionProportional,SizeProportional\"\n                                   ZoomMode=\"None\"\n                                   EasingFunction=\"{x:Null}\"\n                                   ... />",
        "text: System.Runtime.InteropServices.COMException: Element not found.\n  at void Marshal.ThrowExceptionForHR(int errorCode)() in Marshal.cs:line 856\n  at new BaseActivationFactory(string typeNamespace, string typeFullName)()\n  at static PropertySetExtensions()()\n\nSystem.TypeInitializationException: The type initializer for 'SkiaSharp.Views.WinUI.Native.PropertySetExtensions' threw an exception.\n  at IObjectReference PropertySetExtensions.get__objRef_global__SkiaSharp_Views_WinUI_Native_IPropertySetExtensionsStatics()()\n  at void PropertySetExtensions.AddSingle(PropertySet propertySet, string key, float value)()\n  at void GlesContext.CreateSurface(SwapChainPanel panel, Size? renderSurfaceSize, float? resolutionScale)()\n  at void AngleSwapChainPanel.EnsureRenderSurface()()\n  at void AngleSwapChainPanel.OnLoaded(object sender, RoutedEventArgs e)()\n  at int RoutedEventHandler.Do_Abi_Invoke(IntPtr thisPtr, IntPtr sender, IntPtr e)()"
      ]
    },
    "bugSignals": {
      "severity": "high",
      "errorType": "crash"
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.119.1"
      ]
    }
  },
  "analysis": {
    "summary": "MAUI app with LiveCharts2 crashes on certain Windows 11 systems during ANGLE render surface creation. The WinRT activation factory for SkiaSharp.Views.WinUI.Native.PropertySetExtensions fails with COMException 'Element not found', a recurring pattern seen across multiple issues.",
    "rationale": "type: The issue reports a crash with a full stack trace during normal rendering initialization. The app terminates with COMException/TypeInitializationException — clearly broken behavior, not a usage question or feature request. area: The crash occurs in SkiaSharp.Views.WinUI components (PropertySetExtensions, GlesContext, AngleSwapChainPanel) used through a MAUI app. The reporter's context is MAUI and the existing label correctly scopes this. backends: The crash path goes through AngleSwapChainPanel → GlesContext.CreateSurface, which is the ANGLE OpenGL ES backend. ANGLE translates OpenGL ES to Direct3D on Windows. PropertySetExtensions is only needed for GLES surface setup. platforms: Explicitly Windows 11, WinUI 3 stack. The crash is in SkiaSharp.Views.WinUI.Native.PropertySetExtensions, a C++/WinRT component specific to the WinUI rendering path. tenets: Application crash during rendering initialization. The COMException causes a TypeInitializationException that terminates rendering entirely with no recovery path. bugSignals.severity: Crash with no known workaround for users who need GPU-accelerated rendering via SKGLView. The crash is unrecoverable and happens during initialization. It only affects 'certain systems' so it's not universal — hence high rather than critical. actionability.suggestedAction: This is part of a recurring pattern of WinRT activation failures for PropertySetExtensions. The root cause — the C++/WinRT component failing to activate on certain system configurations — needs engineering investigation to find a robust solution, potentially replacing the WinRT component with managed code. partner: The reporter is using a .NET MAUI app with LiveCharts2 for chart rendering. The crash occurs in SkiaSharp.Views.WinUI components invoked through the MAUI rendering pipeline. versionAnalysis.currentRelevance: Version 3.119.1 is a current stable release. The WinRT activation issue with PropertySetExtensions is a persistent architectural problem reported a",
    "codeInvestigation": [],
    "nextQuestions": [
      "Whether the app is deployed as packaged (MSIX) or unpackaged — this significantly affects WinRT component discovery",
      "Whether SkiaSharp.Views.WinUI.Native.dll is present in the app output directory on the failing systems",
      "Whether the failing systems have Windows App SDK runtime installed or if the app is self-contained",
      "Which specific system configuration differences cause the failure on 'certain systems' but not others"
    ],
    "resolution": {
      "hypothesis": "The WinRT activation factory for SkiaSharp.Views.WinUI.Native.PropertySetExtensions fails because the C++/WinRT component DLL cannot be discovered by the WinRT activation system on certain Windows configurations. The 'Element not found' COMException suggests the activation catalog entry exists but the backing DLL or class cannot be located, likely due to deployment mode or Windows App SDK runtime state.",
      "proposals": [
        {
          "description": "Eliminate the dependency on the C++/WinRT component by implementing PropertySet manipulation in managed code using WinRT interop APIs directly. This removes the activation factory requirement entirely and fixes this class of issues across all deployment modes.",
          "confidence": 0.7,
          "effort": "large"
        },
        {
          "description": "Wrap PropertySetExtensions calls with try-catch(COMException) and skip the optional resolution scale/surface size properties on failure, allowing ANGLE surface creation to proceed with defaults.",
          "confidence": 0.6,
          "effort": "medium"
        },
        {
          "description": "Configure LiveCharts2 to use SKCanvasView (CPU rendering) instead of SKGLView, bypassing the entire AngleSwapChainPanel/GlesContext/PropertySetExtensions code path. Workaround for end users, not a fix in SkiaSharp itself.",
          "confidence": 0.8,
          "effort": "small"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.85,
      "reason": "This is a recurring WinRT activation failure pattern affecting multiple users across versions. The root cause needs engineering investigation — specifically whether PropertySetExtensions can be replaced with managed code to eliminate the C++/WinRT dependency."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Add backend/OpenGL and partner/maui labels to existing labels",
        "risk": "low",
        "confidence": 0.9,
        "labels": [
          "backend/OpenGL",
          "partner/maui"
        ]
      },
      {
        "type": "add-comment",
        "description": "Post analysis response with diagnostic questions and workaround suggestion",
        "risk": "high",
        "confidence": 0.8
      }
    ]
  }
}
