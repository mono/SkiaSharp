{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3385,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T16:23:34Z",
    "currentLabels": ["type/feature-request"]
  },
  "summary": "Request for SKColorType.Gray16 to support 16-bit grayscale PNGs — blocked by upstream Skia which lacks kGray_16_SkColorType and explicitly strips 16-bit gray to 8-bit in its PNG decoder.",
  "classification": {
    "type": { "value": "type/feature-request", "confidence": 0.98 },
    "area": { "value": "area/SkiaSharp", "confidence": 0.90 }
  },
  "evidence": {
    "reproEvidence": {
      "relatedIssues": [1222]
    },
    "versionAnalysis": {
      "currentRelevance": "likely",
      "relevanceReason": "Upstream Skia still does not define kGray_16_SkColorType as of the current pinned version. The PNG codec TODO comment remains at SkPngCodec.cpp:861."
    }
  },
  "analysis": {
    "summary": "User wants to decode 16-bit grayscale PNGs with full precision. SkiaSharp's SKColorType enum mirrors upstream Skia's SkColorType enum, which does not include a Gray16 variant. Skia's PNG decoder explicitly strips 16-bit grayscale to 8-bit (SkPngCodec.cpp:861-865) with a TODO asking whether 16-bit gray precision should be supported. This is an upstream limitation, not a SkiaSharp-specific gap.",
    "rationale": "Classified as feature-request because the issue explicitly uses the [FEATURE] template and requests adding a new enum value. Area is area/SkiaSharp because SKColorType is defined in the core SkiaSharp binding (Definitions.cs). The comment from molesmoke correctly identifies this as an upstream Skia limitation — Skia's SkColorType enum (SkColorType.h) has kGray_8_SkColorType but no 16-bit gray equivalent, and the PNG codec actively downgrades 16-bit gray to 8-bit.",
    "keySignals": [
      { "text": "i want to use 16bit grayscale pngs but it looks like it doesnt exist in skiasharp", "source": "issue body", "interpretation": "User needs 16-bit precision for grayscale data — likely scientific/medical imaging use case." },
      { "text": "There's no Gray16 support upstream: https://api.skia.org/SkColorType_8h.html", "source": "comment by molesmoke", "interpretation": "Correctly identifies the root cause — this is blocked by upstream Skia, not just a SkiaSharp mapping gap." },
      { "text": "// TODO: Should we support 16-bits of precision for gray images?", "source": "externals/skia/src/codec/SkPngCodec.cpp:861", "interpretation": "Skia developers have considered this but not implemented it. The decoder uses png_set_strip_16() to discard precision." }
    ],
    "codeInvestigation": [
      { "file": "externals/skia/include/core/SkColorType.h", "lines": "19-66", "finding": "Upstream Skia SkColorType enum has kGray_8_SkColorType (line 34) but no kGray_16 variant. The last enum value is kR8_unorm_SkColorType.", "relevance": "direct" },
      { "file": "externals/skia/src/codec/SkPngCodec.cpp", "lines": "861-865", "finding": "PNG decoder explicitly strips 16-bit grayscale to 8-bit with png_set_strip_16(). Has a TODO comment asking whether 16-bit gray should be supported.", "relevance": "direct" },
      { "file": "externals/skia/include/c/sk_types.h", "lines": "98-126", "finding": "C API sk_colortype_t enum has GRAY_8_SK_COLORTYPE but no GRAY_16 variant — mirrors the upstream gap.", "relevance": "direct" },
      { "file": "binding/SkiaSharp/Definitions.cs", "lines": "36-63", "finding": "SKColorType C# enum has Gray8 = 9 but no Gray16. The enum is a 1:1 mapping of the C API values.", "relevance": "direct" },
      { "file": "binding/SkiaSharp/EnumMappings.cs", "lines": "43-103", "finding": "ToNative/FromNative mappings cover all current color types. Adding Gray16 would require entries in both directions plus the upstream enum values.", "relevance": "context" }
    ],
    "workarounds": [
      "Decode 16-bit grayscale PNGs outside of SkiaSharp (e.g., using a dedicated PNG library like ImageSharp or libpng directly), then import the raw pixel data into an SKBitmap using SKColorType.Alpha16 (which is a 16-bit single-channel format) or SKColorType.Rg1616 for two-channel data.",
      "Use SKBitmap.FromImage() after decoding with SKCodec — the 16-bit data will be silently downsampled to 8-bit Gray8, which may be acceptable for display purposes even if precision is lost."
    ],
    "nextQuestions": [
      "Would Alpha16 (A16_unorm, 16-bit single channel) serve as an adequate workaround for raw pixel import, despite being semantically 'alpha' rather than 'gray'?",
      "Is the use case display/rendering, or pixel-level data analysis where full 16-bit precision is critical?"
    ],
    "resolution": {
      "hypothesis": "Gray16 cannot be added to SkiaSharp without upstream Skia first adding kGray_16_SkColorType and updating the PNG codec to preserve 16-bit precision for grayscale images.",
      "proposals": [
        {
          "title": "External decode + raw pixel import",
          "description": "Decode the 16-bit grayscale PNG using a library that supports it (e.g., SixLabors.ImageSharp, which supports Gray16), then copy the raw 16-bit pixel data into an SKBitmap using SKColorType.Alpha16 as the closest 16-bit single-channel format. This preserves the full 16-bit precision for processing, though rendering will interpret the channel as alpha rather than luminance.",
          "confidence": 0.65,
          "effort": "medium"
        },
        {
          "title": "Accept 8-bit downsampling",
          "description": "Load the 16-bit grayscale PNG normally via SKBitmap.Decode() or SKImage.FromEncodedData(). Skia's PNG decoder will silently strip 16-bit to 8-bit, giving a Gray8 result. Acceptable for display/preview but loses precision.",
          "confidence": 0.90,
          "effort": "trivial"
        },
        {
          "title": "Upstream Skia contribution",
          "description": "Add kGray_16_SkColorType to upstream Skia's SkColorType enum, update the PNG codec to stop stripping 16-bit gray, and propagate through C API and SkiaSharp. This is the proper fix but requires upstream Skia acceptance.",
          "confidence": 0.30,
          "effort": "large"
        }
      ],
      "recommendedProposal": "External decode + raw pixel import",
      "recommendedReason": "Provides 16-bit precision without waiting for upstream Skia changes. The Alpha16 channel semantics are different but the raw data is preserved for custom processing."
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "keep-open",
      "confidence": 0.90,
      "reason": "Valid feature request blocked by upstream Skia limitation. Cannot be implemented without upstream changes, but the request is legitimate and should remain open for tracking."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Confirm existing type/feature-request label and add area/SkiaSharp",
        "risk": "low",
        "confidence": 0.95,
        "labels": ["type/feature-request", "area/SkiaSharp"]
      },
      {
        "type": "add-comment",
        "description": "Explain upstream limitation, provide workaround options",
        "risk": "high",
        "confidence": 0.85,
        "comment": "Thanks for the request. As molesmoke noted, Skia's `SkColorType` enum doesn't include a Gray16 variant — the only grayscale type is `kGray_8_SkColorType`. The PNG decoder also explicitly strips 16-bit grayscale to 8-bit (`png_set_strip_16`), so even the raw pixel data isn't preserved during decode.\n\nThis means adding `SKColorType.Gray16` to SkiaSharp would require upstream Skia changes first.\n\nIn the meantime, if you need the full 16-bit precision, one option is to decode the PNG with a library that supports Gray16 (such as SixLabors.ImageSharp) and import the raw pixel data into an `SKBitmap` using `SKColorType.Alpha16` — it's semantically \"alpha\" rather than \"gray,\" but it's a 16-bit single-channel format that preserves the precision.\n\nIf 8-bit precision is acceptable for your use case, `SKBitmap.Decode()` will load the image fine — it just silently downsamples to Gray8."
      }
    ]
  }
}
