{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3379,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T16:18:05Z",
    "currentLabels": ["type/bug", "os/Windows-Classic", "area/SkiaSharp.Views", "tenet/compatibility"]
  },
  "summary": "SkiaSharp.Views.WPF references OpenTK.GLWpfControl 3.3.0 for .NET Framework targets, which is not strong-named. This causes FileLoadException in applications that enable strong-name signing (SignAssembly), since all dependencies must also be strong-named. OpenTK.GLWpfControl 3.3.1 added strong-name signing, so bumping the version from 3.3.0 to 3.3.1 resolves the issue. A community PR #3380 already proposes this fix.",
  "classification": {
    "type": { "value": "type/bug", "confidence": 0.95 },
    "area": { "value": "area/SkiaSharp.Views", "confidence": 0.98 },
    "platforms": ["os/Windows-Classic"],
    "tenets": ["tenet/compatibility"]
  },
  "evidence": {
    "bugSignals": {
      "severity": "medium",
      "isRegression": true,
      "errorType": "FileLoadException",
      "errorMessage": "Could not load file or assembly 'GLWpfControl, Version=3.3.0.0, Culture=neutral, PublicKeyToken=null' or one of its dependencies. A strongly-named assembly is required. (Exception from HRESULT: 0x80131044)",
      "reproQuality": "complete",
      "targetFrameworks": ["net48"]
    },
    "reproEvidence": {
      "stepsToReproduce": [
        "Create a .NET Framework 4.8 WPF project with strong-name signing enabled (SignAssembly=true)",
        "Add a PackageReference to SkiaSharp.Views.WPF 3.119.1",
        "Build and run the application",
        "Observe FileLoadException for GLWpfControl assembly"
      ],
      "codeSnippets": [
        "<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup>\n    <OutputType>WinExe</OutputType>\n    <TargetFramework>net48</TargetFramework>\n    <SignAssembly>true</SignAssembly>\n    <AssemblyOriginatorKeyFile>MyStrongNameKey.snk</AssemblyOriginatorKeyFile>\n  </PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp.Views.WPF\" Version=\"3.119.1\" />\n  </ItemGroup>\n</Project>"
      ],
      "environmentDetails": "Windows, .NET Framework 4.8, Visual Studio (Windows), strong-name signing enabled",
      "relatedIssues": [1767]
    },
    "versionAnalysis": {
      "mentionedVersions": ["3.116.0", "3.119.1", "2.88.9"],
      "workedIn": "2.88.9",
      "brokeIn": "3.116.0",
      "currentRelevance": "likely",
      "relevanceReason": "The csproj on main still references OpenTK.GLWpfControl 3.3.0 for .NET Framework targets. The issue persists in all 3.x releases."
    },
    "regression": {
      "isRegression": true,
      "confidence": 0.75,
      "reason": "Reporter says 2.88.9 worked. The SKGLElement class (and its dependency on OpenTK.GLWpfControl) was introduced in SkiaSharp 3.0 via PR #2317, so the strong-naming incompatibility started with the 3.x line. In 2.88.x, the WPF view didn't depend on GLWpfControl.",
      "workedInVersion": "2.88.9",
      "brokeInVersion": "3.116.0"
    },
    "fixStatus": {
      "likelyFixed": false,
      "confidence": 0.95,
      "reason": "The csproj on main still shows OpenTK.GLWpfControl 3.3.0. PR #3380 proposes the fix but has not been merged.",
      "relatedPRs": [3380]
    }
  },
  "analysis": {
    "summary": "SkiaSharp.Views.WPF depends on OpenTK.GLWpfControl 3.3.0 for .NET Framework targets (net4*). That version lacks strong-name signing. When the consuming application enables SignAssembly, the CLR refuses to load the unsigned GLWpfControl assembly, throwing FileLoadException. The upstream OpenTK project added strong-naming in GLWpfControl 3.3.1. The fix is a one-line version bump in the csproj.",
    "rationale": "This is clearly a bug — a dependency version choice that breaks strong-named applications. It's area/SkiaSharp.Views because the issue is in the WPF views package dependency, not core SkiaSharp. Windows-Classic because it only affects .NET Framework WPF. tenet/compatibility because strong-naming is a .NET compatibility requirement. Severity is medium — the app won't load the GL control at all, but only affects the subset of users who strong-name their .NET Framework apps.",
    "keySignals": [
      { "text": "PackageReference Include=\"OpenTK.GLWpfControl\" Version=\"3.3.0\"", "source": "source/SkiaSharp.Views/SkiaSharp.Views.WPF/SkiaSharp.Views.WPF.csproj:15", "interpretation": "Root cause — version 3.3.0 is not strong-named; 3.3.1 is." },
      { "text": "SignAssembly Condition=\"!$(TargetFramework.StartsWith('net4'))\">false</SignAssembly>", "source": "source/SkiaSharp.Views/SkiaSharp.Views.WPF/SkiaSharp.Views.WPF.csproj:10", "interpretation": "SkiaSharp.Views.WPF itself IS strong-named for net4* targets, creating a mismatch with unsigned GLWpfControl." },
      { "text": "FileLoadException: A strongly-named assembly is required (0x80131044)", "source": "issue body", "interpretation": "CLR enforces that strong-named assemblies can only reference other strong-named assemblies." },
      { "text": "Strong-naming was added in OpenTK.GLWpfControl 3.3.1", "source": "issue body + opentk/GLWpfControl#164", "interpretation": "Upstream already fixed this; SkiaSharp just needs to bump the dependency version." }
    ],
    "codeInvestigation": [
      { "file": "source/SkiaSharp.Views/SkiaSharp.Views.WPF/SkiaSharp.Views.WPF.csproj", "lines": "13-16", "finding": "For net4* targets, references OpenTK 3.3.1 (strong-named) and OpenTK.GLWpfControl 3.3.0 (NOT strong-named). The GLWpfControl version is the problem.", "relevance": "direct" },
      { "file": "source/SkiaSharp.Views/SkiaSharp.Views.WPF/SkiaSharp.Views.WPF.csproj", "lines": "10", "finding": "SignAssembly is explicitly disabled for non-net4 targets but remains enabled for net4*. This means the WPF assembly itself is strong-named for .NET Framework, requiring all dependencies to also be strong-named.", "relevance": "direct" },
      { "file": "source/SkiaSharp.Views/SkiaSharp.Views.WPF/SkiaSharp.Views.WPF.csproj", "lines": "17-20", "finding": "For modern .NET targets, OpenTK.GLWpfControl is at 4.2.3 — a different major version line not affected by this issue.", "relevance": "context" },
      { "file": "source/SkiaSharp.Views/SkiaSharp.Views.WPF/SKGLElement.cs", "lines": "29", "finding": "SKGLElement inherits from GLWpfControl, making it a direct dependency that cannot be avoided.", "relevance": "related" },
      { "file": "scripts/VERSIONS.txt", "lines": "27", "finding": "VERSIONS.txt lists OpenTK.GLWpfControl at 4.3.4, which is the modern .NET version. The net4* 3.x line version is not tracked here.", "relevance": "context" }
    ],
    "errorFingerprint": "FileLoadException-GLWpfControl-StrongName-net4",
    "workarounds": [
      "Use a binding redirect in app.config to force-load the unsigned assembly (may not work in all strong-naming scenarios)",
      "Target modern .NET (net6.0-windows+) instead of .NET Framework, which uses OpenTK.GLWpfControl 4.x and doesn't require strong-naming"
    ],
    "nextQuestions": [
      "Should VERSIONS.txt also be updated to track the net4* version of OpenTK.GLWpfControl separately?",
      "Are there any breaking API changes between OpenTK.GLWpfControl 3.3.0 and 3.3.1 that could affect SKGLElement?"
    ],
    "resolution": {
      "hypothesis": "OpenTK.GLWpfControl 3.3.0 is not strong-named, but SkiaSharp.Views.WPF IS strong-named for .NET Framework targets. The CLR enforces that strong-named assemblies can only reference other strong-named assemblies, causing FileLoadException at runtime.",
      "proposals": [
        {
          "title": "Bump GLWpfControl to 3.3.1",
          "description": "Change the PackageReference from OpenTK.GLWpfControl 3.3.0 to 3.3.1 in the net4* ItemGroup. Version 3.3.1 is strong-named. Community PR #3380 already implements this exact change.",
          "codeSnippet": "<PackageReference Include=\"OpenTK.GLWpfControl\" Version=\"3.3.1\" NoWarn=\"NU1701\" />",
          "confidence": 0.98,
          "effort": "trivial"
        },
        {
          "title": "Migrate to modern .NET",
          "description": "Users can work around the issue by targeting net6.0-windows or later instead of net48, which uses the OpenTK 4.x line (already strong-name compatible).",
          "confidence": 0.90,
          "effort": "medium"
        }
      ],
      "recommendedProposal": "Bump GLWpfControl to 3.3.1",
      "recommendedReason": "Trivial one-line version bump with zero risk. The upstream already fixed strong-naming in 3.3.1. PR #3380 from the reporter implements this exact change and should be reviewed and merged."
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "close-as-fixed",
      "confidence": 0.90,
      "reason": "The fix is trivial (one-line version bump) and a community PR #3380 already implements it. Review and merge the PR to resolve this."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Labels are already correct — type/bug, area/SkiaSharp.Views, os/Windows-Classic, tenet/compatibility",
        "risk": "low",
        "confidence": 0.98,
        "labels": ["type/bug", "area/SkiaSharp.Views", "os/Windows-Classic", "tenet/compatibility"]
      },
      {
        "type": "add-comment",
        "description": "Acknowledge the issue and point to PR #3380 as the fix",
        "risk": "high",
        "confidence": 0.92,
        "comment": "Thanks for the detailed report and the fix in #3380.\n\nYou're right — `OpenTK.GLWpfControl` 3.3.0 isn't strong-named, and since `SkiaSharp.Views.WPF` is strong-named for .NET Framework targets, the CLR rejects the unsigned dependency at load time. Bumping to 3.3.1 (which added strong-naming) is the correct fix.\n\nIn the meantime, if you need a workaround: targeting `net6.0-windows` or later avoids this entirely, since the modern .NET path uses OpenTK.GLWpfControl 4.x which doesn't have this issue."
      },
      {
        "type": "link-related",
        "description": "Link to community PR #3380 which implements the fix",
        "risk": "low",
        "confidence": 0.98,
        "linkedIssue": 3380
      }
    ]
  }
}
