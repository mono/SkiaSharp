{
  "meta": {
    "schemaVersion": "3.0",
    "number": 3402,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2025-07-24T12:00:00Z"
  },
  "summary": "Feature request for 1bpp, 2bpp, and 4bpp indexed color bitmap support to minimize memory for retro game tile graphics",
  "classification": {
    "type": {
      "value": "type/feature-request",
      "confidence": 0.95
    },
    "area": {
      "value": "area/SkiaSharp",
      "confidence": 0.9
    }
  },
  "evidence": {},
  "analysis": {
    "summary": "User requests sub-byte indexed color formats (1bpp, 2bpp, 4bpp) with native pixel operations for NES/SNES-style tile graphics in Avalonia UI. This requires functionality that upstream Skia explicitly removed (indexed color types) and would need significant new infrastructure.",
    "rationale": "type: User explicitly requests new functionality that does not exist in SkiaSharp. Uses the feature request template. No broken behavior described — this is entirely new capability. area: The request is for new pixel format types and drawing operations in the core SkiaSharp library (SKBitmap, SKColorType, pixel manipulation). Not views-specific or platform-specific. tenets: The entire motivation is memory efficiency — storing tile graphics in sub-byte formats to reduce memory from 15 GiB (32bpp) to 1.87 GiB (4bpp). Performance/memory is the core driver. actionability.suggestedAction: This is a valid feature request but requires upstream Skia support that was intentionally removed. It should remain open for maintainer consideration, but the probability of implementation is low given Skia's direction away from indexed colors.",
    "codeInvestigation": [],
    "nextQuestions": [
      "Whether the user specifically needs SkiaSharp integration or would accept a separate pixel buffer library for indexed formats",
      "Whether partial support (e.g., converting indexed bitmaps to/from SKBitmap) would satisfy the requirement versus full native operations on packed formats"
    ],
    "resolution": {
      "hypothesis": "User wants to build a retro game tile graphics system with sub-byte indexed color formats. Skia removed kIndex_8_SkColorType years ago and does not support sub-byte pixel formats natively. SkiaSharp cannot expose what Skia doesn't provide without building an entirely separate pixel processing layer.",
      "proposals": [
        {
          "description": "Store indexed color data in custom byte arrays and convert to 32bpp SKBitmap only when rendering. Keeps storage compact while using SkiaSharp for final display. User manages palette lookup in C# code.",
          "confidence": 0.75,
          "effort": "medium"
        },
        {
          "description": "SixLabors.ImageSharp supports indexed/paletted formats natively. Use it for pixel manipulation on indexed buffers, then convert to SKBitmap for Avalonia rendering. Combines strengths of both libraries.",
          "confidence": 0.7,
          "effort": "medium"
        },
        {
          "description": "Implement a lightweight PackedPixelBuffer class using Span<byte> for bitwise operations on 1/2/4bpp data. Convert to SKBitmap via SKBitmap.InstallPixels when rendering. No external dependencies.",
          "confidence": 0.65,
          "effort": "large"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "keep-open",
      "confidence": 0.75,
      "reason": "Valid feature request but requires upstream Skia support for indexed color types, which Skia intentionally removed. Low probability of implementation. Maintainer should decide whether to keep open or close as out-of-scope."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Add area and performance tenet labels",
        "risk": "low",
        "confidence": 0.9,
        "labels": [
          "area/SkiaSharp",
          "tenet/performance"
        ]
      },
      {
        "type": "add-comment",
        "description": "Post response explaining Skia's lack of indexed color support and suggesting workarounds",
        "risk": "high",
        "confidence": 0.8
      }
    ]
  }
}
