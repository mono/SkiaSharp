{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3346,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2025-09-08T00:00:00Z"
  },
  "summary": "MAUI app crashes on Windows ARM64 when published as MSIX; installing VC++ Redistributable resolves it",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.95
    },
    "area": {
      "value": "area/libSkiaSharp.native",
      "confidence": 0.85
    },
    "platforms": [
      "os/Windows-Classic"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "stepsToReproduce": [
        "Clone https://github.com/riccardomartins/ArmDemoTryout",
        "Open in Visual Studio on a Windows ARM64 machine",
        "Build and run in Debug or Release mode — works fine",
        "Publish the app as MSIX for Windows ARM64",
        "Run the published executable on a fresh ARM64 Windows machine without VC++ Redistributable installed",
        "App starts and crashes immediately"
      ],
      "environmentDetails": "Windows 10 and 11 ARM64, Visual Studio (Windows), SkiaSharp 3.116.0 (reported) / 3.119.0 (in repro csproj), .NET 9, MSIX packaging",
      "codeSnippets": [
        "xml: <PackageReference Include=\"SkiaSharp.Views.Maui.Controls\" Version=\"3.119.0\" />\n<PackageReference Include=\"Svg.Skia\" Version=\"3.0.6\" />"
      ]
    },
    "bugSignals": {
      "severity": "medium",
      "errorType": "crash"
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.116.0",
        "3.119.0"
      ]
    }
  },
  "analysis": {
    "summary": "A .NET MAUI app using SkiaSharp crashes on Windows ARM64 when published as MSIX, but works in Debug/Release modes. The reporter discovered that installing VC++ Redistributable resolves the crash, indicating the native binaries have a dynamic C++ runtime dependency not satisfied on fresh ARM64 deployments. The repro uses CPU rendering (SKCanvasView), so the maintainer's in-progress GPU fix may not fully address this.",
    "rationale": "type: Reporter describes an app crash on published ARM64 builds. This is clearly broken behavior — a published app should not crash on a supported platform. Debug/Release builds work fine, confirming it's a deployment issue, not user error. area: The crash is resolved by installing VC++ Redistributable, which points to the native binary build configuration. Either libSkiaSharp.dll ARM64 or the ANGLE libraries from NativeAssets.WinUI are dynamically linking the C++ runtime instead of statically linking it. The skia-patterns.md reference confirms this as a known pattern. bugSignals.severity: Hard crash preventing the app from starting is severe, but a straightforward workaround exists (install VC++ Redistributable) and the affected audience is narrow (ARM64 Windows published deployments only). partner: The repro is a MAUI app with MSIX packaging. The ANGLE libraries from NativeAssets.WinUI are part of the MAUI/WinUI rendering pipeline and may contribute to the VC++ dependency. actionability.suggestedAction: The VC++ Redistributable dependency on ARM64 needs investigation. Is it libSkiaSharp.dll or the ANGLE libraries? Was static linking intentionally omitted for ARM64? Static CRT linking was fixed for x86/x64 in issue #136 but may not cover ARM64. platforms: The crash occurs on Windows ARM64 when deploying a MAUI app as MSIX. The label reflects the Windows desktop deployment target where the VC++ runtime dependency manifests. tenets: The app crashes immediately on launch when published to ARM64 Windows without VC++ Redistributable. A hard crash preventing any app functionality is a core reliability issue. fixStatus.likelyFixed: The maintainer mentioned an in-progress GPU fix, but the repro uses CPU rendering (SKCanvasView). The VC++ dependency suggests a native build config issue requiring separate attention. versionAnalysis.currentRelevance: Reported on 3.116.0 and reproduced with 3.119.0, indicating the ARM64 VC++ runtime dependency persists across recent versions a",
    "codeInvestigation": [],
    "workarounds": [
      "Install Microsoft Visual C++ Redistributable on the target ARM64 Windows machine before running the published app."
    ],
    "nextQuestions": [
      "Whether the crash is in libSkiaSharp.dll or the ANGLE libraries (libEGL.dll/libGLESv2.dll) from NativeAssets.WinUI — both could require VC++ runtime",
      "Whether the maintainer's in-progress GPU fix also addresses the VC++ runtime linking for CPU rendering scenarios",
      "The reporter says version 3.116.0 but the repro csproj shows 3.119.0 — unclear if the version discrepancy matters"
    ],
    "resolution": {
      "hypothesis": "The ARM64 Windows build of libSkiaSharp.dll (or the ANGLE libraries from NativeAssets.WinUI) dynamically links the C++ runtime instead of statically linking it. When deployed via MSIX to a fresh ARM64 system, the C++ runtime isn't present, causing an immediate crash. Debug/Release from VS works because VS installs the VC++ runtime.",
      "proposals": [
        {
          "description": "Update the native build configuration to statically link the C++ runtime (/MT instead of /MD) for the ARM64 Windows target, matching what was done for x86/x64 in issue #136 (v1.68.0). This eliminates the dependency for all users.",
          "confidence": 0.8,
          "effort": "medium"
        },
        {
          "description": "Configure the MSIX packaging to include the VC++ Redistributable merge modules or declare a dependency on the VC++ runtime framework package. Doesn't require rebuilding native libraries but pushes the fix to app developers.",
          "confidence": 0.6,
          "effort": "small"
        },
        {
          "description": "Document that ARM64 Windows deployments require the VC++ Redistributable, and recommend including it in deployment scripts or installation prerequisites. Immediate workaround for affected users.",
          "confidence": 0.9,
          "effort": "small"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.85,
      "reason": "The VC++ Redistributable dependency on ARM64 Windows suggests the native library is not statically linking the C++ runtime for ARM64 builds. This was fixed for x86/x64 in issue #136 but may not have been applied to ARM64. The repro uses CPU rendering, so the maintainer's GPU fix may not fully address this."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Add area/libSkiaSharp.native and partner/maui labels",
        "risk": "low",
        "confidence": 0.85,
        "labels": [
          "area/libSkiaSharp.native",
          "partner/maui"
        ]
      },
      {
        "type": "link-related",
        "description": "Cross-reference related ARM64 and CRT linking issues",
        "risk": "low",
        "confidence": 0.8
      },
      {
        "type": "add-comment",
        "description": "Acknowledge workaround and explain the ARM64 VC++ dependency",
        "risk": "high",
        "confidence": 0.75
      }
    ]
  }
}
