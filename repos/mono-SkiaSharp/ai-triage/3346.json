{
  "meta": {
    "schemaVersion": "2.0",
    "number": 3346,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2025-09-08T00:00:00Z",
    "currentLabels": [
      "type/bug",
      "os/Windows-Classic",
      "tenet/reliability"
    ]
  },
  "summary": "MAUI app crashes on Windows ARM64 when published as MSIX; installing VC++ Redistributable resolves it",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.95
    },
    "area": {
      "value": "area/libSkiaSharp.native",
      "confidence": 0.85
    },
    "backends": null,
    "platforms": [
      {
        "value": "os/Windows-Classic",
        "confidence": 0.95
      }
    ],
    "tenets": [
      {
        "value": "tenet/reliability",
        "confidence": 0.95
      }
    ],
    "partner": {
      "value": "partner/maui",
      "confidence": 0.75
    }
  },
  "evidence": {
    "bugSignals": {
      "hasCrash": true,
      "hasStackTrace": false,
      "reproQuality": "complete",
      "hasWorkaround": true,
      "workaroundSummary": "Install Microsoft Visual C++ Redistributable on the target ARM64 Windows machine before running the published app.",
      "targetFrameworks": [
        "net9.0-windows10.0.19041.0"
      ],
      "severity": "medium",
      "severityReason": "Crash on published builds is severe (app won't start), but a workaround exists (install VC++ Redistributable) and the affected audience is narrow (ARM64 Windows published deployments only)."
    },
    "reproEvidence": {
      "repoLinks": [
        {
          "url": "https://github.com/riccardomartins/ArmDemoTryout",
          "description": ".NET MAUI app demonstrating the ARM64 Windows crash. Uses SkiaSharp.Views.Maui.Controls 3.119.0 and Svg.Skia 3.0.6 with MSIX packaging."
        }
      ],
      "relatedIssues": [
        3155,
        136
      ],
      "stepsToReproduce": [
        "Clone https://github.com/riccardomartins/ArmDemoTryout",
        "Open in Visual Studio on a Windows ARM64 machine",
        "Build and run in Debug or Release mode \u2014 works fine",
        "Publish the app as MSIX for Windows ARM64",
        "Run the published executable on a fresh ARM64 Windows machine without VC++ Redistributable installed",
        "App starts and crashes immediately"
      ],
      "codeSnippets": [
        {
          "language": "xml",
          "code": "<PackageReference Include=\"SkiaSharp.Views.Maui.Controls\" Version=\"3.119.0\" />\n<PackageReference Include=\"Svg.Skia\" Version=\"3.0.6\" />",
          "context": "Project dependencies from the repro csproj. Uses MAUI with MSIX packaging (WindowsPackageType=MSIX)."
        }
      ],
      "environmentDetails": "Windows 10 and 11 ARM64, Visual Studio (Windows), SkiaSharp 3.116.0 (reported) / 3.119.0 (in repro csproj), .NET 9, MSIX packaging"
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.116.0",
        "3.119.0"
      ],
      "currentRelevance": "likely",
      "reason": "Issue reported against 3.116.0 but repro project references 3.119.0, indicating it persists across recent versions. The VC++ Redistributable dependency on ARM64 is a build configuration issue that likely still exists."
    },
    "regression": null,
    "fixStatus": {
      "likelyFixed": false,
      "confidence": 0.55,
      "reason": "Maintainer mattleibow asked if GPU rendering was being used, noting 'I am trying to release a fix for that'. However, the repro uses SKCanvasView (CPU rendering), so the GPU fix may not fully address this issue. The VC++ Redistributable dependency suggests a native build configuration issue that may require separate attention."
    }
  },
  "analysis": {
    "summary": "A .NET MAUI app using SkiaSharp crashes on Windows ARM64 when published as MSIX, but works in Debug/Release modes. The reporter discovered that installing VC++ Redistributable resolves the crash, indicating the native binaries have a dynamic C++ runtime dependency not satisfied on fresh ARM64 deployments. The repro uses CPU rendering (SKCanvasView), so the maintainer's in-progress GPU fix may not fully address this.",
    "keySignals": [
      {
        "text": "installing Microsoft Visual C++ Redistributable that app works correctly in a fresh arm64 windows",
        "source": "comment 2",
        "interpretation": "The native binary (libSkiaSharp.dll or ANGLE libraries) dynamically links to the C++ runtime rather than statically linking it. This is the root cause of the crash on fresh ARM64 systems."
      },
      {
        "text": "runs correctly in Debug and Release modes on Windows ARM64, but when creating a Publish build for Windows ARM64, the app starts but crashes immediately",
        "source": "body",
        "interpretation": "Debug/Release work because Visual Studio installs VC++ runtime. Published MSIX on a fresh system lacks it. The difference is deployment context, not code."
      },
      {
        "text": "Were you using the GPU rendering? If so, I am trying to release a fix for that.",
        "source": "comment 3",
        "interpretation": "Maintainer is aware of a related ARM64 GPU issue and has a fix in progress. However, the repro uses SKCanvasView (CPU), so the GPU fix may not fully resolve this."
      }
    ],
    "fieldRationales": [
      {
        "field": "type",
        "chosen": "type/bug",
        "expandedReason": "Reporter describes an app crash on published ARM64 builds. This is clearly broken behavior \u2014 a published app should not crash on a supported platform. Debug/Release builds work fine, confirming it's a deployment issue, not user error.",
        "alternatives": [
          {
            "value": "type/question",
            "whyRejected": "Not asking how to do something \u2014 reporting a crash with clear expected vs actual behavior and a repro project."
          }
        ]
      },
      {
        "field": "area",
        "chosen": "area/libSkiaSharp.native",
        "expandedReason": "The crash is resolved by installing VC++ Redistributable, which points to the native binary build configuration. Either libSkiaSharp.dll ARM64 or the ANGLE libraries from NativeAssets.WinUI are dynamically linking the C++ runtime instead of statically linking it. The skia-patterns.md reference confirms this as a known pattern.",
        "alternatives": [
          {
            "value": "area/SkiaSharp.Views.Maui",
            "whyRejected": "While the repro uses MAUI, the root cause is in the native binary packaging, not the managed MAUI view layer."
          },
          {
            "value": "area/Build",
            "whyRejected": "Build area would suggest a build system issue, but this is specifically about native library linking configuration for ARM64."
          }
        ]
      },
      {
        "field": "bugSignals.severity",
        "chosen": "medium",
        "expandedReason": "Hard crash preventing the app from starting is severe, but a straightforward workaround exists (install VC++ Redistributable) and the affected audience is narrow (ARM64 Windows published deployments only).",
        "alternatives": [
          {
            "value": "high",
            "whyRejected": "A workaround exists (VC++ Redistributable installation), which lowers severity from high to medium."
          },
          {
            "value": "low",
            "whyRejected": "An app crash preventing all functionality is more than cosmetic/minor, even with a workaround."
          }
        ]
      },
      {
        "field": "partner",
        "chosen": "partner/maui",
        "expandedReason": "The repro is a MAUI app with MSIX packaging. The ANGLE libraries from NativeAssets.WinUI are part of the MAUI/WinUI rendering pipeline and may contribute to the VC++ dependency."
      },
      {
        "field": "actionability.suggestedAction",
        "chosen": "needs-investigation",
        "expandedReason": "The VC++ Redistributable dependency on ARM64 needs investigation. Is it libSkiaSharp.dll or the ANGLE libraries? Was static linking intentionally omitted for ARM64? Static CRT linking was fixed for x86/x64 in issue #136 but may not cover ARM64.",
        "alternatives": [
          {
            "value": "request-info",
            "whyRejected": "The reporter provided a full repro project and identified the root cause (VC++ Redistributable). There's enough info to investigate without additional reporter input."
          },
          {
            "value": "close-as-fixed",
            "whyRejected": "No fix has been released. The maintainer mentioned a fix in progress but hasn't confirmed it addresses this specific issue."
          }
        ]
      },
      {
        "field": "platforms",
        "chosen": "os/Windows-Classic",
        "expandedReason": "The crash occurs on Windows ARM64 when deploying a MAUI app as MSIX. The label reflects the Windows desktop deployment target where the VC++ runtime dependency manifests.",
        "alternatives": [
          {
            "value": "os/Windows-WinUI",
            "whyRejected": "While MAUI uses WinUI under the hood, the deployment issue is about the native binary on Windows desktop ARM64, not WinUI-specific behavior."
          }
        ]
      },
      {
        "field": "tenets",
        "chosen": "tenet/reliability",
        "expandedReason": "The app crashes immediately on launch when published to ARM64 Windows without VC++ Redistributable. A hard crash preventing any app functionality is a core reliability issue.",
        "alternatives": [
          {
            "value": "tenet/compatibility",
            "whyRejected": "While there is a platform-specific aspect (ARM64 vs x64), the primary concern is that the published app crashes rather than a cross-version compatibility gap."
          }
        ]
      },
      {
        "field": "fixStatus.likelyFixed",
        "chosen": "false",
        "expandedReason": "The maintainer mentioned an in-progress GPU fix, but the repro uses CPU rendering (SKCanvasView). The VC++ dependency suggests a native build config issue requiring separate attention."
      },
      {
        "field": "versionAnalysis.currentRelevance",
        "chosen": "likely",
        "expandedReason": "Reported on 3.116.0 and reproduced with 3.119.0, indicating the ARM64 VC++ runtime dependency persists across recent versions and likely remains unfixed.",
        "alternatives": [
          {
            "value": "unlikely",
            "whyRejected": "No evidence the static CRT linking was applied to ARM64 builds, so the issue likely persists in current releases."
          }
        ]
      }
    ],
    "uncertainties": [
      "Whether the crash is in libSkiaSharp.dll or the ANGLE libraries (libEGL.dll/libGLESv2.dll) from NativeAssets.WinUI \u2014 both could require VC++ runtime",
      "Whether the maintainer's in-progress GPU fix also addresses the VC++ runtime linking for CPU rendering scenarios",
      "The reporter says version 3.116.0 but the repro csproj shows 3.119.0 \u2014 unclear if the version discrepancy matters"
    ],
    "assumptions": [
      "Assumed the SKCanvasView usage in the repro code represents the reporter's actual usage pattern, making this a CPU rendering issue not a GPU one",
      "Assumed the ARM64 native build configuration is the root cause since the same app works in Debug/Release (where VC++ runtime is available from VS)"
    ],
    "resolution": {
      "hypothesis": "The ARM64 Windows build of libSkiaSharp.dll (or the ANGLE libraries from NativeAssets.WinUI) dynamically links the C++ runtime instead of statically linking it. When deployed via MSIX to a fresh ARM64 system, the C++ runtime isn't present, causing an immediate crash. Debug/Release from VS works because VS installs the VC++ runtime.",
      "proposals": [
        {
          "title": "Statically link C++ runtime for ARM64 Windows builds",
          "description": "Update the native build configuration to statically link the C++ runtime (/MT instead of /MD) for the ARM64 Windows target, matching what was done for x86/x64 in issue #136 (v1.68.0). This eliminates the dependency for all users.",
          "confidence": 0.8,
          "effort": "medium"
        },
        {
          "title": "Include VC++ Redistributable in MSIX package",
          "description": "Configure the MSIX packaging to include the VC++ Redistributable merge modules or declare a dependency on the VC++ runtime framework package. Doesn't require rebuilding native libraries but pushes the fix to app developers.",
          "confidence": 0.6,
          "effort": "low"
        },
        {
          "title": "Document VC++ Redistributable requirement for ARM64",
          "description": "Document that ARM64 Windows deployments require the VC++ Redistributable, and recommend including it in deployment scripts or installation prerequisites. Immediate workaround for affected users.",
          "confidence": 0.9,
          "effort": "low"
        }
      ],
      "recommendedProposal": "Statically link C++ runtime for ARM64 Windows builds",
      "recommendedReason": "This is the proper fix that eliminates the dependency for all users. It's consistent with how x86/x64 builds were fixed in issue #136 and ensures ARM64 published apps work without additional prerequisites."
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.85,
      "reason": "The VC++ Redistributable dependency on ARM64 Windows suggests the native library is not statically linking the C++ runtime for ARM64 builds. This was fixed for x86/x64 in issue #136 but may not have been applied to ARM64. The repro uses CPU rendering, so the maintainer's GPU fix may not fully address this."
    },
    "actions": [
      {
        "id": "labels-1",
        "type": "update-labels",
        "risk": "low",
        "description": "Add area/libSkiaSharp.native and partner/maui labels",
        "reason": "Crash caused by missing VC++ Redistributable is a native library deployment issue. Repro is a MAUI app with MSIX packaging.",
        "confidence": 0.85,
        "dependsOn": null,
        "payload": {
          "labelsToAdd": [
            "area/libSkiaSharp.native",
            "partner/maui"
          ],
          "labelsToRemove": []
        }
      },
      {
        "id": "related-1",
        "type": "link-related",
        "risk": "low",
        "description": "Cross-reference related ARM64 and CRT linking issues",
        "reason": "Issue #3155 is a related ARM64 Windows GPU issue. Issue #136 is where static CRT linking was implemented for x86/x64 \u2014 the same fix may need to be applied for ARM64.",
        "confidence": 0.8,
        "dependsOn": null,
        "payload": {
          "relatedIssues": [
            3155,
            136
          ],
          "comment": null
        }
      },
      {
        "id": "comment-1",
        "type": "add-comment",
        "risk": "high",
        "description": "Acknowledge workaround and explain the ARM64 VC++ dependency",
        "reason": "Reporter found a workaround but asked if it's expected. The maintainer's GPU question is also unanswered. A response would clarify the situation and provide context.",
        "confidence": 0.75,
        "dependsOn": "labels-1",
        "payload": {
          "commentType": "answer",
          "draftBody": "Thanks for tracking that down \u2014 the VC++ Redistributable dependency is a really useful finding.\n\nTo answer your question: ideally, no, you shouldn't need to install the VC++ Redistributable separately. The native libraries should either statically link the C++ runtime or the MSIX package should include it.\n\nThis looks like it could be specific to the ARM64 build of the native libraries \u2014 the x64 builds have had static C++ runtime linking since v1.68.0, but the ARM64 build may not have the same configuration.\n\nLooking at your repro code, it appears you're using `SKCanvasView` (CPU rendering). Would you be able to confirm? That would help clarify whether the GPU rendering fix @mattleibow mentioned would also cover this scenario.",
          "requiresHumanEdit": true,
          "finalBody": null,
          "dedupeToken": "triage-3346-comment-1"
        }
      }
    ]
  }
}
