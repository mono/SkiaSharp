{
  "meta": {
    "schemaVersion": "3.0",
    "number": 607,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2025-07-22T12:00:00Z"
  },
  "summary": "SKTouchAction.Entered and Exited events are never fired on iOS/Android — only implemented on Windows (UWP/WinUI) and Tizen",
  "classification": {
    "type": {
      "value": "type/feature-request",
      "confidence": 0.8
    },
    "area": {
      "value": "area/views",
      "confidence": 0.92
    },
    "platforms": [
      "os/iOS",
      "os/Android"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "codeSnippets": [
        "csharp: var touchType = e.ActionType;\nvar touchpt = e.Location.ToFormsPoint();\nvar viewScale = 2.0;\nvar touchIsInside = !(touchpt.X < 0 || touchpt.Y < 0 || touchpt.X > Bounds.Width * viewScale || touchpt.Y > Bounds.Height * viewScale);\nif (touchType.Equals(SKTouchAction.Moved) && TouchesAreInside != touchIsInside &&\n    Device.RuntimePlatform.Equals(Device.iOS) || Device.RuntimePlatform.Equals(Device.Android))\n{\n    if (TouchesAreInside)\n    {\n        TouchesAreInside = false;\n        touchType = SKTouchAction.Exited;\n    }\n    else\n    {\n        TouchesAreInside = true;\n        touchType = SKTouchAction.Entered;\n    }\n}"
      ]
    }
  },
  "analysis": {
    "summary": "The SKTouchAction enum defines Entered and Exited values, but the Android and Apple (iOS) SKTouchHandler implementations never fire them. Windows wires PointerEntered/PointerExited events, and Tizen maps PointStateType.Leave to Exited. The original issue requests parity: iOS and Android should synthesize enter/exit from touch-move events by checking if the touch is inside view bounds. The reporter also noted a coordinate-scaling bug when doing manual bounds checks. Maintainer mattleibow acknowledged this as future work in Dec 2018.",
    "rationale": "type: The Entered/Exited events were never implemented on iOS/Android — this is a missing feature, not broken behavior. The enum values exist but the platform handlers never emit them. Reporter explicitly titled this 'Feature Request'. area: SKTouchHandler is part of the SkiaSharp.Views layer (platform-specific touch handling for SKCanvasView). The Maui equivalent is in SkiaSharp.Views.Maui.Core but the area label covers both. platforms: Reporter specifically identifies iOS and Android as the platforms missing Entered/Exited support. Windows/UWP works. Code investigation confirms the gap is in the Android and Apple platform handlers. tenets: The core issue is cross-platform inconsistency — the same SKTouchAction enum values produce events on Windows but are silently ignored on iOS/Android. versionAnalysis.currentRelevance: Code investigation of current MAUI-era handlers confirms the gap persists. Android and Apple SKTouchHandler still do not emit Entered/Exited. actionability.suggestedAction: The feature request is valid and acknowledged by the maintainer. The gap persists in current code. No fix has been applied.",
    "codeInvestigation": [
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/SKTouchEventArgs.cs",
        "lines": "60-69",
        "finding": "SKTouchAction enum defines Entered (line 62) and Exited (line 67) values — these are part of the public API surface but only partially implemented across platforms",
        "relevance": "related"
      },
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Platform/Android/SKTouchHandler.cs",
        "lines": "63-109",
        "finding": "Android OnTouch switch handles Down/PointerDown, Move, Up/PointerUp, Cancel — no case for Entered or Exited. The MotionEventActions enum doesn't have direct equivalents; synthesis from Move events would be needed.",
        "relevance": "related"
      },
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Platform/Apple/SKTouchHandler.cs",
        "lines": "54-95",
        "finding": "Apple handler overrides TouchesBegan/Moved/Ended/Cancelled — no support for enter/exit. UIKit doesn't have direct touch enter/exit events; would need bounds-checking during TouchesMoved.",
        "relevance": "related"
      },
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Platform/Windows/SKTouchHandler.cs",
        "lines": "29-66",
        "finding": "Windows handler wires PointerEntered/PointerExited and maps them to SKTouchAction.Entered/Exited — confirms this IS implemented on Windows/WinUI.",
        "relevance": "related"
      },
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Platform/Tizen/SKTouchHandler.cs",
        "lines": "65-73",
        "finding": "Tizen maps PointStateType.Leave to SKTouchAction.Exited — partial support exists on Tizen too, but no Entered mapping.",
        "relevance": "related"
      }
    ],
    "nextQuestions": [
      "Whether Android's HoverListener (MotionEventActions.HoverEnter/HoverExit) should be used instead of synthesizing from Move events — hover events are mouse/stylus-specific, not touch",
      "Whether the coordinate-scaling issue reported in comment 3 is a separate bug or specific to the reporter's workaround approach",
      "Whether macOS (non-touch, mouse-based) should also get Entered/Exited support via NSTrackingArea"
    ],
    "resolution": {
      "hypothesis": "iOS and Android SKTouchHandler implementations need to synthesize Entered/Exited events. On Android, this can be done by tracking whether the touch is inside view bounds during Move events. On iOS, bounds-checking during TouchesMoved achieves the same. For mouse/stylus, Android's HoverListener provides native enter/exit events.",
      "proposals": [
        {
          "description": "During touch Move events, check if the touch position has crossed the view bounds. Track an isInside boolean per pointer ID and fire Entered/Exited when the state changes. This matches the reporter's pseudocode and provides parity with Windows behavior for touch input.",
          "confidence": 0.75,
          "effort": "medium"
        },
        {
          "description": "On Android, use View.setOnHoverListener to capture MotionEventActions.HoverEnter and HoverExit for mouse and stylus devices. This provides native enter/exit for non-touch inputs without synthesis.",
          "confidence": 0.7,
          "effort": "medium"
        },
        {
          "description": "Track touch state manually in the Touch event callback by checking if Location is within the view bounds during Moved events. Reporter provided working code (with scaling hack). This works today without SkiaSharp changes.",
          "confidence": 0.8,
          "effort": "small"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "keep-open",
      "confidence": 0.88,
      "reason": "Valid feature request acknowledged by maintainer. Gap confirmed in current MAUI codebase. No fix has been applied."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Apply feature-request, views, iOS, Android, compatibility labels; remove redundant enhancement",
        "risk": "low",
        "confidence": 0.88,
        "labels": [
          "type/feature-request",
          "area/SkiaSharp.Views",
          "os/iOS",
          "os/Android",
          "tenet/compatibility"
        ]
      },
      {
        "type": "link-related",
        "description": "Cross-reference related touch issues #471 and #1048",
        "risk": "low",
        "confidence": 0.8
      },
      {
        "type": "add-comment",
        "description": "Post analysis confirming the gap still exists in MAUI and provide workaround",
        "risk": "high",
        "confidence": 0.82
      }
    ]
  }
}
