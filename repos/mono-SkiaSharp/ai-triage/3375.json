{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3375,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-08T15:00:00Z"
  },
  "summary": "SkiaSharp 3.116+ crashes on Windows x86 (.NET 8/9) with stack overflow at P/Invoke boundary; works on x64 and on older v2.88.9",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.97
    },
    "area": {
      "value": "area/libSkiaSharp.native",
      "confidence": 0.85
    },
    "platforms": [
      "os/Windows-Classic"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "stepsToReproduce": [
        "Create a .NET 8 or 9 application referencing SkiaSharp 3.116+ (or 3.119.1)",
        "Compile and publish for x86 (win-x86)",
        "Run the application on Windows and invoke any SkiaSharp API (e.g., sk_bitmap_get_pixel_color)",
        "Observe stack overflow crash"
      ],
      "environmentDetails": "Windows 11 Pro (ARM CPU) 23H2 build 22631; also reproduced on standard x86 Windows with .NET 8.0"
    },
    "bugSignals": {
      "severity": "high",
      "errorType": "crash",
      "isRegression": true
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.116.0",
        "3.119.1",
        "2.88.9"
      ]
    }
  },
  "analysis": {
    "summary": "Two independent reporters confirm SkiaSharp 3.x crashes on x86 Windows with .NET 8/9. The second reporter's stack trace shows a stack overflow originating at the P/Invoke boundary (sk_bitmap_get_pixel_color), which strongly suggests a calling convention mismatch in the x86 native binary or P/Invoke declarations. The issue does not affect x64, and the second reporter confirms x86 works under .NET Framework 4.7.2, pointing to an interaction between the new .NET runtime's x86 marshalling and SkiaSharp 3.x's native layer.",
    "rationale": "type: Application crashes with stack overflow when using SkiaSharp on x86. This is clearly broken behavior — a hard crash, not a usage question or feature request. area: The crash occurs at the P/Invoke boundary to the native library. The stack overflow at sk_bitmap_get_pixel_color indicates the native binary or its calling convention is the root cause, not the managed C# wrapper. The DLL loading path workaround also points to native binary issues. bugSignals.severity: Hard crash (stack overflow) with no clean workaround — all workarounds require significant changes (switch architecture, restructure DLL deployment, or downgrade to v2). Two independent reporters confirm the issue. regression: Explicitly stated: v2.88.9 works on x86, v3.116.0+ does not. The v2-to-v3 native library restructuring is the likely point where x86 support broke. actionability.suggestedAction: Two reporters confirm the x86 crash with stack trace evidence, but root cause (calling convention mismatch vs native build issue) needs code inspection of P/Invoke declarations and native build config. platforms: Both reporters are on Windows, and the crash is specific to x86 P/Invoke calling conventions on Windows. No other platforms mentioned or affected. tenets: Reliability: hard crash (stack overflow) with no managed exception handling. Compatibility: regression from v2.88.9 to v3.116.0+ breaking existing x86 deployments. regression.isRegression: Reporter explicitly states v2.88.9 works on x86 while v3.116.0+ crashes. Second reporter confirms x86 works under .NET Framework 4.7.2, pointing to a v2-to-v3 regression in native library structure. versionAnalysis.currentRelevance: Issue reported against 3.116.0 and confirmed still present in 3.119.1, with no indication of a fix in subsequent releases.",
    "codeInvestigation": [],
    "workarounds": [
      "Use x64 instead of x86, copy native DLLs to application root directory, or downgrade to SkiaSharp 2.88.9"
    ],
    "nextQuestions": [
      "Whether the root cause is a calling convention mismatch in P/Invoke declarations or in the native binary compilation",
      "Whether the issue is specific to Windows on ARM (original reporter) or affects all Windows x86 scenarios",
      "Whether the DLL-copy workaround from the first reporter applies to the second reporter's scenario (they say it doesn't help)",
      "Whether this affects all SkiaSharp APIs or only specific P/Invoke calls"
    ],
    "resolution": {
      "hypothesis": "SkiaSharp 3.x native binaries or P/Invoke declarations have a calling convention mismatch on x86. On x86 Windows, cdecl and stdcall differ in stack cleanup responsibility. If the native library uses cdecl but the P/Invoke declaration defaults to stdcall (or vice versa), each call leaks stack space, leading to stack overflow. .NET 8+ may have changed default marshalling behavior that surfaces this issue where .NET Framework 4.7.2 tolerated it.",
      "proposals": [
        {
          "description": "Review all DllImport/LibraryImport declarations in SkiaSharp for explicit CallingConvention specification. Ensure they match the native library's actual calling convention (likely cdecl). On x86, mismatched conventions cause stack corruption on every call.",
          "confidence": 0.7,
          "effort": "medium"
        },
        {
          "description": "Check the build configuration for win-x86 native binaries to ensure correct calling convention (__cdecl vs __stdcall) is specified consistently. The v2-to-v3 build system change may have altered defaults.",
          "confidence": 0.65,
          "effort": "medium"
        },
        {
          "description": "As a diagnostic step, use NativeLibrary.SetDllImportResolver to control exactly which native binary is loaded on x86. This would help isolate whether the issue is DLL resolution (wrong binary loaded) or a genuine calling convention problem.",
          "confidence": 0.5,
          "effort": "small"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.85,
      "reason": "Real bug confirmed by two reporters with stack trace evidence. Root cause hypothesis is strong but needs verification through code inspection of P/Invoke declarations and native build configuration for x86."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Update area label to libSkiaSharp.native and add compatibility tenet",
        "risk": "low",
        "confidence": 0.85,
        "labels": [
          "area/libSkiaSharp.native",
          "tenet/compatibility"
        ]
      },
      {
        "type": "add-comment",
        "description": "Post analysis acknowledging the bug and asking for a minimal repro project",
        "risk": "high",
        "confidence": 0.8
      }
    ]
  }
}
