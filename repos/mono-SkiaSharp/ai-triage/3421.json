{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3421,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T13:15:49Z",
    "currentLabels": [
      "type/bug",
      "os/Windows-Classic",
      "area/SkiaSharp",
      "tenet/reliability"
    ]
  },
  "summary": "User reports that calling SkiaSharp.Skottie.Animation.Create() with a .lottie file path returns null silently. The .lottie format is a ZIP-based container (dotLottie), not raw Lottie JSON. Skottie's parser expects JSON input, so a ZIP file fails to parse and returns null by design. The user needs to either download the .json format from LottieFiles or extract the JSON from the .lottie ZIP archive before passing it to the API.",
  "classification": {
    "type": {
      "value": "type/question",
      "confidence": 0.85
    },
    "area": {
      "value": "area/SkiaSharp",
      "confidence": 0.95
    },
    "platforms": [
      "os/Windows-Classic"
    ],
    "tenets": [
      "tenet/reliability"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "stepsToReproduce": [
        "Download a .lottie file from LottieFiles (ZIP-based dotLottie format)",
        "Call SkiaSharp.Skottie.Animation.Create(sourceFileAbsolute) with the .lottie file path",
        "Observe that the returned animation is null"
      ],
      "codeSnippets": [
        "var animation = SkiaSharp.Skottie.Animation.Create(sourceFileAbsolute);"
      ],
      "screenshots": [
        {
          "url": "https://github.com/user-attachments/assets/9ca27c18-536b-4403-a41d-44e907329001",
          "description": "LottieFiles download page showing the .lottie file"
        },
        {
          "url": "https://github.com/user-attachments/assets/0fe1691c-82ee-462a-a110-f53b0682833f",
          "description": "Debug output showing null animation result"
        }
      ],
      "environmentDetails": "Windows 11 Desktop, Visual Studio (Windows), SkiaSharp 3.116.0"
    },
    "bugSignals": {
      "severity": "medium",
      "isRegression": false,
      "reproQuality": "partial",
      "targetFrameworks": []
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.116.0"
      ],
      "currentRelevance": "likely",
      "relevanceReason": "The issue is about the .lottie (dotLottie ZIP) format not being supported by Skottie's JSON parser. This is a format limitation, not a version-specific bug, so it applies to all versions including current."
    }
  },
  "analysis": {
    "summary": "The root cause is a file format mismatch. The .lottie file format (dotLottie) is a ZIP archive containing a Lottie JSON animation and optional assets. Skia's Skottie parser (skottie::Animation::Make) expects raw JSON data. When a ZIP file is passed, the parser fails and returns nullptr, which SkiaSharp surfaces as null. This is not a bug in SkiaSharp \u2014 the API is working as designed. The user needs to use the .json format instead of .lottie, or extract the JSON from the ZIP archive.",
    "rationale": "Classified as type/question rather than type/bug because Animation.Create() is functioning correctly \u2014 it parses Lottie JSON, and .lottie (dotLottie) is a different ZIP-based format that requires extraction before parsing. The area is area/SkiaSharp as this involves the Skottie C# binding. The tenet/reliability label is retained because silent null returns without error messaging are a usability concern worth tracking.",
    "keySignals": [
      {
        "text": "Loading a .lottie file results in null Animation",
        "source": "issue title",
        "interpretation": "The .lottie extension is critical \u2014 this is a dotLottie ZIP container, not a Lottie JSON file. The parser correctly rejects non-JSON input."
      },
      {
        "text": "var animation = SkiaSharp.Skottie.Animation.Create(sourceFileAbsolute);",
        "source": "issue body code snippet",
        "interpretation": "The string path overload reads raw bytes and passes to skottie::Animation::Make which expects JSON. No format detection or ZIP extraction occurs."
      },
      {
        "text": "No exception is thrown, so it fails silently",
        "source": "issue body description",
        "interpretation": "This is by design \u2014 factory methods return null on failure per SkiaSharp conventions. However, silent failure on format mismatch is a usability gap."
      },
      {
        "text": "https://app.lottiefiles.com/animation/5b206184-3c40-4a29-a6c4-0f62df06e4a8",
        "source": "issue body",
        "interpretation": "LottieFiles offers both .json (Lottie JSON) and .lottie (dotLottie ZIP) download formats. User downloaded the .lottie variant."
      }
    ],
    "codeInvestigation": [
      {
        "file": "binding/SkiaSharp.Skottie/Animation.cs",
        "lines": "91-102",
        "finding": "Animation.Create(string path) reads file via SKData.Create(path) then calls TryCreate(SKData) which passes raw bytes to skottie_animation_make_from_data. No file extension checking or format detection is performed.",
        "relevance": "direct"
      },
      {
        "file": "binding/SkiaSharp.Skottie/Animation.cs",
        "lines": "77-89",
        "finding": "TryCreate(SKData) strips BOM preamble then passes raw bytes to the native parser. A ZIP file (PK header 0x504B) would not match any BOM pattern and would be passed as-is to Skia's JSON parser, which would fail.",
        "relevance": "direct"
      },
      {
        "file": "externals/skia/src/c/skottie_animation.cpp",
        "lines": "24-26",
        "finding": "skottie_animation_make_from_data calls skottie::Animation::Make(data, length) which parses JSON. Returns nullptr if parsing fails \u2014 no exception, no error message.",
        "relevance": "direct"
      },
      {
        "file": "binding/SkiaSharp/Util.cs",
        "lines": "17-34",
        "finding": "GetPreambleSize handles UTF-8 BOM (0xEF 0xBB 0xBF) and other BOMs. A ZIP file starts with PK (0x50 0x4B) which returns preamble=0, so the full ZIP binary is passed to the JSON parser.",
        "relevance": "related"
      },
      {
        "file": "tests/Tests/Skottie/AnimationTest.cs",
        "lines": "11-16",
        "finding": "Tests only cover .json Lottie files (LottieLogo1.json and LottieLogo1_bom.json). No .lottie (dotLottie/ZIP) test files exist, confirming the format is not supported.",
        "relevance": "related"
      }
    ],
    "errorFingerprint": "Skottie-Animation-null-dotlottie-zip-format",
    "workarounds": [
      "Download the Lottie JSON (.json) format from LottieFiles instead of the .lottie (dotLottie) format. LottieFiles offers both options on its download page.",
      "Extract the JSON from the .lottie ZIP archive: use System.IO.Compression.ZipArchive to open the .lottie file, read the animations/*.json entry, then pass the extracted JSON string to Animation.Parse()."
    ],
    "nextQuestions": [
      "Should SkiaSharp add native dotLottie (.lottie ZIP) format detection and automatic extraction?",
      "Should Animation.Create throw a more descriptive exception or log a warning when the input data doesn't look like JSON?"
    ],
    "resolution": {
      "hypothesis": "The .lottie file is a ZIP archive (dotLottie format), not raw Lottie JSON. Skottie's parser expects JSON and correctly returns null when given non-JSON binary data.",
      "proposals": [
        {
          "title": "Use .json format instead of .lottie",
          "description": "Download the Lottie JSON (.json) format from LottieFiles instead of the .lottie (dotLottie) format. The LottieFiles download page offers both formats. The .json file contains raw Lottie JSON that Animation.Create() can parse directly.",
          "confidence": 0.95,
          "effort": "trivial"
        },
        {
          "title": "Extract JSON from .lottie ZIP",
          "description": "If you must use .lottie files, extract the JSON from the ZIP archive before passing it to Skottie. The dotLottie format stores the animation JSON inside the ZIP at a known path.",
          "codeSnippet": "using System.IO.Compression;\n\nstring ExtractLottieJson(string dotLottiePath)\n{\n    using var archive = ZipFile.OpenRead(dotLottiePath);\n    var entry = archive.Entries.FirstOrDefault(e =>\n        e.FullName.EndsWith(\".json\", StringComparison.OrdinalIgnoreCase)\n        && e.FullName.StartsWith(\"animations/\", StringComparison.OrdinalIgnoreCase));\n    if (entry == null)\n        throw new InvalidOperationException(\"No animation JSON found in .lottie file\");\n    using var stream = entry.Open();\n    using var reader = new StreamReader(stream);\n    return reader.ReadToEnd();\n}\n\n// Usage:\nvar json = ExtractLottieJson(sourceFileAbsolute);\nvar animation = SkiaSharp.Skottie.Animation.Parse(json);",
          "confidence": 0.85,
          "effort": "small"
        },
        {
          "title": "Enhancement: Add dotLottie format detection",
          "description": "SkiaSharp could detect the ZIP/PK magic bytes in Animation.Create and either auto-extract the JSON or throw a descriptive exception like 'The file appears to be a dotLottie (.lottie) ZIP archive. Use a .json Lottie file or extract the JSON first.' This would be a new enhancement, not a bug fix.",
          "confidence": 0.7,
          "effort": "medium"
        }
      ],
      "recommendedProposal": "Use .json format instead of .lottie",
      "recommendedReason": "This is the simplest solution \u2014 no code changes required. LottieFiles provides a .json download option alongside .lottie. The .json format is what Skottie was designed to parse."
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "close-with-docs",
      "confidence": 0.82,
      "reason": "This is a file format misunderstanding, not a bug. The .lottie (dotLottie) format is a ZIP container, and Skottie expects raw Lottie JSON. The user should download the .json format from LottieFiles. A comment explaining the format difference with a workaround would fully resolve the issue."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Reclassify from type/bug to type/question \u2014 the API is working as designed; the user is using an unsupported file format.",
        "risk": "low",
        "confidence": 0.85,
        "labels": [
          "type/question"
        ]
      },
      {
        "type": "add-comment",
        "description": "Explain the .lottie vs .json format difference and provide a workaround.",
        "risk": "high",
        "confidence": 0.9,
        "comment": "Thanks for the report.\n\nThe `.lottie` file format (dotLottie) is actually a ZIP archive that contains a Lottie JSON animation inside it \u2014 it's not raw JSON. SkiaSharp's Skottie parser expects raw Lottie JSON data, so passing a `.lottie` file directly to `Animation.Create()` will return `null` because the ZIP binary isn't valid JSON.\n\nHere's a workaround you can use: on the LottieFiles download page, choose the **Lottie JSON** (`.json`) format instead of the `.lottie` format. The `.json` file will work directly with `Animation.Create()`.\n\nIf you need to work with `.lottie` files specifically, you can extract the JSON from the ZIP archive first:\n\n```csharp\nusing System.IO.Compression;\n\nusing var archive = ZipFile.OpenRead(dotLottiePath);\nvar entry = archive.Entries.FirstOrDefault(e =>\n    e.FullName.EndsWith(\".json\", StringComparison.OrdinalIgnoreCase)\n    && e.FullName.StartsWith(\"animations/\", StringComparison.OrdinalIgnoreCase));\n\nusing var stream = entry.Open();\nusing var reader = new StreamReader(stream);\nvar json = reader.ReadToEnd();\n\nvar animation = SkiaSharp.Skottie.Animation.Parse(json);\n```\n\nWe may consider adding dotLottie format detection in the future to provide a more helpful error message."
      },
      {
        "type": "link-related",
        "description": "Link to issue #2166 which also dealt with Skottie returning null due to data format issues (BOM).",
        "risk": "low",
        "confidence": 0.7,
        "linkedIssue": 2166
      }
    ]
  }
}