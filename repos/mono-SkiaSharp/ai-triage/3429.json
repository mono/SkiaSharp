{
  "meta": {
    "schemaVersion": "3.0",
    "number": 3429,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-08T15:00:00Z"
  },
  "summary": "Memory leak in WPF on Windows with Nvidia Quadro GPU drivers when drawing patterns on high-resolution monitors; mitigated by WPF software-only rendering mode",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.95
    },
    "area": {
      "value": "area/views",
      "confidence": 0.75
    },
    "platforms": [
      "os/Windows-Classic"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "environmentDetails": "Windows, WPF, Nvidia Quadro series GPU, high resolution monitor, Visual Studio, SkiaSharp 3.116.0",
      "codeSnippets": [
        "csharp: protected override void OnStartup(StartupEventArgs e)\n{\n    RenderOptions.ProcessRenderMode = RenderMode.SoftwareOnly;\n    base.OnStartup(e);\n}"
      ]
    },
    "bugSignals": {
      "severity": "medium",
      "isRegression": true
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.116.0",
        "2.88.9"
      ]
    }
  },
  "analysis": {
    "summary": "GPU-driver-specific memory leak in WPF when drawing patterns with SkiaSharp, isolated to Nvidia Quadro series. The WPF SoftwareOnly workaround points to an interaction between SkiaSharp rendering and WPF's hardware-accelerated compositing layer. Related to other GPU memory leak reports (#3309, #2660, #2848) but distinct due to Quadro-specific trigger.",
    "rationale": "type: Reporter describes a memory leak that grows over time during normal drawing operations. This is broken behavior â€” memory should not leak during repeated draw calls. area: The issue occurs when drawing patterns in WPF, which uses SkiaSharp.Views.WPF controls. The workaround is a WPF-level rendering setting, further pointing to the views integration layer. Could also be area/libSkiaSharp.native if the native library leaks GPU memory on Quadro drivers. bugSignals.severity: Memory leak that worsens over time, but has a workaround (software rendering). The workaround is impractical for production, but the issue is limited to Nvidia Quadro GPUs, reducing the affected population. regression: Reporter claims last known good version is 2.88.9. The v2-to-v3 jump involved a major rewrite of the native layer and views, making regression plausible but the specific breaking change hard to pinpoint. actionability.suggestedAction: The bug is real but critical details are missing: which WPF control (SKElement vs SKGLElement), GPU model/driver version, and a minimal repro. The existing OpenTK fix (#3309) might already resolve this if SKGLElement is in use. platforms: WPF is a Windows-Classic (Win32/WPF) framework. The reporter runs on Windows with Nvidia Quadro GPUs and the workaround uses WPF-specific RenderOptions API. tenets: Reliability: memory leak degrades application stability over time during normal drawing operations. Performance: the only workaround (software rendering) causes significant performance loss for the rest of the application. regression.isRegression: Reporter states last known good version is 2.88.9. The v2-to-v3 rewrite of the native layer and views makes regression plausible, though the large version gap means the exact breaking change is unidentified. versionAnalysis.currentRelevance: Reported on current SkiaSharp 3.116.0 with no indication the issue has been fixed in newer versions. The GPU-driver-specific nature makes it unlikely to self-resolve.",
    "codeInvestigation": [],
    "workarounds": [
      "Set RenderOptions.ProcessRenderMode = RenderMode.SoftwareOnly in App.OnStartup to disable WPF hardware acceleration. Not practical for production due to performance impact on other application features."
    ],
    "nextQuestions": [
      "Which WPF SkiaSharp control is being used (SKElement, SKGLElement, or SKXamlCanvas)?",
      "Whether the leak is in SkiaSharp's rendering, WPF's compositing, or the Nvidia Quadro driver itself",
      "Specific Nvidia Quadro model and driver version",
      "Whether the issue is specific to high-DPI or also occurs on standard resolution monitors",
      "Whether #3309 (SKGLElement OpenTK memory leak fix) resolves this issue as well"
    ],
    "resolution": {
      "hypothesis": "The Nvidia Quadro driver handles GPU resource management differently from GeForce and AMD drivers, causing SkiaSharp-rendered surfaces to leak GPU memory when composited through WPF's hardware-accelerated pipeline. The v3 rewrite may have changed how surfaces are allocated or recycled, exposing a Quadro-specific driver bug or resource management issue.",
      "proposals": [
        {
          "description": "Issue #3309 identified a memory leak in SKGLElement due to OpenTK not being disposed. If the reporter is using SKGLElement, the fix in #3311 (updating OpenTK dependency) may resolve this. Ask reporter which control they use.",
          "confidence": 0.5,
          "effort": "small"
        },
        {
          "description": "If using SKGLElement (GPU-accelerated), switching to SKElement (CPU-rendered) would avoid the GPU driver interaction while keeping WPF hardware acceleration for other UI elements. Better targeted than the full SoftwareOnly workaround.",
          "confidence": 0.65,
          "effort": "small"
        },
        {
          "description": "Profile GPU memory allocation during pattern drawing to identify whether SkiaSharp's GrDirectContext resource cache behaves differently on Quadro. May need to explicitly flush or limit the GPU resource cache (GrDirectContext.SetResourceCacheLimit).",
          "confidence": 0.55,
          "effort": "medium"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "request-info",
      "confidence": 0.85,
      "reason": "Real bug with validated workaround, but missing critical details: which SkiaSharp WPF control is used, specific GPU model/driver version, and minimal reproduction project. Need this info to investigate effectively."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Add area/SkiaSharp.Views and tenet/performance labels",
        "risk": "low",
        "confidence": 0.85,
        "labels": [
          "area/SkiaSharp.Views",
          "tenet/performance"
        ]
      },
      {
        "type": "add-comment",
        "description": "Request details about WPF control type, GPU model, and ask for minimal repro",
        "risk": "high",
        "confidence": 0.85
      }
    ]
  }
}
