{
  "schemaVersion": "1.0",
  "number": 3386,
  "repo": "mono/SkiaSharp",
  "analyzedAt": "2026-02-08T22:43:01Z",
  "summary": "Wrong libSkiaSharp.so deployed in Azure Container App via .NET Aspire — fontconfig-dependent binary loaded instead of NoDependencies variant",
  "type": {
    "value": "bug",
    "confidence": 0.90,
    "reason": "The dlopen error proves the fontconfig-dependent libSkiaSharp.so was loaded instead of the NoDependencies binary. NoDependencies has zero external deps, so a fontconfig dependency failure means the wrong binary was deployed. This is either a NuGet package conflict or a container build tool bug."
  },
  "area": {
    "value": "libSkiaSharp.native",
    "confidence": 0.95,
    "reason": "DllNotFoundException caused by wrong native binary variant being deployed. The NoDependencies .so was not used at runtime despite being referenced."
  },
  "backends": null,
  "platforms": [
    {
      "value": "Linux",
      "confidence": 0.98,
      "reason": "Explicitly stated: Azure Container App running Linux. Error shows Linux dlopen paths."
    }
  ],
  "tenets": [
    {
      "value": "compatibility",
      "confidence": 0.90,
      "reason": "Worked in 2.88.9, broken in 3.116.0. The NativeAssets packaging structure changed between 2.x and 3.x which may have introduced a conflict between Linux and Linux.NoDependencies packages."
    }
  ],
  "partner": null,
  "regression": {
    "isRegression": true,
    "confidence": 0.75,
    "reason": "User states it worked with 2.88.9 and broke in 3.116.0. The packaging restructure in 3.x may have changed how NoDependencies resolves vs the regular Linux package.",
    "workedInVersion": "2.88.9",
    "brokeInVersion": "3.116.0"
  },
  "fixStatus": null,
  "bugSignals": {
    "hasCrash": true,
    "hasStackTrace": true,
    "reproQuality": "partial",
    "hasScreenshot": false,
    "hasWorkaround": true,
    "workaroundSummary": "Switch to SkiaSharp.NativeAssets.Linux (not NoDependencies), use custom Docker base image (ghcr.io/avantipoint/aspnet-skia) with native deps pre-installed, and add System.Memory.Data as direct PackageReference to fix a separate trimming issue.",
    "targetFrameworks": ["net9.0"],
    "severity": "high",
    "severityReason": "The NoDependencies package is specifically designed for minimal containers and is the recommended approach per documentation. If the wrong binary is deployed silently, the package is fundamentally broken for its intended use case. Workaround requires custom Docker images."
  },
  "reproEvidence": {
    "stepsToReproduce": [
      "Create a .NET 9 WebAPI project using .NET Aspire",
      "Add PackageReference for SkiaSharp and SkiaSharp.NativeAssets.Linux.NoDependencies",
      "Deploy to Azure Container App via Aspire",
      "Call an endpoint that uses SkiaSharp (e.g., SKBitmap.Decode) — crashes with DllNotFoundException showing libfontconfig.so.1 dependency"
    ],
    "codeSnippets": [
      {
        "language": "xml",
        "code": "<PackageReference Include=\"SkiaSharp\" />\n<PackageReference Include=\"SkiaSharp.NativeAssets.Linux.NoDependencies\" />",
        "context": "Package references used in the project — NoDependencies should provide a .so with no fontconfig dep"
      },
      {
        "language": "xml",
        "code": "<PropertyGroup>\n  <OutputType>Exe</OutputType>\n  <TargetFramework>net9.0</TargetFramework>\n  <ContainerBaseImage>ghcr.io/avantipoint/aspnet-skia:9.0</ContainerBaseImage>\n</PropertyGroup>",
        "context": "Workaround: custom container base image with native deps pre-installed"
      }
    ],
    "repoLinks": [
      {
        "url": "https://github.com/AvantiPoint/aspnet-skia",
        "description": "Custom Docker images based on mcr.microsoft.com/dotnet/aspnet with SkiaSharp native dependencies pre-installed"
      }
    ],
    "environmentDetails": "Azure Container App, Linux, .NET 9.0.10, .NET Aspire deployment, Visual Studio (Windows) IDE"
  },
  "versionAnalysis": {
    "mentionedVersions": ["3.116.0", "2.88.9"],
    "era": "modern",
    "currentRelevance": "likely",
    "reason": "The NoDependencies package is the recommended approach for containers. If the wrong binary is being deployed, this affects all container users who follow the documented guidance."
  },
  "actionability": {
    "suggestedAction": "needs-investigation",
    "confidence": 0.85,
    "reason": "The dlopen error proves the wrong libSkiaSharp.so was loaded — the fontconfig-dependent binary instead of the NoDependencies one. Need to investigate: (1) whether a transitive dependency pulls in NativeAssets.Linux alongside NoDependencies, (2) whether .NET Aspire's container build resolves the wrong RID asset, (3) whether the NoDependencies 3.116.0 package contents are correct.",
    "requiresHumanReview": true,
    "closeable": false,
    "closeReason": null,
    "duplicateOf": null,
    "abandoned": false,
    "abandonedReason": null
  },
  "suggestedResponse": null
}
