{
  "meta": {
    "schemaVersion": "3.0",
    "number": 2511,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2025-07-24T12:00:00Z"
  },
  "summary": "AccessViolationException in finalizer thread when closing WinForms app — duplicate of #2194, fixed in v2.88.1",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.95
    },
    "area": {
      "value": "area/SkiaSharp",
      "confidence": 0.92
    },
    "platforms": [
      "os/Windows-Classic"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "stepsToReproduce": [
        "Use SkiaSharp in a WinForms application on Windows (version prior to v2.88.1)",
        "Create and use SKObject-derived instances without explicit disposal",
        "Close the application, allowing finalizers to run"
      ],
      "environmentDetails": "Windows, WinForms application. No SkiaSharp version specified by reporter."
    },
    "bugSignals": {
      "severity": "high",
      "errorType": "crash"
    }
  },
  "analysis": {
    "summary": "This is a duplicate of #2194. The crash occurs because .NET finalizer ordering is non-deterministic — during app shutdown, the NonAlertableWin32Lock's finalizer can destroy the Win32 CRITICAL_SECTION before other SKNativeObject finalizers finish deregistering their handles. PR #2195 fixed this by adding null guards on the critical section pointer. The reporter provided no version info but the stack trace is byte-for-byte identical to the fixed issue.",
    "rationale": "type: Reporter describes an AccessViolationException crash during normal app shutdown. This is clearly broken behavior — finalizer cleanup should not crash. area: The crash is in SkiaSharp's core HandleDictionary and PlatformLock infrastructure, not in any specific view or platform package. bugSignals.severity: AccessViolationException is uncatchable and terminates the process. However, it only occurs during app shutdown and a fix exists, which prevents it from being critical. actionability.suggestedAction: The stack trace is identical to #2194. PR #2195 fixed this exact issue in v2.88.1. The issue was already closed with zero comments, confirming it was recognized as a known/fixed issue. platforms: The crash is in NonAlertableWin32Lock (Win32 CRITICAL_SECTION) and reporter explicitly says \"my winform program,\" confirming a Windows Classic desktop application. tenets: An uncatchable AccessViolationException during normal app shutdown is a reliability defect — finalizer cleanup should never crash the process. fixStatus.likelyFixed: PR #2195 added null guards to NonAlertableWin32Lock.Enter() and Leave(), shipping in v2.88.1. The stack trace is identical to the fixed issue #2194. versionAnalysis.currentRelevance: The fix shipped in v2.88.1 and current SkiaSharp is 3.x. The reporter likely used a pre-fix version given the identical stack trace to #2194.",
    "codeInvestigation": [],
    "workarounds": [
      "Explicitly dispose all SkiaSharp objects before application exit instead of relying on finalizers, or upgrade to SkiaSharp v2.88.1+ which includes the fix from PR #2195."
    ],
    "nextQuestions": [
      "Reporter did not specify SkiaSharp version — cannot confirm they were on a pre-fix version",
      "No .NET framework version specified — unclear if .NET Framework or .NET Core"
    ]
  },
  "output": {
    "actionability": {
      "suggestedAction": "close-as-duplicate",
      "confidence": 0.9,
      "reason": "Identical stack trace to #2194, which was fixed in PR #2195 (v2.88.1). Issue was already closed with no comments."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Apply bug, core SkiaSharp, Windows, and reliability labels",
        "risk": "low",
        "confidence": 0.92,
        "labels": [
          "type/bug",
          "area/SkiaSharp",
          "os/Windows-Classic",
          "tenet/reliability"
        ]
      },
      {
        "type": "link-duplicate",
        "description": "Mark as duplicate of #2194",
        "risk": "medium",
        "confidence": 0.9
      },
      {
        "type": "add-comment",
        "description": "Post duplicate notice with upgrade guidance",
        "risk": "high",
        "confidence": 0.85
      },
      {
        "type": "close-issue",
        "description": "Close as duplicate of #2194",
        "risk": "medium",
        "confidence": 0.9
      }
    ]
  }
}
