{
  "meta": {
    "schemaVersion": "1.0",
    "number": 315,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2025-07-24T12:00:00Z"
  },
  "summary": "Touch events on Android prevent Xamarin.Forms pinch/pan gesture recognizers from receiving events — architectural mismatch between Android and iOS touch handling",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.8
    },
    "area": {
      "value": "area/views.forms",
      "confidence": 0.85
    },
    "platforms": [
      "os/Android"
    ]
  },
  "evidence": {
    "bugSignals": {
      "severity": "medium"
    }
  },
  "analysis": {
    "summary": "On Android, SKTouchHandler subscribes to view.Touch and sets e.Handled = args.Handled, which consumes the event and prevents Xamarin.Forms gesture recognizers (pinch/pan) from receiving it. On iOS, SKTouchHandler extends UIGestureRecognizer, which naturally coexists with other gesture recognizers. This architectural difference causes the same code to work on iOS but not Android. The Xamarin.Forms views have been removed, but the identical Android-vs-iOS touch handling pattern persists in the MAUI handlers.",
    "rationale": "type: Reporter describes a feature that works on iOS but not Android using the same code. This is broken platform parity, not a usage question or feature request. area: Issue was filed against Xamarin.Forms SKCanvasView with PinchGestureRecognizer/PanGestureRecognizer. The Xamarin.Forms views package is the affected area. bugSignals.severity: Not a crash. Feature is broken on one platform. Workaround exists: handle pinch/pan via SKTouchEventArgs multi-touch data instead of using framework gesture recognizers. platforms: Reporter explicitly states it works on iOS but fails on Android. Comment #1 confirms the Android-specific gesture interference. tenets: Cross-platform parity issue — same code behaves differently on iOS vs Android. actionability.suggestedAction: The Xamarin.Forms views are removed, but the same Android touch handling architecture persists in MAUI. A maintainer needs to decide: close as Forms-deprecated, or retarget to track the MAUI parallel. versionAnalysis.currentRelevance: The Android SKTouchHandler in MAUI still uses view.Touch with e.Handled, the same pattern that caused the original issue. The bug pattern persists even though the Forms views are gone.",
    "codeInvestigation": [
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Platform/Android/SKTouchHandler.cs",
        "lines": "41-109",
        "finding": "Android SKTouchHandler hooks into view.Touch event and sets e.Handled = args.Handled (lines 71, 86, 97, 106). When Handled is true, Android stops propagating the event to parent views and framework gesture recognizers — this is the root cause.",
        "relevance": "related"
      },
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Platform/Apple/SKTouchHandler.cs",
        "lines": "10-110",
        "finding": "iOS SKTouchHandler extends UIGestureRecognizer (line 10) and uses IgnoreTouch for unhandled events (line 62). UIGestureRecognizer coexists with other gesture recognizers by design — explains why iOS works correctly.",
        "relevance": "related"
      },
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Handlers/SKCanvasView/SKCanvasViewHandler.Android.cs",
        "lines": "45-52",
        "finding": "MAUI Android handler creates SKTouchHandler with the same pattern — confirms the architectural gap persists beyond Xamarin.Forms.",
        "relevance": "related"
      }
    ],
    "workarounds": [
      "Avoid combining EnableTouchEvents with Xamarin.Forms PinchGestureRecognizer/PanGestureRecognizer on Android; handle multi-touch gestures directly via SKTouchEventArgs instead."
    ],
    "nextQuestions": [
      "Whether MAUI's gesture system handles the Android touch event coexistence differently than Xamarin.Forms did",
      "Whether the reporter's linked GitHub repo still exists or is accessible",
      "Whether setting e.Handled = false on Android would cause other side effects (like duplicate events or touch tracking loss)"
    ],
    "resolution": {
      "hypothesis": "Android's view.Touch event handler in SKTouchHandler consumes events by setting e.Handled = true, preventing framework gesture recognizers from receiving them. iOS avoids this by using UIGestureRecognizer which coexists with other recognizers. The fix would be to change the Android handler to not consume events (or use a gesture recognizer pattern), or to handle multi-touch gestures entirely within SkiaSharp's touch events.",
      "proposals": [
        {
          "description": "Instead of using Xamarin.Forms/MAUI PinchGestureRecognizer and PanGestureRecognizer, handle all gesture detection directly from SKTouchEventArgs multi-touch data (multiple pointer IDs, coordinates). This avoids the framework gesture conflict entirely.",
          "confidence": 0.8,
          "effort": "medium"
        },
        {
          "description": "Modify the Android SKTouchHandler to not set e.Handled = true, allowing framework gesture recognizers to also receive the events. Risk: may cause duplicate handling or lose touch tracking.",
          "confidence": 0.5,
          "effort": "small"
        },
        {
          "description": "Replace Android's view.Touch event subscription with an Android GestureDetector-based approach that can coexist with other gesture recognizers, similar to how iOS uses UIGestureRecognizer.",
          "confidence": 0.65,
          "effort": "large"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.7,
      "reason": "The Xamarin.Forms views are removed, but the same Android touch handling architecture persists in MAUI. A maintainer needs to decide whether to close this Forms-era issue or retarget it for MAUI."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Apply bug, views.forms, android, compatibility labels",
        "risk": "low",
        "confidence": 0.85,
        "labels": [
          "type/bug",
          "area/SkiaSharp.Views.Forms",
          "os/Android",
          "tenet/compatibility"
        ]
      },
      {
        "type": "link-related",
        "description": "Cross-reference #309 (touch events feature PR)",
        "risk": "low",
        "confidence": 0.9
      },
      {
        "type": "add-comment",
        "description": "Post analysis with workaround for handling gestures via SKTouchEventArgs",
        "risk": "high",
        "confidence": 0.7
      }
    ]
  }
}
