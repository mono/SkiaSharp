{
  "meta": {
    "schemaVersion": "2.1",
    "number": 2759,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-11T22:41:00Z",
    "currentLabels": [
      "type/bug"
    ]
  },
  "summary": "SKBitmap.Decode returns null for a specific PNG \u2014 follow-up to #933/#1981. No image file attached, insufficient info to diagnose.",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.72
    },
    "area": {
      "value": "area/SkiaSharp",
      "confidence": 0.9
    },
    "backends": null,
    "platforms": null,
    "tenets": null,
    "partner": null
  },
  "evidence": {
    "bugSignals": {
      "hasCrash": false,
      "hasStackTrace": false,
      "reproQuality": "none",
      "hasWorkaround": false,
      "workaroundSummary": null,
      "severity": "low",
      "severityReason": "No crash, SKBitmap.Decode returns null for an unattached PNG file. No reproduction material provided \u2014 no image file, no error output from SKCodec, no details about the PNG format. Without the actual image, this cannot be investigated."
    },
    "reproEvidence": {
      "relatedIssues": [
        933,
        1981,
        2801,
        2874,
        2429
      ],
      "codeSnippets": [
        {
          "language": "csharp",
          "code": "SkiaSharp.SKBitmap bmp = SkiaSharp.SKBitmap.Decode(@\"C:\\Temp\\image1.png\");\nAssert.IsNotNull(bmp);",
          "context": "Reporter's reproduction code \u2014 references a local file not attached to the issue"
        }
      ],
      "environmentDetails": "Windows, Visual Studio, SkiaSharp 2.88.6 (description) / 2.88.3 (form field). All platforms claimed affected."
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "2.88.6",
        "2.88.3",
        "2.88.2"
      ],
      "currentRelevance": "unknown",
      "reason": "Reporter claims the issue persists in 2.88.6, but without the actual PNG file, we cannot determine if this is the same zlib bug fixed in #1981 or a different PNG decoding issue (e.g., CRC mismatch as in #2874, or format-specific codec failure as in #2429). The version field says 2.88.3 but the description says 2.88.6 \u2014 inconsistency reduces confidence.",
      "migrationPath": null
    },
    "regression": null,
    "fixStatus": null
  },
  "analysis": {
    "summary": "The reporter reopens #933 (closed as dup of #1981) claiming the fix didn't work. However, they provide no image file, no SKCodec error output, and no details about the PNG's properties (bit depth, color type, interlacing, chunk structure). Multiple distinct PNG decoding issues exist in SkiaSharp \u2014 the zlib SSE bug (#1981), CRC mismatch rejection (#2874), and format-specific codec failures (#2429, #2801). Without the image, we cannot determine which issue this is or whether the #1981 fix addresses it.",
    "keySignals": [
      {
        "text": "This is follow-up of #933 issue, which is closed as resolved, but the problem is still there 2.88.6 version",
        "source": "body",
        "interpretation": "Reporter believes #933's fix didn't work. However, #933 was closed as dup of #1981, which was fixed by updating zlib. The reporter may be hitting a different PNG issue entirely."
      },
      {
        "text": "SKBitmap.Decode(@\"C:\\Temp\\image1.png\")",
        "source": "body",
        "interpretation": "References a local file (image1.png) that is not attached to this issue. Same filename as #933 \u2014 but #933's image was an inline GitHub attachment that may no longer be the same format."
      },
      {
        "text": "Version: 2.88.3 (Current) / Last Known Good: 2.88.2",
        "source": "body",
        "interpretation": "Contradicts the description which says 2.88.6. The 2.88.2\u21922.88.3 transition aligns with the original #1981 regression (zlib SSE changes), but 2.88.6 should include the fix."
      }
    ],
    "codeInvestigation": [
      {
        "file": "binding/SkiaSharp/SKBitmap.cs",
        "lines": "539-549",
        "relevance": "SKBitmap.Decode(string) creates SKCodec via SKCodec.Create(filename). If the codec is null (Skia rejected the image), Decode returns null. The reporter sees null, meaning SKCodec.Create failed \u2014 but we don't know why without the image."
      },
      {
        "file": "binding/SkiaSharp/SKCodec.cs",
        "lines": "232-241",
        "relevance": "SKCodec.Create(string) opens an SKFileStream and passes to sk_codec_new_from_stream. The out parameter SKCodecResult would reveal the failure reason, but the reporter's code doesn't capture it."
      },
      {
        "file": "binding/SkiaSharp/SKBitmap.cs",
        "lines": "446-459",
        "relevance": "Even if SKCodec creation succeeds, Decode(codec, bitmapInfo) can still return null if GetPixels fails (result != Success && result != IncompleteInput). This is a second failure point."
      }
    ],
    "fieldRationales": [
      {
        "field": "type",
        "chosen": "type/bug",
        "expandedReason": "Reporter describes SKBitmap.Decode returning null for a valid PNG. If the image is genuinely valid, this is a bug. However, without the image, we can't confirm validity \u2014 the PNG might have CRC errors, unusual encoding, or other issues that Skia intentionally rejects.",
        "alternatives": [
          {
            "value": "type/question",
            "whyRejected": "Reporter is not asking how to use an API \u2014 they report a specific failure. Even though the report is incomplete, the intent is a bug report."
          }
        ]
      },
      {
        "field": "area",
        "chosen": "area/SkiaSharp",
        "expandedReason": "SKBitmap.Decode is in the core SkiaSharp binding. The failure could be in native Skia's codec, but the entry point is SkiaSharp."
      },
      {
        "field": "bugSignals.severity",
        "chosen": "low",
        "expandedReason": "No crash, no stack trace, no reproduction material. The report has zero comments and no image file attached. Cannot investigate without additional information from the reporter."
      },
      {
        "field": "actionability.suggestedAction",
        "chosen": "request-info",
        "expandedReason": "We need the actual PNG file to diagnose the issue. We also need SKCodecResult output to understand why decoding fails. Without these, we cannot determine if this is a new bug, an unfixed old bug, or an invalid image."
      },
      {
        "field": "versionAnalysis.currentRelevance",
        "chosen": "unknown",
        "expandedReason": "Without the actual PNG file, we cannot determine if this is the same zlib bug fixed in #1981 (which would be fixed in current versions) or a different PNG issue. The reporter's version info is contradictory (2.88.3 vs 2.88.6)."
      }
    ],
    "uncertainties": [
      "Whether the PNG file is the same one from #933 \u2014 the original #933 image was embedded as a GitHub attachment but we can't verify it's the same file referenced as C:\\Temp\\image1.png",
      "Whether the reporter actually tested on 2.88.6 (description) or 2.88.3 (version field) \u2014 these are different releases",
      "Whether the PNG has structural issues (CRC mismatch, unusual bit depth, interlacing) that Skia intentionally rejects",
      "Whether upgrading to SkiaSharp 3.x (with newer Skia/zlib) would resolve this"
    ],
    "assumptions": [
      "Assumed the reporter's PNG is a local copy of the image from #933, but cannot verify without the file",
      "Assumed the issue is platform-independent since the decode path is the same on all platforms, despite reporter selecting 'All'"
    ],
    "resolution": {
      "hypothesis": "SKBitmap.Decode returns null because Skia's native codec rejects the PNG. The reason could be: (1) the same zlib decompression bug from #1981 (unlikely if on 2.88.6+), (2) CRC mismatch in PNG chunks (like #2874), (3) unsupported PNG features, or (4) a different native codec bug. Without the image, we cannot distinguish these.",
      "proposals": [
        {
          "title": "Use SKCodec.Create with SKCodecResult to diagnose",
          "description": "Use the SKCodec.Create overload that returns an SKCodecResult to get the specific failure reason. This narrows down whether it's a codec initialization failure or a pixel decoding failure.",
          "confidence": 0.85,
          "effort": "low",
          "category": "investigation",
          "codeSnippet": "var codec = SKCodec.Create(@\"C:\\Temp\\image1.png\", out var result);\nConsole.WriteLine($\"Codec result: {result}\");\nif (codec != null)\n{\n    var info = codec.Info;\n    Console.WriteLine($\"Size: {info.Width}x{info.Height}, ColorType: {info.ColorType}, AlphaType: {info.AlphaType}\");\n    \n    var bitmap = new SKBitmap(info);\n    var pixelResult = codec.GetPixels(info, bitmap.GetPixels(out _));\n    Console.WriteLine($\"Pixel result: {pixelResult}\");\n}",
          "validated": "untested"
        },
        {
          "title": "Try SkiaSharp 3.x",
          "description": "SkiaSharp 3.x uses a significantly newer Skia engine with updated libpng and zlib. If the issue is a native codec bug, upgrading may resolve it.",
          "confidence": 0.5,
          "effort": "medium",
          "category": "alternative"
        }
      ],
      "recommendedProposal": "Use SKCodec.Create with SKCodecResult to diagnose",
      "recommendedReason": "First step is diagnosis \u2014 we need to know WHY the decode fails before we can fix or work around it."
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "request-info",
      "confidence": 0.88,
      "reason": "The report is missing critical information: no image file attached, no SKCodecResult output, and conflicting version numbers. Cannot investigate without the actual PNG file."
    },
    "actions": [
      {
        "id": "labels-1",
        "type": "update-labels",
        "risk": "low",
        "description": "Apply area label",
        "reason": "Matches classification \u2014 core SkiaSharp decode issue",
        "confidence": 0.9,
        "dependsOn": null,
        "payload": {
          "labelsToAdd": [
            "area/SkiaSharp"
          ],
          "labelsToRemove": []
        }
      },
      {
        "id": "comment-1",
        "type": "add-comment",
        "risk": "high",
        "description": "Request the PNG file and diagnostic output",
        "reason": "Cannot investigate without the actual image and codec error details",
        "confidence": 0.85,
        "dependsOn": "labels-1",
        "payload": {
          "commentType": "request-info",
          "draftBody": "Thanks for the follow-up. We understand this is frustrating, especially since #933 was closed.\n\nTo investigate, we'd need two things:\n\n1. **The actual PNG file** \u2014 could you attach `image1.png` to this issue? (Drag and drop, or zip it first if GitHub won't accept the format.) Without the file, we can't reproduce or diagnose.\n\n2. **The codec error** \u2014 this will tell us exactly why Skia rejected it:\n\n```csharp\nvar codec = SKCodec.Create(@\"C:\\Temp\\image1.png\", out var result);\nConsole.WriteLine($\"Codec result: {result}\");\n```\n\nThere are several distinct reasons Skia can reject a PNG (format issues, CRC mismatches, compression quirks), and the fix depends on which one it is. The `SKCodecResult` output will point us in the right direction.\n\nAlso \u2014 could you confirm which SkiaSharp version you're on? The description mentions 2.88.6, but the version field says 2.88.3.",
          "requiresHumanEdit": true,
          "finalBody": null,
          "dedupeToken": "triage-2759-comment-1"
        }
      }
    ]
  }
}