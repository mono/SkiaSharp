{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3188,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-11T22:25:00Z"
  },
  "summary": "DrawVertices outputs black triangle instead of colored gradient in SkiaSharp 3.x — upstream Skia behavior change requires a shader on the paint when using vertex colors with SKBlendMode.Modulate",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.75
    },
    "area": {
      "value": "area/SkiaSharp",
      "confidence": 0.95
    },
    "platforms": [
      "os/Windows-Classic"
    ]
  },
  "evidence": {
    "reproEvidence": {
      "environmentDetails": "Windows 11, .NET 8, Visual Studio, SkiaSharp 3.116.1",
      "screenshots": [
        {
          "url": "https://github.com/user-attachments/assets/afa656d4-1966-496c-be0f-50d3d325f554"
        },
        {
          "url": "https://github.com/user-attachments/assets/5a9f1421-92d4-49f6-8f65-e7fb990cb82f"
        }
      ],
      "codeSnippets": [
        "csharp: var paint = new SKPaint { IsAntialias = true };\nvar vertices = new[] { new SKPoint(110, 20), new SKPoint(160, 200), new SKPoint(10, 200) };\nvar colors = new[] { SKColors.Red, SKColors.Green, SKColors.Blue };\nsurface.Canvas.DrawVertices(SKVertexMode.Triangles, vertices, colors, paint);"
      ]
    },
    "bugSignals": {
      "severity": "medium",
      "isRegression": true
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.116.1",
        "2.88.9"
      ]
    }
  },
  "analysis": {
    "summary": "This is an upstream Skia behavioral change exposed in SkiaSharp 3.x. The DrawVertices overloads in SKCanvas.cs use SKBlendMode.Modulate by default (line 915). In Modulate mode, vertex colors are multiplied by the paint's source — either a shader or the opaque paint color. Without a shader, the default paint color is black (0,0,0), so Modulate produces black regardless of vertex colors. A community member already provided the correct workaround: set a white shader on the paint.",
    "rationale": "type: While this is technically an upstream Skia behavioral change, it manifests as a breaking change in SkiaSharp 3.x that produces incorrect visual output from code that worked in 2.x. The SkiaSharp sample itself is broken. This warrants bug classification because: (1) existing code silently produces wrong output, (2) no migration guidance was provided, (3) the SkiaSharp convenience overloads hardcode SKBlendMode.Modulate without documentation of the shader requirement. area: The DrawVertices methods and their default blend mode are in core SkiaSharp (SKCanvas.cs). The upstream Skia behavior change surfaces through SkiaSharp's convenience overloads. bugSignals.severity: Visual output is wrong (black instead of gradient), but no crash or data loss. Workaround is simple (one line) and already provided by a community member. The severity is elevated slightly because the breakage is silent — no error or warning, just wrong output. platforms: Reporter tested on Windows 11. The issue is platform-independent (it's in the blend mode logic), but only Windows was explicitly tested. tenets: This is a v2→v3 compatibility break. Existing code produces different (wrong) output after upgrading, with no compile-time or runtime warning. regression.isRegression: Working v2 code produces black output in v3. The regression is in upstream Skia's handling of drawVertices blend mode with no shader, exposed through SkiaSharp's unchanged wrapper code. versionAnalysis.currentRelevance: The behavior is inherent to the Skia version in SkiaSharp 3.x and will persist. Workaround or convenience API change needed. actionability.suggestedAction: The SkiaSharp sample itself is broken and the convenience overloads may need updating (e.g., default to SKBlendMode.Dst when colors are provided and no shader exists, or document the shader requirement). Workaround exists but the API should be improved or documented.",
    "codeInvestigation": [
      {
        "file": "binding/SkiaSharp/SKCanvas.cs",
        "lines": "912-916",
        "finding": "DrawVertices(SKVertexMode, SKPoint[], SKColor[], SKPaint) creates SKVertices.CreateCopy then calls DrawVertices with SKBlendMode.Modulate. The Modulate blend mode multiplies vertex colors by paint source. Without a shader, paint source = paint color (black by default), so result is black.",
        "relevance": "related"
      },
      {
        "file": "binding/SkiaSharp/SKCanvas.cs",
        "lines": "936-943",
        "finding": "The core DrawVertices overload passes blend mode directly to sk_canvas_draw_vertices. No SkiaSharp-level transformation of colors — the behavior change is purely in native Skia's handling of the blend.",
        "relevance": "related"
      },
      {
        "file": "samples/Gallery/Shared/Samples/DrawVerticesSample.cs",
        "lines": "19-31",
        "finding": "The official SkiaSharp sample uses identical code to the reporter — no shader set on paint. This sample is broken in v3 and needs updating, confirming this is a known gap.",
        "relevance": "related"
      },
      {
        "file": "externals/skia/include/core/SkCanvas.h",
        "lines": "1953-1975",
        "finding": "Upstream Skia docs state: mode 'combines vertices colors with SkShader if present or SkPaint opaque color if not'. This clarifies the new behavior — without a shader, the paint's opaque color (default black) is used in the blend.",
        "relevance": "related"
      }
    ],
    "workarounds": [
      "Set a white shader on the paint: `paint.Shader = SKShader.CreateColor(SKColors.White)`. This gives the same visual result as SkiaSharp 2.x without a shader."
    ],
    "nextQuestions": [
      "Whether SkiaSharp should change the default blend mode in the convenience overloads (e.g., use Dst instead of Modulate when no shader is present) or just document the requirement",
      "Whether this affects all platforms or just CPU raster surfaces (reporter only tested on Windows)",
      "Whether SkiaSharp 3.x migration guide already mentions this change (none found)"
    ],
    "resolution": {
      "hypothesis": "Upstream Skia changed how drawVertices blends vertex colors with the paint source. Without a shader, the paint's default black color is used as the blend source with Modulate mode, producing black output. Setting a white shader restores the v2 behavior.",
      "proposals": [
        {
          "description": "Add `paint.Shader = SKShader.CreateColor(SKColors.White)` before calling DrawVertices. This makes the Modulate blend multiply vertex colors by white (1,1,1), preserving them. This is the workaround suggested by community member molesmoke.",
          "confidence": 0.92,
          "effort": "small"
        },
        {
          "description": "Change the default blend mode in the convenience DrawVertices overloads from Modulate to Dst when vertex colors are provided. Dst uses only the destination (vertex colors) and ignores the paint color. This would restore v2 visual behavior without requiring users to change their code.",
          "confidence": 0.55,
          "effort": "small"
        },
        {
          "description": "Fix DrawVerticesSample.cs to include a shader on the paint, and add a note to SkiaSharp 3.x migration guide about the DrawVertices behavior change.",
          "confidence": 0.85,
          "effort": "small"
        }
      ]
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "keep-open",
      "confidence": 0.8,
      "reason": "Real behavioral regression with a simple workaround. Keep open to track the sample fix and potential convenience API improvement. The workaround is already provided by a community member."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Apply area, platform, and compatibility labels",
        "risk": "low",
        "confidence": 0.92,
        "labels": [
          "area/SkiaSharp",
          "os/Windows-Classic",
          "tenet/compatibility"
        ]
      },
      {
        "type": "add-comment",
        "description": "Acknowledge the regression, confirm the workaround, and explain the upstream Skia change",
        "risk": "high",
        "confidence": 0.85
      }
    ]
  }
}
