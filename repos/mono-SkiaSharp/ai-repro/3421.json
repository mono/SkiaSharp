{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3421,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T16:20:50Z"
  },
  "inputs": {
    "triageFile": "ai-triage/3421.json"
  },
  "conclusion": "reproduced",
  "assessment": "working-as-designed",
  "notes": "Reproduced as reported: Animation.Create() returns null when given a .lottie file (dotLottie ZIP archive format). This is expected behavior \u2014 Skia's Skottie module only parses raw Lottie JSON, not the dotLottie container format (which is a ZIP archive containing JSON animations + manifest). The reporter likely downloaded a .lottie file from LottieFiles, which defaults to the dotLottie format. The workaround is to either download the raw .json format from LottieFiles or extract the JSON from the .lottie ZIP before passing it to Animation.Create().",
  "scope": "unknown",
  "reproductionTime": "~15 minutes",
  "versionResults": [
    {
      "version": "3.116.0",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Animation.Create() returns null for .lottie (ZIP) file. Raw .json Lottie works fine.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Same behavior \u2014 .lottie returns null, raw .json works.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "reproduced",
      "notes": "No dotLottie support in Animation.Create on main. All 42 existing Skottie tests pass with JSON input. Code unchanged from released versions.",
      "platform": "host-macos-arm64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp.Skottie",
        "version": "3.116.0"
      }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project and add SkiaSharp.Skottie 3.116.0 (reporter's version)",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-3421 && cd /tmp/repro-3421 && dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp.Skottie --version 3.116.0",
      "exitCode": 0,
      "output": "PackageReference for package 'SkiaSharp.Skottie' version '3.116.0' added.",
      "result": "success",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project referencing SkiaSharp.Skottie 3.116.0",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp.Skottie\" Version=\"3.116.0\" />\n  </ItemGroup>\n</Project>"
        }
      ]
    },
    {
      "stepNumber": 2,
      "description": "Write reproduction code that creates a .lottie (ZIP) file and a raw .json Lottie file, then tests Animation.Create() with both",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Repro code: creates minimal Lottie JSON and dotLottie ZIP, tests Animation.Create() with both formats",
          "content": "using System;\nusing System.IO;\nusing System.IO.Compression;\nusing SkiaSharp;\nusing SkiaSharp.Skottie;\n\nstring lottieJson = \"{\\\"v\\\":\\\"5.7.4\\\",\\\"fr\\\":30,\\\"ip\\\":0,\\\"op\\\":60,\\\"w\\\":100,\\\"h\\\":100,\\\"layers\\\":[{\\\"ty\\\":1,\\\"sc\\\":\\\"#ff0000\\\",\\\"sw\\\":100,\\\"sh\\\":100,\\\"ip\\\":0,\\\"op\\\":60,\\\"st\\\":0,\\\"ks\\\":{\\\"o\\\":{\\\"a\\\":0,\\\"k\\\":100},\\\"r\\\":{\\\"a\\\":0,\\\"k\\\":0},\\\"p\\\":{\\\"a\\\":0,\\\"k\\\":[50,50,0]},\\\"a\\\":{\\\"a\\\":0,\\\"k\\\":[50,50,0]},\\\"s\\\":{\\\"a\\\":0,\\\"k\\\":[100,100,100]}}}]}\";\n\nstring dir = Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().Location)!;\nstring jsonPath = Path.Combine(dir, \"test.json\");\nFile.WriteAllText(jsonPath, lottieJson);\n\nstring lottiePath = Path.Combine(dir, \"test.lottie\");\nusing (var zip = ZipFile.Open(lottiePath, ZipArchiveMode.Create))\n{\n    var manifestEntry = zip.CreateEntry(\"manifest.json\");\n    using (var w = new StreamWriter(manifestEntry.Open())) w.Write(\"{\\\"generator\\\":\\\"test\\\",\\\"version\\\":1.0,\\\"animations\\\":[{\\\"id\\\":\\\"animation_0\\\"}]}\");\n    var animEntry = zip.CreateEntry(\"animations/animation_0.json\");\n    using (var w = new StreamWriter(animEntry.Open())) w.Write(lottieJson);\n}\n\nConsole.WriteLine($\"Test 1 (.json): {(Animation.Create(jsonPath) != null ? \"NOT NULL\" : \"NULL\")}\");\nConsole.WriteLine($\"Test 2 (.lottie): {(Animation.Create(lottiePath) != null ? \"NOT NULL\" : \"NULL\")}\");\nConsole.WriteLine($\"Test 3 (.lottie via SKData): {(Animation.Create(SKData.Create(lottiePath)) != null ? \"NOT NULL\" : \"NULL\")}\");"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Build the reproduction project",
      "layer": "csharp",
      "command": "cd /tmp/repro-3421/Repro && dotnet build",
      "exitCode": 0,
      "output": "Build succeeded. 0 Warning(s) 0 Error(s)",
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Run reproduction \u2014 Animation.Create() with .lottie (ZIP) file should return null, confirming the reported bug",
      "layer": "csharp",
      "command": "cd /tmp/repro-3421/Repro && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp.Skottie version: 3.116.0.0\nRuntime: .NET 8.0.23\n\n=== Test 1: Load raw .json Lottie file ===\nAnimation from .json: NOT NULL (valid)\n  Duration: 00:00:02s, FPS: 30, Size: {Width=100, Height=100}\n\n=== Test 2: Load .lottie (ZIP) file ===\nAnimation from .lottie: NULL\n  BUG CONFIRMED: .lottie file returns null Animation (silent failure)\n\n=== Test 3: Load .lottie data via SKData ===\nAnimation from .lottie data: NULL\n  BUG CONFIRMED: .lottie data also returns null Animation\n\nSUCCESS: test completed",
      "result": "wrong-output"
    },
    {
      "stepNumber": 5,
      "description": "Test with latest stable SkiaSharp 3.119.2 in fresh project directory",
      "layer": "csharp",
      "command": "mkdir -p /tmp/repro-3421-latest && cd /tmp/repro-3421-latest && dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp.Skottie --version 3.119.2 && cp /tmp/repro-3421/Repro/Program.cs . && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp.Skottie version: 3.119.0.0\nRuntime: .NET 8.0.23\n\n=== Test 1: Load raw .json Lottie file ===\nAnimation from .json: NOT NULL (valid)\n  Duration: 00:00:02s, FPS: 30, Size: {Width=100, Height=100}\n\n=== Test 2: Load .lottie (ZIP) file ===\nAnimation from .lottie: NULL\n  BUG CONFIRMED: .lottie file returns null Animation (silent failure)\n\n=== Test 3: Load .lottie data via SKData ===\nAnimation from .lottie data: NULL\n  BUG CONFIRMED: .lottie data also returns null Animation\n\nSUCCESS: test completed",
      "result": "wrong-output"
    },
    {
      "stepNumber": 6,
      "description": "Test on main branch source \u2014 run existing Skottie tests (42 tests, all JSON-based) and confirm Animation.Create code has no dotLottie support",
      "layer": "csharp",
      "command": "cd $REPO && dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --filter \"FullyQualifiedName~AnimationTest\" --no-restore",
      "exitCode": 0,
      "output": "Passed! - Failed: 0, Passed: 42, Skipped: 0, Total: 42, Duration: 1 s\n\nAnimation.Create(string path) on main reads file to SKData and passes raw bytes to skottie_animation_make_from_data(). No ZIP detection or dotLottie handling exists.",
      "result": "wrong-output"
    }
  ],
  "errorMessages": {
    "primaryError": "Animation.Create() returns null when given a .lottie file (dotLottie ZIP format). No exception is thrown \u2014 silent failure.",
    "additionalErrors": [
      "Animation.Create(SKData) also returns null for .lottie data \u2014 same root cause, the Skottie JSON parser cannot parse ZIP binary data."
    ]
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.23",
    "dotnetSdkVersion": "10.0.102",
    "skiaSharpVersion": "3.116.0",
    "dockerUsed": false
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "classification",
        "upstream": "type/question (confidence 0.8) \u2014 triage classified as question since API is working as designed",
        "corrected": "Reproduction confirms the reported behavior occurs (null return). Classification as question vs bug is editorial \u2014 the factual conclusion is reproduced. However, triage's analysis that this is working-as-designed is correct: Skottie only supports JSON, not dotLottie ZIP."
      }
    ]
  },
  "output": {
    "actionability": {
      "suggestedAction": "close-with-docs",
      "confidence": 0.85,
      "reason": "Reproduced on all tested versions including main. The behavior is by design \u2014 Skia's Skottie module only parses Lottie JSON, not the dotLottie container format (ZIP). The reporter needs to extract JSON from the .lottie file or download raw .json from LottieFiles. This is a documentation/awareness gap, not a code defect."
    },
    "workarounds": [
      "Download the Lottie JSON format (.json) directly from LottieFiles instead of the dotLottie format (.lottie).",
      "Extract the Lottie JSON from the .lottie ZIP archive before passing to Animation.Create(). The .lottie format is a ZIP containing animations/*.json files: using var zip = ZipFile.OpenRead(\"file.lottie\"); var entry = zip.Entries.First(e => e.FullName.EndsWith(\".json\") && e.FullName.StartsWith(\"animations/\")); using var stream = entry.Open(); var animation = Animation.Create(stream);"
    ],
    "proposedResponse": {
      "status": "ready",
      "summary": "Reproduced \u2014 .lottie is a ZIP format not supported by Skottie; workaround provided.",
      "body": "Thanks for reporting this! We were able to reproduce the issue \u2014 `Animation.Create()` does return `null` when given a `.lottie` file.\n\nThe reason is that `.lottie` files use the **dotLottie format**, which is a ZIP archive containing Lottie JSON animations and a manifest. Skia's Skottie module (which SkiaSharp wraps) only understands raw **Lottie JSON** \u2014 it cannot parse ZIP archives.\n\nThis is a common source of confusion because [LottieFiles](https://lottiefiles.com) now defaults to `.lottie` downloads rather than raw `.json`.\n\n**Workarounds:**\n\n1. **Download the JSON format** from LottieFiles instead of `.lottie` (look for the `.json` download option)\n\n2. **Extract the JSON** from the `.lottie` ZIP before loading:\n```csharp\nusing System.IO.Compression;\n\nusing var zip = ZipFile.OpenRead(\"animation.lottie\");\nvar entry = zip.Entries.First(e => e.FullName.EndsWith(\".json\") \n    && e.FullName.StartsWith(\"animations/\"));\nusing var stream = entry.Open();\nvar animation = SkiaSharp.Skottie.Animation.Create(stream);\n```\n\n**Tested versions:**\n| Version | Result |\n|---------|--------|\n| 3.116.0 (reported) | \u274c null (expected \u2014 ZIP not supported) |\n| 3.119.2 (latest) | \u274c null (same) |\n| main (source) | \u274c null (same) |\n\nNote: Adding dotLottie format support would require new functionality in the Skottie module. This could be tracked as a feature request if there's interest."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Add area/Skottie label to indicate this is specific to the Skottie sub-module",
        "risk": "low",
        "confidence": 0.9,
        "labels": [
          "area/Skottie"
        ]
      },
      {
        "type": "add-comment",
        "description": "Post reproduction results with workarounds for extracting JSON from .lottie files",
        "risk": "low",
        "confidence": 0.85
      }
    ]
  }
}