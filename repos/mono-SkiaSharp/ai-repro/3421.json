{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3421,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T00:26:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/3421.json"
  },
  "conclusion": "reproduced",
  "notes": "Reproduced: Animation.Create() returns null when given a .lottie file (ZIP archive containing Lottie JSON). The Skottie API only understands raw Lottie JSON — it passes file bytes directly to skottie_animation_make_from_data, which expects JSON, not a ZIP container. The .lottie format (a ZIP containing animations/*.json and a manifest) is not handled at either the C API or C# layer. Loading the same Lottie JSON from a .json file or via Animation.Parse() works correctly. Reproduced on 3.116.0 (reporter's version), 3.119.2 (latest), and main (source).",
  "assessment": "likely-bug",
  "reproductionTime": "~12 minutes",
  "versionResults": [
    {
      "version": "3.116.0",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Animation.Create() returns null for .lottie ZIP files; raw .json works fine."
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Same behavior as 3.116.0 — .lottie returns null."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "reproduced",
      "notes": "Built from source and ran test confirming .lottie returns null. No .lottie/ZIP handling exists in the codebase."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "3.116.0"
      },
      {
        "name": "SkiaSharp.Skottie",
        "version": "3.116.0"
      }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create standalone console project with SkiaSharp.Skottie 3.116.0",
      "layer": "setup",
      "command": "dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 3.116.0 && dotnet add package SkiaSharp.Skottie --version 3.116.0",
      "exitCode": 0,
      "output": "Restore succeeded.",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Write reproduction code that creates both a raw .json and a .lottie (ZIP) file containing the same Lottie animation, then attempts to load both via Animation.Create()",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Creates minimal Lottie JSON and .lottie ZIP, tests Animation.Create() with .json (control), .lottie file path, .lottie stream, and Parse() with raw JSON string.",
          "content": "using System;\nusing System.IO;\nusing System.IO.Compression;\nusing SkiaSharp.Skottie;\n\nvar lottieJson = \"\"\"\n{\n  \"v\": \"5.5.2\", \"fr\": 30, \"ip\": 0, \"op\": 60, \"w\": 100, \"h\": 100,\n  \"layers\": [{ \"ty\": 1, \"nm\": \"Solid\", \"sr\": 1,\n    \"ks\": { \"o\": {\"a\":0,\"k\":100}, \"r\": {\"a\":0,\"k\":0},\n      \"p\": {\"a\":0,\"k\":[50,50,0]}, \"a\": {\"a\":0,\"k\":[50,50,0]},\n      \"s\": {\"a\":0,\"k\":[100,100,100]} },\n    \"ao\": 0, \"sw\": 100, \"sh\": 100, \"sc\": \"#ff0000\", \"ip\": 0, \"op\": 60, \"st\": 0 }]\n}\n\"\"\";\n\nvar jsonPath = Path.Combine(AppContext.BaseDirectory, \"test.json\");\nvar lottiePath = Path.Combine(AppContext.BaseDirectory, \"test.lottie\");\nFile.WriteAllText(jsonPath, lottieJson);\nusing (var zip = ZipFile.Open(lottiePath, ZipArchiveMode.Create))\n{\n    var entry = zip.CreateEntry(\"animations/anim.json\");\n    using var writer = new StreamWriter(entry.Open());\n    writer.Write(lottieJson);\n}\n\nConsole.WriteLine(\"=== Test 1: Load .json file ===\");\nvar jsonAnim = Animation.Create(jsonPath);\nConsole.WriteLine($\"Animation from .json: {(jsonAnim != null ? \"SUCCESS\" : \"NULL\")}\");\njsonAnim?.Dispose();\n\nConsole.WriteLine(\"=== Test 2: Load .lottie file ===\");\nvar lottieAnim = Animation.Create(lottiePath);\nConsole.WriteLine($\"Animation from .lottie: {(lottieAnim != null ? \"SUCCESS\" : \"NULL\")}\");\nlottieAnim?.Dispose();\n\nConsole.WriteLine(\"=== Test 3: Load .lottie via Stream ===\");\nusing var stream = File.OpenRead(lottiePath);\nvar streamAnim = Animation.Create(stream);\nConsole.WriteLine($\"Animation from .lottie stream: {(streamAnim != null ? \"SUCCESS\" : \"NULL\")}\");\nstreamAnim?.Dispose();\n\nConsole.WriteLine(\"=== Test 4: Parse raw JSON string ===\");\nvar parsedAnim = Animation.Parse(lottieJson);\nConsole.WriteLine($\"Animation from Parse(): {(parsedAnim != null ? \"SUCCESS\" : \"NULL\")}\");\nparsedAnim?.Dispose();"
        }
      ]
    },
    {
      "stepNumber": 3,
      "description": "Run reproduction with SkiaSharp 3.116.0 (reporter's version). Raw .json succeeds, .lottie file returns null — confirming the reported behavior.",
      "layer": "csharp",
      "command": "dotnet run",
      "exitCode": 0,
      "output": "Runtime: osx-arm64\n.NET Version: 8.0.23\nSkiaSharp.Skottie loaded\n\n=== Test 1: Load .json file ===\nAnimation from .json: SUCCESS (not null)\n  Duration: 00:00:02\n  Size: {Width=100, Height=100}\n  FPS: 30\n\n=== Test 2: Load .lottie file ===\nAnimation from .lottie: NULL\n\n=== Test 3: Load .lottie via Stream ===\nAnimation from .lottie stream: NULL\n\n=== Test 4: Parse raw JSON string ===\nAnimation from Parse(): SUCCESS (not null)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Update to latest SkiaSharp 3.119.2 and rerun. Same behavior: .lottie returns null, .json works.",
      "layer": "csharp",
      "command": "dotnet add package SkiaSharp && dotnet add package SkiaSharp.Skottie && dotnet run",
      "exitCode": 0,
      "output": "=== Test 1: Load .json file ===\nAnimation from .json: SUCCESS (not null)\n  Duration: 00:00:02\n  Size: {Width=100, Height=100}\n  FPS: 30\n\n=== Test 2: Load .lottie file ===\nAnimation from .lottie: NULL\n\n=== Test 3: Load .lottie via Stream ===\nAnimation from .lottie stream: NULL\n\n=== Test 4: Parse raw JSON string ===\nAnimation from Parse(): SUCCESS (not null)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 5,
      "description": "Test on main (source): Built test project from source, added test that creates a .lottie ZIP and verifies Animation.Create returns null. Test passed, confirming bug exists on main. No .lottie/ZIP handling code found anywhere in binding/SkiaSharp.Skottie/.",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj -p:TargetFramework=net8.0 --filter \"FullyQualifiedName~DotLottieFileReturnsNull\"",
      "exitCode": 0,
      "output": "Passed!  - Failed:     0, Passed:     1, Skipped:     0, Total:     1, Duration: < 1 ms - SkiaSharp.Tests.dll (net8.0)",
      "result": "success"
    }
  ],
  "errorMessages": {
    "primaryError": "Animation.Create() returns null for .lottie files (ZIP archives) because Skottie expects raw Lottie JSON data, not the .lottie container format."
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "3.116.0",
    "dockerUsed": false
  }
}
