{
  "meta": {
    "schemaVersion": "1.0",
    "number": 2759,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T14:25:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/2759.json"
  },
  "conclusion": "reproduced",
  "assessment": "unknown",
  "notes": "Reproduced: SKBitmap.Decode returns null for the PNG image embedded in referenced issue #933. The PNG has a corrupted IDAT chunk CRC (stored=0xe9ce4a73, actual=0xe9ce643b) while the zlib payload decompresses correctly to the expected 92568 bytes. libpng validates CRC and rejects the chunk, causing SKCodec.GetPixels to return ErrorInInput. The failure is consistent across ALL tested versions (2.88.0, 2.88.2, 2.88.3, 3.119.2, main) \u2014 contradicting the reporter's claim that 2.88.2 was 'last known good'. Note: the reporter did not attach the actual PNG in #2759; the test image was retrieved from the GitHub CDN URL in #933. GitHub's image processing may have introduced the CRC corruption. The reporter's original file may differ.",
  "reproductionTime": "~10 minutes",
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "2.88.3"
      }
    ]
  },
  "versionResults": [
    {
      "version": "2.88.0",
      "source": "nuget",
      "result": "reproduced",
      "notes": "SKBitmap.Decode returns null, SKCodec.GetPixels returns ErrorInInput"
    },
    {
      "version": "2.88.2",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Same failure \u2014 contradicts reporter's claim this was 'last known good'"
    },
    {
      "version": "2.88.3",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Reporter's stated version. SKBitmap.Decode returns null, ErrorInInput from codec"
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Latest stable. Same failure"
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "reproduced",
      "notes": "Test Issue2759_DecodePngReturnsNull failed: Assert.NotNull() on SKBitmap.Decode result"
    }
  ],
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create standalone console project with SkiaSharp 2.88.3",
      "layer": "setup",
      "command": "dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 2.88.3",
      "exitCode": 0,
      "result": "success",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Reproduction code that decodes PNG files using SKBitmap.Decode, SKData-based Decode, and SKCodec.Create with result inspection",
          "content": "using SkiaSharp;\nusing System;\nusing System.IO;\nusing System.Runtime.InteropServices;\n\nConsole.WriteLine($\"SkiaSharp Version: {typeof(SKBitmap).Assembly.GetName().Version}\");\nConsole.WriteLine($\"OS: {RuntimeInformation.OSDescription}\");\nConsole.WriteLine($\"Arch: {RuntimeInformation.ProcessArchitecture}\");\n\nforeach (var path in args)\n{\n    Console.WriteLine($\"--- Testing: {Path.GetFileName(path)} ---\");\n    if (!File.Exists(path)) { Console.WriteLine($\"  File not found\"); continue; }\n    Console.WriteLine($\"  Size: {new FileInfo(path).Length} bytes\");\n    using var bmp1 = SKBitmap.Decode(path);\n    Console.WriteLine($\"  SKBitmap.Decode(path): {(bmp1 != null ? $\"OK ({bmp1.Width}x{bmp1.Height})\" : \"NULL\")}\");\n    using var data = SKData.Create(path);\n    if (data != null) { using var bmp2 = SKBitmap.Decode(data); Console.WriteLine($\"  SKBitmap.Decode(data): {(bmp2 != null ? $\"OK ({bmp2.Width}x{bmp2.Height})\" : \"NULL\")}\"); }\n    using var stream = File.OpenRead(path);\n    using var skStream = new SKManagedStream(stream);\n    using var codec = SKCodec.Create(skStream, out var codecResult);\n    Console.WriteLine($\"  SKCodec.Create result: {codecResult}\");\n    if (codec != null) {\n        Console.WriteLine($\"  Codec info: {codec.Info.Width}x{codec.Info.Height}, {codec.EncodedFormat}\");\n        var info = new SKImageInfo(codec.Info.Width, codec.Info.Height);\n        using var bmp3 = new SKBitmap(info);\n        var decodeResult = codec.GetPixels(info, bmp3.GetPixels());\n        Console.WriteLine($\"  Codec.GetPixels result: {decodeResult}\");\n    }\n}"
        },
        {
          "filename": "Repro.csproj",
          "description": "Project file targeting net8.0 with SkiaSharp 2.88.3",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n  </PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp\" Version=\"2.88.3\" />\n  </ItemGroup>\n</Project>"
        }
      ]
    },
    {
      "stepNumber": 2,
      "description": "Download test PNG from issue #933 (referenced by #2759). The reporter attached the problematic image in the original issue as an inline <img> tag.",
      "layer": "setup",
      "command": "curl -sLo image1.png https://user-images.githubusercontent.com/31235892/63347183-4943cb80-c35f-11e9-8d58-247cad52b13b.png",
      "exitCode": 0,
      "output": "Downloaded 29310 bytes. file: PNG image data, 152x152, 8-bit/color RGBA, non-interlaced",
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Run reproduction with SkiaSharp 2.88.3 (reporter's version). SKBitmap.Decode returns null, SKCodec.GetPixels returns ErrorInInput.",
      "layer": "csharp",
      "command": "dotnet run -- image1.png",
      "exitCode": 0,
      "output": "SkiaSharp Version: 2.88.0.0\nOS: Darwin 25.2.0\nArch: Arm64\n\n--- Testing: image1.png ---\n  Size: 29310 bytes\n  SKBitmap.Decode(path): NULL\n  SKBitmap.Decode(data): NULL\n  SKCodec.Create result: Success\n  Codec info: 152x152, Png\n  Codec.GetPixels result: ErrorInInput",
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Verify standard PNGs decode correctly (baboon.png, color-wheel.png, index8.png) \u2014 confirms the issue is specific to this PNG, not a general decode failure.",
      "layer": "csharp",
      "command": "dotnet run -- baboon.png color-wheel.png index8.png",
      "exitCode": 0,
      "output": "--- Testing: baboon.png ---\n  SKBitmap.Decode(path): OK (512x512)\n  SKCodec.Create result: Success\n  Codec.GetPixels result: Success\n--- Testing: color-wheel.png ---\n  SKBitmap.Decode(path): OK (128x128)\n--- Testing: index8.png ---\n  SKBitmap.Decode(path): OK (1024x1218)",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Analyze PNG structure \u2014 found IDAT chunk CRC mismatch (stored=0xe9ce4a73, actual=0xe9ce643b). The zlib payload decompresses correctly to 92568 bytes (expected for 152x152 RGBA). libpng validates CRC and rejects the chunk.",
      "layer": "native",
      "command": "python3 analyze_png.py image1.png",
      "output": "PNG signature: valid\nIHDR: 152x152, bit_depth=8, color_type=6 (RGBA), non-interlaced\nIDAT CRC: MISMATCH (stored=0xe9ce4a73 actual=0xe9ce643b)\nZlib decompress: OK (92568 bytes, matches expected)",
      "result": "failure"
    },
    {
      "stepNumber": 6,
      "description": "Test with reporter's 'last known good' version 2.88.2 \u2014 same failure, contradicting regression claim.",
      "layer": "csharp",
      "command": "dotnet add package SkiaSharp --version 2.88.2 && dotnet run -- image1.png",
      "exitCode": 0,
      "output": "SKBitmap.Decode(path): NULL\nSKCodec.Create result: Success\nCodec.GetPixels result: ErrorInInput",
      "result": "wrong-output"
    },
    {
      "stepNumber": 7,
      "description": "Test with latest stable SkiaSharp 3.119.2 \u2014 same failure persists.",
      "layer": "csharp",
      "command": "dotnet add package SkiaSharp --version 3.119.2 && dotnet run -- image1.png",
      "exitCode": 0,
      "output": "SkiaSharp Version: 3.119.0.0\nSKBitmap.Decode(path): NULL\nSKCodec.Create result: Success\nCodec.GetPixels result: ErrorInInput",
      "result": "wrong-output"
    },
    {
      "stepNumber": 8,
      "description": "Test on main branch (source). Built test project, added temporary test Issue2759_DecodePngReturnsNull \u2014 Assert.NotNull failed on SKBitmap.Decode.",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --filter Issue2759",
      "exitCode": 1,
      "output": "Failed Issue2759_DecodePngReturnsNull\nError Message: Assert.NotNull() Failure\nStack Trace: at SKBitmapTest.Issue2759_DecodePngReturnsNull() in SKBitmapTest.cs:line 29\n\nTest Run Failed. Total: 1, Failed: 1",
      "result": "failure"
    }
  ],
  "artifacts": [
    {
      "filename": "image1.png",
      "description": "152x152 RGBA PNG from issue #933 with corrupted IDAT CRC. Zlib data decompresses correctly but chunk CRC validation fails in libpng.",
      "source": "issue-attachment",
      "url": "https://user-images.githubusercontent.com/31235892/63347183-4943cb80-c35f-11e9-8d58-247cad52b13b.png",
      "available": true
    }
  ],
  "errorMessages": {
    "primaryError": "SKBitmap.Decode returns null; SKCodec.GetPixels returns ErrorInInput",
    "additionalErrors": [
      "PNG IDAT chunk CRC mismatch: stored=0xe9ce4a73, actual=0xe9ce643b",
      "Failure is consistent across SkiaSharp 2.88.0, 2.88.2, 2.88.3, 3.119.2, and main (source)"
    ]
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "2.88.3",
    "dockerUsed": false
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "version-regression",
        "upstream": "Triage noted workedIn=2.88.2, brokeIn=2.88.3, suggesting a regression between those versions",
        "corrected": "Tested 2.88.0, 2.88.2, 2.88.3, 3.119.2, and main \u2014 all fail identically. No regression found. The PNG has a corrupted IDAT CRC which is rejected by libpng on all versions."
      },
      {
        "topic": "root-cause",
        "upstream": "Triage suggested possible relation to zlib SSE fix from #1981/PR #2045",
        "corrected": "Not related to zlib SSE. The issue is a PNG with corrupted IDAT chunk CRC. The zlib payload is valid but libpng rejects the chunk due to CRC validation. This is arguably correct behavior \u2014 the PNG violates spec."
      }
    ]
  }
}