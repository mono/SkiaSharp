{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3188,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T16:40:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/3188.json"
  },
  "conclusion": "wrong-output",
  "assessment": "breaking-change",
  "scope": "universal",
  "notes": "Confirmed: DrawVertices outputs a solid black triangle instead of a colored gradient in SkiaSharp v3. Reproduced on v3.116.1 (reporter's version), v3.119.2 (latest stable), and main branch source. Works correctly on v2.88.9. Root cause is an upstream Skia behavior change — drawVertices now blends the paint's opaque color (default black) with vertex colors via Modulate blend mode. Black × any color = black. Verified workaround: setting paint.Color = SKColors.White preserves vertex colors. Reproduced on both macOS arm64 and Docker Linux x64 — universal scope.",
  "reproductionTime": "~15 minutes",
  "versionResults": [
    {
      "version": "2.88.9",
      "source": "nuget",
      "result": "not-reproduced",
      "platform": "host-macos-arm64",
      "notes": "Triangle renders with correct RGB gradient. Center pixel: R=84 G=43 B=85."
    },
    {
      "version": "3.116.1",
      "source": "nuget",
      "result": "wrong-output",
      "platform": "host-macos-arm64",
      "notes": "Reporter's version. Triangle is solid black. Center pixel: R=0 G=0 B=0."
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "wrong-output",
      "platform": "host-macos-arm64",
      "notes": "Latest stable. Bug still present. Center pixel: R=0 G=0 B=0."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "wrong-output",
      "platform": "host-macos-arm64",
      "notes": "Bug still present on main branch. Center pixel: R=0 G=0 B=0."
    },
    {
      "version": "3.116.1",
      "source": "nuget",
      "result": "wrong-output",
      "platform": "docker-linux-x64",
      "notes": "Cross-platform verification. Same black triangle on Linux x64."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      { "name": "SkiaSharp", "version": "3.116.1" }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project with reporter's SkiaSharp version (3.116.1)",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-3188 && cd /tmp/repro-3188 && dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 3.116.1",
      "exitCode": 0,
      "output": "The template \"Console App\" was created successfully.\nPackageReference for package 'SkiaSharp' version '3.116.1' added.",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Write reproduction code from issue: create 200x200 surface, clear white, draw triangle with RGB vertex colors using DrawVertices, save PNG, sample pixel colors to verify",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Console app that draws a triangle with DrawVertices using Red/Green/Blue vertex colors, saves to PNG, then samples pixel colors to detect black triangle bug.",
          "content": "using SkiaSharp;\n\nvar imageInfo = new SKImageInfo(width: 200, height: 200, colorType: SKColorType.Rgba8888, alphaType: SKAlphaType.Premul);\nvar surface = SKSurface.Create(imageInfo);\nsurface.Canvas.Clear(SKColors.White);\nvar paint = new SKPaint { IsAntialias = true };\nvar vertices = new[] { new SKPoint(110, 20), new SKPoint(160, 200), new SKPoint(10, 200) };\nvar colors = new[] { SKColors.Red, SKColors.Green, SKColors.Blue };\nsurface.Canvas.DrawVertices(SKVertexMode.Triangles, vertices, colors, paint);\n\nusing var data = surface.Snapshot();\nusing var pngImage = data.Encode(SKEncodedImageFormat.Png, 100);\nusing var fileStream = File.Create(\"output.png\");\npngImage.SaveTo(fileStream);\nfileStream.Close();\n\nusing var bitmap = SKBitmap.Decode(\"output.png\");\nvar centerPixel = bitmap.GetPixel(93, 140);\nvar nearRedVertex = bitmap.GetPixel(110, 30);\nvar cornerPixel = bitmap.GetPixel(0, 0);\n\nConsole.WriteLine($\"SkiaSharp version: {typeof(SKSurface).Assembly.GetName().Version}\");\nConsole.WriteLine($\"Center pixel (93,140): R={centerPixel.Red} G={centerPixel.Green} B={centerPixel.Blue} A={centerPixel.Alpha}\");\nConsole.WriteLine($\"Near red vertex (110,30): R={nearRedVertex.Red} G={nearRedVertex.Green} B={nearRedVertex.Blue} A={nearRedVertex.Alpha}\");\nConsole.WriteLine($\"Corner pixel (0,0): R={cornerPixel.Red} G={cornerPixel.Green} B={cornerPixel.Blue} A={cornerPixel.Alpha}\");\n\nbool isBlackTriangle = centerPixel.Red < 10 && centerPixel.Green < 10 && centerPixel.Blue < 10;\nbool cornerIsWhite = cornerPixel.Red > 240 && cornerPixel.Green > 240 && cornerPixel.Blue > 240;\n\nif (isBlackTriangle && cornerIsWhite)\n    Console.WriteLine(\"BUG CONFIRMED: Triangle is black (vertex colors not applied)\");\nelse if (!isBlackTriangle && cornerIsWhite)\n    Console.WriteLine(\"SUCCESS: Triangle has vertex colors (gradient visible)\");\nelse\n    Console.WriteLine($\"UNEXPECTED: Center black={isBlackTriangle}, corner white={cornerIsWhite}\");"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Run with SkiaSharp 3.116.1 (reporter's version). Triangle renders solid black — all vertex color information is lost.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188/Repro && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.116.0.0\nCenter pixel (93,140): R=0 G=0 B=0 A=255\nNear red vertex (110,30): R=0 G=0 B=0 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nBUG CONFIRMED: Triangle is black (vertex colors not applied)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Test with v2.88.9 (reporter's last known good). Triangle renders correctly with RGB gradient.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188-v2/Repro && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 2.88.0.0\nCenter pixel (93,140): R=84 G=43 B=85 A=255\nNear red vertex (110,30): R=240 G=5 B=4 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nSUCCESS: Triangle has vertex colors (gradient visible)",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Test with latest stable v3.119.2. Bug still present — black triangle.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188-latest/Repro && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nCenter pixel (93,140): R=0 G=0 B=0 A=255\nNear red vertex (110,30): R=0 G=0 B=0 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nBUG CONFIRMED: Triangle is black (vertex colors not applied)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 6,
      "description": "Test against main branch source (built from local repo). Bug still present.",
      "layer": "csharp",
      "command": "dotnet run --project samples/Basic/Console/SkiaSharpSample/SkiaSharpSample.csproj",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nCenter pixel (93,140): R=0 G=0 B=0 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nBUG CONFIRMED: Triangle is black",
      "result": "wrong-output"
    },
    {
      "stepNumber": 7,
      "description": "Cross-platform verification on Docker Linux x64 with v3.116.1. Same black triangle — confirms universal scope.",
      "layer": "csharp",
      "command": "docker run --rm --platform linux/amd64 mcr.microsoft.com/dotnet/sdk:8.0 bash -c '...'",
      "exitCode": 0,
      "output": "Center: R=0 G=0 B=0\nCorner: R=255 G=255 B=255\nBUG CONFIRMED: Triangle is black",
      "result": "wrong-output"
    },
    {
      "stepNumber": 8,
      "description": "Verify workaround: set paint.Color = SKColors.White. Triangle renders correctly with colored gradient, confirming the root cause is default black paint being modulated with vertex colors.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188/Repro && dotnet run (with paint.Color = SKColors.White)",
      "exitCode": 0,
      "output": "Center: R=84 G=43 B=85\nCorner: R=255 G=255 B=255\nWORKAROUND WORKS: Triangle has vertex colors",
      "result": "success"
    }
  ],
  "errorMessages": {
    "primaryError": "DrawVertices outputs solid black triangle instead of colored gradient. All vertex color information is lost because default black paint color is modulated with vertex colors (black × anything = black)."
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "10.0.102",
    "dotnetSdkVersion": "10.0.102",
    "skiaSharpVersion": "3.116.1",
    "dockerUsed": true
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "affected-platforms",
        "upstream": "Triage classified as os/Windows-Classic only",
        "corrected": "Bug is universal — reproduced on macOS arm64 and Docker Linux x64. Not Windows-specific."
      }
    ]
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.92,
      "reason": "Bug reproduced on all v3 versions including latest stable (3.119.2) and main branch. Not fixed anywhere. This is a regression from v2 caused by upstream Skia behavior change in drawVertices blending. Needs investigation to determine whether SkiaSharp should add a compatibility shim in convenience DrawVertices overloads."
    },
    "workarounds": [
      "Set paint.Color = SKColors.White before calling DrawVertices — white (1,1,1,1) modulated with vertex colors preserves the original gradient",
      "Set paint.Shader = SKShader.CreateColor(SKColors.White) for the same effect via a shader",
      "Use the overload DrawVertices(SKVertexMode, SKPoint[], SKPoint[], SKColor[], SKBlendMode, UInt16[], SKPaint) with SKBlendMode.Dst to ignore paint color entirely"
    ],
    "proposedResponse": {
      "status": "ready",
      "summary": "Confirmed regression: DrawVertices black triangle due to upstream Skia behavior change. Workaround: set paint color to white.",
      "body": "Thanks for the clear report and reproduction code! We've confirmed this issue.\n\nThis is a behavior change in the upstream Skia library used by SkiaSharp v3. In v3, `drawVertices` blends the paint's color (src) with vertex colors (dst) using the blend mode. The convenience `DrawVertices` overloads use `SKBlendMode.Modulate` (src × dst), and since `SKPaint` defaults to opaque black `{0,0,0,1}`, the result is `black × vertex_color = black`.\n\n**Tested versions:**\n| Version | Platform | Result |\n|---------|----------|--------|\n| 2.88.9 | macOS arm64 | ✅ Colored gradient |\n| 3.116.1 | macOS arm64 | ❌ Black triangle |\n| 3.119.2 | macOS arm64 | ❌ Black triangle |\n| main (source) | macOS arm64 | ❌ Black triangle |\n| 3.116.1 | Docker Linux x64 | ❌ Black triangle |\n\n**Workaround** — set the paint color to white so Modulate preserves vertex colors:\n\n```csharp\nvar paint = new SKPaint\n{\n    IsAntialias = true,\n    Color = SKColors.White\n};\n```\n\nAlternatively, use `Shader = SKShader.CreateColor(SKColors.White)` or use the lower-level `DrawVertices` overload with `SKBlendMode.Dst` to ignore paint color entirely.\n\nWe're tracking this for a fix."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Add area/SkiaSharp and tenet/compatibility labels, confirm type/bug",
        "risk": "low",
        "confidence": 0.95,
        "labels": ["type/bug", "area/SkiaSharp", "tenet/compatibility"]
      }
    ]
  }
}
