{
  "meta": {
    "schemaVersion": "1.0",
    "number": 648,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T17:25:00Z"
  },
  "conclusion": "not-reproduced",
  "notes": "Tested large image (14034x9921, ~530MB uncompressed) resize workflow on macOS arm64 with ample RAM. Bitmap allocation succeeds, resize produces correct non-blank output, and SKBitmap.FromImage works on all versions tested (2.88.9, 3.119.2, main source). The original issue from 2018 was likely due to Skia library limitations at the time (confirmed by maintainer comment linking to Skia discussion group) and/or constrained memory environments. Cannot reproduce on modern 64-bit hardware with current Skia versions.",
  "assessment": "likely-bug",
  "reproductionTime": "~8 minutes",
  "versionResults": [
    {
      "version": "2.88.9",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "14034x9921 bitmap allocates fine, resize to 1527x1080 produces correct output with 100% non-white pixels sampled."
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "Same result as 2.88.9. Adapted code for 3.x API (SKSamplingOptions instead of SKFilterQuality)."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "not-reproduced",
      "notes": "xUnit test LargeImageResizeDoesNotProduceBlankOutput passed — bitmap allocation and resize both succeed."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      { "name": "SkiaSharp", "version": "2.88.9" },
      { "name": "SkiaSharp.NativeAssets.macOS", "version": "2.88.9" }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create standalone console project with SkiaSharp 2.88.9",
      "layer": "setup",
      "command": "dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 2.88.9 && dotnet add package SkiaSharp.NativeAssets.macOS --version 2.88.9",
      "exitCode": 0,
      "output": "The template \"Console App\" was created successfully.\nRestored /tmp/repro-648/Repro/Repro.csproj",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project targeting net8.0 with SkiaSharp 2.88.9",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp\" Version=\"2.88.9\" />\n    <PackageReference Include=\"SkiaSharp.NativeAssets.macOS\" Version=\"2.88.9\" />\n  </ItemGroup>\n</Project>"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Write reproduction code: allocate 14034x9921 bitmap, encode to JPEG, resize using reporter's pattern, verify output is not blank",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Reproduction code testing 4 aspects: bitmap allocation at reporter's dimensions, JPEG encoding of large bitmap, resize workflow matching reporter's code pattern, and SKBitmap.FromImage with large data",
          "content": "using System;\nusing System.IO;\nusing SkiaSharp;\n\nConsole.WriteLine($\"SkiaSharp Version: {typeof(SKBitmap).Assembly.GetName().Version}\");\nConsole.WriteLine($\"Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\");\nConsole.WriteLine($\"OS: {System.Runtime.InteropServices.RuntimeInformation.OSDescription}\");\nConsole.WriteLine($\"Arch: {System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture}\");\nConsole.WriteLine();\n\nint sourceWidth = 14034;\nint sourceHeight = 9921;\nlong pixelBytes = (long)sourceWidth * sourceHeight * 4;\nConsole.WriteLine($\"=== Test 1: Allocate SKBitmap at {sourceWidth}x{sourceHeight} ({pixelBytes / 1024 / 1024}MB) ===\");\n\nSKBitmap? largeBitmap = null;\ntry\n{\n    largeBitmap = new SKBitmap(sourceWidth, sourceHeight);\n    if (largeBitmap.GetPixels() == IntPtr.Zero)\n        Console.WriteLine(\"ERROR: SKBitmap created but GetPixels() returned IntPtr.Zero\");\n    else\n        Console.WriteLine($\"SUCCESS: SKBitmap allocated ({largeBitmap.Width}x{largeBitmap.Height})\");\n}\ncatch (Exception ex)\n{\n    Console.WriteLine($\"EXCEPTION: {ex.GetType().Name}: {ex.Message}\");\n}\n\n// Generate large JPEG, resize using reporter's pattern, verify output\nif (largeBitmap != null && largeBitmap.GetPixels() != IntPtr.Zero)\n{\n    using var canvas = new SKCanvas(largeBitmap);\n    canvas.Clear(SKColors.Blue);\n    using var paint = new SKPaint { Color = SKColors.Red };\n    canvas.DrawRect(0, 0, sourceWidth / 2f, sourceHeight / 2f, paint);\n    canvas.Flush();\n\n    using var img = SKImage.FromBitmap(largeBitmap);\n    using var encoded = img.Encode(SKEncodedImageFormat.Jpeg, 80);\n    var imageData = encoded.ToArray();\n\n    using var sourceStream = new SKMemoryStream(imageData);\n    using var codec = SKCodec.Create(sourceStream);\n    sourceStream.Seek(0);\n    using var image = SKImage.FromEncodedData(SKData.Create(sourceStream));\n\n    int newW = 1527, newH = 1080;\n    var info = new SKImageInfo(newW, newH);\n    using var surface = SKSurface.Create(info);\n    using var rpaint = new SKPaint { IsAntialias = true, FilterQuality = SKFilterQuality.High };\n    surface.Canvas.Clear(SKColors.White);\n    surface.Canvas.DrawImage(image, new SKRect(0, 0, newW, newH), rpaint);\n    surface.Canvas.Flush();\n\n    using var newImage = surface.Snapshot();\n    using var newImageData = newImage.Encode(SKEncodedImageFormat.Jpeg, 85);\n    // Verify output is not blank by sampling pixels\n    using var outputBitmap = SKBitmap.FromImage(SKImage.FromEncodedData(newImageData));\n    int nonWhite = 0, total = 0;\n    for (int y = 0; y < outputBitmap.Height; y += 50)\n        for (int x = 0; x < outputBitmap.Width; x += 50)\n        {\n            total++;\n            if (outputBitmap.GetPixel(x, y) != SKColors.White) nonWhite++;\n        }\n    Console.WriteLine($\"Pixel check: {nonWhite}/{total} non-white\");\n    if (nonWhite == 0) Console.WriteLine(\"BUG: Output is blank\");\n    else Console.WriteLine(\"Output has content — not blank\");\n    largeBitmap.Dispose();\n}"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Run reproduction with SkiaSharp 2.88.9 — test large bitmap allocation and resize",
      "layer": "csharp",
      "command": "cd /tmp/repro-648/Repro && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp Version: 2.88.0.0\nRuntime: .NET 8.0.23\nOS: Darwin 25.2.0 ...\nArch: Arm64\n\n=== Test 1: Allocate SKBitmap at 14034x9921 (531MB) ===\nSUCCESS: SKBitmap allocated (14034x9921)\n\n=== Test 2: Generate large image and resize ===\nEncoding large bitmap to JPEG...\nEncoded JPEG size: 821KB\n\n=== Test 3: Resize 14034x9921 image using reporter's pattern ===\nCodec: 14034x9921, Format=Jpeg\nImage: 14034x9921\nTarget size: 1527x1080\nOutput saved: output.jpg (12KB)\nPixel check: 315/315 non-white pixels sampled\nRESULT: Output has content (100% non-white) — appears correct\n\n=== Test 4: SKBitmap.FromImage with large image data ===\nImage loaded: 14034x9921\nSUCCESS: SKBitmap created (14034x9921, 531MB)\n\n=== Done ===",
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Run reproduction with SkiaSharp 3.119.2 (latest stable) — adapted for 3.x API (SKSamplingOptions instead of SKFilterQuality)",
      "layer": "csharp",
      "command": "cd /tmp/repro-648/Repro3 && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp Version: 3.119.0.0\nRuntime: .NET 8.0.23\nOS: Darwin 25.2.0 ...\nArch: Arm64\n\n=== Test 1: Allocate SKBitmap at 14034x9921 (531MB) ===\nSUCCESS: SKBitmap allocated (14034x9921)\n\n=== Test 2: Generate large image and resize ===\nEncoding large bitmap to JPEG...\nEncoded JPEG size: 821KB\n\n=== Test 3: Resize using adapted reporter's pattern (3.x API) ===\nCodec: 14034x9921, Format=Jpeg\nImage: 14034x9921\nTarget size: 1527x1080\nOutput saved: output.jpg (12KB)\nPixel check: 315/315 non-white pixels sampled\nRESULT: Output has content (100% non-white) — correct\n\n=== Test 4: SKBitmap.FromImage with large image data ===\nImage loaded: 14034x9921\nSUCCESS: SKBitmap created (14034x9921, 531MB)\n\n=== Done ===",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Run xUnit test against main branch source build — LargeImageResizeDoesNotProduceBlankOutput test",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --no-build --filter \"FullyQualifiedName~LargeImageResize\"",
      "exitCode": 0,
      "output": "Passed!  - Failed: 0, Passed: 1, Skipped: 0, Total: 1, Duration: < 1 ms",
      "result": "success"
    }
  ],
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "2.88.9",
    "dockerUsed": false
  }
}
