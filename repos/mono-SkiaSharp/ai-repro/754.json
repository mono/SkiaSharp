{
  "meta": {
    "schemaVersion": "1.0",
    "number": 754,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T00:35:19Z"
  },
  "conclusion": "reproduced",
  "notes": "Reproduced on SkiaSharp 3.119.1, 3.119.2 (latest), and main (source). SKBitmap.Decode(codec, imageInfo) returns null when requesting SKColorType.Gray8, both with default AlphaType (Premul) and explicit AlphaType.Opaque. The codec reports the image as Rgba8888/Opaque. Default decoding (without specifying Gray8) works fine but returns 4 bytes per pixel. The bug has persisted from 1.68.0 through 3.119.2 and remains unfixed on main.",
  "assessment": "likely-bug",
  "reproductionTime": "~10 minutes",
  "versionResults": [
    {
      "version": "3.119.1",
      "source": "nuget",
      "result": "reproduced",
      "notes": "SKBitmap.Decode returns null when requesting Gray8 color type. Matches reporter's description and latest commenter's confirmation."
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Latest stable release. Same null result when decoding with Gray8."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "reproduced",
      "notes": "Test added to SKBitmapTest fails with Assert.NotNull() — bitmap is null. Bug exists on main."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "3.119.1"
      }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create standalone console project and add SkiaSharp 3.119.1 NuGet package",
      "layer": "setup",
      "command": "dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 3.119.1",
      "exitCode": 0,
      "output": "The template \"Console App\" was created successfully.\nPackageReference for package 'SkiaSharp' version '3.119.1' added.",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project referencing SkiaSharp 3.119.1",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp\" Version=\"3.119.1\" />\n  </ItemGroup>\n</Project>"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Download the 8-bit PNG test image from the issue attachment",
      "layer": "setup",
      "command": "curl -sLo gray8.png 'https://user-images.githubusercontent.com/5593825/51076794-aecf2b80-169d-11e9-9b9b-1c01eeb20467.png'",
      "exitCode": 0,
      "output": "PNG image data, 960 x 960, 8-bit colormap, non-interlaced",
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Write reproduction code that decodes image with Gray8 color type (reporter's exact approach) and also tries default decode and Gray8+Opaque",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Reproduction code: attempts SKBitmap.Decode with Gray8 imageInfo, default decode, and Gray8+Opaque",
          "content": "using SkiaSharp;\n\nConsole.WriteLine($\"SkiaSharp version: {typeof(SKBitmap).Assembly.GetName().Version}\");\nConsole.WriteLine($\"Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\");\n\nvar bytes = File.ReadAllBytes(\"gray8.png\");\nvar stream1 = new MemoryStream(bytes);\nvar codec = SKCodec.Create(stream1);\nConsole.WriteLine($\"Codec Info: {codec.Info.Width}x{codec.Info.Height}, ColorType={codec.Info.ColorType}, AlphaType={codec.Info.AlphaType}\");\nConsole.WriteLine($\"Codec BytesPerPixel: {codec.Info.BytesPerPixel}\");\n\n// Method 1: Reporter's code\nvar imageInfo = new SKImageInfo(codec.Info.Width, codec.Info.Height, SKColorType.Gray8);\nvar bitmap = SKBitmap.Decode(codec, imageInfo);\nConsole.WriteLine($\"Method 1 (Gray8/Premul) bitmap == null: {bitmap == null}\");\n\n// Method 2: Default decode\nvar stream2 = new MemoryStream(bytes);\nvar bitmap2 = SKBitmap.Decode(stream2);\nConsole.WriteLine($\"Method 2 (default) bitmap == null: {bitmap2 == null}\");\nif (bitmap2 != null) Console.WriteLine($\"  BytesPerPixel: {bitmap2.BytesPerPixel}, ColorType: {bitmap2.ColorType}\");\n\n// Method 3: Gray8 + Opaque\nvar stream3 = new MemoryStream(bytes);\nvar codec3 = SKCodec.Create(stream3);\nvar imageInfo3 = new SKImageInfo(codec3.Info.Width, codec3.Info.Height, SKColorType.Gray8, SKAlphaType.Opaque);\nvar bitmap3 = SKBitmap.Decode(codec3, imageInfo3);\nConsole.WriteLine($\"Method 3 (Gray8/Opaque) bitmap == null: {bitmap3 == null}\");"
        }
      ]
    },
    {
      "stepNumber": 4,
      "description": "Run reproduction with SkiaSharp 3.119.1 — SKBitmap.Decode returns null for Gray8",
      "layer": "csharp",
      "command": "dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nRuntime: .NET 8.0.23\n\nImage path: found\n=== Method 1: Reporter's code (Decode with Gray8 imageInfo) ===\nCodec Info: 960x960, ColorType=Rgba8888, AlphaType=Opaque\nCodec BytesPerPixel: 4\nRequested ImageInfo: 960x960, ColorType=Gray8, AlphaType=Premul\nbitmap == null: True\n\n=== Method 2: Default decode (no Gray8 request) ===\nbitmap2.BytesPerPixel: 4\nbitmap2.ColorType: Rgba8888\nbitmap2.Width: 960, Height: 960\n\n=== Method 3: Gray8 with AlphaType.Opaque ===\nRequested ImageInfo: ColorType=Gray8, AlphaType=Opaque\nbitmap3 == null: True",
      "result": "wrong-output"
    },
    {
      "stepNumber": 5,
      "description": "Update to SkiaSharp 3.119.2 (latest stable) and re-run — still null",
      "layer": "csharp",
      "command": "dotnet add package SkiaSharp && dotnet run",
      "exitCode": 0,
      "output": "PackageReference for package 'SkiaSharp' version '3.119.2' updated.\n\nSkiaSharp version: 3.119.0.0\n\n=== Method 1: Reporter's code (Decode with Gray8 imageInfo) ===\nCodec Info: 960x960, ColorType=Rgba8888, AlphaType=Opaque\nCodec BytesPerPixel: 4\nRequested ImageInfo: 960x960, ColorType=Gray8, AlphaType=Premul\nbitmap == null: True\n\n=== Method 2: Default decode (no Gray8 request) ===\nbitmap2.BytesPerPixel: 4\nbitmap2.ColorType: Rgba8888\n\n=== Method 3: Gray8 with AlphaType.Opaque ===\nbitmap3 == null: True",
      "result": "wrong-output"
    },
    {
      "stepNumber": 6,
      "description": "Test on main branch (source) — added xUnit test to SKBitmapTest that calls SKBitmap.Decode(codec, imageInfo) with Gray8. Test fails: Assert.NotNull() Failure.",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --filter DecodeWithGray8",
      "exitCode": 1,
      "output": "[xUnit.net 00:00:30.45]     SkiaSharp.Tests.SKBitmapTest.DecodeWithGray8ColorTypeReturnsNonNullBitmap [FAIL]\n  Failed SkiaSharp.Tests.SKBitmapTest.DecodeWithGray8ColorTypeReturnsNonNullBitmap [231 ms]\n  Error Message:\n   Assert.NotNull() Failure\n  Stack Trace:\n     at SkiaSharp.Tests.SKBitmapTest.DecodeWithGray8ColorTypeReturnsNonNullBitmap() in tests/Tests/SkiaSharp/SKBitmapTest.cs:line 694\n\nFailed!  - Failed: 1, Passed: 0, Skipped: 0, Total: 1",
      "result": "failure"
    }
  ],
  "artifacts": [
    {
      "filename": "gray8.png",
      "description": "960x960 8-bit colormap PNG from the issue. Reporter's test image for Gray8 decoding.",
      "source": "issue-attachment",
      "url": "https://user-images.githubusercontent.com/5593825/51076794-aecf2b80-169d-11e9-9b9b-1c01eeb20467.png",
      "available": true
    }
  ],
  "errorMessages": {
    "primaryError": "SKBitmap.Decode(codec, imageInfo) returns null when imageInfo.ColorType is Gray8, even though the codec successfully reads the image and default decoding works.",
    "additionalErrors": [
      "Both AlphaType.Premul (default) and AlphaType.Opaque produce null result with Gray8 color type"
    ]
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "3.119.1",
    "dockerUsed": false
  }
}
