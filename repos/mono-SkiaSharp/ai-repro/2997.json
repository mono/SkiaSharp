{
  "meta": {
    "schemaVersion": "1.0",
    "number": 2997,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T02:55:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/2997.json"
  },
  "conclusion": "reproduced",
  "assessment": "working-as-designed",
  "scope": "unknown",
  "notes": "Reproduced on SkiaSharp 2.88.3, 3.119.2, and main (source). SKMatrix.MapRect with an identity matrix normalizes a non-standard rect (Left>Right, Top>Bottom) \u2014 output has Left/Right and Top/Bottom swapped. This is upstream Skia behavior: SkMatrix::mapRect calls sort_as_rect() which enforces left<=right, top<=bottom. Cross-platform verification skipped: pure API/logic bug with no platform signals.",
  "reproductionTime": "~5 minutes",
  "versionResults": [
    {
      "version": "2.88.3",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Identity MapRect normalizes non-standard rect. Left=15 (expected 25), Right=25 (expected 15), Top=2 (expected 10), Bottom=10 (expected 2).",
      "platform": "host-macos-arm64"
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Same normalization behavior on latest stable release.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "reproduced",
      "notes": "xUnit test fails: Assert.Equal() Expected: 25, Actual: 15. Bug present on main.",
      "platform": "host-macos-arm64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "2.88.3"
      }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project and add SkiaSharp 2.88.3",
      "layer": "setup",
      "command": "dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 2.88.3",
      "exitCode": 0,
      "output": "Restore succeeded.",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project targeting net8.0 with SkiaSharp 2.88.3",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp\" Version=\"2.88.3\" />\n  </ItemGroup>\n\n</Project>"
        },
        {
          "filename": "Program.cs",
          "description": "Reproduction code from issue #2997 \u2014 tests SKMatrix.MapRect with a non-standard rect",
          "content": "using SkiaSharp;\n\nConsole.WriteLine($\"SkiaSharp version: {typeof(SKMatrix).Assembly.GetName().Version}\");\nConsole.WriteLine($\"Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\");\nConsole.WriteLine($\"OS: {System.Runtime.InteropServices.RuntimeInformation.OSDescription}\");\nConsole.WriteLine();\n\nvar inputRect = new SKRect();\ninputRect.Left = 25;\ninputRect.Right = 15;\ninputRect.Bottom = 2;\ninputRect.Top = 10;\n\nConsole.WriteLine($\"Input rect:  Left={inputRect.Left}, Top={inputRect.Top}, Right={inputRect.Right}, Bottom={inputRect.Bottom}\");\n\nvar resultRect = SKMatrix.CreateIdentity().MapRect(inputRect);\n\nConsole.WriteLine($\"Result rect: Left={resultRect.Left}, Top={resultRect.Top}, Right={resultRect.Right}, Bottom={resultRect.Bottom}\");\nConsole.WriteLine();\n\nbool leftMatch = resultRect.Left == inputRect.Left;\nbool rightMatch = resultRect.Right == inputRect.Right;\nbool topMatch = resultRect.Top == inputRect.Top;\nbool bottomMatch = resultRect.Bottom == inputRect.Bottom;\n\nConsole.WriteLine($\"Left   matches: {leftMatch} (expected={inputRect.Left}, got={resultRect.Left})\");\nConsole.WriteLine($\"Right  matches: {rightMatch} (expected={inputRect.Right}, got={resultRect.Right})\");\nConsole.WriteLine($\"Top    matches: {topMatch} (expected={inputRect.Top}, got={resultRect.Top})\");\nConsole.WriteLine($\"Bottom matches: {bottomMatch} (expected={inputRect.Bottom}, got={resultRect.Bottom})\");\nConsole.WriteLine();\n\nif (leftMatch && rightMatch && topMatch && bottomMatch)\n    Console.WriteLine(\"SUCCESS: MapRect preserved rect coordinates (bug NOT present)\");\nelse\n{\n    Console.WriteLine(\"BUG CONFIRMED: MapRect normalized/standardized the rect coordinates\");\n    Console.WriteLine($\"  Left/Right swapped: {resultRect.Left == inputRect.Right && resultRect.Right == inputRect.Left}\");\n    Console.WriteLine($\"  Top/Bottom swapped: {resultRect.Top == inputRect.Bottom && resultRect.Bottom == inputRect.Top}\");\n}"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Build the repro project with SkiaSharp 2.88.3",
      "layer": "setup",
      "command": "dotnet build",
      "exitCode": 0,
      "output": "Build succeeded. 0 Error(s)",
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Run repro with SkiaSharp 2.88.3 \u2014 test SKMatrix.MapRect with non-standard rect (Left>Right, Top>Bottom)",
      "layer": "csharp",
      "command": "dotnet run --no-build",
      "exitCode": 0,
      "output": "SkiaSharp version: 2.88.0.0\nRuntime: .NET 8.0.23\nOS: Darwin 25.2.0\n\nInput rect:  Left=25, Top=10, Right=15, Bottom=2\nResult rect: Left=15, Top=2, Right=25, Bottom=10\n\nLeft   matches: False (expected=25, got=15)\nRight  matches: False (expected=15, got=25)\nTop    matches: False (expected=10, got=2)\nBottom matches: False (expected=2, got=10)\n\nBUG CONFIRMED: MapRect normalized/standardized the rect coordinates\n  Left/Right swapped: True\n  Top/Bottom swapped: True",
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Update to latest stable (3.119.2) and re-run to check if fixed",
      "layer": "csharp",
      "command": "dotnet add package SkiaSharp && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nRuntime: .NET 8.0.23\nOS: Darwin 25.2.0\n\nInput rect:  Left=25, Top=10, Right=15, Bottom=2\nResult rect: Left=15, Top=2, Right=25, Bottom=10\n\nLeft   matches: False (expected=25, got=15)\nRight  matches: False (expected=15, got=25)\nTop    matches: False (expected=10, got=2)\nBottom matches: False (expected=2, got=10)\n\nBUG CONFIRMED: MapRect normalized/standardized the rect coordinates\n  Left/Right swapped: True\n  Top/Bottom swapped: True",
      "result": "wrong-output"
    },
    {
      "stepNumber": 5,
      "description": "Test on main (source) \u2014 add targeted xUnit test for issue #2997 to existing test infrastructure",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --filter \"FullyQualifiedName~Issue2997\"",
      "exitCode": 1,
      "output": "Failed SkiaSharp.Tests.SKMatrixTest.MapRectNormalizesNonStandardRect_Issue2997 [8 ms]\n  Error Message:\n   Assert.Equal() Failure\nExpected: 25\nActual:   15\n  Stack Trace:\n     at SkiaSharp.Tests.SKMatrixTest.MapRectNormalizesNonStandardRect_Issue2997()\n\nFailed!  - Failed: 1, Passed: 0, Skipped: 0, Total: 1",
      "result": "failure"
    }
  ],
  "errorMessages": {
    "primaryError": "SKMatrix.MapRect returns normalized rect: input (Left=25, Top=10, Right=15, Bottom=2) becomes (Left=15, Top=2, Right=25, Bottom=10) \u2014 coordinates are sorted so Left<Right and Top<Bottom"
  },
  "environment": {
    "os": "macOS 26.2 (Darwin 25.2.0)",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "2.88.3",
    "dockerUsed": false
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "classification",
        "upstream": "Classified as type/bug with confidence 0.35, suggesting this is upstream Skia behavior not a SkiaSharp bug",
        "corrected": "Confirmed the behavior reproduces as reported \u2014 MapRect normalizes non-standard rects. Whether this is a SkiaSharp bug or upstream Skia behavior is editorial; the factual reproduction confirms the reported symptoms."
      }
    ]
  }
}