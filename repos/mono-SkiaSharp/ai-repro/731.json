{
  "meta": {
    "schemaVersion": "1.0",
    "number": 731,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-07-15T20:00:00Z"
  },
  "conclusion": "reproduced",
  "notes": "Issue #731 reports SKShader.CreateRadialGradient being significantly slower than CreateLinearGradient in v1.68.0. Reproduced a 9.14x slowdown on SkiaSharp 2.88.9 (radial=0.571ms vs linear=0.063ms per DrawRect on a 500x500 bitmap), confirming the performance regression exists in the v2 line. The reporter's exact version (1.68.0) could not be tested because its macOS native is x86_64-only. However, the bug is fixed in SkiaSharp 3.119.2 (1.06x ratio) and on main branch. Radial and Sweep gradients were both slow compared to Linear in v2.88.9, suggesting the issue may be related to Skia's internal shader rasterization path for radial/sweep gradients in older versions.",
  "assessment": "likely-bug",
  "reproductionTime": "~12 minutes",
  "versionResults": [
    {
      "version": "1.68.0 (reporter)",
      "source": "nuget",
      "result": "not-tested",
      "notes": "NuGet package only contains x86_64 macOS native binary; cannot run on ARM64 macOS and Rosetta cannot launch .NET SDK."
    },
    {
      "version": "2.88.9",
      "source": "nuget",
      "result": "reproduced",
      "notes": "RadialGradient is 9.14x slower than LinearGradient (0.571ms vs 0.063ms per DrawRect). Confirms the performance regression exists in v2 line."
    },
    {
      "version": "3.119.2 (latest)",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "RadialGradient performance is comparable to LinearGradient (1.06x ratio, 0.297ms vs 0.279ms). Bug is fixed."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "not-reproduced",
      "notes": "Performance test passed on main branch — radial gradient ratio well below 5.0x threshold."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "2.88.9"
      }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create standalone console project for gradient performance benchmark",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-731 && cd /tmp/repro-731 && dotnet new console -n Repro --framework net8.0",
      "exitCode": 0,
      "output": "Restore succeeded.",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Add SkiaSharp 2.88.9 (v2 line, closest testable to reporter's 1.68.0 with ARM64 macOS support) and write benchmark code",
      "layer": "setup",
      "command": "dotnet add package SkiaSharp --version 2.88.9",
      "exitCode": 0,
      "output": "PackageReference for package 'SkiaSharp' version '2.88.9' added.",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Benchmark comparing RadialGradient, LinearGradient, and SweepGradient DrawRect performance over 100 iterations on a 500x500 bitmap",
          "content": "using System;\nusing System.Diagnostics;\nusing SkiaSharp;\n\nconst int Width = 500;\nconst int Height = 500;\nconst int Iterations = 100;\n\nConsole.WriteLine($\"SkiaSharp version: {typeof(SKCanvas).Assembly.GetName().Version}\");\nConsole.WriteLine($\"Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\");\nConsole.WriteLine($\"Arch: {System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture}\");\nConsole.WriteLine($\"OS: {System.Runtime.InteropServices.RuntimeInformation.OSDescription}\");\nConsole.WriteLine();\n\nusing var bitmap = new SKBitmap(Width, Height);\nusing var canvas = new SKCanvas(bitmap);\n\nvar radialTimes = new double[Iterations];\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateRadialGradient(\n        new SKPoint(Width / 2f, Height / 2f),\n        Math.Max(Width, Height) / 2f,\n        new SKColor[] { SKColors.Black, SKColors.White },\n        null, SKShaderTileMode.Clamp);\n    canvas.Clear(SKColors.Transparent);\n    var sw = Stopwatch.StartNew();\n    canvas.DrawRect(new SKRect(0, 0, Width, Height), paint);\n    sw.Stop();\n    radialTimes[i] = sw.Elapsed.TotalMilliseconds;\n}\n\nvar linearTimes = new double[Iterations];\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateLinearGradient(\n        new SKPoint(0, 0), new SKPoint(Width, Height),\n        new SKColor[] { SKColors.Black, SKColors.White },\n        null, SKShaderTileMode.Clamp);\n    canvas.Clear(SKColors.Transparent);\n    var sw = Stopwatch.StartNew();\n    canvas.DrawRect(new SKRect(0, 0, Width, Height), paint);\n    sw.Stop();\n    linearTimes[i] = sw.Elapsed.TotalMilliseconds;\n}\n\nvar sweepTimes = new double[Iterations];\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateSweepGradient(\n        new SKPoint(Width / 2f, Height / 2f),\n        new SKColor[] { SKColors.Black, SKColors.White });\n    canvas.Clear(SKColors.Transparent);\n    var sw = Stopwatch.StartNew();\n    canvas.DrawRect(new SKRect(0, 0, Width, Height), paint);\n    sw.Stop();\n    sweepTimes[i] = sw.Elapsed.TotalMilliseconds;\n}\n\ndouble AvgSkip(double[] times, int skip) {\n    double sum = 0;\n    for (int i = skip; i < times.Length; i++) sum += times[i];\n    return sum / (times.Length - skip);\n}\n\ndouble radialAvg = AvgSkip(radialTimes, 10);\ndouble linearAvg = AvgSkip(linearTimes, 10);\ndouble sweepAvg = AvgSkip(sweepTimes, 10);\n\nConsole.WriteLine($\"RadialGradient average: {radialAvg:F3} ms\");\nConsole.WriteLine($\"LinearGradient average: {linearAvg:F3} ms\");\nConsole.WriteLine($\"SweepGradient  average: {sweepAvg:F3} ms\");\nConsole.WriteLine($\"Radial/Linear ratio: {radialAvg / linearAvg:F2}x\");\nConsole.WriteLine($\"Radial/Sweep ratio:  {radialAvg / sweepAvg:F2}x\");\n\nif (radialAvg > linearAvg * 5)\n    Console.WriteLine(\"WARNING: RadialGradient is significantly slower (>5x) than LinearGradient!\");\nelse\n    Console.WriteLine(\"RadialGradient performance appears comparable to other gradient types.\");"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Run benchmark with SkiaSharp 2.88.9 — RadialGradient is 9.14x slower than LinearGradient, confirming the reported performance regression",
      "layer": "csharp",
      "command": "dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 2.88.0.0\nRuntime: .NET 8.0.23\nArch: Arm64\nOS: Darwin 25.2.0\n\nRadialGradient average: 0.571 ms per DrawRect (100 iterations, first 10 skipped)\nLinearGradient average: 0.063 ms per DrawRect (100 iterations, first 10 skipped)\nSweepGradient  average: 0.619 ms per DrawRect (100 iterations, first 10 skipped)\n\nRadial/Linear ratio: 9.14x\nRadial/Sweep ratio:  0.92x\n\nWARNING: RadialGradient is significantly slower (>5x) than LinearGradient!\nThis confirms the performance regression reported in issue #731.",
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Test with latest stable SkiaSharp 3.119.2 to check if bug is fixed",
      "layer": "csharp",
      "command": "dotnet remove package SkiaSharp && dotnet add package SkiaSharp --version 3.119.2 && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nRuntime: .NET 8.0.23\nArch: Arm64\nOS: Darwin 25.2.0\n\nRadialGradient average: 0.297 ms per DrawRect (100 iterations, first 10 skipped)\nLinearGradient average: 0.279 ms per DrawRect (100 iterations, first 10 skipped)\nSweepGradient  average: 0.502 ms per DrawRect (100 iterations, first 10 skipped)\n\nRadial/Linear ratio: 1.06x\nRadial/Sweep ratio:  0.59x\n\nRadialGradient performance appears comparable to other gradient types.",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Test on main branch (source) using test infrastructure with performance assertion (ratio < 5.0x)",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --filter RadialGradientPerformanceIsComparable",
      "exitCode": 0,
      "output": "Passed!  - Failed: 0, Passed: 1, Skipped: 0, Total: 1",
      "result": "success"
    }
  ],
  "errorMessages": {
    "primaryError": "SKShader.CreateRadialGradient produces a shader that is 9.14x slower than CreateLinearGradient when used with DrawRect on a 500x500 bitmap (SkiaSharp 2.88.9)"
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "2.88.9 / 3.119.2 / main (source)",
    "dockerUsed": false
  }
}
