{
  "meta": {
    "schemaVersion": "1.0",
    "number": 731,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T15:55:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/731.json"
  },
  "conclusion": "reproduced",
  "assessment": "likely-bug",
  "notes": "Confirmed: SKShader.CreateRadialGradient is ~181x slower than CreateLinearGradient in SkiaSharp 1.68.0 (22.1ms vs 0.12ms avg per 500x500 fill). Interestingly, CreateSweepGradient is equally slow (~22.7ms), contradicting the reporter's claim that only radial was affected. The regression is in the upstream Skia native layer. Fixed in SkiaSharp 3.119.2 where all gradient types perform similarly (~1.5-1.8ms avg). Upgrading to any modern SkiaSharp version resolves the issue.",
  "scope": "unknown",
  "reproductionTime": "~15 minutes",
  "versionResults": [
    {
      "version": "1.68.0",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Radial gradient 22.1ms avg vs linear 0.12ms avg (181x slower). Sweep gradient equally slow at 22.7ms.",
      "platform": "docker-linux-x64"
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "All gradients perform similarly: radial 1.76ms, linear 1.46ms, sweep 1.69ms. Performance regression is fixed.",
      "platform": "docker-linux-x64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      { "name": "SkiaSharp", "version": "1.68.0" },
      { "name": "SkiaSharp.NativeAssets.Linux", "version": "1.68.0" }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project with SkiaSharp 1.68.0 in Docker linux/amd64 (1.68.0 lacks macOS ARM64 natives)",
      "layer": "setup",
      "command": "docker run --rm --platform linux/amd64 mcr.microsoft.com/dotnet/sdk:8.0 bash -c 'apt-get update -qq && apt-get install -y -qq libfontconfig1 && mkdir -p /tmp/repro && cd /tmp/repro && dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 1.68.0 && dotnet add package SkiaSharp.NativeAssets.Linux --version 1.68.0'",
      "exitCode": 0,
      "output": "Restored /tmp/repro/Repro/Repro.csproj (in 21.08 sec).",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Benchmark comparing radial, linear, sweep gradients and solid color baseline on 500x500 canvas with 100 iterations",
          "content": "using System;\nusing System.Diagnostics;\nusing SkiaSharp;\n\nconst int WIDTH = 500;\nconst int HEIGHT = 500;\nconst int WARMUP = 5;\nconst int ITERATIONS = 100;\n\nConsole.WriteLine($\"SkiaSharp Version: {typeof(SKBitmap).Assembly.GetName().Version}\");\nConsole.WriteLine($\"Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\");\nConsole.WriteLine($\"OS: {System.Runtime.InteropServices.RuntimeInformation.OSDescription}\");\nConsole.WriteLine($\"Arch: {System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture}\");\nConsole.WriteLine();\n\nusing var bitmap = new SKBitmap(WIDTH, HEIGHT);\nusing var canvas = new SKCanvas(bitmap);\nvar rect = new SKRect(0, 0, WIDTH, HEIGHT);\nvar colors = new SKColor[] { SKColors.Black, SKColors.White };\n\nusing var radialShader = SKShader.CreateRadialGradient(\n    new SKPoint(WIDTH / 2f, HEIGHT / 2f),\n    WIDTH / 2f,\n    colors, null, SKShaderTileMode.Clamp);\n\nusing var linearShader = SKShader.CreateLinearGradient(\n    new SKPoint(0, 0), new SKPoint(WIDTH, HEIGHT),\n    colors, null, SKShaderTileMode.Clamp);\n\nusing var sweepShader = SKShader.CreateSweepGradient(\n    new SKPoint(WIDTH / 2f, HEIGHT / 2f),\n    colors, null);\n\nvoid Benchmark(string name, SKShader shader)\n{\n    using var paint = new SKPaint();\n    paint.Shader = shader;\n    for (int i = 0; i < WARMUP; i++)\n    {\n        canvas.Clear(SKColors.Transparent);\n        canvas.DrawRect(rect, paint);\n    }\n    var sw = Stopwatch.StartNew();\n    for (int i = 0; i < ITERATIONS; i++)\n    {\n        canvas.Clear(SKColors.Transparent);\n        canvas.DrawRect(rect, paint);\n    }\n    sw.Stop();\n    double avgMs = sw.Elapsed.TotalMilliseconds / ITERATIONS;\n    Console.WriteLine($\"{name,-25} {ITERATIONS} iters: {sw.Elapsed.TotalMilliseconds:F1}ms total, {avgMs:F3}ms avg\");\n}\n\nConsole.WriteLine($\"Canvas: {WIDTH}x{HEIGHT}, Warmup: {WARMUP}, Iterations: {ITERATIONS}\");\nConsole.WriteLine(new string('-', 70));\n\nBenchmark(\"RadialGradient\", radialShader);\nBenchmark(\"LinearGradient\", linearShader);\nBenchmark(\"SweepGradient\", sweepShader);\n\nusing (var solidPaint = new SKPaint { Color = SKColors.Blue })\n{\n    var sw2 = Stopwatch.StartNew();\n    for (int i = 0; i < ITERATIONS; i++)\n    {\n        canvas.Clear(SKColors.Transparent);\n        canvas.DrawRect(rect, solidPaint);\n    }\n    sw2.Stop();\n    Console.WriteLine($\"{\"SolidColor (baseline)\",-25} {ITERATIONS} iters: {sw2.Elapsed.TotalMilliseconds:F1}ms total, {sw2.Elapsed.TotalMilliseconds / ITERATIONS:F3}ms avg\");\n}\n\nConsole.WriteLine();\nConsole.WriteLine(\"SUCCESS: benchmark completed\");"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Run gradient performance benchmark with SkiaSharp 1.68.0 — radial gradient is ~181x slower than linear",
      "layer": "csharp",
      "command": "dotnet run -c Release",
      "exitCode": 0,
      "output": "SkiaSharp Version: 1.68.0.0\nRuntime: .NET 8.0.24\nOS: Debian GNU/Linux 12 (bookworm)\nArch: X64\n\nCanvas: 500x500, Warmup: 5, Iterations: 100\n----------------------------------------------------------------------\nRadialGradient            100 iters: 2208.7ms total, 22.087ms avg\nLinearGradient            100 iters: 12.2ms total, 0.122ms avg\nSweepGradient             100 iters: 2273.4ms total, 22.734ms avg\nSolidColor (baseline)     100 iters: 4.6ms total, 0.046ms avg\n\nSUCCESS: benchmark completed",
      "result": "wrong-output"
    },
    {
      "stepNumber": 3,
      "description": "Run same benchmark with SkiaSharp 3.119.2 (latest stable) — all gradient types perform similarly, regression is fixed",
      "layer": "csharp",
      "command": "dotnet run -c Release (with SkiaSharp 3.119.2)",
      "exitCode": 0,
      "output": "SkiaSharp Version: 3.119.0.0\nRuntime: .NET 8.0.24\nOS: Debian GNU/Linux 12 (bookworm)\nArch: X64\n\nCanvas: 500x500, Warmup: 5, Iterations: 100\n----------------------------------------------------------------------\nRadialGradient            100 iters: 175.5ms total, 1.755ms avg\nLinearGradient            100 iters: 145.5ms total, 1.455ms avg\nSweepGradient             100 iters: 169.2ms total, 1.692ms avg\nSolidColor (baseline)     100 iters: 9.6ms total, 0.096ms avg\n\nSUCCESS: benchmark completed",
      "result": "success"
    }
  ],
  "errorMessages": {
    "primaryError": "SKShader.CreateRadialGradient performance regression: 22.1ms avg per 500x500 fill vs 0.12ms for LinearGradient (181x slower) in SkiaSharp 1.68.0"
  },
  "environment": {
    "os": "Linux (Docker on macOS 26.2)",
    "arch": "x64",
    "dotnetVersion": "8.0.24",
    "dotnetSdkVersion": "8.0.418",
    "skiaSharpVersion": "1.68.0",
    "dockerUsed": true
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "affected-gradients",
        "upstream": "Triage implied only radial gradient affected based on reporter's statement",
        "corrected": "Both radial AND sweep gradients are equally affected (~22ms avg). Reporter claimed sweep was not slow, but benchmark shows it is 186x slower than linear, same as radial."
      }
    ]
  },
  "output": {
    "actionability": {
      "suggestedAction": "close-as-fixed",
      "confidence": 0.92,
      "reason": "Performance regression confirmed in 1.68.0 (radial gradient 181x slower than linear). Definitively fixed in 3.119.2 where all gradient types perform within 1.2x of each other. Issue is from 2018 and upgrading resolves it."
    },
    "workarounds": [
      "Upgrade to SkiaSharp 3.x — the radial/sweep gradient performance regression is fully resolved",
      "On 1.68.0: pre-render the gradient to an SKImage/SKBitmap once and reuse the cached result instead of applying the shader each frame"
    ],
    "proposedResponse": {
      "status": "ready",
      "summary": "Radial gradient performance regression confirmed in 1.68.0, fixed in latest 3.x",
      "body": "Thanks for reporting this! We confirmed the performance regression with `SKShader.CreateRadialGradient` in SkiaSharp 1.68.0.\n\n**Benchmark results (500×500 canvas, 100 iterations, raster backend):**\n\n| Gradient Type | SkiaSharp 1.68.0 | SkiaSharp 3.119.2 |\n|--------------|-----------------|------------------|\n| RadialGradient | 22.1ms avg ❌ | 1.8ms avg ✅ |\n| LinearGradient | 0.1ms avg | 1.5ms avg |\n| SweepGradient | 22.7ms avg ❌ | 1.7ms avg |\n| SolidColor | 0.05ms avg | 0.1ms avg |\n\nIn 1.68.0, radial (and sweep) gradients were **~181× slower** than linear. This was a regression in the upstream Skia raster gradient code path.\n\nThe good news is this is **fully resolved** in current SkiaSharp (3.x) where all gradient types perform similarly. Upgrading to the latest SkiaSharp should fix this.\n\nIf upgrading isn't feasible on 1.68.0, you can work around it by pre-rendering the gradient to a cached `SKImage`:\n\n```csharp\nusing var surface = SKSurface.Create(new SKImageInfo(width, height));\nusing var paint = new SKPaint();\npaint.Shader = SKShader.CreateRadialGradient(\n    new SKPoint(50, 50), 100,\n    new SKColor[] { SKColors.Black, SKColors.White },\n    null, SKShaderTileMode.Clamp);\nsurface.Canvas.DrawRect(new SKRect(0, 0, width, height), paint);\nusing var cached = surface.Snapshot();\n// Draw cached image instead of using shader directly\n```"
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Add performance tenet label",
        "risk": "low",
        "confidence": 0.95,
        "labels": ["type/bug", "os/Windows-Classic", "backend/Raster", "tenet/performance"]
      },
      {
        "type": "link-related",
        "description": "Cross-reference related shader performance issue #543",
        "risk": "low",
        "confidence": 0.9,
        "linkedIssue": 543
      },
      {
        "type": "close-issue",
        "description": "Close as fixed in SkiaSharp 3.x — performance regression no longer exists",
        "risk": "medium",
        "confidence": 0.9
      }
    ]
  }
}
