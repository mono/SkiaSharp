{
  "meta": {
    "schemaVersion": "1.0",
    "number": 731,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T01:13:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/731.json"
  },
  "conclusion": "reproduced",
  "assessment": "likely-bug",
  "notes": "Reproduced the radial gradient performance regression in SkiaSharp 1.68.0. On Docker Linux/amd64, radial gradient rendering is ~127x slower than linear gradient (5097ms vs 40ms for 100 iterations of 1000x1000 canvas). The issue is fixed in SkiaSharp 3.119.2 (ratio 1.15x) and on main (ratio 1.01x). The regression was in the upstream Skia engine's SkGradientShader::MakeRadial code path, not in the SkiaSharp C# or C API layers. Could not test 1.60.3 baseline as no Linux native assets exist for that version.",
  "reproductionTime": "~8 minutes",
  "versionResults": [
    {
      "version": "1.68.0",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Radial gradient 127x slower than linear (5097ms vs 40ms for 100 iterations on 1000x1000 canvas). Tested via Docker linux/amd64."
    },
    {
      "version": "1.60.3",
      "source": "nuget",
      "result": "not-tested",
      "notes": "No SkiaSharp.NativeAssets.Linux exists for 1.60.x and macOS arm64 cannot run x64-only native libraries. Cannot verify baseline performance."
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "Radial/linear ratio is 1.15x (118ms vs 103ms for 100 iterations). Performance regression is fully resolved."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "not-reproduced",
      "notes": "Radial/linear ratio is 1.01x (137ms vs 136ms for 100 iterations). xUnit test passed â€” no regression on main."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      { "name": "SkiaSharp", "version": "1.68.0" },
      { "name": "SkiaSharp.NativeAssets.Linux", "version": "1.68.0" }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project and add SkiaSharp 1.68.0 with Linux native assets for Docker testing",
      "layer": "setup",
      "command": "dotnet new console -n Repro --framework net8.0 && dotnet add package SkiaSharp --version 1.68.0 && dotnet add package SkiaSharp.NativeAssets.Linux --version 1.68.0",
      "exitCode": 0,
      "output": "The template \"Console App\" was created successfully.",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project targeting net8.0 with SkiaSharp 1.68.0",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp\" Version=\"1.68.0\" />\n    <PackageReference Include=\"SkiaSharp.NativeAssets.Linux\" Version=\"1.68.0\" />\n  </ItemGroup>\n\n</Project>"
        },
        {
          "filename": "Program.cs",
          "description": "Benchmark comparing radial vs linear gradient performance with 100 iterations on 1000x1000 canvas",
          "content": "using System;\nusing System.Diagnostics;\nusing SkiaSharp;\n\nconst int Width = 1000;\nconst int Height = 1000;\nconst int Iterations = 100;\n\nusing var bitmap = new SKBitmap(Width, Height);\nusing var canvas = new SKCanvas(bitmap);\nvar rect = new SKRect(0, 0, Width, Height);\n\n// Warmup\nusing (var warmupPaint = new SKPaint())\n{\n    warmupPaint.Shader = SKShader.CreateRadialGradient(\n        new SKPoint(50, 50), 100,\n        new SKColor[] { SKColors.Black, SKColors.White },\n        null, SKShaderTileMode.Clamp);\n    canvas.DrawRect(rect, warmupPaint);\n}\n\nvar sw = Stopwatch.StartNew();\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateRadialGradient(\n        new SKPoint(50, 50), 100,\n        new SKColor[] { SKColors.Black, SKColors.White },\n        null, SKShaderTileMode.Clamp);\n    canvas.DrawRect(rect, paint);\n}\nsw.Stop();\nvar radialMs = sw.ElapsedMilliseconds;\nConsole.WriteLine($\"Radial gradient: {Iterations} iterations in {radialMs}ms ({radialMs / (double)Iterations:F2}ms/iter)\");\n\nsw.Restart();\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateLinearGradient(\n        new SKPoint(0, 0), new SKPoint(Width, Height),\n        new SKColor[] { SKColors.Black, SKColors.White },\n        null, SKShaderTileMode.Clamp);\n    canvas.DrawRect(rect, paint);\n}\nsw.Stop();\nvar linearMs = sw.ElapsedMilliseconds;\nConsole.WriteLine($\"Linear gradient: {Iterations} iterations in {linearMs}ms ({linearMs / (double)Iterations:F2}ms/iter)\");\n\nConsole.WriteLine();\nConsole.WriteLine($\"Radial/Linear ratio: {radialMs / (double)linearMs:F2}x\");\n\nif (radialMs > linearMs * 3)\n    Console.WriteLine(\"*** PERFORMANCE REGRESSION: Radial gradient is significantly slower than linear ***\");\nelse\n    Console.WriteLine(\"No significant performance difference detected between gradient types.\");"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Run benchmark with SkiaSharp 1.68.0 in Docker linux/amd64 to reproduce the reported radial gradient slowdown",
      "layer": "csharp",
      "command": "docker run --rm --platform linux/amd64 mcr.microsoft.com/dotnet/sdk:8.0 bash -c '... dotnet run --runtime linux-x64 --no-self-contained'",
      "exitCode": 0,
      "output": "Radial gradient: 100 iterations in 5097ms (50.97ms/iter)\nLinear gradient: 100 iterations in 40ms (0.40ms/iter)\n\nRadial/Linear ratio: 127.42x\n*** PERFORMANCE REGRESSION: Radial gradient is significantly slower than linear ***",
      "result": "wrong-output"
    },
    {
      "stepNumber": 3,
      "description": "Test with latest SkiaSharp 3.119.2 on macOS arm64 to check if regression is fixed",
      "layer": "csharp",
      "command": "dotnet run (with SkiaSharp 3.119.2 on macOS arm64)",
      "exitCode": 0,
      "output": "Radial gradient: 100 iterations in 118ms (1.18ms/iter)\nLinear gradient: 100 iterations in 103ms (1.03ms/iter)\nSweep gradient:  100 iterations in 183ms (1.83ms/iter)\n\nRadial/Linear ratio: 1.15x\nRadial/Sweep ratio:  0.64x\nNo significant performance difference detected between gradient types.",
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Test on main branch source using xUnit test infrastructure to confirm fix on current development code",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --filter RadialGradient",
      "exitCode": 0,
      "output": "Radial: 137ms, Linear: 136ms, Ratio: 1.01x\nPassed SkiaSharp.Tests.SKShaderTest.RadialGradientPerformanceIsComparableToLinear [334 ms]\nTest Run Successful. Total tests: 1, Passed: 1",
      "result": "success"
    }
  ],
  "errorMessages": {
    "primaryError": "Radial gradient rendering ~127x slower than linear gradient in SkiaSharp 1.68.0 (5097ms vs 40ms for 100 iterations on 1000x1000 raster canvas)"
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "1.68.0",
    "dockerUsed": true
  }
}
