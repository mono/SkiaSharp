{
  "meta": {
    "schemaVersion": "1.0",
    "number": 731,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T00:04:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/731.json"
  },
  "conclusion": "not-reproduced",
  "notes": "Performance regression in SKShader.CreateRadialGradient reported for SkiaSharp 1.68.0 (Dec 2018). Could not test the reporter's version (1.68.0) because it ships only x86_64 macOS natives, incompatible with ARM64 host and no Rosetta .NET available. On latest stable (3.119.2), radial gradient performance is comparable to linear (1.04x ratio) and faster than sweep (0.60x). On main (source), radial is 0.98x of linear. The performance issue does not exist in any testable version. Triage data indicates the related issue #543 (shader performance regression) was confirmed fixed in v1.69.0, and the underlying Skia gradient code has been extensively rewritten since then.",
  "assessment": "likely-bug",
  "reproductionTime": "~8 minutes",
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      { "name": "SkiaSharp", "version": "3.119.2" }
    ]
  },
  "versionResults": [
    {
      "version": "1.68.0",
      "source": "nuget",
      "result": "not-tested",
      "notes": "NuGet package ships only x86_64 macOS native (runtimes/osx/native/libSkiaSharp.dylib has 'x86_64' only). No ARM64 native available. No Rosetta .NET SDK installed. DllNotFoundException when attempted."
    },
    {
      "version": "1.60.3",
      "source": "nuget",
      "result": "not-tested",
      "notes": "Same x86_64-only limitation as 1.68.0. Reporter's 'last known good' version."
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "Radial=28ms, Linear=27ms, Sweep=47ms over 100 iterations. Radial/Linear ratio=1.04x. No performance issue."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "not-reproduced",
      "notes": "Radial=51ms, Linear=52ms, Sweep=69ms over 100 iterations. Radial/Linear ratio=0.98x. No performance issue. Test passed."
    }
  ],
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create standalone console project with SkiaSharp 3.119.2 and write gradient performance benchmark",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-731 && cd /tmp/repro-731 && dotnet new console -n Repro --framework net8.0 && cd Repro && dotnet add package SkiaSharp --version 3.119.2",
      "exitCode": 0,
      "result": "success",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project targeting net8.0 with SkiaSharp 3.119.2",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp\" Version=\"3.119.2\" />\n  </ItemGroup>\n\n</Project>"
        },
        {
          "filename": "Program.cs",
          "description": "Benchmarks radial, linear, and sweep gradient draw performance over 100 iterations on a 500x500 raster surface",
          "content": "using System;\nusing System.Diagnostics;\nusing System.Runtime.InteropServices;\nusing SkiaSharp;\n\nConsole.WriteLine($\"SkiaSharp version: {typeof(SKPaint).Assembly.GetName().Version}\");\nConsole.WriteLine($\"OS: {RuntimeInformation.OSDescription}\");\nConsole.WriteLine($\"Arch: {RuntimeInformation.ProcessArchitecture}\");\nConsole.WriteLine($\"Runtime: {RuntimeInformation.FrameworkDescription}\");\n\nconst int Width = 500;\nconst int Height = 500;\nconst int Iterations = 100;\n\nusing var bitmap = new SKBitmap(Width, Height, SKColorType.Rgba8888, SKAlphaType.Premul);\nusing var canvas = new SKCanvas(bitmap);\n\nvar colors = new SKColor[] { SKColors.Black, SKColors.White };\nvar center = new SKPoint(Width / 2f, Height / 2f);\nfloat radius = 250f;\nvar rect = new SKRect(0, 0, Width, Height);\nvar startPt = new SKPoint(0, 0);\nvar endPt = new SKPoint(Width, Height);\n\n// Warm up\nusing (var paint = new SKPaint())\n{\n    paint.Shader = SKShader.CreateRadialGradient(center, radius, colors, null, SKShaderTileMode.Clamp);\n    canvas.DrawRect(rect, paint);\n    canvas.Flush();\n}\n\n// Benchmark radial gradient\nvar sw = Stopwatch.StartNew();\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateRadialGradient(center, radius, colors, null, SKShaderTileMode.Clamp);\n    canvas.DrawRect(rect, paint);\n    canvas.Flush();\n}\nsw.Stop();\nvar radialTime = sw.ElapsedMilliseconds;\nConsole.WriteLine($\"Radial gradient:  {Iterations} iterations in {radialTime}ms ({radialTime / (double)Iterations:F2}ms/iter)\");\n\n// Benchmark linear gradient\nsw.Restart();\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateLinearGradient(startPt, endPt, colors, null, SKShaderTileMode.Clamp);\n    canvas.DrawRect(rect, paint);\n    canvas.Flush();\n}\nsw.Stop();\nvar linearTime = sw.ElapsedMilliseconds;\nConsole.WriteLine($\"Linear gradient:  {Iterations} iterations in {linearTime}ms ({linearTime / (double)Iterations:F2}ms/iter)\");\n\n// Benchmark sweep gradient\nsw.Restart();\nfor (int i = 0; i < Iterations; i++)\n{\n    using var paint = new SKPaint();\n    paint.Shader = SKShader.CreateSweepGradient(center, colors, null);\n    canvas.DrawRect(rect, paint);\n    canvas.Flush();\n}\nsw.Stop();\nvar sweepTime = sw.ElapsedMilliseconds;\nConsole.WriteLine($\"Sweep gradient:   {Iterations} iterations in {sweepTime}ms ({sweepTime / (double)Iterations:F2}ms/iter)\");\n\n// Summary\nConsole.WriteLine();\nConsole.WriteLine($\"Radial/Linear ratio:  {radialTime / (double)linearTime:F2}x\");\nConsole.WriteLine($\"Radial/Sweep ratio:   {radialTime / (double)sweepTime:F2}x\");\n\nif (radialTime > linearTime * 3 || radialTime > sweepTime * 3)\n    Console.WriteLine(\"*** PERFORMANCE ISSUE: Radial gradient is >3x slower than others ***\");\nelse\n    Console.WriteLine(\"Performance looks comparable across gradient types.\");"
        }
      ]
    },
    {
      "stepNumber": 2,
      "description": "Run gradient performance benchmark with SkiaSharp 3.119.2 (latest stable)",
      "layer": "csharp",
      "command": "cd /tmp/repro-731/Repro && dotnet run -c Release",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nOS: Darwin 25.2.0 Darwin Kernel Version 25.2.0\nArch: Arm64\nRuntime: .NET 8.0.23\nRadial gradient:  100 iterations in 28ms (0.28ms/iter)\nLinear gradient:  100 iterations in 27ms (0.27ms/iter)\nSweep gradient:   100 iterations in 47ms (0.47ms/iter)\n\nRadial/Linear ratio:  1.04x\nRadial/Sweep ratio:   0.60x\nPerformance looks comparable across gradient types.",
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Build SkiaSharp test project from source (main branch) using pre-built natives",
      "layer": "setup",
      "command": "dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj",
      "exitCode": 0,
      "output": "Build succeeded.\n    13 Warning(s)\n    0 Error(s)\nTime Elapsed 00:00:08.10",
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Run radial gradient performance test against main branch source build",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj --no-build --filter \"FullyQualifiedName~RadialGradientPerformanceIsComparable\"",
      "exitCode": 0,
      "output": "Radial=51ms, Linear=52ms, Sweep=69ms, Radial/Linear=0.98x, Radial/Sweep=0.74x\n  Passed SkiaSharp.Tests.SKShaderTest.RadialGradientPerformanceIsComparable [220 ms]\n\nTest Run Successful.\nTotal tests: 1\n     Passed: 1",
      "result": "success"
    }
  ],
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "3.119.2",
    "dockerUsed": false
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "fixStatus",
        "upstream": "Triage assessed likelyFixed=true with confidence 0.8 based on related issue #543 fix in v1.69.0",
        "corrected": "Confirmed: radial gradient performance is normal on 3.119.2 and main. The issue was almost certainly fixed long ago, consistent with the triage assessment."
      }
    ]
  }
}
