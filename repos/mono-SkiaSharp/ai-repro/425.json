{
  "meta": {
    "schemaVersion": "1.0",
    "number": 425,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T15:50:00Z"
  },
  "inputs": {
    "triageFile": "ai-triage/425.json"
  },
  "conclusion": "wrong-output",
  "assessment": "likely-bug",
  "scope": "unknown",
  "notes": "Reproduced as reported. SKCodec.EncodedOrigin returns TopLeft for all DNG and CR2 files, but exiftool confirms the actual EXIF orientation is RightTop (6) for both DNG files and LeftBottom (8) for the CR2 file. The codec reports EncodedFormat as Jpeg for these RAW files (extracting embedded JPEG preview), but does not propagate the EXIF orientation tag. Bug persists on latest stable (3.119.2) and main branch source. This is a Skia upstream issue in SkRawCodec — the label status/skia-update-required is correct. Cross-platform verification skipped because this is a pure codec API bug with no platform-specific signals.",
  "reproductionTime": "~15 minutes",
  "versionResults": [
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "wrong-output",
      "notes": "EncodedOrigin returns TopLeft for all three test files. Actual EXIF: DNG=RightTop(6), CR2=LeftBottom(8).",
      "platform": "host-macos-arm64"
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "wrong-output",
      "notes": "Same behavior as 3.119.2 — EncodedOrigin returns TopLeft for all RAW files.",
      "platform": "host-macos-arm64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net10.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "3.119.2"
      }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project and add SkiaSharp package",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-425 && cd /tmp/repro-425 && dotnet new console -n Repro --framework net10.0 && cd Repro && dotnet add package SkiaSharp --version 3.119.2",
      "exitCode": 0,
      "output": "The template \"Console App\" was created successfully.\nPackageReference for package 'SkiaSharp' version '3.119.2' added.",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Download and extract reporter's DNG and CR2 test files from issue attachments",
      "layer": "setup",
      "command": "cd /tmp/repro-425 && curl -sL 'https://github.com/mono/SkiaSharp/files/1616452/APC_0316.zip' -o APC_0316.zip && unzip -o APC_0316.zip && curl -sL 'https://github.com/mono/SkiaSharp/files/1616453/APC_0193.zip' -o APC_0193.zip && unzip -o APC_0193.zip && curl -sL 'https://github.com/mono/SkiaSharp/files/1645431/IMG_1361.zip' -o IMG_1361.zip && unzip -o IMG_1361.zip",
      "exitCode": 0,
      "output": "inflating: APC_0316.dng\ninflating: APC_0193.dng\ninflating: IMG_1361.CR2",
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Write reproduction code that reads EncodedOrigin from DNG/CR2 files via SKCodec",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Repro code that opens DNG/CR2 files with SKCodec and prints EncodedOrigin",
          "content": "using SkiaSharp;\n\nstring[] testFiles = { \"../APC_0316.dng\", \"../APC_0193.dng\", \"../IMG_1361.CR2\" };\n\nConsole.WriteLine($\"SkiaSharp Version: {typeof(SKBitmap).Assembly.GetName().Version}\");\nConsole.WriteLine($\"Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\");\nConsole.WriteLine($\"OS: {System.Runtime.InteropServices.RuntimeInformation.OSDescription}\");\nConsole.WriteLine($\"Arch: {System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture}\");\nConsole.WriteLine();\n\nforeach (var file in testFiles)\n{\n    Console.WriteLine($\"Testing: {Path.GetFileName(file)}\");\n    if (!File.Exists(file)) { Console.WriteLine($\"  ERROR: File not found\"); continue; }\n    using var stream = new SKFileStream(file);\n    using var codec = SKCodec.Create(stream);\n    if (codec == null) { Console.WriteLine($\"  ERROR: SKCodec.Create returned null\"); continue; }\n    Console.WriteLine($\"  Codec: {codec.EncodedFormat}\");\n    Console.WriteLine($\"  Size: {codec.Info.Width}x{codec.Info.Height}\");\n    Console.WriteLine($\"  EncodedOrigin: {codec.EncodedOrigin}\");\n    if (codec.EncodedOrigin == SKEncodedOrigin.TopLeft)\n        Console.WriteLine($\"  WARNING: Origin is TopLeft - may be incorrect for RAW files\");\n    Console.WriteLine();\n}\nConsole.WriteLine(\"SUCCESS: test completed\");"
        },
        {
          "filename": "Repro.csproj",
          "description": "Project file targeting net10.0 with SkiaSharp 3.119.2",
          "content": "<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net10.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"SkiaSharp\" Version=\"3.119.2\" />\n  </ItemGroup>\n</Project>"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Build the repro project",
      "layer": "csharp",
      "command": "cd /tmp/repro-425/Repro && dotnet build",
      "exitCode": 0,
      "output": "Build succeeded.\n    0 Warning(s)\n    0 Error(s)",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Run repro and observe EncodedOrigin values for DNG/CR2 files",
      "layer": "csharp",
      "command": "cd /tmp/repro-425/Repro && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp Version: 3.119.0.0\nRuntime: .NET 10.0.2\nOS: macOS 26.2.0\nArch: Arm64\n\nTesting: APC_0316.dng\n  Codec: Jpeg\n  Size: 4032x3024\n  EncodedOrigin: TopLeft\n  WARNING: Origin is TopLeft - may be incorrect for RAW files\n\nTesting: APC_0193.dng\n  Codec: Jpeg\n  Size: 4032x3024\n  EncodedOrigin: TopLeft\n  WARNING: Origin is TopLeft - may be incorrect for RAW files\n\nTesting: IMG_1361.CR2\n  Codec: Jpeg\n  Size: 1536x1024\n  EncodedOrigin: TopLeft\n  WARNING: Origin is TopLeft - may be incorrect for RAW files\n\nSUCCESS: test completed",
      "result": "wrong-output"
    },
    {
      "stepNumber": 6,
      "description": "Verify actual EXIF orientation of test files using exiftool to confirm bug",
      "layer": "native",
      "command": "exiftool -Orientation APC_0316.dng APC_0193.dng IMG_1361.CR2",
      "exitCode": 0,
      "output": "======== APC_0316.dng\nOrientation: Rotate 90 CW\n======== APC_0193.dng\nOrientation: Rotate 90 CW\n======== IMG_1361.CR2\nOrientation: Rotate 270 CW",
      "result": "success"
    },
    {
      "stepNumber": 7,
      "description": "Test on main branch source using console sample with project references",
      "layer": "csharp",
      "command": "cd $REPO_ROOT && dotnet build samples/Basic/Console/SkiaSharpSample/SkiaSharpSample.csproj && cd samples/Basic/Console/SkiaSharpSample && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp Version: 3.119.0.0\n\nTesting: APC_0316.dng\n  Codec: Jpeg\n  Size: 4032x3024\n  EncodedOrigin: TopLeft\n\nTesting: APC_0193.dng\n  Codec: Jpeg\n  Size: 4032x3024\n  EncodedOrigin: TopLeft\n\nTesting: IMG_1361.CR2\n  Codec: Jpeg\n  Size: 1536x1024\n  EncodedOrigin: TopLeft\n\nSUCCESS: test completed",
      "result": "wrong-output"
    }
  ],
  "artifacts": [
    {
      "filename": "APC_0316.dng",
      "description": "DNG sample with EXIF orientation RightTop (6), but SKCodec reports TopLeft",
      "source": "issue-attachment",
      "url": "https://github.com/mono/SkiaSharp/files/1616452/APC_0316.zip",
      "available": true
    },
    {
      "filename": "APC_0193.dng",
      "description": "DNG sample with EXIF orientation RightTop (6), but SKCodec reports TopLeft",
      "source": "issue-attachment",
      "url": "https://github.com/mono/SkiaSharp/files/1616453/APC_0193.zip",
      "available": true
    },
    {
      "filename": "IMG_1361.CR2",
      "description": "CR2 sample with EXIF orientation LeftBottom (8), but SKCodec reports TopLeft",
      "source": "issue-attachment",
      "url": "https://github.com/mono/SkiaSharp/files/1645431/IMG_1361.zip",
      "available": true
    }
  ],
  "errorMessages": {
    "primaryError": "SKCodec.EncodedOrigin returns TopLeft (1) for DNG files with actual EXIF orientation RightTop (6) and CR2 files with actual EXIF orientation LeftBottom (8)"
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "10.0.2",
    "dotnetSdkVersion": "10.0.102",
    "skiaSharpVersion": "3.119.2",
    "dockerUsed": false
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.92,
      "reason": "Bug reproduced on latest stable (3.119.2) and main branch source. The Skia RAW codec (SkRawCodec) does not propagate EXIF orientation to the base SkCodec class. The existing label status/skia-update-required correctly indicates this needs an upstream Skia fix."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Confirm existing labels are correct — type/bug and status/skia-update-required both apply",
        "risk": "low",
        "confidence": 0.95,
        "labels": ["type/bug", "status/skia-update-required"]
      },
      {
        "type": "link-related",
        "description": "Link to related issue #836 which may also involve codec orientation",
        "risk": "low",
        "confidence": 0.70,
        "linkedIssue": 836
      }
    ],
    "proposedResponse": {
      "status": "needs-human-edit",
      "summary": "Bug confirmed — SKCodec.EncodedOrigin returns TopLeft for DNG/CR2 files that have non-TopLeft EXIF orientation",
      "body": "We've confirmed this issue. `SKCodec.EncodedOrigin` returns `TopLeft` for DNG and CR2 files even though they have non-TopLeft EXIF orientation:\n\n| File | Actual EXIF Orientation | SKCodec.EncodedOrigin |\n|------|------------------------|----------------------|\n| APC_0316.dng | RightTop (6 = Rotate 90° CW) | TopLeft ❌ |\n| APC_0193.dng | RightTop (6 = Rotate 90° CW) | TopLeft ❌ |\n| IMG_1361.CR2 | LeftBottom (8 = Rotate 270° CW) | TopLeft ❌ |\n\n**Tested versions:**\n| Version | Result |\n|---------|--------|\n| SkiaSharp 3.119.2 (latest stable) | ❌ Wrong output |\n| main branch (source) | ❌ Wrong output |\n\nThe codec reports `EncodedFormat` as `Jpeg` for these RAW files (it extracts the embedded JPEG preview), but the EXIF orientation is not propagated from the RAW container. This appears to be a Skia upstream limitation in `SkRawCodec`.\n\n**Workaround:** For applications that need correct orientation of RAW files, read the EXIF orientation directly from the file using a metadata library (e.g., MetadataExtractor) rather than relying on `SKCodec.EncodedOrigin`."
    },
    "workarounds": [
      "Read EXIF orientation directly from the file using a metadata library (e.g., MetadataExtractor for .NET) instead of relying on SKCodec.EncodedOrigin for RAW file formats"
    ]
  }
}
