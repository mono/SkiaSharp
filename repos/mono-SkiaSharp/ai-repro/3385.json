{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3385,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T16:09:03Z"
  },
  "inputs": {
    "triageFile": "ai-triage/3385.json"
  },
  "conclusion": "reproduced",
  "assessment": "working-as-designed",
  "scope": "universal",
  "notes": "Confirmed: SKColorType.Gray16 does not exist in the SkiaSharp enum. Decoding a 16-bit grayscale PNG silently downsamples to Gray8 (8-bit), losing precision. Tested on SkiaSharp 3.119.2 (NuGet) and main branch (source) — same result. This is an upstream Skia limitation: kGray_16_SkColorType does not exist in Skia's SkColorType enum, and Skia's PNG codec explicitly calls png_set_strip_16() to discard 16-bit precision. The Alpha16 color type exists as a 16-bit single-channel format but represents alpha, not luminance.",
  "reproductionTime": "~10 minutes",
  "versionResults": [
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "reproduced",
      "notes": "SKColorType.Gray16 missing from enum. 16-bit grayscale PNG decoded as Gray8 with precision loss.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "reproduced",
      "notes": "No Gray16 in main branch either. Same Gray8 downsampling behavior.",
      "platform": "host-macos-arm64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net10.0",
    "packages": [
      { "name": "SkiaSharp", "version": "3.119.2" }
    ]
  },
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project with SkiaSharp 3.119.2",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-3385 && cd /tmp/repro-3385 && dotnet new console -n Repro --framework net10.0 && cd Repro && dotnet add package SkiaSharp --version 3.119.2",
      "exitCode": 0,
      "output": "The template \"Console App\" was created successfully.\nPackageReference for package 'SkiaSharp' version '3.119.2' added.",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Create a valid 16-bit grayscale PNG test image using Python (4x4 pixels with known 16-bit values: 0x0000, 0x4000, 0x8000, 0xFFFF)",
      "layer": "setup",
      "command": "python3 create_gray16_png.py",
      "exitCode": 0,
      "output": "Created 102 byte PNG\nIHDR: 4x4, bitDepth=16, colorType=0 (grayscale)",
      "filesCreated": [
        {
          "filename": "gray16_test.png",
          "description": "4x4 16-bit grayscale PNG with pixel values ranging from 0x0000 to 0xFFFF"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Write reproduction code that checks for Gray16 in the enum and decodes the 16-bit grayscale PNG",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Repro code checking SKColorType enum for Gray16 and decoding 16-bit grayscale PNG",
          "content": "using System;\nusing System.IO;\nusing System.Linq;\nusing System.Runtime.InteropServices;\nusing SkiaSharp;\n\nConsole.WriteLine($\"SkiaSharp version: {typeof(SKBitmap).Assembly.GetName().Version}\");\n\n// Test 1: Check if Gray16 exists in SKColorType enum\nvar colorTypes = Enum.GetNames<SKColorType>();\nvar hasGray16 = colorTypes.Contains(\"Gray16\");\nConsole.WriteLine($\"Has Gray16: {hasGray16}\");\n\n// Test 2: Decode 16-bit grayscale PNG\nvar pngBytes = File.ReadAllBytes(\"gray16_test.png\");\nusing var skData = SKData.CreateCopy(pngBytes);\nusing var codec = SKCodec.Create(skData);\nConsole.WriteLine($\"Codec: ColorType={codec?.Info.ColorType}, BitsPerPixel={codec?.Info.BitsPerPixel}\");\n\nusing var bitmap = SKBitmap.Decode(skData);\nConsole.WriteLine($\"Decoded: ColorType={bitmap?.ColorType}, BytesPerPixel={bitmap?.BytesPerPixel}\");\n\nvar p00 = bitmap?.GetPixel(0, 0); // was 0x0000\nvar p10 = bitmap?.GetPixel(1, 0); // was 0x4000\nvar p20 = bitmap?.GetPixel(2, 0); // was 0x8000\nvar p30 = bitmap?.GetPixel(3, 0); // was 0xFFFF\nConsole.WriteLine($\"Pixel(0,0)=0x0000: {p00}\");\nConsole.WriteLine($\"Pixel(1,0)=0x4000: {p10}\");\nConsole.WriteLine($\"Pixel(2,0)=0x8000: {p20}\");\nConsole.WriteLine($\"Pixel(3,0)=0xFFFF: {p30}\");\nConsole.WriteLine($\"Precision lost: decoded as {bitmap?.ColorType}\");"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Build and run the reproduction — verify Gray16 is missing and 16-bit data is downsampled",
      "layer": "csharp",
      "command": "cd /tmp/repro-3385/Repro && dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nRuntime: .NET 10.0.2\nOS: macOS 26.2.0\nArch: Arm64\n\n=== Test 1: SKColorType Enum Values ===\nHas Gray8: True\nHas Gray16: False\nAll color types: Unknown, Alpha8, Rgb565, Argb4444, Rgba8888, Rgb888x, Bgra8888, Rgba1010102, Rgb101010x, Gray8, RgbaF16, RgbaF16Clamped, RgbaF32, Rg88, AlphaF16, RgF16, Alpha16, Rg1616, Rgba16161616, Bgra1010102, Bgr101010x, Bgr101010xXR, Srgba8888, R8Unorm, Rgba10x6\n\n=== Test 2: Decode 16-bit grayscale PNG ===\nCodec info: 4x4, ColorType=Gray8, BitsPerPixel=8\nDecoded bitmap: 4x4, ColorType=Gray8, BytesPerPixel=1\nPixel (0,0) original=0x0000 (0):     decoded as #ff000000\nPixel (1,0) original=0x4000 (16384): decoded as #ff404040\nPixel (2,0) original=0x8000 (32768): decoded as #ff808080\nPixel (3,0) original=0xFFFF (65535): decoded as #ffffffff\n\nResult: 16-bit precision silently lost — decoded as Gray8 (8-bit)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 5,
      "description": "Test on main branch source — check if Gray16 has been added",
      "layer": "csharp",
      "command": "dotnet run --project samples/Basic/Console/SkiaSharpSample/SkiaSharpSample.csproj",
      "exitCode": 0,
      "output": "=== Main branch Gray16 test ===\nHas Gray16 in enum: False\nCodec: ColorType=Gray8, BitsPerPixel=8\nDecoded: ColorType=Gray8, BytesPerPixel=1\nPixel(0,0)=0x0000: #ff000000\nPixel(3,0)=0xFFFF: #ffffffff\nGray16 still missing on main: True\nSUCCESS: test completed",
      "result": "wrong-output"
    }
  ],
  "errorMessages": {
    "primaryError": "SKColorType.Gray16 does not exist. 16-bit grayscale PNG decoded as Gray8 — 16-bit precision silently lost (0x4000→0x40, 0x8000→0x80)."
  },
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "10.0.2",
    "dotnetSdkVersion": "10.0.102",
    "skiaSharpVersion": "3.119.2",
    "dockerUsed": false
  },
  "output": {
    "actionability": {
      "suggestedAction": "keep-open",
      "confidence": 0.92,
      "reason": "Confirmed feature gap: SKColorType.Gray16 does not exist and 16-bit grayscale PNG precision is silently lost. This is blocked by upstream Skia (no kGray_16_SkColorType), so it should stay open for tracking but cannot be fixed without upstream changes."
    },
    "workarounds": [
      "Decode 16-bit grayscale PNGs using a dedicated library (e.g., SixLabors.ImageSharp which supports Gray16), then import raw pixel data into an SKBitmap using SKColorType.Alpha16 as a 16-bit single-channel workaround.",
      "Accept 8-bit downsampling: SKBitmap.Decode() works on 16-bit grayscale PNGs but silently reduces to Gray8. Acceptable for display/preview when full precision is not needed."
    ],
    "proposedResponse": {
      "status": "needs-human-edit",
      "summary": "Confirmed missing Gray16 — upstream Skia limitation with workaround suggestions",
      "body": "Thanks for the report! We've confirmed the behavior:\n\n- `SKColorType.Gray16` does not exist in the SkiaSharp enum\n- 16-bit grayscale PNGs **are** decoded, but Skia's PNG codec silently strips the 16-bit precision down to 8-bit (`Gray8`)\n\nThis is an upstream Skia limitation — Skia's `SkColorType` enum has `kGray_8_SkColorType` but no 16-bit gray variant, and the PNG decoder explicitly calls `png_set_strip_16()` to discard the extra precision.\n\n**Tested versions:**\n| Version | Result |\n|---------|--------|\n| SkiaSharp 3.119.2 (latest) | ❌ Gray16 missing, decoded as Gray8 |\n| main (source) | ❌ Same — no change |\n\n**Workarounds:**\n1. **External decode + raw import:** Decode the PNG with a library that supports Gray16 (e.g., SixLabors.ImageSharp), then import the raw 16-bit pixel data into an `SKBitmap` using `SKColorType.Alpha16` — it's semantically \"alpha\" rather than \"gray\" but preserves the 16-bit precision.\n2. **Accept 8-bit:** `SKBitmap.Decode()` works fine on 16-bit grayscale PNGs — it just maps to `Gray8`, which may be sufficient for display/preview.\n\nKeeping this open for tracking. Adding Gray16 to SkiaSharp would require upstream Skia to first add `kGray_16_SkColorType` and update the PNG codec."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Confirm feature-request label and add area/SkiaSharp",
        "risk": "low",
        "confidence": 0.95,
        "labels": ["type/feature-request", "area/SkiaSharp"]
      },
      {
        "type": "link-related",
        "description": "Link to related issue #1222 which also discusses color type gaps",
        "risk": "low",
        "confidence": 0.70,
        "linkedIssue": 1222
      }
    ]
  }
}
