{
  "meta": {
    "schemaVersion": "1.0",
    "number": 648,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T00:15:00Z"
  },
  "conclusion": "not-reproduced",
  "notes": "Large image resize (14034x9921, 139M pixels, ~531MB RGBA) works correctly on macOS arm64 with both SkiaSharp 2.88.9 and 3.116.1 and main (source). All outputs contain expected pixel data with no blank images. SKBitmap allocation, SKSurface.Create, SKCodec.GetPixels, and the full encode-decode-resize flow all succeed at reporter\u0027s dimensions. Allocation failure (\u0027Unable to allocate pixels\u0027) only occurs at much larger sizes (~30000x20000, ~2.3GB RGBA). The original issue from 2018 was likely caused by 32-bit process memory constraints or older Skia limits that have since been lifted. The maintainer noted this was an upstream Skia issue (labeled status/skia-update-required).",
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project with SkiaSharp 3.116.1",
      "layer": "setup",
      "command": "dotnet new console -n Repro --framework net8.0 \u0026\u0026 dotnet add package SkiaSharp --version 3.116.1",
      "exitCode": 0,
      "output": "The template \u0022Console App\u0022 was created successfully.\nPackageReference for package \u0027SkiaSharp\u0027 version \u00273.116.1\u0027 added.",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project targeting net8.0 with SkiaSharp 3.116.1",
          "content": "\u003CProject Sdk=\u0022Microsoft.NET.Sdk\u0022\u003E\n  \u003CPropertyGroup\u003E\n    \u003COutputType\u003EExe\u003C/OutputType\u003E\n    \u003CTargetFramework\u003Enet8.0\u003C/TargetFramework\u003E\n    \u003CImplicitUsings\u003Eenable\u003C/ImplicitUsings\u003E\n    \u003CNullable\u003Eenable\u003C/Nullable\u003E\n  \u003C/PropertyGroup\u003E\n  \u003CItemGroup\u003E\n    \u003CPackageReference Include=\u0022SkiaSharp\u0022 Version=\u00223.116.1\u0022 /\u003E\n  \u003C/ItemGroup\u003E\n\u003C/Project\u003E"
        },
        {
          "filename": "Program.cs",
          "description": "Reproduction code that tests large image allocation, surface creation, encode/decode/resize flow, and pixel verification at reporter\u0027s dimensions and larger sizes",
          "content": "using SkiaSharp;\n\nConsole.WriteLine(\u0022Testing blank-output-after-resize (Issue #648)\u0022);\nConsole.WriteLine($\u0022Platform: {Environment.OSVersion}, 64-bit={Environment.Is64BitProcess}\u0022);\n\nvoid TestEncodedResize(int w, int h, string label)\n{\n    Console.WriteLine($\u0022\\n=== {label}: {w}x{h} ===\u0022);\n    Console.Write(\u0022  Creating source surface... \u0022);\n    using var srcSurface = SKSurface.Create(new SKImageInfo(w, h));\n    if (srcSurface == null)\n    {\n        Console.WriteLine(\u0022FAIL (null surface - too large to allocate)\u0022);\n        return;\n    }\n    srcSurface.Canvas.Clear(SKColors.Blue);\n    using var paint = new SKPaint { Color = SKColors.Red };\n    srcSurface.Canvas.DrawCircle(w / 2f, h / 2f, Math.Min(w, h) / 3f, paint);\n    srcSurface.Canvas.Flush();\n    using var srcSnap = srcSurface.Snapshot();\n    using var encodedData = srcSnap.Encode(SKEncodedImageFormat.Jpeg, 80);\n    Console.WriteLine($\u0022OK, encoded={encodedData.Size / 1024} KB\u0022);\n\n    Console.Write(\u0022  Decoding... \u0022);\n    using var decoded = SKImage.FromEncodedData(encodedData);\n    if (decoded == null) { Console.WriteLine(\u0022FAIL\u0022); return; }\n    Console.WriteLine($\u0022OK ({decoded.Width}x{decoded.Height})\u0022);\n\n    Console.Write(\u0022  SKCodec... \u0022);\n    using var codecData = SKData.CreateCopy(encodedData.ToArray());\n    using var codec = SKCodec.Create(codecData);\n    if (codec == null) { Console.WriteLine(\u0022FAIL\u0022); }\n    else\n    {\n        Console.WriteLine($\u0022OK (info={codec.Info.Width}x{codec.Info.Height})\u0022);\n        using var bmpFromCodec = new SKBitmap(codec.Info);\n        var codecResult = codec.GetPixels(bmpFromCodec.Info, bmpFromCodec.GetPixels());\n        Console.WriteLine($\u0022  Codec.GetPixels: {codecResult}\u0022);\n    }\n\n    int maxWidth = 1024, maxHeight = 768;\n    double scale = Math.Min((double)maxWidth / decoded.Width, (double)maxHeight / decoded.Height);\n    int newW = (int)(decoded.Width * scale);\n    int newH = (int)(decoded.Height * scale);\n    Console.Write($\u0022  Resizing to {newW}x{newH}... \u0022);\n    using var dstSurface = SKSurface.Create(new SKImageInfo(newW, newH));\n    if (dstSurface == null) { Console.WriteLine(\u0022FAIL\u0022); return; }\n    dstSurface.Canvas.Clear(SKColors.White);\n    dstSurface.Canvas.DrawImage(decoded, new SKRect(0, 0, newW, newH));\n    dstSurface.Canvas.Flush();\n    using var result = dstSurface.Snapshot();\n    using var resultData = result.Encode(SKEncodedImageFormat.Jpeg, 85);\n    if (resultData == null || resultData.Size == 0) { Console.WriteLine(\u0022FAIL\u0022); return; }\n    using var checkBmp = SKBitmap.Decode(resultData);\n    int nonWhite = 0;\n    var rng = new Random(42);\n    for (int i = 0; i \u003C 100; i\u002B\u002B)\n    {\n        var px = checkBmp.GetPixel(rng.Next(checkBmp.Width), rng.Next(checkBmp.Height));\n        if (px.Red \u003C 240 || px.Green \u003C 240 || px.Blue \u003C 240) nonWhite\u002B\u002B;\n    }\n    bool isBlank = nonWhite \u003C 5;\n    Console.WriteLine($\u0022{resultData.Size} bytes, nonWhite={nonWhite}/100, BLANK={isBlank}\u0022);\n}\n\nTestEncodedResize(14034, 9921, \u0022Reporter (14034x9921)\u0022);\nTestEncodedResize(16000, 12000, \u002216Kx12K\u0022);\nTestEncodedResize(20000, 15000, \u002220Kx15K\u0022);\nTestEncodedResize(24000, 18000, \u002224Kx18K\u0022);\nTestEncodedResize(28000, 20000, \u002228Kx20K\u0022);\nConsole.WriteLine(\u0022\\nDone.\u0022);"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Run reproduction at reporter\u0027s dimensions (14034x9921) with SkiaSharp 3.116.1 \u2014 test full encode-decode-resize flow",
      "layer": "csharp",
      "command": "dotnet run",
      "exitCode": 0,
      "output": "Reporter (14034x9921): SKBitmap OK, SKSurface OK, SKCodec OK, Codec.GetPixels: Success, Resize: 13516 bytes, nonWhite=100/100, BLANK=False\n16Kx12K: OK, BLANK=False\n20Kx15K: OK, BLANK=False\n24Kx18K: OK, BLANK=False\n28Kx20K: FAIL (null surface - too large to allocate)",
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Re-test with SkiaSharp 2.88.9 (last 2.x release) at reporter\u0027s dimensions",
      "layer": "csharp",
      "command": "dotnet remove package SkiaSharp \u0026\u0026 dotnet add package SkiaSharp --version 2.88.9 \u0026\u0026 dotnet run",
      "exitCode": 0,
      "output": "All operations succeed identically: 14034x9921 surface created, encoded/decoded/resized, center pixel=#fffe0000, blank=False. Same results through 24000x18000.",
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Test allocation failure boundary \u2014 SKBitmap and SKSurface at 30000x20000",
      "layer": "csharp",
      "command": "dotnet run (with 30000x20000 test)",
      "exitCode": 0,
      "output": "30000x20000: SKBitmap: Exception: Unable to allocate pixels for the bitmap.\nSKSurface.Create: returned null\nSKImage.Create: returned null",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Build and run targeted test on main (source) \u2014 LargeImageResizeProducesNonBlankOutput",
      "layer": "csharp",
      "command": "dotnet build tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj \u0026\u0026 dotnet test --no-build --filter LargeImageResize",
      "exitCode": 0,
      "output": "Passed! - Failed: 0, Passed: 1, Skipped: 0, Total: 1",
      "result": "success"
    }
  ],
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "3.116.1",
    "dockerUsed": false
  },
  "inputs": {
    "triageFile": "ai-triage/648.json"
  },
  "assessment": "likely-bug",
  "reproductionTime": "~12 minutes",
  "versionResults": [
    {
      "version": "2.88.9",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "14034x9921 allocation, surface creation, encode/decode/resize all succeed with correct non-blank output."
    },
    {
      "version": "3.116.1",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "All operations succeed up to 24000x18000. Reporter\u0027s 14034x9921 works perfectly. Allocation failure only at 28000x20000\u002B."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "not-reproduced",
      "notes": "Test LargeImageResizeProducesNonBlankOutput passed: 14034x9921 encode-decode-resize produces non-blank output."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "3.116.1"
      }
    ]
  }
}