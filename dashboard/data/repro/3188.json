{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3188,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T16:40:00Z"
  },
  "conclusion": "wrong-output",
  "notes": "Confirmed: DrawVertices outputs a solid black triangle instead of a colored gradient in SkiaSharp v3. Reproduced on v3.116.1 (reporter\u0027s version), v3.119.2 (latest stable), and main branch source. Works correctly on v2.88.9. Root cause is an upstream Skia behavior change \u2014 drawVertices now blends the paint\u0027s opaque color (default black) with vertex colors via Modulate blend mode. Black \u00D7 any color = black. Verified workaround: setting paint.Color = SKColors.White preserves vertex colors. Reproduced on both macOS arm64 and Docker Linux x64 \u2014 universal scope.",
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project with reporter\u0027s SkiaSharp version (3.116.1)",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-3188 \u0026\u0026 cd /tmp/repro-3188 \u0026\u0026 dotnet new console -n Repro --framework net8.0 \u0026\u0026 cd Repro \u0026\u0026 dotnet add package SkiaSharp --version 3.116.1",
      "exitCode": 0,
      "output": "The template \u0022Console App\u0022 was created successfully.\nPackageReference for package \u0027SkiaSharp\u0027 version \u00273.116.1\u0027 added.",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Write reproduction code from issue: create 200x200 surface, clear white, draw triangle with RGB vertex colors using DrawVertices, save PNG, sample pixel colors to verify",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Console app that draws a triangle with DrawVertices using Red/Green/Blue vertex colors, saves to PNG, then samples pixel colors to detect black triangle bug.",
          "content": "using SkiaSharp;\n\nvar imageInfo = new SKImageInfo(width: 200, height: 200, colorType: SKColorType.Rgba8888, alphaType: SKAlphaType.Premul);\nvar surface = SKSurface.Create(imageInfo);\nsurface.Canvas.Clear(SKColors.White);\nvar paint = new SKPaint { IsAntialias = true };\nvar vertices = new[] { new SKPoint(110, 20), new SKPoint(160, 200), new SKPoint(10, 200) };\nvar colors = new[] { SKColors.Red, SKColors.Green, SKColors.Blue };\nsurface.Canvas.DrawVertices(SKVertexMode.Triangles, vertices, colors, paint);\n\nusing var data = surface.Snapshot();\nusing var pngImage = data.Encode(SKEncodedImageFormat.Png, 100);\nusing var fileStream = File.Create(\u0022output.png\u0022);\npngImage.SaveTo(fileStream);\nfileStream.Close();\n\nusing var bitmap = SKBitmap.Decode(\u0022output.png\u0022);\nvar centerPixel = bitmap.GetPixel(93, 140);\nvar nearRedVertex = bitmap.GetPixel(110, 30);\nvar cornerPixel = bitmap.GetPixel(0, 0);\n\nConsole.WriteLine($\u0022SkiaSharp version: {typeof(SKSurface).Assembly.GetName().Version}\u0022);\nConsole.WriteLine($\u0022Center pixel (93,140): R={centerPixel.Red} G={centerPixel.Green} B={centerPixel.Blue} A={centerPixel.Alpha}\u0022);\nConsole.WriteLine($\u0022Near red vertex (110,30): R={nearRedVertex.Red} G={nearRedVertex.Green} B={nearRedVertex.Blue} A={nearRedVertex.Alpha}\u0022);\nConsole.WriteLine($\u0022Corner pixel (0,0): R={cornerPixel.Red} G={cornerPixel.Green} B={cornerPixel.Blue} A={cornerPixel.Alpha}\u0022);\n\nbool isBlackTriangle = centerPixel.Red \u003C 10 \u0026\u0026 centerPixel.Green \u003C 10 \u0026\u0026 centerPixel.Blue \u003C 10;\nbool cornerIsWhite = cornerPixel.Red \u003E 240 \u0026\u0026 cornerPixel.Green \u003E 240 \u0026\u0026 cornerPixel.Blue \u003E 240;\n\nif (isBlackTriangle \u0026\u0026 cornerIsWhite)\n    Console.WriteLine(\u0022BUG CONFIRMED: Triangle is black (vertex colors not applied)\u0022);\nelse if (!isBlackTriangle \u0026\u0026 cornerIsWhite)\n    Console.WriteLine(\u0022SUCCESS: Triangle has vertex colors (gradient visible)\u0022);\nelse\n    Console.WriteLine($\u0022UNEXPECTED: Center black={isBlackTriangle}, corner white={cornerIsWhite}\u0022);"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Run with SkiaSharp 3.116.1 (reporter\u0027s version). Triangle renders solid black \u2014 all vertex color information is lost.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188/Repro \u0026\u0026 dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.116.0.0\nCenter pixel (93,140): R=0 G=0 B=0 A=255\nNear red vertex (110,30): R=0 G=0 B=0 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nBUG CONFIRMED: Triangle is black (vertex colors not applied)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Test with v2.88.9 (reporter\u0027s last known good). Triangle renders correctly with RGB gradient.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188-v2/Repro \u0026\u0026 dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 2.88.0.0\nCenter pixel (93,140): R=84 G=43 B=85 A=255\nNear red vertex (110,30): R=240 G=5 B=4 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nSUCCESS: Triangle has vertex colors (gradient visible)",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Test with latest stable v3.119.2. Bug still present \u2014 black triangle.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188-latest/Repro \u0026\u0026 dotnet run",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nCenter pixel (93,140): R=0 G=0 B=0 A=255\nNear red vertex (110,30): R=0 G=0 B=0 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nBUG CONFIRMED: Triangle is black (vertex colors not applied)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 6,
      "description": "Test against main branch source (built from local repo). Bug still present.",
      "layer": "csharp",
      "command": "dotnet run --project samples/Basic/Console/SkiaSharpSample/SkiaSharpSample.csproj",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.119.0.0\nCenter pixel (93,140): R=0 G=0 B=0 A=255\nCorner pixel (0,0): R=255 G=255 B=255 A=255\nBUG CONFIRMED: Triangle is black",
      "result": "wrong-output"
    },
    {
      "stepNumber": 7,
      "description": "Cross-platform verification on Docker Linux x64 with v3.116.1. Same black triangle \u2014 confirms universal scope.",
      "layer": "csharp",
      "command": "docker run --rm --platform linux/amd64 mcr.microsoft.com/dotnet/sdk:8.0 bash -c \u0027...\u0027",
      "exitCode": 0,
      "output": "Center: R=0 G=0 B=0\nCorner: R=255 G=255 B=255\nBUG CONFIRMED: Triangle is black",
      "result": "wrong-output"
    },
    {
      "stepNumber": 8,
      "description": "Verify workaround: set paint.Color = SKColors.White. Triangle renders correctly with colored gradient, confirming the root cause is default black paint being modulated with vertex colors.",
      "layer": "csharp",
      "command": "cd /tmp/repro-3188/Repro \u0026\u0026 dotnet run (with paint.Color = SKColors.White)",
      "exitCode": 0,
      "output": "Center: R=84 G=43 B=85\nCorner: R=255 G=255 B=255\nWORKAROUND WORKS: Triangle has vertex colors",
      "result": "success"
    }
  ],
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "10.0.102",
    "skiaSharpVersion": "3.116.1",
    "dockerUsed": true,
    "dotnetSdkVersion": "10.0.102"
  },
  "inputs": {
    "triageFile": "ai-triage/3188.json"
  },
  "assessment": "breaking-change",
  "scope": "universal",
  "reproductionTime": "~15 minutes",
  "versionResults": [
    {
      "version": "2.88.9",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "Triangle renders with correct RGB gradient. Center pixel: R=84 G=43 B=85.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "3.116.1",
      "source": "nuget",
      "result": "wrong-output",
      "notes": "Reporter\u0027s version. Triangle is solid black. Center pixel: R=0 G=0 B=0.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "wrong-output",
      "notes": "Latest stable. Bug still present. Center pixel: R=0 G=0 B=0.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "wrong-output",
      "notes": "Bug still present on main branch. Center pixel: R=0 G=0 B=0.",
      "platform": "host-macos-arm64"
    },
    {
      "version": "3.116.1",
      "source": "nuget",
      "result": "wrong-output",
      "notes": "Cross-platform verification. Same black triangle on Linux x64.",
      "platform": "docker-linux-x64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "3.116.1"
      }
    ]
  },
  "errorMessages": {
    "primaryError": "DrawVertices outputs solid black triangle instead of colored gradient. All vertex color information is lost because default black paint color is modulated with vertex colors (black \u00D7 anything = black)."
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "affected-platforms",
        "upstream": "Triage classified as os/Windows-Classic only",
        "corrected": "Bug is universal \u2014 reproduced on macOS arm64 and Docker Linux x64. Not Windows-specific."
      }
    ]
  },
  "output": {
    "proposedResponse": {
      "status": "ready",
      "body": "Thanks for the clear report and reproduction code! We\u0027ve confirmed this issue.\n\nThis is a behavior change in the upstream Skia library used by SkiaSharp v3. In v3, \u0060drawVertices\u0060 blends the paint\u0027s color (src) with vertex colors (dst) using the blend mode. The convenience \u0060DrawVertices\u0060 overloads use \u0060SKBlendMode.Modulate\u0060 (src \u00D7 dst), and since \u0060SKPaint\u0060 defaults to opaque black \u0060{0,0,0,1}\u0060, the result is \u0060black \u00D7 vertex_color = black\u0060.\n\n**Tested versions:**\n| Version | Platform | Result |\n|---------|----------|--------|\n| 2.88.9 | macOS arm64 | \u2705 Colored gradient |\n| 3.116.1 | macOS arm64 | \u274C Black triangle |\n| 3.119.2 | macOS arm64 | \u274C Black triangle |\n| main (source) | macOS arm64 | \u274C Black triangle |\n| 3.116.1 | Docker Linux x64 | \u274C Black triangle |\n\n**Workaround** \u2014 set the paint color to white so Modulate preserves vertex colors:\n\n\u0060\u0060\u0060csharp\nvar paint = new SKPaint\n{\n    IsAntialias = true,\n    Color = SKColors.White\n};\n\u0060\u0060\u0060\n\nAlternatively, use \u0060Shader = SKShader.CreateColor(SKColors.White)\u0060 or use the lower-level \u0060DrawVertices\u0060 overload with \u0060SKBlendMode.Dst\u0060 to ignore paint color entirely.\n\nWe\u0027re tracking this for a fix.",
      "summary": "Confirmed regression: DrawVertices black triangle due to upstream Skia behavior change. Workaround: set paint color to white."
    },
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.92,
      "reason": "Bug reproduced on all v3 versions including latest stable (3.119.2) and main branch. Not fixed anywhere. This is a regression from v2 caused by upstream Skia behavior change in drawVertices blending. Needs investigation to determine whether SkiaSharp should add a compatibility shim in convenience DrawVertices overloads."
    },
    "workarounds": [
      "Set paint.Color = SKColors.White before calling DrawVertices \u2014 white (1,1,1,1) modulated with vertex colors preserves the original gradient",
      "Set paint.Shader = SKShader.CreateColor(SKColors.White) for the same effect via a shader",
      "Use the overload DrawVertices(SKVertexMode, SKPoint[], SKPoint[], SKColor[], SKBlendMode, UInt16[], SKPaint) with SKBlendMode.Dst to ignore paint color entirely"
    ],
    "actions": [
      {
        "type": "update-labels",
        "description": "Add area/SkiaSharp and tenet/compatibility labels, confirm type/bug",
        "risk": "low",
        "confidence": 0.95,
        "labels": [
          "type/bug",
          "area/SkiaSharp",
          "tenet/compatibility"
        ]
      }
    ]
  }
}