{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3420,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T19:14:00Z"
  },
  "conclusion": "reproduced",
  "notes": "Confirmed: libSkiaSharp.so in SkiaSharp.NativeAssets.Android 2.88.6 and 2.88.9 uses 4 KB page alignment, incompatible with Android 16\u002B requirement for 16 KB. The fix was implemented in PR #3096 (commit db01ee168) by adding the \u0027-Wl,-z,max-page-size=16384\u0027 linker flag and upgrading to Android NDK r27c. The fix shipped in SkiaSharp 3.116.1 and is present in all subsequent releases including 3.119.2 (latest stable) and main branch. Both libSkiaSharp.so and libHarfBuzzSharp.so now use 16 KB alignment across all Android architectures (arm64-v8a, armeabi-v7a, x86, x86_64). The reporter is on the unsupported 2.x series which will not receive this fix.",
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Download SkiaSharp.NativeAssets.Android 2.88.6 NuGet package",
      "layer": "setup",
      "command": "curl -sLo skiasharp-2.88.6.nupkg https://api.nuget.org/v3-flatcontainer/skiasharp.nativeassets.android/2.88.6/skiasharp.nativeassets.android.2.88.6.nupkg",
      "exitCode": 0,
      "output": "Package downloaded successfully (15.1 MB)",
      "result": "skip"
    },
    {
      "stepNumber": 2,
      "description": "Extract NuGet package and check libSkiaSharp.so page alignment for arm64-v8a",
      "layer": "native",
      "command": "unzip -q skiasharp-2.88.6.nupkg -d v2.88.6 \u0026\u0026 python3 check-page-size.py v2.88.6/runtimes/android-arm64/native/libSkiaSharp.so",
      "exitCode": 0,
      "output": "Max page alignment: 4096 bytes (4 KB)",
      "filesCreated": [
        {
          "filename": "check-page-size.py",
          "description": "Python script to parse ELF program headers and extract page alignment from LOAD segments",
          "content": "#!/usr/bin/env python3\nimport struct\nimport sys\n\ndef check_elf_alignment(filename):\n    with open(filename, \u0027rb\u0027) as f:\n        # Read ELF header\n        elf_header = f.read(64)\n        \n        # Check if it\u0027s an ELF file\n        if elf_header[:4] != b\u0027\\x7fELF\u0027:\n            print(f\u0022Not an ELF file\u0022)\n            return\n        \n        # Check if it\u0027s 64-bit\n        is_64bit = elf_header[4] == 2\n        is_little_endian = elf_header[5] == 1\n        \n        if not is_64bit:\n            print(\u002232-bit ELF not supported\u0022)\n            return\n        \n        endian = \u0027\u003C\u0027 if is_little_endian else \u0027\u003E\u0027\n        \n        # Parse 64-bit ELF header\n        e_phoff = struct.unpack(f\u0027{endian}Q\u0027, elf_header[32:40])[0]\n        e_phentsize = struct.unpack(f\u0027{endian}H\u0027, elf_header[54:56])[0]\n        e_phnum = struct.unpack(f\u0027{endian}H\u0027, elf_header[56:58])[0]\n        \n        # Read program headers\n        f.seek(e_phoff)\n        max_align = 0\n        \n        for i in range(e_phnum):\n            ph = f.read(e_phentsize)\n            p_type = struct.unpack(f\u0027{endian}I\u0027, ph[0:4])[0]\n            p_align = struct.unpack(f\u0027{endian}Q\u0027, ph[48:56])[0]\n            \n            # PT_LOAD = 1\n            if p_type == 1:\n                max_align = max(max_align, p_align)\n        \n        print(f\u0022Max page alignment: {max_align} bytes ({max_align // 1024} KB)\u0022)\n\nif __name__ == \u0027__main__\u0027:\n    if len(sys.argv) \u003C 2:\n        print(\u0022Usage: check-page-size.py \u003Celf-file\u003E\u0022)\n        sys.exit(1)\n    \n    check_elf_alignment(sys.argv[1])"
        }
      ],
      "result": "wrong-output"
    },
    {
      "stepNumber": 3,
      "description": "Check x86_64 architecture for completeness",
      "layer": "native",
      "command": "python3 check-page-size.py v2.88.6/runtimes/android-x64/native/libSkiaSharp.so",
      "exitCode": 0,
      "output": "Max page alignment: 4096 bytes (4 KB)",
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Download and check SkiaSharp.NativeAssets.Android 3.116.1 (first fixed release)",
      "layer": "native",
      "command": "curl -sLo skiasharp-3.116.1.nupkg https://api.nuget.org/v3-flatcontainer/skiasharp.nativeassets.android/3.116.1/skiasharp.nativeassets.android.3.116.1.nupkg \u0026\u0026 unzip -q skiasharp-3.116.1.nupkg -d v3.116.1 \u0026\u0026 python3 check-page-size.py v3.116.1/runtimes/android-arm64/native/libSkiaSharp.so",
      "exitCode": 0,
      "output": "Max page alignment: 16384 bytes (16 KB)",
      "result": "skip"
    },
    {
      "stepNumber": 5,
      "description": "Check latest stable release 3.119.2",
      "layer": "native",
      "command": "curl -sLo skiasharp-3.119.2.nupkg https://api.nuget.org/v3-flatcontainer/skiasharp.nativeassets.android/3.119.2/skiasharp.nativeassets.android.3.119.2.nupkg \u0026\u0026 unzip -q skiasharp-3.119.2.nupkg -d v3.119.2 \u0026\u0026 python3 check-page-size.py v3.119.2/runtimes/android-arm64/native/libSkiaSharp.so",
      "exitCode": 0,
      "output": "Max page alignment: 16384 bytes (16 KB)",
      "result": "skip"
    },
    {
      "stepNumber": 6,
      "description": "Verify fix exists in main branch source code (build.cake)",
      "layer": "c-api",
      "command": "grep -n \u0027max-page-size\u0027 native/android/build.cake",
      "exitCode": 0,
      "output": "43:            $\u0022extra_ldflags=[ \u0027-Wl,-z,max-page-size=16384\u0027 ] \u0022 \u002B",
      "result": "skip"
    },
    {
      "stepNumber": 7,
      "description": "Verify fix exists in HarfBuzzSharp native makefile",
      "layer": "c-api",
      "command": "grep -n \u0027max-page-size\u0027 native/android/libHarfBuzzSharp/jni/HarfBuzzSharp.mk",
      "exitCode": 0,
      "output": "11:LOCAL_LDFLAGS          := -Wl,--gc-sections -Wl,-z,max-page-size=16384",
      "result": "skip"
    },
    {
      "stepNumber": 8,
      "description": "Check main branch built libraries (arm64-v8a)",
      "layer": "native",
      "command": "python3 check-page-size.py $REPO/output/native/android/arm64-v8a/libSkiaSharp.so",
      "exitCode": 0,
      "output": "Max page alignment: 16384 bytes (16 KB)",
      "result": "skip"
    },
    {
      "stepNumber": 9,
      "description": "Verify HarfBuzzSharp also has 16 KB alignment",
      "layer": "native",
      "command": "python3 check-page-size.py $REPO/output/native/android/arm64-v8a/libHarfBuzzSharp.so",
      "exitCode": 0,
      "output": "Max page alignment: 16384 bytes (16 KB)",
      "result": "skip"
    }
  ],
  "environment": {
    "os": "macOS",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "2.88.6, 2.88.9, 3.116.1, 3.119.2, main",
    "dockerUsed": false
  },
  "inputs": {
    "triageFile": "ai-triage/3420.json"
  },
  "assessment": "working-as-designed",
  "versionResults": [
    {
      "version": "2.88.6 (reporter)",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Confirmed 4 KB page alignment on both arm64-v8a and x86_64 architectures. Incompatible with Android 16\u002B."
    },
    {
      "version": "2.88.9 (last known good claimed)",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Also has 4 KB page alignment. The reporter\u0027s claim this was \u0027last known good\u0027 is incorrect - the entire 2.x series has this issue."
    },
    {
      "version": "3.116.1 (first fix)",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "First release with 16 KB page alignment. Fix from PR #3096 (commit db01ee168)."
    },
    {
      "version": "3.119.2 (latest stable)",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "Latest stable release confirmed to have 16 KB alignment."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "not-reproduced",
      "notes": "Source code confirmed to have linker flags in both build.cake and HarfBuzzSharp.mk. Built libraries verified with 16 KB alignment for both libSkiaSharp.so and libHarfBuzzSharp.so."
    }
  ],
  "reproProject": {
    "type": "existing",
    "tfm": "net8.0",
    "packages": []
  },
  "artifacts": [
    {
      "filename": "libSkiaSharp.so",
      "description": "Android native library (arm64-v8a, x86_64, armeabi-v7a, x86)",
      "source": "external",
      "available": true
    }
  ],
  "errorMessages": {
    "primaryError": "libSkiaSharp.so has 4 KB page alignment instead of required 16 KB",
    "stackTrace": "PT_LOAD segments in v2.88.6 runtimes/android-arm64/native/libSkiaSharp.so show p_align = 0x1000 (4096 bytes)"
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "coverage",
        "upstream": "Triage identified the fix exists but did not verify the actual binary page alignment in released packages",
        "corrected": "Reproduction confirmed actual page alignment in released binaries: 2.88.6/2.88.9 have 4KB (bug present), 3.116.1\u002B have 16KB (bug fixed). Also verified both libSkiaSharp.so and libHarfBuzzSharp.so across multiple architectures."
      }
    ]
  }
}