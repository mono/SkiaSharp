{
  "meta": {
    "schemaVersion": "1.0",
    "number": 552,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T15:55:00Z"
  },
  "conclusion": "inconclusive",
  "notes": "Issue #552 is a type/enhancement requesting investigation into reusing SKSurface instances across draw calls. No specific bug behavior (crash, exception, wrong output) is reported \u2014 the claim is that SKSurface.Create() is expensive. A benchmark confirms measurable overhead: ~10.85 \u00B5s per Create/Dispose, and reusing surfaces yields ~52% speedup in a simple rendering loop. All view implementations on main still create SKSurface per frame except GTK3. However, this is a performance optimization request, not a bug with reproducible failure behavior, so it does not fit the reproduction schema\u0027s requirement for a failure/wrong-output step.",
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project and add SkiaSharp 3.119.2",
      "layer": "setup",
      "command": "mkdir -p /tmp/repro-552 \u0026\u0026 cd /tmp/repro-552 \u0026\u0026 dotnet new console -n Repro --framework net10.0 \u0026\u0026 cd Repro \u0026\u0026 dotnet add package SkiaSharp --version 3.119.2",
      "exitCode": 0,
      "output": "PackageReference for package \u0027SkiaSharp\u0027 version \u00273.119.2\u0027 added.",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Write benchmark comparing new-per-frame vs reuse SKSurface patterns (800x600 surface, 10K iterations, with warm-up)",
      "layer": "csharp",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Benchmark comparing SKSurface.Create per frame vs reusing a cached surface, plus isolated Create/Dispose overhead measurement.",
          "content": "using System.Diagnostics;\nusing SkiaSharp;\n\nconst int Width = 800;\nconst int Height = 600;\nconst int Iterations = 10_000;\nconst int WarmUp = 100;\n\nConsole.WriteLine($\u0022SkiaSharp Version: {typeof(SKSurface).Assembly.GetName().Version}\u0022);\nConsole.WriteLine($\u0022Platform: {System.Runtime.InteropServices.RuntimeInformation.OSDescription} ({System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture})\u0022);\nConsole.WriteLine($\u0022Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\u0022);\nConsole.WriteLine();\n\nvar info = new SKImageInfo(Width, Height);\n\n// Pattern 1: New SKSurface per frame\nfor (int i = 0; i \u003C WarmUp; i\u002B\u002B) { using var s = SKSurface.Create(info); var c = s.Canvas; c.Clear(SKColors.White); using var p = new SKPaint { Color = SKColors.Red }; c.DrawRect(10, 10, 100, 50, p); }\nvar sw = Stopwatch.StartNew();\nfor (int i = 0; i \u003C Iterations; i\u002B\u002B) { using var s = SKSurface.Create(info); var c = s.Canvas; c.Clear(SKColors.White); using var p = new SKPaint { Color = SKColors.Red }; c.DrawRect(10, 10, 100, 50, p); }\nsw.Stop();\nvar newMs = sw.Elapsed.TotalMilliseconds;\n\n// Pattern 2: Reuse SKSurface\nusing (var rs = SKSurface.Create(info)) { for (int i = 0; i \u003C WarmUp; i\u002B\u002B) { var c = rs.Canvas; c.Clear(SKColors.White); using var p = new SKPaint { Color = SKColors.Red }; c.DrawRect(10, 10, 100, 50, p); } }\nsw.Restart();\nusing (var rs = SKSurface.Create(info)) { for (int i = 0; i \u003C Iterations; i\u002B\u002B) { var c = rs.Canvas; c.Clear(SKColors.White); using var p = new SKPaint { Color = SKColors.Red }; c.DrawRect(10, 10, 100, 50, p); } }\nsw.Stop();\nvar reuseMs = sw.Elapsed.TotalMilliseconds;\n\n// Pattern 3: Isolated Create/Dispose\nfor (int i = 0; i \u003C WarmUp; i\u002B\u002B) { using var s = SKSurface.Create(info); }\nsw.Restart();\nfor (int i = 0; i \u003C Iterations; i\u002B\u002B) { using var s = SKSurface.Create(info); }\nsw.Stop();\nvar createMs = sw.Elapsed.TotalMilliseconds;\n\nvar overhead = newMs - reuseMs;\nConsole.WriteLine($\u0022New-per-frame: {newMs:F2} ms ({newMs/Iterations*1000:F2} us/frame)\u0022);\nConsole.WriteLine($\u0022Reuse: {reuseMs:F2} ms ({reuseMs/Iterations*1000:F2} us/frame)\u0022);\nConsole.WriteLine($\u0022Create/Dispose: {createMs:F2} ms ({createMs/Iterations*1000:F2} us/call)\u0022);\nConsole.WriteLine($\u0022Speedup: {overhead/reuseMs*100:F1}% ({overhead:F2} ms over {Iterations} frames)\u0022);\nConsole.WriteLine(\u0022SUCCESS: benchmark completed\u0022);"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 3,
      "description": "Build the benchmark project in Release configuration",
      "layer": "csharp",
      "command": "cd /tmp/repro-552/Repro \u0026\u0026 dotnet build -c Release",
      "exitCode": 0,
      "output": "Build succeeded.\n    0 Warning(s)\n    0 Error(s)",
      "result": "success"
    },
    {
      "stepNumber": 4,
      "description": "Run benchmark to measure SKSurface.Create() overhead (10K iterations, 800x600 surface)",
      "layer": "csharp",
      "command": "cd /tmp/repro-552/Repro \u0026\u0026 dotnet run -c Release",
      "exitCode": 0,
      "output": "SkiaSharp Version: 3.119.0.0\nPlatform: macOS 26.2.0 (Arm64)\nRuntime: .NET 10.0.2\n\n--- Pattern 1: New SKSurface per frame (10000 iterations) ---\nTotal: 456.88 ms\nAverage per frame: 45.69 \u00B5s\n\n--- Pattern 2: Reuse SKSurface (10000 iterations) ---\nTotal: 300.74 ms\nAverage per frame: 30.07 \u00B5s\n\n--- Pattern 3: Isolated SKSurface.Create/Dispose cost (10000 iterations) ---\nTotal: 108.50 ms\nAverage per Create\u002BDispose: 10.85 \u00B5s\n\n=== Summary ===\nNew-per-frame total:     456.88 ms (45.69 \u00B5s/frame)\nReuse total:             300.74 ms (30.07 \u00B5s/frame)\nCreate/Dispose overhead: 108.50 ms (10.85 \u00B5s/call)\nReuse speedup:           51.9% faster (156.14 ms saved over 10000 frames)\nPer-frame savings:       15.61 \u00B5s\n\nCONCLUSION: SKSurface.Create() has measurable overhead (10.85 \u00B5s/call). Reusing surfaces saves 51.9% per frame.\n\nSUCCESS: benchmark completed",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Verify main branch code still creates SKSurface per frame in all views (confirming enhancement is still unaddressed)",
      "layer": "csharp",
      "command": "grep -rn \u0027using.*surface = SKSurface.Create\u0027 source/SkiaSharp.Views/ --include=\u0027*.cs\u0027 | grep -v obj/ | wc -l",
      "exitCode": 0,
      "output": "14 occurrences of per-frame SKSurface.Create in view layer code across WPF, WinForms, WinUI, Blazor, Apple, Android, and Tizen platforms. GTK3 is the only view that caches the surface.",
      "result": "success"
    }
  ],
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "10.0.2",
    "skiaSharpVersion": "3.119.2",
    "dockerUsed": false,
    "dotnetSdkVersion": "10.0.102"
  },
  "inputs": {
    "triageFile": "ai-triage/552.json"
  },
  "assessment": "likely-bug",
  "scope": "universal",
  "reproductionTime": "~10 minutes",
  "versionResults": [
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "not-tested",
      "notes": "No bug behavior to test \u2014 ran performance benchmark instead. SKSurface.Create() costs ~10.85 \u00B5s/call, reuse saves ~52%.",
      "platform": "host-macos-arm64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net10.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "3.119.2"
      }
    ]
  },
  "blockers": [
    "Issue #552 is labeled type/enhancement \u2014 it requests performance investigation, not a bug fix. No specific failure behavior (crash, exception, wrong output) is reported.",
    "The reproduction schema requires at least one step with result \u0027failure\u0027 or \u0027wrong-output\u0027 for a \u0027reproduced\u0027 conclusion. Performance overhead (measurable but successful execution) does not meet this criterion.",
    "The performance claim IS validated: SKSurface.Create()/Dispose costs ~10.85 \u00B5s/call, and reusing surfaces yields ~52% speedup in a tight rendering loop. This data is captured in the steps."
  ],
  "output": {
    "proposedResponse": {
      "status": "needs-human-edit",
      "body": "This enhancement request is still applicable as of SkiaSharp 3.119.2. A quick benchmark on macOS arm64 shows:\n\n| Pattern | Time (10K frames, 800\u00D7600) | Per Frame |\n|---------|---------------------------|-----------|\n| New SKSurface per frame | 457 ms | ~45.7 \u00B5s |\n| Reuse SKSurface | 301 ms | ~30.1 \u00B5s |\n| Isolated Create/Dispose | 109 ms | ~10.9 \u00B5s |\n\nReusing the surface yields **~52% speedup** per frame by eliminating the ~10.9 \u00B5s Create/Dispose overhead.\n\nAll view implementations except GTK3 still create \u0060SKSurface\u0060 per frame (\u0060using (var surface = SKSurface.Create(...))\u0060 pattern). The GTK3 \u0060SKDrawingArea\u0060 caches the surface as a field and only recreates on resize \u2014 this pattern could be applied to other platforms.\n\n**Affected views:** WPF (\u0060SKElement\u0060), WinForms (\u0060SKControl\u0060), WinUI (\u0060SKXamlCanvas\u0060), Blazor (\u0060SKCanvasView\u0060), Apple (\u0060SKCGSurfaceFactory\u0060), Android (\u0060SurfaceFactory\u0060), Tizen.",
      "summary": "Benchmark validates that SKSurface.Create() has measurable per-frame overhead; enhancement still applicable."
    },
    "actionability": {
      "suggestedAction": "keep-open",
      "confidence": 0.9,
      "reason": "Enhancement remains valid and unaddressed. Benchmark confirms SKSurface.Create() has ~10.85 \u00B5s overhead per call (52% faster with reuse). All views except GTK3 still create per-frame surfaces on main."
    },
    "workarounds": [
      "For custom views, cache SKSurface as a field and only recreate when dimensions change (following GTK3\u0027s SKDrawingArea pattern)."
    ],
    "actions": [
      {
        "type": "update-labels",
        "description": "Existing labels type/enhancement and area/SkiaSharp.Views are correct. Consider adding tenet/performance.",
        "risk": "low",
        "confidence": 0.9,
        "labels": [
          "type/enhancement",
          "area/SkiaSharp.Views",
          "tenet/performance"
        ]
      },
      {
        "type": "link-related",
        "description": "Link #1251 which reports similar per-frame allocation concerns for SKSwapChainPanel",
        "risk": "low",
        "confidence": 0.85,
        "linkedIssue": 1251
      }
    ]
  }
}