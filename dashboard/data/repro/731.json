{
  "meta": {
    "schemaVersion": "1.0",
    "number": 731,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T17:30:00Z"
  },
  "conclusion": "partial",
  "notes": "Reporter claims SKShader.CreateRadialGradient is very slow in SkiaSharp 1.68.0 compared to 1.60.3, while linear and sweep gradients are fast. Could not test the exact reporter versions (1.68.0 and 1.60.3) because their NuGet packages only include x86_64 macOS native libraries and no ARM64 .NET SDK is available. However, on SkiaSharp 2.88.9, radial gradient drawing (800x800 bitmap, 200 iterations) is ~5x slower than linear gradient (0.778ms vs 0.158ms median), corroborating the reporter\u0027s observation that radial is disproportionately slow. On SkiaSharp 3.116.1 and main (source), the radial/linear ratio drops to ~1.05-1.09x, suggesting the performance gap has been resolved by newer upstream Skia builds. The issue is in the native Skia raster pipeline, not in the C# wrapper layer.",
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Check NuGet package compatibility for reporter\u0027s version (1.68.0). Inspect nupkg for TFMs and native binary architectures.",
      "layer": "setup",
      "command": "curl -sLo /tmp/check168.nupkg \u0027https://api.nuget.org/v3-flatcontainer/skiasharp/1.68.0/skiasharp.1.68.0.nupkg\u0027 \u0026\u0026 unzip -l /tmp/check168.nupkg | grep -E \u0027runtimes/osx\u0027",
      "exitCode": 0,
      "output": "7224240  12-02-2018 22:21   runtimes/osx/native/libSkiaSharp.dylib\nfile: Mach-O universal binary with 1 architecture: [x86_64]",
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Check NuGet package compatibility for \u0027last known good\u0027 version (1.60.3). Inspect nupkg for native binary architectures.",
      "layer": "setup",
      "command": "curl -sLo /tmp/check160.nupkg \u0027https://api.nuget.org/v3-flatcontainer/skiasharp/1.60.3/skiasharp.1.60.3.nupkg\u0027 \u0026\u0026 file extracted dylib",
      "exitCode": 0,
      "output": "libSkiaSharp.dylib: Mach-O universal binary with 2 architectures: [i386] [x86_64]",
      "result": "skip"
    },
    {
      "stepNumber": 3,
      "description": "Create standalone console project and benchmark gradient performance with SkiaSharp 2.88.9 (earliest testable version with ARM64 native). Measures radial vs linear vs sweep vs solid color drawing on 800x800 bitmap over 200 iterations.",
      "layer": "csharp",
      "command": "cd /tmp/repro-731/Repro \u0026\u0026 dotnet run -c Release",
      "exitCode": 0,
      "output": "SkiaSharp version: 2.88.0.0\nRuntime: .NET 8.0.23\nArchitecture: Arm64\nOS: Darwin 25.2.0\n\nResults (200 iterations, 800x800 bitmap):\n  Solid color:     avg=0.052ms  median=0.051ms\n  Linear gradient: avg=0.161ms  median=0.158ms\n  Sweep gradient:  avg=1.282ms  median=1.276ms\n  Radial gradient: avg=0.786ms  median=0.778ms\n\nRadial/Linear ratio: 4.94x\nRadial/Sweep ratio:  0.61x\nRadial/Solid ratio:  15.40x",
      "filesCreated": [
        {
          "filename": "Repro.csproj",
          "description": "Console project file targeting net8.0 with SkiaSharp package reference",
          "content": "\u003CProject Sdk=\u0022Microsoft.NET.Sdk\u0022\u003E\n  \u003CPropertyGroup\u003E\n    \u003COutputType\u003EExe\u003C/OutputType\u003E\n    \u003CTargetFramework\u003Enet8.0\u003C/TargetFramework\u003E\n    \u003CImplicitUsings\u003Eenable\u003C/ImplicitUsings\u003E\n    \u003CNullable\u003Eenable\u003C/Nullable\u003E\n  \u003C/PropertyGroup\u003E\n  \u003CItemGroup\u003E\n    \u003CPackageReference Include=\u0022SkiaSharp\u0022 Version=\u00222.88.9\u0022 /\u003E\n  \u003C/ItemGroup\u003E\n\u003C/Project\u003E"
        },
        {
          "filename": "Program.cs",
          "description": "Benchmark comparing radial, linear, sweep gradient and solid color drawing performance over 200 iterations on 800x800 bitmap",
          "content": "using System;\nusing System.Diagnostics;\nusing SkiaSharp;\n\nconst int Iterations = 200;\nconst int Width = 800;\nconst int Height = 800;\n\nConsole.WriteLine($\u0022SkiaSharp version: {typeof(SKCanvas).Assembly.GetName().Version}\u0022);\nConsole.WriteLine($\u0022Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\u0022);\nConsole.WriteLine($\u0022Architecture: {System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture}\u0022);\nConsole.WriteLine($\u0022OS: {System.Runtime.InteropServices.RuntimeInformation.OSDescription}\u0022);\nConsole.WriteLine();\n\nusing (var warmup = new SKBitmap(1, 1))\nusing (var warmupCanvas = new SKCanvas(warmup))\n    warmupCanvas.Clear(SKColors.White);\n\nvar radialTimes = new double[Iterations];\nfor (int i = 0; i \u003C Iterations; i\u002B\u002B)\n{\n    using var bitmap = new SKBitmap(Width, Height);\n    using var canvas = new SKCanvas(bitmap);\n    canvas.Clear(SKColors.White);\n    var sw = Stopwatch.StartNew();\n    using (var paint = new SKPaint())\n    {\n        paint.Shader = SKShader.CreateRadialGradient(\n            new SKPoint(Width / 2f, Height / 2f),\n            Math.Max(Width, Height) / 2f,\n            new SKColor[] { SKColors.Black, SKColors.White },\n            null, SKShaderTileMode.Clamp);\n        canvas.DrawRect(new SKRect(0, 0, Width, Height), paint);\n    }\n    sw.Stop();\n    radialTimes[i] = sw.Elapsed.TotalMilliseconds;\n}\n\nvar linearTimes = new double[Iterations];\nfor (int i = 0; i \u003C Iterations; i\u002B\u002B)\n{\n    using var bitmap = new SKBitmap(Width, Height);\n    using var canvas = new SKCanvas(bitmap);\n    canvas.Clear(SKColors.White);\n    var sw = Stopwatch.StartNew();\n    using (var paint = new SKPaint())\n    {\n        paint.Shader = SKShader.CreateLinearGradient(\n            new SKPoint(0, 0), new SKPoint(Width, Height),\n            new SKColor[] { SKColors.Black, SKColors.White },\n            null, SKShaderTileMode.Clamp);\n        canvas.DrawRect(new SKRect(0, 0, Width, Height), paint);\n    }\n    sw.Stop();\n    linearTimes[i] = sw.Elapsed.TotalMilliseconds;\n}\n\nvar sweepTimes = new double[Iterations];\nfor (int i = 0; i \u003C Iterations; i\u002B\u002B)\n{\n    using var bitmap = new SKBitmap(Width, Height);\n    using var canvas = new SKCanvas(bitmap);\n    canvas.Clear(SKColors.White);\n    var sw = Stopwatch.StartNew();\n    using (var paint = new SKPaint())\n    {\n        paint.Shader = SKShader.CreateSweepGradient(\n            new SKPoint(Width / 2f, Height / 2f),\n            new SKColor[] { SKColors.Black, SKColors.White });\n        canvas.DrawRect(new SKRect(0, 0, Width, Height), paint);\n    }\n    sw.Stop();\n    sweepTimes[i] = sw.Elapsed.TotalMilliseconds;\n}\n\nvar solidTimes = new double[Iterations];\nfor (int i = 0; i \u003C Iterations; i\u002B\u002B)\n{\n    using var bitmap = new SKBitmap(Width, Height);\n    using var canvas = new SKCanvas(bitmap);\n    canvas.Clear(SKColors.White);\n    var sw = Stopwatch.StartNew();\n    using (var paint = new SKPaint())\n    {\n        paint.Color = SKColors.Blue;\n        canvas.DrawRect(new SKRect(0, 0, Width, Height), paint);\n    }\n    sw.Stop();\n    solidTimes[i] = sw.Elapsed.TotalMilliseconds;\n}\n\nstatic double Median(double[] arr) { var sorted = (double[])arr.Clone(); Array.Sort(sorted); int mid = sorted.Length / 2; return sorted.Length % 2 == 0 ? (sorted[mid - 1] \u002B sorted[mid]) / 2.0 : sorted[mid]; }\nstatic double Average(double[] arr) { double sum = 0; for (int i = 0; i \u003C arr.Length; i\u002B\u002B) sum \u002B= arr[i]; return sum / arr.Length; }\n\nConsole.WriteLine($\u0022Results ({Iterations} iterations, {Width}x{Height} bitmap):\u0022);\nConsole.WriteLine($\u0022  Solid color:     avg={Average(solidTimes):F3}ms  median={Median(solidTimes):F3}ms\u0022);\nConsole.WriteLine($\u0022  Linear gradient: avg={Average(linearTimes):F3}ms  median={Median(linearTimes):F3}ms\u0022);\nConsole.WriteLine($\u0022  Sweep gradient:  avg={Average(sweepTimes):F3}ms  median={Median(sweepTimes):F3}ms\u0022);\nConsole.WriteLine($\u0022  Radial gradient: avg={Average(radialTimes):F3}ms  median={Median(radialTimes):F3}ms\u0022);\nConsole.WriteLine();\nConsole.WriteLine($\u0022Radial/Linear ratio: {Median(radialTimes) / Median(linearTimes):F2}x\u0022);\nConsole.WriteLine($\u0022Radial/Sweep ratio:  {Median(radialTimes) / Median(sweepTimes):F2}x\u0022);\nConsole.WriteLine($\u0022Radial/Solid ratio:  {Median(radialTimes) / Median(solidTimes):F2}x\u0022);"
        }
      ],
      "result": "wrong-output"
    },
    {
      "stepNumber": 4,
      "description": "Test with SkiaSharp 3.116.1 (latest stable) to check if performance gap still exists.",
      "layer": "csharp",
      "command": "dotnet remove package SkiaSharp \u0026\u0026 dotnet add package SkiaSharp --version 3.116.1 \u0026\u0026 dotnet run -c Release",
      "exitCode": 0,
      "output": "SkiaSharp version: 3.116.0.0\nRuntime: .NET 8.0.23\nArchitecture: Arm64\n\nResults (200 iterations, 800x800 bitmap):\n  Solid color:     avg=0.042ms  median=0.038ms\n  Linear gradient: avg=0.755ms  median=0.736ms\n  Sweep gradient:  avg=1.323ms  median=1.290ms\n  Radial gradient: avg=0.790ms  median=0.774ms\n\nRadial/Linear ratio: 1.05x\nRadial/Sweep ratio:  0.60x\nRadial/Solid ratio:  20.41x",
      "result": "success"
    },
    {
      "stepNumber": 5,
      "description": "Test on main (source build) with xUnit test infrastructure to check if performance gap exists on latest development code.",
      "layer": "csharp",
      "command": "dotnet test tests/SkiaSharp.Tests.Console/SkiaSharp.Tests.Console.csproj -c Release --filter \u0027FullyQualifiedName~SKShaderPerfTest731\u0027",
      "exitCode": 0,
      "output": "Radial avg: 0.845ms\nLinear avg: 0.772ms\nSweep avg: 1.292ms\nRadial/Linear ratio: 1.09x\n\nPassed SKShaderPerfTest731.RadialGradientPerformanceComparison [627 ms]",
      "result": "success"
    }
  ],
  "environment": {
    "os": "macOS 26.2",
    "arch": "arm64",
    "dotnetVersion": "8.0.417",
    "skiaSharpVersion": "2.88.9",
    "dockerUsed": false
  },
  "assessment": "likely-bug",
  "reproductionTime": "~10 minutes",
  "versionResults": [
    {
      "version": "1.60.3",
      "source": "nuget",
      "result": "not-tested",
      "notes": "NuGet package only contains x86_64 macOS native library; cannot load on ARM64"
    },
    {
      "version": "1.68.0",
      "source": "nuget",
      "result": "not-tested",
      "notes": "NuGet package only contains x86_64 macOS native library; cannot load on ARM64"
    },
    {
      "version": "2.88.9",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Radial gradient is ~5x slower than linear gradient (0.778ms vs 0.158ms median, 200 iterations, 800x800 bitmap). Corroborates reporter\u0027s observation."
    },
    {
      "version": "3.116.1",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "Radial/Linear ratio is 1.05x \u2014 performance gap resolved. All gradient types have similar performance."
    },
    {
      "version": "main (source)",
      "source": "source",
      "result": "not-reproduced",
      "notes": "Radial/Linear ratio is 1.09x \u2014 performance is similar across gradient types. Issue resolved on main."
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "2.88.9"
      }
    ]
  },
  "blockers": [
    "Cannot test reporter\u0027s exact version (1.68.0) \u2014 NuGet package contains only x86_64 macOS native library, current environment is macOS ARM64 with no x64 .NET SDK installed",
    "Cannot test reporter\u0027s \u0027last known good\u0027 version (1.60.3) \u2014 same x86_64-only limitation",
    "Reporter\u0027s platform is Windows Forms .NET Framework 4.6.1 \u2014 current environment is macOS ARM64 .NET 8"
  ]
}