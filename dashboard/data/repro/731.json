{
  "meta": {
    "schemaVersion": "1.0",
    "number": 731,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T15:55:00Z"
  },
  "conclusion": "reproduced",
  "notes": "Confirmed: SKShader.CreateRadialGradient is ~181x slower than CreateLinearGradient in SkiaSharp 1.68.0 (22.1ms vs 0.12ms avg per 500x500 fill). Interestingly, CreateSweepGradient is equally slow (~22.7ms), contradicting the reporter\u0027s claim that only radial was affected. The regression is in the upstream Skia native layer. Fixed in SkiaSharp 3.119.2 where all gradient types perform similarly (~1.5-1.8ms avg). Upgrading to any modern SkiaSharp version resolves the issue.",
  "reproductionSteps": [
    {
      "stepNumber": 1,
      "description": "Create console project with SkiaSharp 1.68.0 in Docker linux/amd64 (1.68.0 lacks macOS ARM64 natives)",
      "layer": "setup",
      "command": "docker run --rm --platform linux/amd64 mcr.microsoft.com/dotnet/sdk:8.0 bash -c \u0027apt-get update -qq \u0026\u0026 apt-get install -y -qq libfontconfig1 \u0026\u0026 mkdir -p /tmp/repro \u0026\u0026 cd /tmp/repro \u0026\u0026 dotnet new console -n Repro --framework net8.0 \u0026\u0026 cd Repro \u0026\u0026 dotnet add package SkiaSharp --version 1.68.0 \u0026\u0026 dotnet add package SkiaSharp.NativeAssets.Linux --version 1.68.0\u0027",
      "exitCode": 0,
      "output": "Restored /tmp/repro/Repro/Repro.csproj (in 21.08 sec).",
      "filesCreated": [
        {
          "filename": "Program.cs",
          "description": "Benchmark comparing radial, linear, sweep gradients and solid color baseline on 500x500 canvas with 100 iterations",
          "content": "using System;\nusing System.Diagnostics;\nusing SkiaSharp;\n\nconst int WIDTH = 500;\nconst int HEIGHT = 500;\nconst int WARMUP = 5;\nconst int ITERATIONS = 100;\n\nConsole.WriteLine($\u0022SkiaSharp Version: {typeof(SKBitmap).Assembly.GetName().Version}\u0022);\nConsole.WriteLine($\u0022Runtime: {System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription}\u0022);\nConsole.WriteLine($\u0022OS: {System.Runtime.InteropServices.RuntimeInformation.OSDescription}\u0022);\nConsole.WriteLine($\u0022Arch: {System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture}\u0022);\nConsole.WriteLine();\n\nusing var bitmap = new SKBitmap(WIDTH, HEIGHT);\nusing var canvas = new SKCanvas(bitmap);\nvar rect = new SKRect(0, 0, WIDTH, HEIGHT);\nvar colors = new SKColor[] { SKColors.Black, SKColors.White };\n\nusing var radialShader = SKShader.CreateRadialGradient(\n    new SKPoint(WIDTH / 2f, HEIGHT / 2f),\n    WIDTH / 2f,\n    colors, null, SKShaderTileMode.Clamp);\n\nusing var linearShader = SKShader.CreateLinearGradient(\n    new SKPoint(0, 0), new SKPoint(WIDTH, HEIGHT),\n    colors, null, SKShaderTileMode.Clamp);\n\nusing var sweepShader = SKShader.CreateSweepGradient(\n    new SKPoint(WIDTH / 2f, HEIGHT / 2f),\n    colors, null);\n\nvoid Benchmark(string name, SKShader shader)\n{\n    using var paint = new SKPaint();\n    paint.Shader = shader;\n    for (int i = 0; i \u003C WARMUP; i\u002B\u002B)\n    {\n        canvas.Clear(SKColors.Transparent);\n        canvas.DrawRect(rect, paint);\n    }\n    var sw = Stopwatch.StartNew();\n    for (int i = 0; i \u003C ITERATIONS; i\u002B\u002B)\n    {\n        canvas.Clear(SKColors.Transparent);\n        canvas.DrawRect(rect, paint);\n    }\n    sw.Stop();\n    double avgMs = sw.Elapsed.TotalMilliseconds / ITERATIONS;\n    Console.WriteLine($\u0022{name,-25} {ITERATIONS} iters: {sw.Elapsed.TotalMilliseconds:F1}ms total, {avgMs:F3}ms avg\u0022);\n}\n\nConsole.WriteLine($\u0022Canvas: {WIDTH}x{HEIGHT}, Warmup: {WARMUP}, Iterations: {ITERATIONS}\u0022);\nConsole.WriteLine(new string(\u0027-\u0027, 70));\n\nBenchmark(\u0022RadialGradient\u0022, radialShader);\nBenchmark(\u0022LinearGradient\u0022, linearShader);\nBenchmark(\u0022SweepGradient\u0022, sweepShader);\n\nusing (var solidPaint = new SKPaint { Color = SKColors.Blue })\n{\n    var sw2 = Stopwatch.StartNew();\n    for (int i = 0; i \u003C ITERATIONS; i\u002B\u002B)\n    {\n        canvas.Clear(SKColors.Transparent);\n        canvas.DrawRect(rect, solidPaint);\n    }\n    sw2.Stop();\n    Console.WriteLine($\u0022{\u0022SolidColor (baseline)\u0022,-25} {ITERATIONS} iters: {sw2.Elapsed.TotalMilliseconds:F1}ms total, {sw2.Elapsed.TotalMilliseconds / ITERATIONS:F3}ms avg\u0022);\n}\n\nConsole.WriteLine();\nConsole.WriteLine(\u0022SUCCESS: benchmark completed\u0022);"
        }
      ],
      "result": "success"
    },
    {
      "stepNumber": 2,
      "description": "Run gradient performance benchmark with SkiaSharp 1.68.0 \u2014 radial gradient is ~181x slower than linear",
      "layer": "csharp",
      "command": "dotnet run -c Release",
      "exitCode": 0,
      "output": "SkiaSharp Version: 1.68.0.0\nRuntime: .NET 8.0.24\nOS: Debian GNU/Linux 12 (bookworm)\nArch: X64\n\nCanvas: 500x500, Warmup: 5, Iterations: 100\n----------------------------------------------------------------------\nRadialGradient            100 iters: 2208.7ms total, 22.087ms avg\nLinearGradient            100 iters: 12.2ms total, 0.122ms avg\nSweepGradient             100 iters: 2273.4ms total, 22.734ms avg\nSolidColor (baseline)     100 iters: 4.6ms total, 0.046ms avg\n\nSUCCESS: benchmark completed",
      "result": "wrong-output"
    },
    {
      "stepNumber": 3,
      "description": "Run same benchmark with SkiaSharp 3.119.2 (latest stable) \u2014 all gradient types perform similarly, regression is fixed",
      "layer": "csharp",
      "command": "dotnet run -c Release (with SkiaSharp 3.119.2)",
      "exitCode": 0,
      "output": "SkiaSharp Version: 3.119.0.0\nRuntime: .NET 8.0.24\nOS: Debian GNU/Linux 12 (bookworm)\nArch: X64\n\nCanvas: 500x500, Warmup: 5, Iterations: 100\n----------------------------------------------------------------------\nRadialGradient            100 iters: 175.5ms total, 1.755ms avg\nLinearGradient            100 iters: 145.5ms total, 1.455ms avg\nSweepGradient             100 iters: 169.2ms total, 1.692ms avg\nSolidColor (baseline)     100 iters: 9.6ms total, 0.096ms avg\n\nSUCCESS: benchmark completed",
      "result": "success"
    }
  ],
  "environment": {
    "os": "Linux (Docker on macOS 26.2)",
    "arch": "x64",
    "dotnetVersion": "8.0.24",
    "skiaSharpVersion": "1.68.0",
    "dockerUsed": true,
    "dotnetSdkVersion": "8.0.418"
  },
  "inputs": {
    "triageFile": "ai-triage/731.json"
  },
  "assessment": "likely-bug",
  "scope": "unknown",
  "reproductionTime": "~15 minutes",
  "versionResults": [
    {
      "version": "1.68.0",
      "source": "nuget",
      "result": "reproduced",
      "notes": "Radial gradient 22.1ms avg vs linear 0.12ms avg (181x slower). Sweep gradient equally slow at 22.7ms.",
      "platform": "docker-linux-x64"
    },
    {
      "version": "3.119.2",
      "source": "nuget",
      "result": "not-reproduced",
      "notes": "All gradients perform similarly: radial 1.76ms, linear 1.46ms, sweep 1.69ms. Performance regression is fixed.",
      "platform": "docker-linux-x64"
    }
  ],
  "reproProject": {
    "type": "console",
    "tfm": "net8.0",
    "packages": [
      {
        "name": "SkiaSharp",
        "version": "1.68.0"
      },
      {
        "name": "SkiaSharp.NativeAssets.Linux",
        "version": "1.68.0"
      }
    ]
  },
  "errorMessages": {
    "primaryError": "SKShader.CreateRadialGradient performance regression: 22.1ms avg per 500x500 fill vs 0.12ms for LinearGradient (181x slower) in SkiaSharp 1.68.0"
  },
  "feedback": {
    "triageCorrections": [
      {
        "topic": "affected-gradients",
        "upstream": "Triage implied only radial gradient affected based on reporter\u0027s statement",
        "corrected": "Both radial AND sweep gradients are equally affected (~22ms avg). Reporter claimed sweep was not slow, but benchmark shows it is 186x slower than linear, same as radial."
      }
    ]
  },
  "output": {
    "proposedResponse": {
      "status": "ready",
      "body": "Thanks for reporting this! We confirmed the performance regression with \u0060SKShader.CreateRadialGradient\u0060 in SkiaSharp 1.68.0.\n\n**Benchmark results (500\u00D7500 canvas, 100 iterations, raster backend):**\n\n| Gradient Type | SkiaSharp 1.68.0 | SkiaSharp 3.119.2 |\n|--------------|-----------------|------------------|\n| RadialGradient | 22.1ms avg \u274C | 1.8ms avg \u2705 |\n| LinearGradient | 0.1ms avg | 1.5ms avg |\n| SweepGradient | 22.7ms avg \u274C | 1.7ms avg |\n| SolidColor | 0.05ms avg | 0.1ms avg |\n\nIn 1.68.0, radial (and sweep) gradients were **~181\u00D7 slower** than linear. This was a regression in the upstream Skia raster gradient code path.\n\nThe good news is this is **fully resolved** in current SkiaSharp (3.x) where all gradient types perform similarly. Upgrading to the latest SkiaSharp should fix this.\n\nIf upgrading isn\u0027t feasible on 1.68.0, you can work around it by pre-rendering the gradient to a cached \u0060SKImage\u0060:\n\n\u0060\u0060\u0060csharp\nusing var surface = SKSurface.Create(new SKImageInfo(width, height));\nusing var paint = new SKPaint();\npaint.Shader = SKShader.CreateRadialGradient(\n    new SKPoint(50, 50), 100,\n    new SKColor[] { SKColors.Black, SKColors.White },\n    null, SKShaderTileMode.Clamp);\nsurface.Canvas.DrawRect(new SKRect(0, 0, width, height), paint);\nusing var cached = surface.Snapshot();\n// Draw cached image instead of using shader directly\n\u0060\u0060\u0060",
      "summary": "Radial gradient performance regression confirmed in 1.68.0, fixed in latest 3.x"
    },
    "actionability": {
      "suggestedAction": "close-as-fixed",
      "confidence": 0.92,
      "reason": "Performance regression confirmed in 1.68.0 (radial gradient 181x slower than linear). Definitively fixed in 3.119.2 where all gradient types perform within 1.2x of each other. Issue is from 2018 and upgrading resolves it."
    },
    "workarounds": [
      "Upgrade to SkiaSharp 3.x \u2014 the radial/sweep gradient performance regression is fully resolved",
      "On 1.68.0: pre-render the gradient to an SKImage/SKBitmap once and reuse the cached result instead of applying the shader each frame"
    ],
    "actions": [
      {
        "type": "update-labels",
        "description": "Add performance tenet label",
        "risk": "low",
        "confidence": 0.95,
        "labels": [
          "type/bug",
          "os/Windows-Classic",
          "backend/Raster",
          "tenet/performance"
        ]
      },
      {
        "type": "link-related",
        "description": "Cross-reference related shader performance issue #543",
        "risk": "low",
        "confidence": 0.9,
        "linkedIssue": 543
      },
      {
        "type": "close-issue",
        "description": "Close as fixed in SkiaSharp 3.x \u2014 performance regression no longer exists",
        "risk": "medium",
        "confidence": 0.9
      }
    ]
  }
}