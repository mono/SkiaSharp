{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3440,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-12T16:52:04Z",
    "currentLabels": [
      "type/bug",
      "area/SkiaSharp.Views.Maui",
      "os/Windows-WinUI",
      "tenet/reliability"
    ]
  },
  "summary": "MAUI app using LiveCharts2 with SkiaSharp 3.119.1 crashes on certain Windows 11 systems with a COMException (Element not found) during WinRT activation of SkiaSharp.Views.WinUI.Native.PropertySetExtensions. The crash occurs in the ANGLE/OpenGL rendering path (SKSwapChainPanel) when GlesContext.CreateSurface() calls PropertySetExtensions.AddSingle() to set EGL surface properties. The WinRT runtime cannot locate or activate the native C\u002B\u002B/WinRT component, suggesting a deployment or WinRT registration issue specific to certain machine configurations.",
  "classification": {
    "type": {
      "value": "type/bug",
      "confidence": 0.95
    },
    "area": {
      "value": "area/SkiaSharp.Views.Maui",
      "confidence": 0.85
    },
    "platforms": [
      "os/Windows-WinUI"
    ],
    "backends": [
      "backend/OpenGL"
    ],
    "tenets": [
      "tenet/reliability"
    ],
    "partner": "partner/maui"
  },
  "evidence": {
    "reproEvidence": {
      "stepsToReproduce": [
        "Create a MAUI app with LiveCharts2 that uses SkiaSharp for rendering",
        "Deploy to certain Windows 11 systems (Lenovo 83C4 confirmed)",
        "Observe crash when the chart control loads and attempts GL rendering"
      ],
      "codeSnippets": [
        "\u003CliveCharts:CartesianChart x:Name=\u0022Graph\u0022 AbsoluteLayout.LayoutBounds=\u00220,0,1,1\u0022 AbsoluteLayout.LayoutFlags=\u0022PositionProportional,SizeProportional\u0022 ZoomMode=\u0022None\u0022 EasingFunction=\u0022{x:Null}\u0022 /\u003E"
      ],
      "environmentDetails": "Windows 11 (10.0.26100.7462), Lenovo 83C4 (IdeaPad), SkiaSharp 3.119.1, MAUI with LiveCharts2",
      "relatedIssues": [
        2948
      ]
    },
    "bugSignals": {
      "severity": "high",
      "isRegression": false,
      "errorType": "COMException / TypeInitializationException",
      "errorMessage": "System.Runtime.InteropServices.COMException: Element not found. The type initializer for \u0027SkiaSharp.Views.WinUI.Native.PropertySetExtensions\u0027 threw an exception.",
      "stackTrace": "System.Runtime.InteropServices.COMException: Element not found.\n  at void Marshal.ThrowExceptionForHR(int errorCode)()\n  at new BaseActivationFactory(string typeNamespace, string typeFullName)()\n  at static PropertySetExtensions()()\nSystem.TypeInitializationException:\n  at IObjectReference PropertySetExtensions.get__objRef_global__SkiaSharp_Views_WinUI_Native_IPropertySetExtensionsStatics()()\n  at void PropertySetExtensions.AddSingle(PropertySet propertySet, string key, float value)()\n  at void GlesContext.CreateSurface(SwapChainPanel panel, Size? renderSurfaceSize, float? resolutionScale)()\n  at void AngleSwapChainPanel.EnsureRenderSurface()()\n  at void AngleSwapChainPanel.OnLoaded(object sender, RoutedEventArgs e)()\n  at int RoutedEventHandler.Do_Abi_Invoke(IntPtr thisPtr, IntPtr sender, IntPtr e)()",
      "reproQuality": "partial",
      "targetFrameworks": [
        "net8.0-windows10.0.19041.0"
      ]
    },
    "versionAnalysis": {
      "mentionedVersions": [
        "3.119.1"
      ],
      "currentRelevance": "likely",
      "relevanceReason": "The PropertySetExtensions WinRT component and ANGLE rendering path have not changed since 3.119.1. The native WinUI component architecture is the same on main."
    }
  },
  "analysis": {
    "summary": "The crash occurs because the WinRT runtime cannot activate the SkiaSharp.Views.WinUI.Native.PropertySetExtensions class from the native C\u002B\u002B/WinRT component DLL. This class is only used in the ANGLE/OpenGL rendering path (SKSwapChainPanel \u2192 GlesContext.CreateSurface), not in the CPU rendering path (SKXamlCanvas). LiveCharts2 appears to use the GL view (SKGLView \u2192 SKSwapChainPanel) on Windows, triggering this code path. The \u0027Element not found\u0027 COMException from BaseActivationFactory indicates the WinRT activation infrastructure cannot locate the class registration \u2014 either the native DLL is not deployed, is the wrong architecture, or the activation metadata is missing. Issue #2948 reported the identical stack trace with a different COM error (REGDB_E_CLASSNOTREG / 0x80040154) during Microsoft Store certification and was resolved externally. The \u0027certain systems\u0027 qualifier suggests an environment-specific deployment or WinRT registration issue.",
    "codeInvestigation": [
      {
        "file": "source/SkiaSharp.Views/SkiaSharp.Views.WinUI/GlesInterop/GlesContext.cs",
        "finding": "CreateSurface() calls PropertySetExtensions.AddSingle() at line 104 and PropertySetExtensions.AddSize() at line 98 to configure EGL surface creation properties. These are the call sites that trigger the WinRT activation of the native component.",
        "relevance": "direct",
        "lines": "77-114"
      },
      {
        "file": "native/winui/SkiaSharp.Views.WinUI.Native/SkiaSharp.Views.WinUI.Native/PropertySetExtensions.cpp",
        "finding": "The C\u002B\u002B/WinRT component implementation is straightforward \u2014 just wraps PropertyValue::CreateSingle() and PropertyValue::CreateSize(). The code itself is correct; the issue is WinRT activation, not the implementation.",
        "relevance": "direct",
        "lines": "1-19"
      },
      {
        "file": "native/winui/SkiaSharp.Views.WinUI.Native/SkiaSharp.Views.WinUI.Native/PropertySetExtensions.idl",
        "finding": "IDL declares the runtimeclass in namespace SkiaSharp.Views.WinUI.Native. WinRT activation requires the DLL containing this class to be findable by the activation system.",
        "relevance": "direct",
        "lines": "1-8"
      },
      {
        "file": "source/SkiaSharp.Views/SkiaSharp.Views.WinUI/AngleSwapChainPanel.cs",
        "finding": "OnLoaded creates GlesContext and calls EnsureRenderSurface(), which calls glesContext.CreateSurface(). This is the entry point from the XAML lifecycle that triggers the crash.",
        "relevance": "direct",
        "lines": "124-135"
      },
      {
        "file": "source/SkiaSharp.Views/SkiaSharp.Views.WinUI/SKXamlCanvas.cs",
        "finding": "SKXamlCanvas is entirely managed \u2014 uses WriteableBitmap for CPU rendering, no dependency on SkiaSharp.Views.WinUI.Native. Confirmed as an unaffected alternative rendering path.",
        "relevance": "related",
        "lines": "1-279"
      },
      {
        "file": "binding/SkiaSharp.NativeAssets.WinUI/SkiaSharp.NativeAssets.WinUI.csproj",
        "finding": "NativeAssets.WinUI package includes architecture-specific DLLs (x64, x86, arm64) from output/native/winui/. If this package\u0027s content is not properly deployed, the WinRT DLL will be missing.",
        "relevance": "related",
        "lines": "8-15"
      },
      {
        "file": "source/SkiaSharp.Views.Maui/SkiaSharp.Views.Maui.Core/Handlers/SKGLView/SKGLViewHandler.Windows.cs",
        "finding": "MAUI\u0027s SKGLViewHandler on Windows creates SKSwapChainPanel (the ANGLE/GL path). LiveCharts2 uses this GL view handler, causing it to hit the PropertySetExtensions activation path.",
        "relevance": "related",
        "lines": "7-13"
      }
    ],
    "rationale": "Classified as type/bug because this is a crash with a clear stack trace during normal rendering. The area is SkiaSharp.Views.Maui because the reporter uses MAUI, though the actual failure is in the WinUI views layer (SkiaSharp.Views.WinUI.Native). The crash is specific to the OpenGL/ANGLE backend path because PropertySetExtensions is only invoked during EGL surface creation in GlesContext.CreateSurface. Severity is high because it completely prevents rendering, but not critical because it only affects certain systems and only the GL path.",
    "keySignals": [
      {
        "text": "COMException: Element not found at BaseActivationFactory",
        "source": "issue body",
        "interpretation": "WinRT activation failure \u2014 the runtime cannot find the class registration for PropertySetExtensions. This is a deployment/packaging issue, not a code logic bug."
      },
      {
        "text": "crashes on certain systems",
        "source": "issue body",
        "interpretation": "Environment-specific \u2014 not all Windows deployments are affected, pointing to machine-specific factors (policy, DLL deployment, architecture)."
      },
      {
        "text": "We have tried both with HA enabled and disabled",
        "source": "issue body",
        "interpretation": "Reporter tested hardware acceleration toggle \u2014 rules out simple GPU driver issues. The problem is in WinRT component activation, not GPU rendering itself."
      },
      {
        "text": "SKGLViewHandler.Windows.cs uses SKSwapChainPanel (line 7)",
        "source": "code search",
        "interpretation": "MAUI\u0027s GL view handler on Windows creates SKSwapChainPanel, which inherits AngleSwapChainPanel, which calls PropertySetExtensions via GlesContext. LiveCharts2 likely uses the GL view path."
      },
      {
        "text": "SKCanvasViewHandler.Windows.cs uses SKXamlCanvas (line 8)",
        "source": "code search",
        "interpretation": "The CPU rendering path (SKXamlCanvas) does NOT use PropertySetExtensions at all \u2014 it\u0027s a pure managed implementation. This path would not be affected."
      },
      {
        "text": "#2948 closed: \u0027fixed by Microsoft Store adjusting their setup\u0027",
        "source": "issue #2948 comment",
        "interpretation": "Identical stack trace with different COM error code. External environment fix resolved it \u2014 further evidence this is deployment/environment, not a code bug."
      }
    ],
    "errorFingerprint": "COMException-ElementNotFound-PropertySetExtensions-WinUI",
    "workarounds": [
      "If LiveCharts2 supports it, configure the chart to use CPU rendering (SKCanvasView) instead of GPU rendering (SKGLView) to avoid the ANGLE/PropertySetExtensions code path entirely.",
      "Add an explicit PackageReference to SkiaSharp.NativeAssets.WinUI in the application project to ensure the native DLLs are deployed correctly, rather than relying on transitive references through LiveCharts2.",
      "Verify that SkiaSharp.Views.WinUI.Native.dll, libEGL.dll, and libGLESv2.dll are present in the application output directory after publish."
    ],
    "nextQuestions": [
      "Is the app deployed as packaged (MSIX) or unpackaged? Unpackaged WinUI apps may have different WinRT activation behavior.",
      "Are the native WinUI DLLs (SkiaSharp.Views.WinUI.Native.dll, libEGL.dll, libGLESv2.dll) present in the deployment output on the affected system?",
      "What is the target architecture (x64, x86, arm64) and does it match the deployed native binaries?",
      "Is the app published as framework-dependent or self-contained? Framework-dependent publish may not copy native assets correctly.",
      "Does LiveCharts2 offer a way to use SKCanvasView (CPU) instead of SKGLView (GPU) on Windows?"
    ],
    "resolution": {
      "hypothesis": "The WinRT activation of SkiaSharp.Views.WinUI.Native.PropertySetExtensions fails on certain systems because the native C\u002B\u002B/WinRT DLL is either not deployed to the output directory, is the wrong architecture, or the WinRT activation metadata is not properly registered in the app\u0027s deployment manifest. This is a deployment/packaging issue that manifests environment-specifically, similar to #2948.",
      "proposals": [
        {
          "description": "Check that SkiaSharp.Views.WinUI.Native.dll is present alongside the app executable on the failing system. If missing, add an explicit PackageReference to SkiaSharp.NativeAssets.WinUI in the application project.",
          "title": "Verify native DLL deployment",
          "codeSnippet": "\u003CPackageReference Include=\u0022SkiaSharp.NativeAssets.WinUI\u0022 Version=\u00223.119.1\u0022 /\u003E",
          "confidence": 0.65,
          "effort": "trivial"
        },
        {
          "description": "If LiveCharts2 supports it, configure the rendering to use SKCanvasView (CPU/WriteableBitmap) instead of SKGLView (ANGLE/OpenGL) on Windows. This completely avoids the PropertySetExtensions WinRT component. This is the most robust workaround since it eliminates the dependency on the native WinUI component.",
          "title": "Switch to CPU rendering path",
          "confidence": 0.8,
          "effort": "small"
        },
        {
          "description": "Replace the WinRT PropertySetExtensions component with direct P/Invoke or managed code in GlesContext.CreateSurface(). The component only does PropertyValue::CreateSingle() and PropertyValue::CreateSize() \u2014 these could potentially be done via the managed WinRT APIs without a separate native DLL, eliminating the WinRT activation requirement entirely.",
          "title": "Eliminate PropertySetExtensions dependency",
          "confidence": 0.6,
          "effort": "medium"
        }
      ],
      "recommendedProposal": "Verify native DLL deployment",
      "recommendedReason": "Most likely root cause based on #2948 precedent. Quick to verify and eliminates the most common cause of WinRT activation failures. If the DLLs are present, then the CPU rendering workaround is the next best option."
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "request-info",
      "confidence": 0.8,
      "reason": "Need to confirm whether native DLLs are present on the failing system, the deployment mode (packaged vs unpackaged, self-contained vs framework-dependent), and architecture details to diagnose the WinRT activation failure."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Labels are already correct \u2014 type/bug, area/SkiaSharp.Views.Maui, os/Windows-WinUI, tenet/reliability all apply",
        "risk": "low",
        "confidence": 0.95,
        "labels": [
          "type/bug",
          "area/SkiaSharp.Views.Maui",
          "os/Windows-WinUI",
          "tenet/reliability"
        ]
      },
      {
        "type": "add-comment",
        "description": "Request deployment details and suggest diagnostic steps",
        "risk": "high",
        "confidence": 0.8,
        "comment": "Thanks for the stack trace \u2014 this helps narrow things down.\n\nThe crash is in the WinRT activation of \u0060SkiaSharp.Views.WinUI.Native.PropertySetExtensions\u0060, which is a native C\u002B\u002B/WinRT component used only by the OpenGL/ANGLE rendering path (\u0060SKSwapChainPanel\u0060). LiveCharts2 uses this GPU-accelerated path on Windows. The \u0022Element not found\u0022 error means the WinRT runtime can\u0027t locate the component\u0027s class registration on the affected system.\n\nWe\u0027ve seen a very similar issue before (#2948) where the same stack trace appeared during Microsoft Store certification \u2014 that turned out to be an environment/deployment issue.\n\nTo help diagnose:\n1. Could you check if \u0060SkiaSharp.Views.WinUI.Native.dll\u0060 is present in your app\u0027s output directory on the affected machine?\n2. Is the app deployed as packaged (MSIX) or unpackaged?\n3. Is it published as self-contained or framework-dependent?\n4. What target architecture are you building for (x64, arm64)?\n\nAs an immediate workaround, you can try adding an explicit package reference to ensure the native assets are deployed:\n\n\u0060\u0060\u0060xml\n\u003CPackageReference Include=\u0022SkiaSharp.NativeAssets.WinUI\u0022 Version=\u00223.119.1\u0022 /\u003E\n\u0060\u0060\u0060\n\nIf LiveCharts2 supports configuring the rendering backend, switching to CPU rendering (which uses \u0060SKXamlCanvas\u0060 instead of \u0060SKSwapChainPanel\u0060) would bypass this component entirely."
      },
      {
        "type": "link-related",
        "description": "Cross-reference #2948 \u2014 identical stack trace, different COM error code",
        "risk": "low",
        "confidence": 0.9,
        "linkedIssue": 2948
      }
    ],
    "missingInfo": [
      "Whether SkiaSharp.Views.WinUI.Native.dll is present in the app\u0027s output/deployment directory on the affected system",
      "Deployment mode: packaged (MSIX) or unpackaged, self-contained or framework-dependent",
      "Target architecture (x64, x86, or arm64) of the published app",
      "Whether the issue is reproducible on a clean Windows 11 install or only on specific machines"
    ]
  }
}