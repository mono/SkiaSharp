{
  "meta": {
    "schemaVersion": "1.0",
    "number": 3490,
    "repo": "mono/SkiaSharp",
    "analyzedAt": "2026-02-13T00:14:31Z",
    "currentLabels": [
      "copilot"
    ]
  },
  "summary": "Draft PR by maintainer (mattleibow) that adds new HarfBuzzSharp C# binding APIs for OpenType font features, variable font manipulation, language matching, and buffer cloning. Updates the binding generator (CppAst 0.24.0 upgrade with compatibility fixes), regenerates HarfBuzzApi.generated.cs (\u002B89 new extern functions, -28 removed), adds 586 lines of tests across 4 test files, and includes 5 new documentation files covering migration planning and binding generation. The CI build is currently failing.",
  "classification": {
    "type": {
      "value": "type/enhancement",
      "confidence": 0.95
    },
    "area": {
      "value": "area/HarfBuzzSharp",
      "confidence": 0.98
    }
  },
  "evidence": {
    "versionAnalysis": {
      "mentionedVersions": [
        "3.119.2-pr.3490.1"
      ],
      "currentRelevance": "likely",
      "relevanceReason": "Active draft PR targeting main. Adds new API surface not yet available."
    }
  },
  "analysis": {
    "summary": "This is a large enhancement PR that modernizes the HarfBuzzSharp binding. It progresses through incremental HarfBuzz header versions (2.9.1 \u2192 3.4.0 \u2192 4.4.1 \u2192 5.3.1 \u2192 7.3.0 \u2192 8.3.0) in separate commits, adds manual C# wrappers for Face/Font/Buffer/Language, upgrades the CppAst parser to 0.24.0 with compatibility fixes (space-around-pointers normalization, suffix-const removal, signed/unsigned long long mappings, cross-platform SDK include paths), and excludes new hb_paint_/hb_color_line_ namespaces from generation. The CI build (#3.119.2-pr.3490.1) is failing. The nuget.config change adding nuget.org as an explicit source may be unintentional or could conflict with the existing dotnet-public feed.",
    "codeInvestigation": [
      {
        "file": "binding/HarfBuzzSharp/Face.cs",
        "finding": "New methods: GetName, TryGetName (with language overloads), GetAllNameEntries, GetOpenTypeLayoutScriptTags, GetOpenTypeLayoutFeatureTags, TryGetOpenTypeLayoutFeatureNameIds. All follow correct patterns: ArgumentNullException for null params, stackalloc for buffer allocation, two-pass pattern (get length then get data) for string retrieval.",
        "relevance": "direct"
      },
      {
        "file": "binding/HarfBuzzSharp/Font.cs",
        "finding": "New APIs: GetPpem/SetPpem, Ptem property, SyntheticSlant property, SetSyntheticBold/GetSyntheticBold, SetVariation (uint and string tag overloads), SetVariations (array and ReadOnlySpan overloads), NamedInstance property. String tag overload validates length == 4. All use Handle correctly via P/Invoke.",
        "relevance": "direct"
      },
      {
        "file": "binding/HarfBuzzSharp/Buffer.cs",
        "finding": "New static method CreateSimilar(Buffer source) \u2014 validates null, delegates to hb_buffer_create_similar. Returns new Buffer wrapping the native handle. Follows factory method pattern.",
        "relevance": "direct"
      },
      {
        "file": "binding/HarfBuzzSharp/Language.cs",
        "finding": "New Matches(Language specific) method \u2014 validates null, delegates to hb_language_matches. Returns bool. Correct pattern.",
        "relevance": "direct"
      },
      {
        "file": "binding/HarfBuzzSharp/Definitions.cs",
        "finding": "New OpenTypeLayoutTableTag enum (Gsub, Gpos) with correct HarfBuzz tag encoding using bit shifts. New OpenTypeFeatureNameIds struct with 5 properties matching hb_ot_layout_feature_get_name_ids output parameters.",
        "relevance": "direct"
      },
      {
        "file": "utils/SkiaSharpGenerator/BaseTool.cs",
        "finding": "Three categories of changes: (1) Cross-platform SDK include path resolution for CppAst parsing (macOS, Linux, Windows). (2) Type mapping fixes: unsigned char\u2192Byte, signed char\u2192SByte, added signed/unsigned long long variants. (3) Type name normalization: remove suffix \u0027const\u0027, normalize \u0027type *\u0027 to \u0027type*\u0027 for CppAst 0.24.0 compatibility.",
        "relevance": "related"
      },
      {
        "file": "binding/libHarfBuzzSharp.json",
        "finding": "Excludes hb_paint_ and hb_color_line_ namespaces. Adds hb-paint.h to excluded headers. Adds 20\u002B paint/color_line types to excluded types. Adds hb_style_tag_t enum config. Adds generateProxy:false for 15\u002B callback function types (draw, paint).",
        "relevance": "related"
      },
      {
        "file": "nuget.config",
        "finding": "Adds explicit nuget.org source before the existing dotnet-public Azure DevOps feed. This may have been needed for the CppAst 0.24.0 NuGet package during development.",
        "relevance": "context"
      }
    ],
    "rationale": "Classified as type/enhancement because it adds substantial new API surface (OpenType layout queries, variable font controls, language matching) to an existing component. Not a feature-request (it\u0027s a PR with code). Area is area/HarfBuzzSharp since all new C# wrappers are in binding/HarfBuzzSharp/ and all new C API functions are HarfBuzz functions. No platform specificity \u2014 these are cross-platform APIs.",
    "keySignals": [
      {
        "text": "19 commits progressing through HarfBuzz header versions 2.9.1 \u2192 8.3.0",
        "source": "git log",
        "interpretation": "Methodical incremental binding update, not a one-shot change. Each commit regenerates bindings for a specific HarfBuzz version."
      },
      {
        "text": "Draft PR with failing CI build (#3.119.2-pr.3490.1)",
        "source": "GitHub PR status",
        "interpretation": "Work in progress. The build failure needs investigation before this can be reviewed for merge."
      },
      {
        "text": "\u002B89 new extern functions, -28 removed in HarfBuzzApi.generated.cs",
        "source": "diff analysis",
        "interpretation": "Significant API surface change. Removed functions may indicate renamed/refactored HarfBuzz C API entries across versions."
      },
      {
        "text": "CppAst upgraded from older version to 0.24.0 with space-around-pointer normalization",
        "source": "utils/SkiaSharpGenerator/BaseTool.cs diff",
        "interpretation": "Generator compatibility fix \u2014 CppAst 0.24.0 changes type display names, requiring normalization of pointer syntax."
      },
      {
        "text": "hb_paint_ and hb_color_line_ namespaces excluded from generation",
        "source": "binding/libHarfBuzzSharp.json diff",
        "interpretation": "Paint/color-line APIs intentionally deferred \u2014 complex callback-heavy APIs not yet ready for binding."
      },
      {
        "text": "586 lines of new tests across 4 files",
        "source": "diff stat",
        "interpretation": "Good test coverage for new APIs. Tests cover Buffer.CreateSimilar, Language.Matches, Face OpenType queries, Font variable/synthetic properties."
      }
    ],
    "nextQuestions": [
      "What is the CI build failure? Need to check Azure DevOps build logs for #3.119.2-pr.3490.1.",
      "Are the 28 removed extern functions expected removals (API renames across HarfBuzz versions) or accidental losses?",
      "Is the nuget.config change intentional for the final PR or a development artifact?",
      "The SkiaApi.generated.cs shows 990 lines changed \u2014 are those just comment/formatting changes from the CppAst upgrade or actual signature changes?",
      "Should the hb_paint_/hb_color_line_ APIs be tracked as a follow-up issue?"
    ],
    "resolution": {
      "hypothesis": "This is a well-structured enhancement PR that methodically updates HarfBuzzSharp bindings. The CI failure is the primary blocker. The generator changes (CppAst 0.24.0) affect both HarfBuzzSharp and SkiaSharp generated files.",
      "proposals": [
        {
          "description": "Investigate the Azure DevOps build failure for #3.119.2-pr.3490.1. This is the primary blocker for the PR.",
          "title": "Fix CI build failure",
          "confidence": 0.9,
          "effort": "small"
        },
        {
          "description": "Audit the 28 removed extern functions in HarfBuzzApi.generated.cs to confirm they are expected API renames/removals across HarfBuzz versions and not accidental losses.",
          "title": "Verify removed extern functions",
          "confidence": 0.7,
          "effort": "small"
        },
        {
          "description": "Determine if the nuget.org source addition is needed for the final PR or should be reverted as a development artifact.",
          "title": "Review nuget.config change",
          "confidence": 0.6,
          "effort": "trivial"
        },
        {
          "description": "Create a follow-up issue to track the intentionally excluded hb_paint_ and hb_color_line_ APIs for future binding work.",
          "title": "Track deferred paint APIs",
          "confidence": 0.5,
          "effort": "trivial"
        }
      ],
      "recommendedProposal": "Fix CI build failure",
      "recommendedReason": "The build failure is the only hard blocker. All other items are review observations that can be addressed during code review."
    }
  },
  "output": {
    "actionability": {
      "suggestedAction": "needs-investigation",
      "confidence": 0.9,
      "reason": "Draft PR with failing CI. Needs build failure diagnosis before it can proceed to review."
    },
    "actions": [
      {
        "type": "update-labels",
        "description": "Apply enhancement and HarfBuzzSharp labels",
        "risk": "low",
        "confidence": 0.95,
        "labels": [
          "type/enhancement",
          "area/HarfBuzzSharp"
        ]
      }
    ]
  }
}